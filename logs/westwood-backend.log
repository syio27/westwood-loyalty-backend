2026-01-06 00:00:36.790  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m52s11ms).
2026-01-06 00:54:05.368  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 00:54:05.378  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:54:05.382  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:54:06.414  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 93648 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:54:06.415 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:54:06.416  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:54:06.729  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:54:06.758  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 24 ms. Found 7 JPA repository interfaces.
2026-01-06 00:54:07.195  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:54:07.202  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:54:07.202  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:54:07.232  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:54:07.233  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 790 ms
2026-01-06 00:54:07.255  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:54:07.343  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:54:07.344  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:54:07.349  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:54:07.470  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:54:07.472  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:54:07.483  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:54:07.485  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.009s)
2026-01-06 00:54:07.489  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:54:07.508  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:54:07.511  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:54:07.527  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:54:07.536  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:54:07.545  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:54:07.556  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:54:07.562  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:54:07.575  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:54:07.588  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:54:07.596  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:54:07.600  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:54:07.613 ERROR [main] [] o.f.core.internal.command.DbMigrate      : Migration of schema "PUBLIC" to version "10 - add referral fields to clients" failed! Please restore backups and roll back database and code!
2026-01-06 00:54:07.617 ERROR [main] [] o.s.b.web.embedded.tomcat.TomcatStarter  : Error starting Tomcat context. Exception: org.springframework.beans.factory.UnsatisfiedDependencyException. Message: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
2026-01-06 00:54:07.636  INFO [main] [] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2026-01-06 00:54:07.639  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Unable to start web server
2026-01-06 00:54:07.639  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:54:07.662  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:54:07.667  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 00:54:07.675 ERROR [main] [] o.s.boot.SpringApplication               : Application run failed

org.springframework.context.ApplicationContextException: Unable to start web server
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:165)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:619)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:335)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)
	at com.westwood.WestwoodBackendApplication.main(WestwoodBackendApplication.java:12)
Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:147)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:516)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:222)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:188)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:162)
	... 8 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:205)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:211)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:174)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:169)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAdaptableBeans(ServletContextInitializerBeans.java:154)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:87)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:266)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:240)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:415)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:437)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	... 13 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 54 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1705)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1454)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 68 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpaSharedEM_entityManagerFactory': Cannot resolve reference to bean 'entityManagerFactory' while setting constructor argument
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:682)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1185)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 82 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1806)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 94 common frames omitted
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate$1.call(TableLockingExecutionTemplate.java:36)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate.execute(TableLockingExecutionTemplate.java:31)
	at org.flywaydb.core.internal.database.base.Connection.lock(Connection.java:102)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:145)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:202)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:205)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:147)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1853)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1802)
	... 103 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:252)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:214)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:133)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:65)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 121 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:514)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:489)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.getSyntaxError(DbException.java:247)
	at org.h2.command.ParserBase.getSyntaxError(ParserBase.java:748)
	at org.h2.command.Parser.prepareCommand(Parser.java:486)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:639)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:559)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1166)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:245)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:231)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:210)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:89)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:206)
	... 127 common frames omitted

2026-01-06 00:55:57.916  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 93848 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:55:57.917 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:55:57.917  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:55:58.105  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:55:58.123  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 00:55:58.439  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:55:58.444  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:55:58.445  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:55:58.464  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:55:58.464  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 530 ms
2026-01-06 00:55:58.481  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:55:58.555  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:55:58.556  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:55:58.559  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:55:58.634  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:55:58.636  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:55:58.643  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:55:58.644  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.005s)
2026-01-06 00:55:58.646  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:55:58.658  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:55:58.660  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:55:58.669  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:55:58.673  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:55:58.677  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:55:58.682  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:55:58.685  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:55:58.692  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:55:58.700  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:55:58.703  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:55:58.705  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:55:58.712 ERROR [main] [] o.f.core.internal.command.DbMigrate      : Migration of schema "PUBLIC" to version "10 - add referral fields to clients" failed! Please restore backups and roll back database and code!
2026-01-06 00:55:58.715 ERROR [main] [] o.s.b.web.embedded.tomcat.TomcatStarter  : Error starting Tomcat context. Exception: org.springframework.beans.factory.UnsatisfiedDependencyException. Message: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
2026-01-06 00:55:58.723  INFO [main] [] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2026-01-06 00:55:58.724  WARN [main] [] o.a.c.loader.WebappClassLoaderBase       : The web application [ROOT] appears to have started a thread named [HikariPool-1 connection adder] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 java.base@17.0.10/java.lang.Thread.sleep(Native Method)
 app//com.zaxxer.hikari.util.UtilityElf.quietlySleep(UtilityElf.java:53)
 app//com.zaxxer.hikari.pool.HikariPool$PoolEntryCreator.call(HikariPool.java:729)
 app//com.zaxxer.hikari.pool.HikariPool$PoolEntryCreator.call(HikariPool.java:703)
 java.base@17.0.10/java.util.concurrent.FutureTask.run(FutureTask.java:264)
 java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
 java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
 java.base@17.0.10/java.lang.Thread.run(Thread.java:840)
2026-01-06 00:55:58.725  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Unable to start web server
2026-01-06 00:55:58.725  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:55:58.725  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:55:58.729  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 00:55:58.734 ERROR [main] [] o.s.boot.SpringApplication               : Application run failed

org.springframework.context.ApplicationContextException: Unable to start web server
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:165)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:619)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:335)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)
	at com.westwood.WestwoodBackendApplication.main(WestwoodBackendApplication.java:12)
Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:147)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:516)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:222)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:188)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:162)
	... 8 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:205)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:211)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:174)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:169)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAdaptableBeans(ServletContextInitializerBeans.java:154)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:87)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:266)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:240)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:415)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:437)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	... 13 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 54 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1705)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1454)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 68 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpaSharedEM_entityManagerFactory': Cannot resolve reference to bean 'entityManagerFactory' while setting constructor argument
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:682)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1185)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 82 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1806)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 94 common frames omitted
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate$1.call(TableLockingExecutionTemplate.java:36)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate.execute(TableLockingExecutionTemplate.java:31)
	at org.flywaydb.core.internal.database.base.Connection.lock(Connection.java:102)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:145)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:202)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:205)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:147)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1853)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1802)
	... 103 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:252)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:214)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:133)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:65)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 121 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:514)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:489)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.getSyntaxError(DbException.java:247)
	at org.h2.command.ParserBase.getSyntaxError(ParserBase.java:748)
	at org.h2.command.Parser.prepareCommand(Parser.java:486)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:639)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:559)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1166)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:245)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:231)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:210)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:89)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:206)
	... 127 common frames omitted

2026-01-06 00:57:57.553  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94039 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:57:57.554 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:57:57.555  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:57:57.765  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:57:57.785  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 7 JPA repository interfaces.
2026-01-06 00:57:58.139  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:57:58.146  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:57:58.146  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:57:58.172  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:57:58.173  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 596 ms
2026-01-06 00:57:58.192  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:57:58.275  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:57:58.275  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:57:58.279  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:57:58.399  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:57:58.403  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:57:58.419  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:57:58.421  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.012s)
2026-01-06 00:57:58.423  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:57:58.439  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:57:58.441  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:57:58.455  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:57:58.460  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:57:58.464  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:57:58.470  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:57:58.473  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:57:58.485  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:57:58.498  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:57:58.501  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:57:58.503  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:57:58.511 ERROR [main] [] o.f.core.internal.command.DbMigrate      : Migration of schema "PUBLIC" to version "10 - add referral fields to clients" failed! Please restore backups and roll back database and code!
2026-01-06 00:57:58.514 ERROR [main] [] o.s.b.web.embedded.tomcat.TomcatStarter  : Error starting Tomcat context. Exception: org.springframework.beans.factory.UnsatisfiedDependencyException. Message: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
2026-01-06 00:57:58.530  INFO [main] [] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2026-01-06 00:57:58.534  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Unable to start web server
2026-01-06 00:57:58.534  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:57:58.545  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:57:58.550  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 00:57:58.557 ERROR [main] [] o.s.boot.SpringApplication               : Application run failed

org.springframework.context.ApplicationContextException: Unable to start web server
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:165)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:619)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:335)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)
	at com.westwood.WestwoodBackendApplication.main(WestwoodBackendApplication.java:12)
Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:147)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:516)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:222)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:188)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:162)
	... 8 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:205)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:211)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:174)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:169)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAdaptableBeans(ServletContextInitializerBeans.java:154)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:87)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:266)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:240)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:415)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:437)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	... 13 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 54 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1705)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1454)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 68 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpaSharedEM_entityManagerFactory': Cannot resolve reference to bean 'entityManagerFactory' while setting constructor argument
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:682)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1185)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 82 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1806)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 94 common frames omitted
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate$1.call(TableLockingExecutionTemplate.java:36)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate.execute(TableLockingExecutionTemplate.java:31)
	at org.flywaydb.core.internal.database.base.Connection.lock(Connection.java:102)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:145)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:202)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:205)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:147)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1853)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1802)
	... 103 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:252)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:214)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:133)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:65)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 121 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:514)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:489)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.getSyntaxError(DbException.java:247)
	at org.h2.command.ParserBase.getSyntaxError(ParserBase.java:748)
	at org.h2.command.Parser.prepareCommand(Parser.java:486)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:639)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:559)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1166)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:245)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:231)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:210)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:89)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:206)
	... 127 common frames omitted

2026-01-06 00:59:06.258  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94158 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:59:06.259 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:59:06.259  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:59:06.500  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:59:06.519  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 7 JPA repository interfaces.
2026-01-06 00:59:06.879  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:59:06.886  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:59:06.887  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:59:06.911  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:59:06.911  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 626 ms
2026-01-06 00:59:06.937  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:59:07.017  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:59:07.018  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:59:07.022  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:59:07.110  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:59:07.112  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:59:07.122  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:59:07.123  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 00:59:07.125  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:59:07.138  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:59:07.140  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:59:07.149  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:59:07.153  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:59:07.157  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:59:07.162  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:59:07.165  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:59:07.173  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:59:07.182  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:59:07.185  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:59:07.187  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:59:07.191  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 00:59:07.194  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 00:59:07.200  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 00:59:07.204  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 00:59:07.212  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.039s)
2026-01-06 00:59:07.246  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 00:59:07.270  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 00:59:07.283  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 00:59:07.412  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 00:59:07.430  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 00:59:07.473  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 00:59:07.850  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 00:59:07.861 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 00:59:07.861 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 00:59:07.861 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 00:59:07.865  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 00:59:07.999 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 00:59:07.999 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 00:59:08.021  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 00:59:08.278  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 00:59:08.278  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 00:59:08.340  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 00:59:08.468 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 00:59:08.603  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 00:59:08.608  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.593 seconds (process running for 2.732)
2026-01-06 00:59:47.045  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94251 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:59:47.045 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:59:47.046  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:59:47.229  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:59:47.248  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 00:59:47.574  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:59:47.579  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:59:47.579  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:59:47.599  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:59:47.599  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 536 ms
2026-01-06 00:59:47.622  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:59:47.689  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:59:47.689  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:59:47.693  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:59:47.769  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:59:47.771  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:59:47.784  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:59:47.785  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 00:59:47.787  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:59:47.799  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:59:47.805  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:59:47.813  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:59:47.818  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:59:47.821  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:59:47.827  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:59:47.829  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:59:47.838  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:59:47.847  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:59:47.851  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:59:47.853  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:59:47.857  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 00:59:47.860  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 00:59:47.867  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 00:59:47.870  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 00:59:47.877  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.039s)
2026-01-06 00:59:47.907  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 00:59:47.926  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 00:59:47.937  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 00:59:48.028  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 00:59:48.044  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 00:59:48.082  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 00:59:48.494  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 00:59:48.505 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 00:59:48.508 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 00:59:48.508 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 00:59:48.511  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 00:59:48.649 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 00:59:48.649 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 00:59:48.671  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 00:59:48.927  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 00:59:48.927  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 00:59:48.984  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 00:59:49.100 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 00:59:49.229  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 00:59:49.235  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.363 seconds (process running for 2.496)
2026-01-06 01:04:45.229  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:04:45.242  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:04:45.245  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:07:44.971  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94550 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:07:44.972 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:07:44.972  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:07:45.196  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:07:45.222  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 22 ms. Found 7 JPA repository interfaces.
2026-01-06 01:07:45.546  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:07:45.552  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:07:45.553  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:07:45.574  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:07:45.575  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 585 ms
2026-01-06 01:07:45.602  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:07:45.669  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:07:45.670  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:07:45.673  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:07:45.754  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:07:45.756  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:07:45.767  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:07:45.768  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.008s)
2026-01-06 01:07:45.770  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:07:45.782  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:07:45.784  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:07:45.792  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:07:45.796  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:07:45.800  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:07:45.805  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:07:45.809  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:07:45.816  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:07:45.824  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:07:45.827  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:07:45.828  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:07:45.833  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:07:45.837  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:07:45.840  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:07:45.843  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:07:45.851  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.032s)
2026-01-06 01:07:45.883  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:07:45.909  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:07:45.923  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:07:46.032  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:07:46.050  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:07:46.091  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:07:46.515  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:07:46.525 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:07:46.528 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:07:46.528 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:07:46.528 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:07:46.531  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:07:46.669 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:07:46.669 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:07:46.688  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:07:46.950  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:07:46.951  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:07:47.012  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:07:47.132 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:07:47.273  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:07:47.278  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.503 seconds (process running for 2.645)
2026-01-06 01:08:19.817  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94622 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:08:19.818 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:08:19.818  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:08:20.021  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:08:20.040  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 7 JPA repository interfaces.
2026-01-06 01:08:20.375  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:08:20.381  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:08:20.381  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:08:20.405  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:08:20.406  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 566 ms
2026-01-06 01:08:20.432  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:08:20.504  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:08:20.504  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:08:20.508  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:08:20.592  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:08:20.594  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:08:20.605  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:08:20.606  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.008s)
2026-01-06 01:08:20.608  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:08:20.621  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:08:20.623  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:08:20.631  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:08:20.636  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:08:20.640  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:08:20.644  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:08:20.647  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:08:20.654  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:08:20.661  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:08:20.665  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:08:20.668  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:08:20.672  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:08:20.675  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:08:20.679  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:08:20.682  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:08:20.690  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.034s)
2026-01-06 01:08:20.724  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:08:20.748  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:08:20.761  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:08:20.864  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:08:20.881  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:08:20.922  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:08:21.317  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:08:21.326 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:08:21.328 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:08:21.328 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:08:21.333  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:21.471 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:08:21.471 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:08:21.491  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:08:21.749  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:08:21.750  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:08:21.808  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:08:21.928 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:08:22.059  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2026-01-06 01:08:22.060  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:22.061  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:08:22.062  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:08:22.067  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 01:08:22.073 ERROR [main] [] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2026-01-06 01:08:42.945  INFO [http-nio-8080-exec-1] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 01:08:42.945  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 01:08:42.948  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 2 ms
2026-01-06 01:08:42.957 DEBUG [http-nio-8080-exec-1] [bdf186ab-63fb-4431-a575-60c4914d9cfb] o.s.security.web.FilterChainProxy        : Securing GET /actuator/health
2026-01-06 01:08:42.961 DEBUG [http-nio-8080-exec-1] [bdf186ab-63fb-4431-a575-60c4914d9cfb] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:08:42.962 DEBUG [http-nio-8080-exec-1] [bdf186ab-63fb-4431-a575-60c4914d9cfb] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:08:42.968 DEBUG [http-nio-8080-exec-1] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 01:08:42.968 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:08:42.969 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:08:53.727  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94694 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:08:53.728 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:08:53.728  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:08:53.913  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:08:53.930  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 01:08:54.238  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:08:54.243  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:08:54.243  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:08:54.262  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:08:54.263  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 513 ms
2026-01-06 01:08:54.284  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:08:54.348  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:08:54.349  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:08:54.352  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:08:54.430  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:08:54.432  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:08:54.442  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:08:54.443  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:08:54.445  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:08:54.459  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:08:54.461  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:08:54.470  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:08:54.475  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:08:54.479  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:08:54.484  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:08:54.486  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:08:54.493  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:08:54.502  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:08:54.505  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:08:54.506  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:08:54.510  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:08:54.515  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:08:54.518  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:08:54.521  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:08:54.526  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.034s)
2026-01-06 01:08:54.554  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:08:54.575  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:08:54.587  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:08:54.675  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:08:54.689  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:08:54.729  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:08:55.076  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:08:55.095  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:55.229 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:08:55.229 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:08:55.247  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:08:55.499  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:08:55.500  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:08:55.556  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:08:55.670 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:08:55.790  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2026-01-06 01:08:55.792  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:55.793  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:08:55.793  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:08:55.798  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 01:08:55.803 ERROR [main] [] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2026-01-06 01:09:27.427  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94770 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:09:27.428 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:09:27.429  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:09:27.626  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:09:27.644  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 15 ms. Found 7 JPA repository interfaces.
2026-01-06 01:09:27.952  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:09:27.957  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:09:27.957  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:09:27.976  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:09:27.976  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 530 ms
2026-01-06 01:09:28.000  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:09:28.067  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:09:28.067  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:09:28.071  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:09:28.153  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:09:28.155  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:09:28.168  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:09:28.169  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.008s)
2026-01-06 01:09:28.171  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:09:28.182  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:09:28.185  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:09:28.193  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:09:28.198  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:09:28.201  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:09:28.207  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:09:28.211  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:09:28.219  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:09:28.226  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:09:28.229  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:09:28.231  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:09:28.235  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:09:28.238  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:09:28.242  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:09:28.244  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:09:28.252  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.032s)
2026-01-06 01:09:28.283  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:09:28.305  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:09:28.318  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:09:28.417  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:09:28.434  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:09:28.472  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:09:28.858  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:09:28.868 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:09:28.868 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:09:28.871 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:09:28.874  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:09:29.010 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:09:29.010 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:09:29.033  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:09:29.300  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:09:29.301  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:09:29.360  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:09:29.485 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:09:29.621  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:09:29.626  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.376 seconds (process running for 2.52)
2026-01-06 01:11:44.159  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:11:44.165  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:11:44.167  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:11:58.840  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94919 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:11:58.842 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:11:58.842  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:11:59.037  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:11:59.055  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 01:11:59.380  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:11:59.386  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:11:59.386  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:11:59.408  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:11:59.408  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 548 ms
2026-01-06 01:11:59.431  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:11:59.497  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:11:59.497  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:11:59.501  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:11:59.578  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:11:59.579  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:11:59.589  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:11:59.590  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:11:59.592  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:11:59.604  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:11:59.606  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:11:59.614  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:11:59.619  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:11:59.623  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:11:59.628  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:11:59.630  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:11:59.637  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:11:59.645  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:11:59.649  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:11:59.650  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:11:59.655  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:11:59.660  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:11:59.663  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:11:59.667  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:11:59.672  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.034s)
2026-01-06 01:11:59.703  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:11:59.728  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:11:59.741  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:11:59.838  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:11:59.854  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:11:59.892  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:12:00.259  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:12:00.268 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:12:00.271 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:12:00.271 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:12:00.271 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:12:00.274  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:12:00.402 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:12:00.402 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:12:00.423  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:12:00.677  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:12:00.678  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:12:00.737  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:12:00.849 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:12:00.982  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:12:00.987  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.351 seconds (process running for 2.486)
2026-01-06 01:13:57.686  INFO [http-nio-8080-exec-1] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 01:13:57.686  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 01:13:57.689  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 3 ms
2026-01-06 01:13:57.698 DEBUG [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/tags
2026-01-06 01:13:57.727 ERROR [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] c.w.security.JwtAuthenticationFilter     : Cannot set user authentication: {}

io.jsonwebtoken.MalformedJwtException: Invalid compact JWT string: Compact JWSs must contain exactly 2 period characters, and compact JWEs must contain exactly 4.  Found: 0
	at io.jsonwebtoken.impl.JwtTokenizer.tokenize(JwtTokenizer.java:102)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:370)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:362)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:94)
	at io.jsonwebtoken.impl.io.AbstractParser.parse(AbstractParser.java:36)
	at io.jsonwebtoken.impl.io.AbstractParser.parse(AbstractParser.java:29)
	at io.jsonwebtoken.impl.DefaultJwtParser.parseSignedClaims(DefaultJwtParser.java:821)
	at com.westwood.util.jwt.JwtUtil.extractAllClaims(JwtUtil.java:47)
	at com.westwood.util.jwt.JwtUtil.extractClaim(JwtUtil.java:39)
	at com.westwood.util.jwt.JwtUtil.extractUsername(JwtUtil.java:31)
	at com.westwood.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.westwood.config.RequestIdFilter.doFilterInternal(RequestIdFilter.java:47)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)

2026-01-06 01:13:57.729 DEBUG [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:13:57.731 DEBUG [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:13:57.734 DEBUG [http-nio-8080-exec-1] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 01:13:57.734 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:13:57.734 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:14:36.495  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 95523 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:14:36.497 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:14:36.497  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:14:36.732  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:14:36.754  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 19 ms. Found 7 JPA repository interfaces.
2026-01-06 01:14:37.118  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:14:37.125  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:14:37.125  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:14:37.157  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:14:37.157  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 644 ms
2026-01-06 01:14:37.179  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:14:37.256  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:14:37.256  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:14:37.261  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:14:37.344  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:14:37.346  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:14:37.356  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:14:37.357  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:14:37.359  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:14:37.374  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:14:37.381  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:14:37.393  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:14:37.402  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:14:37.407  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:14:37.413  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:14:37.417  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:14:37.426  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:14:37.439  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:14:37.442  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:14:37.446  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:14:37.453  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:14:37.458  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:14:37.464  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:14:37.471  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:14:37.479  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.054s)
2026-01-06 01:14:37.514  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:14:37.540  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:14:37.554  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:14:37.663  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:14:37.680  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:14:37.718  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:14:38.118  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:14:38.128 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:14:38.131 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:14:38.132 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:14:38.132 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:14:38.133 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:14:38.133 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:14:38.134 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:14:38.134 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:14:38.136 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:14:38.140  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:14:38.273 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:14:38.273 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:14:38.294  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:14:38.565  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:14:38.565  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:14:38.623  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:14:38.730 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:14:38.858  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2026-01-06 01:14:38.860  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:14:38.861  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:14:38.863  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:14:38.871  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 01:14:38.877 ERROR [main] [] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2026-01-06 01:15:18.319  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 95894 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:15:18.320 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:15:18.321  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:15:18.569  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:15:18.591  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 19 ms. Found 7 JPA repository interfaces.
2026-01-06 01:15:18.967  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:15:18.973  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:15:18.973  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:15:19.002  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:15:19.002  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 661 ms
2026-01-06 01:15:19.024  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:15:19.099  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:15:19.100  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:15:19.104  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:15:19.189  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:15:19.191  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:15:19.200  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:15:19.201  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:15:19.207  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:15:19.222  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:15:19.225  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:15:19.237  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:15:19.242  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:15:19.247  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:15:19.254  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:15:19.257  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:15:19.267  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:15:19.278  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:15:19.283  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:15:19.286  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:15:19.292  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:15:19.297  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:15:19.303  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:15:19.307  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:15:19.315  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.049s)
2026-01-06 01:15:19.458  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:15:19.479  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:15:19.491  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:15:19.606  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:15:19.623  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:15:19.661  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:15:20.036  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:15:20.046 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:15:20.050 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:15:20.050 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:15:20.052 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:15:20.056  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:15:20.202 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:15:20.202 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:15:20.225  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:15:20.496  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:15:20.496  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:15:20.555  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:15:20.662 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:15:20.792  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:15:20.797  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.71 seconds (process running for 2.887)
2026-01-06 01:16:22.575  INFO [http-nio-8080-exec-2] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 01:16:22.575  INFO [http-nio-8080-exec-2] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 01:16:22.578  INFO [http-nio-8080-exec-2] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 3 ms
2026-01-06 01:16:22.596 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/register
2026-01-06 01:16:22.602 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:16:22.606 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/register
2026-01-06 01:16:22.773 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.username=? 
    fetch
        first ? rows only
2026-01-06 01:16:22.778 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.email=? 
    fetch
        first ? rows only
2026-01-06 01:16:22.873 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    insert 
    into
        users
        (account_status, activation_token, activation_token_expiry, active, created_at, email, first_name, last_name, password, updated_at, username, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:16:22.920 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 01:16:22.921 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 01:16:31.005 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/login
2026-01-06 01:16:31.007 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:16:31.008 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/login
2026-01-06 01:16:31.299 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:16:31.304 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:16:31.379 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2026-01-06 01:16:55.181 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 01:16:55.310 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:16:55.315 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:16:55.320 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 01:17:09.314 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 01:17:09.346 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:17:09.350 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:17:09.354 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 01:17:09.371 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:09.464 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:09.466 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        c1_0.id 
    from
        clients c1_0 
    where
        c1_0.phone=? 
    fetch
        first ? rows only
2026-01-06 01:17:09.469 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 01:17:09.471 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 01:17:09.473 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 01:17:09.473 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 01:17:09.482 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0
2026-01-06 01:17:09.486 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        clients
        (client_type, created_at, date_of_birth, name, notes, phone, referral_code, referrer_id, surname, updated_at, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:17:09.489 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:17:09.492 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:17:09.505 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at desc
2026-01-06 01:17:09.509 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:17:09.510 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:17:09.511  INFO [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] c.w.service.impl.EventBonusServiceImpl   : Welcome bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:17:09.513 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 01:17:09.514 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 01:17:22.606 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/tags
2026-01-06 01:17:22.621 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:17:22.625 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:17:22.632 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/tags
2026-01-06 01:17:22.635 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllDistinctTags(); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:22.636 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllDistinctTags(); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:22.643 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0
2026-01-06 01:17:52.808 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients?tag=vip
2026-01-06 01:17:52.826 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:17:52.829 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:17:52.834 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients?tag=vip
2026-01-06 01:17:52.862 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllClients(java.lang.String,java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:52.863 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllClients(java.lang.String,java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:52.878 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    join
        client_tag t1_0 
            on c1_0.id=t1_0.client_id 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_1.name=?
2026-01-06 01:17:52.900 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:26.688 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:26.709 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:26.713 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:26.722 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:26.771 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:26.780 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:26.784 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:26.789 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:26.803 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:26.805 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:26.817 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:26.820 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:26.821 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:26.823 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:26.823 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:26.824  INFO [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:26.824 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:26.825 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.164 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:30.178 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:30.186 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:30.191 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:30.198 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.200 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.202 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.203 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:30.205 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:30.208 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.214 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.224 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.228 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.238 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:30.239 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:30.240  INFO [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.242 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.245 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.952 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:30.956 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:30.957 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:30.961 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:30.968 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.969 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.972 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.973 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:30.975 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:30.977 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.977 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.981 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.982 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.983 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:30.984 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:30.984  INFO [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.985 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.985 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:31.606 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:31.627 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:31.638 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:31.642 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:31.650 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:31.651 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:31.653 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:31.653 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:31.655 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:31.656 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:31.658 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:31.659 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:31.664 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:31.667 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:31.667 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:31.668  INFO [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:31.669 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:31.669 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:32.121 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:32.128 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:32.131 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:32.135 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:32.137 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:32.137 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:32.139 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:32.140 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:32.143 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:32.144 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:32.145 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:32.147 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:32.151 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:32.152 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:32.153 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:32.153  INFO [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:32.154 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:32.154 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:46.017 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/bonuses/client/2ab4ee44-758e-408e-81b2-eea0b3e10659/balance
2026-01-06 01:18:46.039 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:46.047 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:46.053 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/bonuses/client/2ab4ee44-758e-408e-81b2-eea0b3e10659/balance
2026-01-06 01:18:46.061 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusController.getClientBonusBalance(java.util.UUID); target is of class [com.westwood.controller.BonusController]
2026-01-06 01:18:46.065 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusController.getClientBonusBalance(java.util.UUID); target is of class [com.westwood.controller.BonusController]
2026-01-06 01:18:46.069 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:46.070 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:46.113 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at
2026-01-06 01:18:57.040 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/phone/+77021475451
2026-01-06 01:18:57.067 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:57.069 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:57.074 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/phone/+77021475451
2026-01-06 01:18:57.079 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getClientByPhone(java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:18:57.083 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getClientByPhone(java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:18:57.097 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.phone=?
2026-01-06 01:18:57.113 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:57.128 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:57.135 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at
2026-01-06 01:19:25.289 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/bonus-types
2026-01-06 01:19:25.324 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:19:25.329 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:19:25.332 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/bonus-types
2026-01-06 01:19:25.350 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusTypeController.getAllBonusTypes(); target is of class [com.westwood.controller.BonusTypeController]
2026-01-06 01:19:25.356 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusTypeController.getAllBonusTypes(); target is of class [com.westwood.controller.BonusTypeController]
2026-01-06 01:19:25.371 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0
2026-01-06 01:48:28.252  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=22m38s909ms).
2026-01-06 02:21:57.726  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=30m59s434ms).
2026-01-06 03:51:37.859  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h29m10s113ms).
2026-01-06 04:08:00.204  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m22s347ms).
2026-01-06 04:52:53.194  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=44m52s991ms).
2026-01-06 05:53:51.086  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h27s876ms).
2026-01-06 06:06:42.049  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=12m20s944ms).
2026-01-06 06:39:54.712  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=33m12s660ms).
2026-01-06 06:55:07.397  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m12s687ms).
2026-01-06 07:29:53.051  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=34m45s654ms).
2026-01-06 08:31:02.456  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h1m9s404ms).
2026-01-06 09:19:30.700  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=48m28s245ms).
2026-01-06 10:02:33.676  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=43m2s976ms).
2026-01-06 10:19:13.663  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m39s987ms).
2026-01-06 10:44:29.955  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=25m16s290ms).
2026-01-06 11:00:38.903  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m8s949ms).
2026-01-06 11:06:36.862  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m57s958ms).
2026-01-06 11:09:28.475  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m51s615ms).
2026-01-06 11:40:46.038  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=30m47s543ms).
2026-01-06 11:43:16.489  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m30s451ms).
2026-01-06 12:32:02.502  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=48m15s963ms).
2026-01-06 12:45:39.105  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=13m36s607ms).
2026-01-06 13:36:23.401  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=50m44s293ms).
2026-01-06 13:46:37.114  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=10m13s713ms).
2026-01-06 14:12:05.128  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=25m28s14ms).
2026-01-06 14:16:21.995  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m46s839ms).
2026-01-06 14:19:34.836  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 14:19:34.880  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 14:19:34.886  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
