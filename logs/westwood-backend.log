2026-01-06 00:00:36.790  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m52s11ms).
2026-01-06 00:54:05.368  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 00:54:05.378  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:54:05.382  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:54:06.414  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 93648 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:54:06.415 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:54:06.416  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:54:06.729  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:54:06.758  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 24 ms. Found 7 JPA repository interfaces.
2026-01-06 00:54:07.195  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:54:07.202  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:54:07.202  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:54:07.232  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:54:07.233  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 790 ms
2026-01-06 00:54:07.255  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:54:07.343  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:54:07.344  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:54:07.349  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:54:07.470  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:54:07.472  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:54:07.483  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:54:07.485  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.009s)
2026-01-06 00:54:07.489  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:54:07.508  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:54:07.511  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:54:07.527  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:54:07.536  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:54:07.545  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:54:07.556  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:54:07.562  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:54:07.575  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:54:07.588  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:54:07.596  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:54:07.600  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:54:07.613 ERROR [main] [] o.f.core.internal.command.DbMigrate      : Migration of schema "PUBLIC" to version "10 - add referral fields to clients" failed! Please restore backups and roll back database and code!
2026-01-06 00:54:07.617 ERROR [main] [] o.s.b.web.embedded.tomcat.TomcatStarter  : Error starting Tomcat context. Exception: org.springframework.beans.factory.UnsatisfiedDependencyException. Message: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
2026-01-06 00:54:07.636  INFO [main] [] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2026-01-06 00:54:07.639  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Unable to start web server
2026-01-06 00:54:07.639  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:54:07.662  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:54:07.667  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 00:54:07.675 ERROR [main] [] o.s.boot.SpringApplication               : Application run failed

org.springframework.context.ApplicationContextException: Unable to start web server
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:165)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:619)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:335)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)
	at com.westwood.WestwoodBackendApplication.main(WestwoodBackendApplication.java:12)
Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:147)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:516)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:222)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:188)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:162)
	... 8 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:205)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:211)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:174)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:169)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAdaptableBeans(ServletContextInitializerBeans.java:154)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:87)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:266)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:240)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:415)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:437)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	... 13 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 54 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1705)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1454)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 68 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpaSharedEM_entityManagerFactory': Cannot resolve reference to bean 'entityManagerFactory' while setting constructor argument
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:682)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1185)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 82 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1806)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 94 common frames omitted
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate$1.call(TableLockingExecutionTemplate.java:36)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate.execute(TableLockingExecutionTemplate.java:31)
	at org.flywaydb.core.internal.database.base.Connection.lock(Connection.java:102)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:145)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:202)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:205)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:147)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1853)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1802)
	... 103 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:252)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:214)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:133)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:65)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 121 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:514)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:489)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.getSyntaxError(DbException.java:247)
	at org.h2.command.ParserBase.getSyntaxError(ParserBase.java:748)
	at org.h2.command.Parser.prepareCommand(Parser.java:486)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:639)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:559)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1166)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:245)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:231)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:210)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:89)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:206)
	... 127 common frames omitted

2026-01-06 00:55:57.916  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 93848 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:55:57.917 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:55:57.917  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:55:58.105  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:55:58.123  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 00:55:58.439  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:55:58.444  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:55:58.445  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:55:58.464  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:55:58.464  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 530 ms
2026-01-06 00:55:58.481  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:55:58.555  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:55:58.556  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:55:58.559  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:55:58.634  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:55:58.636  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:55:58.643  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:55:58.644  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.005s)
2026-01-06 00:55:58.646  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:55:58.658  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:55:58.660  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:55:58.669  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:55:58.673  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:55:58.677  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:55:58.682  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:55:58.685  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:55:58.692  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:55:58.700  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:55:58.703  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:55:58.705  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:55:58.712 ERROR [main] [] o.f.core.internal.command.DbMigrate      : Migration of schema "PUBLIC" to version "10 - add referral fields to clients" failed! Please restore backups and roll back database and code!
2026-01-06 00:55:58.715 ERROR [main] [] o.s.b.web.embedded.tomcat.TomcatStarter  : Error starting Tomcat context. Exception: org.springframework.beans.factory.UnsatisfiedDependencyException. Message: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
2026-01-06 00:55:58.723  INFO [main] [] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2026-01-06 00:55:58.724  WARN [main] [] o.a.c.loader.WebappClassLoaderBase       : The web application [ROOT] appears to have started a thread named [HikariPool-1 connection adder] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 java.base@17.0.10/java.lang.Thread.sleep(Native Method)
 app//com.zaxxer.hikari.util.UtilityElf.quietlySleep(UtilityElf.java:53)
 app//com.zaxxer.hikari.pool.HikariPool$PoolEntryCreator.call(HikariPool.java:729)
 app//com.zaxxer.hikari.pool.HikariPool$PoolEntryCreator.call(HikariPool.java:703)
 java.base@17.0.10/java.util.concurrent.FutureTask.run(FutureTask.java:264)
 java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
 java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
 java.base@17.0.10/java.lang.Thread.run(Thread.java:840)
2026-01-06 00:55:58.725  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Unable to start web server
2026-01-06 00:55:58.725  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:55:58.725  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:55:58.729  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 00:55:58.734 ERROR [main] [] o.s.boot.SpringApplication               : Application run failed

org.springframework.context.ApplicationContextException: Unable to start web server
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:165)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:619)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:335)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)
	at com.westwood.WestwoodBackendApplication.main(WestwoodBackendApplication.java:12)
Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:147)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:516)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:222)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:188)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:162)
	... 8 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:205)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:211)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:174)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:169)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAdaptableBeans(ServletContextInitializerBeans.java:154)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:87)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:266)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:240)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:415)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:437)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	... 13 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 54 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1705)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1454)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 68 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpaSharedEM_entityManagerFactory': Cannot resolve reference to bean 'entityManagerFactory' while setting constructor argument
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:682)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1185)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 82 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1806)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 94 common frames omitted
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate$1.call(TableLockingExecutionTemplate.java:36)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate.execute(TableLockingExecutionTemplate.java:31)
	at org.flywaydb.core.internal.database.base.Connection.lock(Connection.java:102)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:145)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:202)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:205)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:147)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1853)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1802)
	... 103 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:252)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:214)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:133)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:65)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 121 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:514)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:489)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.getSyntaxError(DbException.java:247)
	at org.h2.command.ParserBase.getSyntaxError(ParserBase.java:748)
	at org.h2.command.Parser.prepareCommand(Parser.java:486)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:639)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:559)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1166)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:245)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:231)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:210)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:89)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:206)
	... 127 common frames omitted

2026-01-06 00:57:57.553  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94039 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:57:57.554 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:57:57.555  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:57:57.765  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:57:57.785  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 7 JPA repository interfaces.
2026-01-06 00:57:58.139  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:57:58.146  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:57:58.146  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:57:58.172  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:57:58.173  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 596 ms
2026-01-06 00:57:58.192  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:57:58.275  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:57:58.275  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:57:58.279  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:57:58.399  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:57:58.403  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:57:58.419  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:57:58.421  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.012s)
2026-01-06 00:57:58.423  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:57:58.439  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:57:58.441  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:57:58.455  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:57:58.460  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:57:58.464  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:57:58.470  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:57:58.473  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:57:58.485  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:57:58.498  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:57:58.501  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:57:58.503  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:57:58.511 ERROR [main] [] o.f.core.internal.command.DbMigrate      : Migration of schema "PUBLIC" to version "10 - add referral fields to clients" failed! Please restore backups and roll back database and code!
2026-01-06 00:57:58.514 ERROR [main] [] o.s.b.web.embedded.tomcat.TomcatStarter  : Error starting Tomcat context. Exception: org.springframework.beans.factory.UnsatisfiedDependencyException. Message: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
2026-01-06 00:57:58.530  INFO [main] [] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2026-01-06 00:57:58.534  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Unable to start web server
2026-01-06 00:57:58.534  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 00:57:58.545  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 00:57:58.550  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 00:57:58.557 ERROR [main] [] o.s.boot.SpringApplication               : Application run failed

org.springframework.context.ApplicationContextException: Unable to start web server
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:165)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:619)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:335)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)
	at com.westwood.WestwoodBackendApplication.main(WestwoodBackendApplication.java:12)
Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:147)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:516)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:222)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:188)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:162)
	... 8 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jwtAuthenticationFilter' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/JwtAuthenticationFilter.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:205)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:211)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:174)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAsRegistrationBean(ServletContextInitializerBeans.java:169)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addAdaptableBeans(ServletContextInitializerBeans.java:154)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:87)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:266)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:240)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:415)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:437)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	... 13 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDetailsServiceImpl' defined in file [/Users/baglan/repo/westwood-backend/target/classes/com/westwood/security/UserDetailsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 54 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'userRepository' defined in com.westwood.repository.UserRepository defined in @EnableJpaRepositories declared on JpaConfig: Cannot resolve reference to bean 'jpaSharedEM_entityManagerFactory' while setting bean property 'entityManager'
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1705)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1454)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 68 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpaSharedEM_entityManagerFactory': Cannot resolve reference to bean 'entityManagerFactory' while setting constructor argument
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:377)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:135)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:682)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1185)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 82 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1806)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:365)
	... 94 common frames omitted
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate$1.call(TableLockingExecutionTemplate.java:36)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.jdbc.TableLockingExecutionTemplate.execute(TableLockingExecutionTemplate.java:31)
	at org.flywaydb.core.internal.database.base.Connection.lock(Connection.java:102)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:145)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:202)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:205)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:147)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1853)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1802)
	... 103 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V10__add_referral_fields_to_clients.sql failed
--------------------------------------------------------
SQL State  : 42000
Error Code : 42000
Message    : Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
Location   : db/migration/V10__add_referral_fields_to_clients.sql (/Users/baglan/repo/westwood-backend/target/classes/db/migration/V10__add_referral_fields_to_clients.sql)
Line       : 4
Statement  : CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:252)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:214)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:133)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:65)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 121 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Синтаксическая ошибка в выражении SQL "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"
Syntax error in SQL statement "CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) [*]WHERE referral_code IS NOT NULL"; SQL statement:
CREATE UNIQUE INDEX idx_clients_referral_code ON clients(referral_code) WHERE referral_code IS NOT NULL [42000-224]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:514)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:489)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.getSyntaxError(DbException.java:247)
	at org.h2.command.ParserBase.getSyntaxError(ParserBase.java:748)
	at org.h2.command.Parser.prepareCommand(Parser.java:486)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:639)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:559)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1166)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:245)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:231)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:210)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:89)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:206)
	... 127 common frames omitted

2026-01-06 00:59:06.258  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94158 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:59:06.259 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:59:06.259  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:59:06.500  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:59:06.519  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 7 JPA repository interfaces.
2026-01-06 00:59:06.879  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:59:06.886  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:59:06.887  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:59:06.911  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:59:06.911  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 626 ms
2026-01-06 00:59:06.937  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:59:07.017  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:59:07.018  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:59:07.022  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:59:07.110  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:59:07.112  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:59:07.122  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:59:07.123  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 00:59:07.125  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:59:07.138  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:59:07.140  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:59:07.149  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:59:07.153  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:59:07.157  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:59:07.162  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:59:07.165  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:59:07.173  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:59:07.182  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:59:07.185  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:59:07.187  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:59:07.191  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 00:59:07.194  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 00:59:07.200  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 00:59:07.204  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 00:59:07.212  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.039s)
2026-01-06 00:59:07.246  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 00:59:07.270  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 00:59:07.283  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 00:59:07.412  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 00:59:07.430  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 00:59:07.473  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 00:59:07.850  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 00:59:07.860 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 00:59:07.861 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 00:59:07.861 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 00:59:07.861 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 00:59:07.862 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 00:59:07.865  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 00:59:07.999 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 00:59:07.999 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 00:59:08.021  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 00:59:08.278  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 00:59:08.278  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 00:59:08.340  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 00:59:08.468 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 00:59:08.603  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 00:59:08.608  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.593 seconds (process running for 2.732)
2026-01-06 00:59:47.045  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94251 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 00:59:47.045 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 00:59:47.046  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 00:59:47.229  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 00:59:47.248  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 00:59:47.574  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 00:59:47.579  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 00:59:47.579  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 00:59:47.599  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 00:59:47.599  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 536 ms
2026-01-06 00:59:47.622  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 00:59:47.689  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 00:59:47.689  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 00:59:47.693  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 00:59:47.769  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 00:59:47.771  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 00:59:47.784  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 00:59:47.785  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 00:59:47.787  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 00:59:47.799  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 00:59:47.805  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 00:59:47.813  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 00:59:47.818  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 00:59:47.821  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 00:59:47.827  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 00:59:47.829  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 00:59:47.838  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 00:59:47.847  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 00:59:47.851  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 00:59:47.853  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 00:59:47.857  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 00:59:47.860  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 00:59:47.867  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 00:59:47.870  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 00:59:47.877  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.039s)
2026-01-06 00:59:47.907  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 00:59:47.926  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 00:59:47.937  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 00:59:48.028  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 00:59:48.044  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 00:59:48.082  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 00:59:48.494  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 00:59:48.505 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 00:59:48.506 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 00:59:48.507 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 00:59:48.508 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 00:59:48.508 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 00:59:48.511  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 00:59:48.649 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 00:59:48.649 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 00:59:48.671  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 00:59:48.927  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 00:59:48.927  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 00:59:48.984  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 00:59:49.100 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 00:59:49.229  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 00:59:49.235  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.363 seconds (process running for 2.496)
2026-01-06 01:04:45.229  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:04:45.242  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:04:45.245  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:07:44.971  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94550 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:07:44.972 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:07:44.972  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:07:45.196  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:07:45.222  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 22 ms. Found 7 JPA repository interfaces.
2026-01-06 01:07:45.546  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:07:45.552  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:07:45.553  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:07:45.574  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:07:45.575  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 585 ms
2026-01-06 01:07:45.602  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:07:45.669  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:07:45.670  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:07:45.673  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:07:45.754  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:07:45.756  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:07:45.767  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:07:45.768  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.008s)
2026-01-06 01:07:45.770  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:07:45.782  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:07:45.784  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:07:45.792  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:07:45.796  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:07:45.800  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:07:45.805  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:07:45.809  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:07:45.816  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:07:45.824  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:07:45.827  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:07:45.828  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:07:45.833  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:07:45.837  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:07:45.840  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:07:45.843  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:07:45.851  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.032s)
2026-01-06 01:07:45.883  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:07:45.909  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:07:45.923  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:07:46.032  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:07:46.050  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:07:46.091  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:07:46.515  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:07:46.525 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:07:46.526 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:07:46.527 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:07:46.528 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:07:46.528 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:07:46.528 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:07:46.531  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:07:46.669 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:07:46.669 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:07:46.688  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:07:46.950  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:07:46.951  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:07:47.012  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:07:47.132 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:07:47.273  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:07:47.278  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.503 seconds (process running for 2.645)
2026-01-06 01:08:19.817  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94622 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:08:19.818 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:08:19.818  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:08:20.021  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:08:20.040  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 7 JPA repository interfaces.
2026-01-06 01:08:20.375  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:08:20.381  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:08:20.381  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:08:20.405  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:08:20.406  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 566 ms
2026-01-06 01:08:20.432  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:08:20.504  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:08:20.504  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:08:20.508  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:08:20.592  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:08:20.594  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:08:20.605  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:08:20.606  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.008s)
2026-01-06 01:08:20.608  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:08:20.621  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:08:20.623  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:08:20.631  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:08:20.636  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:08:20.640  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:08:20.644  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:08:20.647  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:08:20.654  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:08:20.661  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:08:20.665  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:08:20.668  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:08:20.672  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:08:20.675  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:08:20.679  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:08:20.682  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:08:20.690  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.034s)
2026-01-06 01:08:20.724  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:08:20.748  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:08:20.761  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:08:20.864  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:08:20.881  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:08:20.922  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:08:21.317  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:08:21.326 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:08:21.327 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:08:21.328 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:08:21.328 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:08:21.329 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:08:21.333  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:21.471 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:08:21.471 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:08:21.491  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:08:21.749  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:08:21.750  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:08:21.808  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:08:21.928 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:08:22.059  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2026-01-06 01:08:22.060  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:22.061  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:08:22.062  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:08:22.067  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 01:08:22.073 ERROR [main] [] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2026-01-06 01:08:42.945  INFO [http-nio-8080-exec-1] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 01:08:42.945  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 01:08:42.948  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 2 ms
2026-01-06 01:08:42.957 DEBUG [http-nio-8080-exec-1] [bdf186ab-63fb-4431-a575-60c4914d9cfb] o.s.security.web.FilterChainProxy        : Securing GET /actuator/health
2026-01-06 01:08:42.961 DEBUG [http-nio-8080-exec-1] [bdf186ab-63fb-4431-a575-60c4914d9cfb] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:08:42.962 DEBUG [http-nio-8080-exec-1] [bdf186ab-63fb-4431-a575-60c4914d9cfb] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:08:42.968 DEBUG [http-nio-8080-exec-1] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 01:08:42.968 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:08:42.969 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:08:53.727  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94694 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:08:53.728 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:08:53.728  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:08:53.913  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:08:53.930  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 01:08:54.238  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:08:54.243  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:08:54.243  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:08:54.262  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:08:54.263  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 513 ms
2026-01-06 01:08:54.284  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:08:54.348  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:08:54.349  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:08:54.352  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:08:54.430  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:08:54.432  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:08:54.442  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:08:54.443  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:08:54.445  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:08:54.459  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:08:54.461  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:08:54.470  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:08:54.475  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:08:54.479  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:08:54.484  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:08:54.486  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:08:54.493  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:08:54.502  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:08:54.505  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:08:54.506  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:08:54.510  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:08:54.515  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:08:54.518  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:08:54.521  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:08:54.526  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.034s)
2026-01-06 01:08:54.554  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:08:54.575  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:08:54.587  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:08:54.675  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:08:54.689  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:08:54.729  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:08:55.076  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:08:55.089 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:08:55.090 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:08:55.091 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:08:55.095  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:55.229 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:08:55.229 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:08:55.247  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:08:55.499  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:08:55.500  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:08:55.556  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:08:55.670 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:08:55.790  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2026-01-06 01:08:55.792  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:08:55.793  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:08:55.793  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:08:55.798  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 01:08:55.803 ERROR [main] [] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2026-01-06 01:09:27.427  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94770 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:09:27.428 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:09:27.429  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:09:27.626  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:09:27.644  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 15 ms. Found 7 JPA repository interfaces.
2026-01-06 01:09:27.952  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:09:27.957  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:09:27.957  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:09:27.976  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:09:27.976  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 530 ms
2026-01-06 01:09:28.000  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:09:28.067  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:09:28.067  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:09:28.071  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:09:28.153  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:09:28.155  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:09:28.168  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:09:28.169  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.008s)
2026-01-06 01:09:28.171  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:09:28.182  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:09:28.185  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:09:28.193  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:09:28.198  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:09:28.201  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:09:28.207  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:09:28.211  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:09:28.219  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:09:28.226  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:09:28.229  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:09:28.231  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:09:28.235  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:09:28.238  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:09:28.242  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:09:28.244  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:09:28.252  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.032s)
2026-01-06 01:09:28.283  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:09:28.305  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:09:28.318  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:09:28.417  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:09:28.434  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:09:28.472  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:09:28.858  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:09:28.868 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:09:28.868 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:09:28.869 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:09:28.870 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:09:28.871 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:09:28.874  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:09:29.010 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:09:29.010 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:09:29.033  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:09:29.300  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:09:29.301  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:09:29.360  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:09:29.485 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:09:29.621  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:09:29.626  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.376 seconds (process running for 2.52)
2026-01-06 01:11:44.159  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:11:44.165  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:11:44.167  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:11:58.840  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 94919 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:11:58.842 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:11:58.842  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:11:59.037  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:11:59.055  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 7 JPA repository interfaces.
2026-01-06 01:11:59.380  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:11:59.386  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:11:59.386  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:11:59.408  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:11:59.408  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 548 ms
2026-01-06 01:11:59.431  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:11:59.497  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:11:59.497  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:11:59.501  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:11:59.578  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:11:59.579  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:11:59.589  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:11:59.590  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:11:59.592  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:11:59.604  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:11:59.606  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:11:59.614  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:11:59.619  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:11:59.623  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:11:59.628  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:11:59.630  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:11:59.637  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:11:59.645  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:11:59.649  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:11:59.650  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:11:59.655  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:11:59.660  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:11:59.663  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:11:59.667  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:11:59.672  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.034s)
2026-01-06 01:11:59.703  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:11:59.728  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:11:59.741  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:11:59.838  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:11:59.854  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:11:59.892  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:12:00.259  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:12:00.268 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:12:00.269 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:12:00.270 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:12:00.271 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:12:00.271 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:12:00.271 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:12:00.274  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:12:00.402 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:12:00.402 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:12:00.423  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:12:00.677  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:12:00.678  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:12:00.737  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:12:00.849 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:12:00.982  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:12:00.987  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.351 seconds (process running for 2.486)
2026-01-06 01:13:57.686  INFO [http-nio-8080-exec-1] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 01:13:57.686  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 01:13:57.689  INFO [http-nio-8080-exec-1] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 3 ms
2026-01-06 01:13:57.698 DEBUG [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/tags
2026-01-06 01:13:57.727 ERROR [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] c.w.security.JwtAuthenticationFilter     : Cannot set user authentication: {}

io.jsonwebtoken.MalformedJwtException: Invalid compact JWT string: Compact JWSs must contain exactly 2 period characters, and compact JWEs must contain exactly 4.  Found: 0
	at io.jsonwebtoken.impl.JwtTokenizer.tokenize(JwtTokenizer.java:102)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:370)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:362)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:94)
	at io.jsonwebtoken.impl.io.AbstractParser.parse(AbstractParser.java:36)
	at io.jsonwebtoken.impl.io.AbstractParser.parse(AbstractParser.java:29)
	at io.jsonwebtoken.impl.DefaultJwtParser.parseSignedClaims(DefaultJwtParser.java:821)
	at com.westwood.util.jwt.JwtUtil.extractAllClaims(JwtUtil.java:47)
	at com.westwood.util.jwt.JwtUtil.extractClaim(JwtUtil.java:39)
	at com.westwood.util.jwt.JwtUtil.extractUsername(JwtUtil.java:31)
	at com.westwood.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.westwood.config.RequestIdFilter.doFilterInternal(RequestIdFilter.java:47)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)

2026-01-06 01:13:57.729 DEBUG [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:13:57.731 DEBUG [http-nio-8080-exec-1] [e74ce52e-c535-4f28-8ffb-75cd625565b1] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:13:57.734 DEBUG [http-nio-8080-exec-1] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 01:13:57.734 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:13:57.734 DEBUG [http-nio-8080-exec-1] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 01:14:36.495  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 95523 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:14:36.497 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:14:36.497  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:14:36.732  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:14:36.754  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 19 ms. Found 7 JPA repository interfaces.
2026-01-06 01:14:37.118  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:14:37.125  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:14:37.125  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:14:37.157  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:14:37.157  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 644 ms
2026-01-06 01:14:37.179  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:14:37.256  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:14:37.256  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:14:37.261  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:14:37.344  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:14:37.346  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:14:37.356  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:14:37.357  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:14:37.359  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:14:37.374  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:14:37.381  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:14:37.393  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:14:37.402  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:14:37.407  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:14:37.413  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:14:37.417  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:14:37.426  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:14:37.439  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:14:37.442  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:14:37.446  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:14:37.453  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:14:37.458  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:14:37.464  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:14:37.471  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:14:37.479  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.054s)
2026-01-06 01:14:37.514  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:14:37.540  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:14:37.554  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:14:37.663  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:14:37.680  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:14:37.718  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:14:38.118  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:14:38.128 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:14:38.131 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:14:38.132 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:14:38.132 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:14:38.133 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:14:38.133 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:14:38.134 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:14:38.134 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:14:38.135 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:14:38.136 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:14:38.140  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:14:38.273 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:14:38.273 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:14:38.294  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:14:38.565  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:14:38.565  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:14:38.623  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:14:38.730 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:14:38.858  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2026-01-06 01:14:38.860  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:14:38.861  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 01:14:38.863  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 01:14:38.871  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 01:14:38.877 ERROR [main] [] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2026-01-06 01:15:18.319  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 17.0.10 with PID 95894 (/Users/baglan/repo/westwood-backend/target/classes started by baglan in /Users/baglan/repo/westwood-backend)
2026-01-06 01:15:18.320 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 01:15:18.321  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 01:15:18.569  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 01:15:18.591  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 19 ms. Found 7 JPA repository interfaces.
2026-01-06 01:15:18.967  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 01:15:18.973  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 01:15:18.973  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 01:15:19.002  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 01:15:19.002  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 661 ms
2026-01-06 01:15:19.024  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 01:15:19.099  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 01:15:19.100  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 01:15:19.104  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 01:15:19.189  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 01:15:19.191  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 01:15:19.200  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 01:15:19.201  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.007s)
2026-01-06 01:15:19.207  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 01:15:19.222  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 01:15:19.225  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 01:15:19.237  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 01:15:19.242  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 01:15:19.247  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 01:15:19.254  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 01:15:19.257  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 01:15:19.267  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 01:15:19.278  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 01:15:19.283  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 01:15:19.286  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 01:15:19.292  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 01:15:19.297  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 01:15:19.303  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 01:15:19.307  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 01:15:19.315  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.049s)
2026-01-06 01:15:19.458  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 01:15:19.479  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 01:15:19.491  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 01:15:19.606  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 01:15:19.623  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 01:15:19.661  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 01:15:20.036  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 01:15:20.046 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 01:15:20.049 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 01:15:20.050 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 01:15:20.050 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 01:15:20.051 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 01:15:20.052 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 01:15:20.056  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 01:15:20.202 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 01:15:20.202 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 01:15:20.225  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 01:15:20.496  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 01:15:20.496  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 01:15:20.555  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 01:15:20.662 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 01:15:20.792  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 01:15:20.797  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 2.71 seconds (process running for 2.887)
2026-01-06 01:16:22.575  INFO [http-nio-8080-exec-2] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 01:16:22.575  INFO [http-nio-8080-exec-2] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 01:16:22.578  INFO [http-nio-8080-exec-2] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 3 ms
2026-01-06 01:16:22.596 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/register
2026-01-06 01:16:22.602 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:16:22.606 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/register
2026-01-06 01:16:22.773 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.username=? 
    fetch
        first ? rows only
2026-01-06 01:16:22.778 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.email=? 
    fetch
        first ? rows only
2026-01-06 01:16:22.873 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    insert 
    into
        users
        (account_status, activation_token, activation_token_expiry, active, created_at, email, first_name, last_name, password, updated_at, username, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:16:22.920 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 01:16:22.921 DEBUG [http-nio-8080-exec-2] [e25a6500-7fcd-4815-ab56-412ffbab6732] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 01:16:31.005 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/login
2026-01-06 01:16:31.007 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 01:16:31.008 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/login
2026-01-06 01:16:31.299 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:16:31.304 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:16:31.379 DEBUG [http-nio-8080-exec-3] [c07d533b-233b-4d80-99fb-727c8704c47b] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2026-01-06 01:16:55.181 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 01:16:55.310 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:16:55.315 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:16:55.320 DEBUG [http-nio-8080-exec-4] [8f2cb314-8e52-40f9-92dd-ec05f471c64e] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 01:17:09.314 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 01:17:09.346 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:17:09.350 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:17:09.354 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 01:17:09.371 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:09.464 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:09.466 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        c1_0.id 
    from
        clients c1_0 
    where
        c1_0.phone=? 
    fetch
        first ? rows only
2026-01-06 01:17:09.469 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 01:17:09.471 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 01:17:09.473 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 01:17:09.473 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 01:17:09.482 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0
2026-01-06 01:17:09.486 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        clients
        (client_type, created_at, date_of_birth, name, notes, phone, referral_code, referrer_id, surname, updated_at, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:17:09.489 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:17:09.492 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:17:09.505 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at desc
2026-01-06 01:17:09.509 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:17:09.510 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:17:09.511  INFO [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] c.w.service.impl.EventBonusServiceImpl   : Welcome bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:17:09.513 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 01:17:09.514 DEBUG [http-nio-8080-exec-6] [19b6a5be-f17c-4fd4-a78e-2b3cb778b3dc] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 01:17:22.606 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/tags
2026-01-06 01:17:22.621 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:17:22.625 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:17:22.632 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/tags
2026-01-06 01:17:22.635 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllDistinctTags(); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:22.636 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllDistinctTags(); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:22.643 DEBUG [http-nio-8080-exec-7] [a4e2d02f-edd1-4061-b9c1-31cf3a497ea3] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0
2026-01-06 01:17:52.808 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients?tag=vip
2026-01-06 01:17:52.826 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:17:52.829 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:17:52.834 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients?tag=vip
2026-01-06 01:17:52.862 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllClients(java.lang.String,java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:52.863 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getAllClients(java.lang.String,java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:17:52.878 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    join
        client_tag t1_0 
            on c1_0.id=t1_0.client_id 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_1.name=?
2026-01-06 01:17:52.900 DEBUG [http-nio-8080-exec-8] [59f9e792-32bd-4438-b195-6b6efdaa48ad] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:26.688 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:26.709 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:26.713 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:26.722 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:26.771 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:26.780 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:26.784 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:26.789 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:26.803 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:26.805 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:26.817 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:26.820 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:26.821 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:26.823 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:26.823 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:26.824  INFO [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:26.824 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:26.825 DEBUG [http-nio-8080-exec-9] [29764ce1-1db8-4ce8-93fd-41b57839fd81] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.164 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:30.178 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:30.186 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:30.191 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:30.198 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.200 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.202 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.203 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:30.205 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:30.208 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.214 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.224 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.228 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.238 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:30.239 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:30.240  INFO [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.242 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.245 DEBUG [http-nio-8080-exec-10] [7b16158e-9b37-4e8c-93eb-310be0396494] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.952 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:30.956 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:30.957 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:30.961 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:30.968 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.969 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:30.972 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.973 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:30.975 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:30.977 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.977 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:30.981 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.982 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:30.983 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:30.984 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:30.984  INFO [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:30.985 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:30.985 DEBUG [http-nio-8080-exec-1] [665faaa2-e1d8-4490-95f1-5a329a997887] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:31.606 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:31.627 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:31.638 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:31.642 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:31.650 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:31.651 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:31.653 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:31.653 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:31.655 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:31.656 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:31.658 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:31.659 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:31.664 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:31.667 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:31.667 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:31.668  INFO [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:31.669 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:31.669 DEBUG [http-nio-8080-exec-2] [8023eca5-6799-4539-84c3-e38e396777f9] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:32.121 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/payments
2026-01-06 01:18:32.128 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:32.131 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:32.135 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/payments
2026-01-06 01:18:32.137 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:32.137 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.PaymentController.createPayment(com.westwood.common.dto.CreatePaymentRequest); target is of class [com.westwood.controller.PaymentController]
2026-01-06 01:18:32.139 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:32.140 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:32.143 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        r1_0.user_id,
        r1_0.role,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    left join
        user_roles r1_0 
            on u1_0.id=r1_0.user_id 
    where
        u1_0.id=?
2026-01-06 01:18:32.144 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        payment_transactions
        (amount, client_id, created_at, entered_by_user_id, notes, status, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:32.145 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        event_store
        (aggregate_id, aggregate_type, created_at, event_data, event_id, event_type, timestamp, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 01:18:32.147 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:32.151 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:32.152 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 01:18:32.153 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 01:18:32.153  INFO [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] c.w.service.impl.EventBonusServiceImpl   : Cashback bonus granted to client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:32.154 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 01:18:32.154 DEBUG [http-nio-8080-exec-3] [08b18264-b8c5-47f6-b05d-c6e416b69244] c.w.service.impl.EventBonusServiceImpl   : Payment milestone bonus is not enabled or threshold not set, skipping for client: 2ab4ee44-758e-408e-81b2-eea0b3e10659
2026-01-06 01:18:46.017 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/bonuses/client/2ab4ee44-758e-408e-81b2-eea0b3e10659/balance
2026-01-06 01:18:46.039 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:46.047 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:46.053 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/bonuses/client/2ab4ee44-758e-408e-81b2-eea0b3e10659/balance
2026-01-06 01:18:46.061 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusController.getClientBonusBalance(java.util.UUID); target is of class [com.westwood.controller.BonusController]
2026-01-06 01:18:46.065 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusController.getClientBonusBalance(java.util.UUID); target is of class [com.westwood.controller.BonusController]
2026-01-06 01:18:46.069 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:46.070 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:46.113 DEBUG [http-nio-8080-exec-4] [5b30fe66-7801-4e8f-98d6-fd81334b8fae] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at
2026-01-06 01:18:57.040 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/phone/+77021475451
2026-01-06 01:18:57.067 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:18:57.069 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:18:57.074 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/phone/+77021475451
2026-01-06 01:18:57.079 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getClientByPhone(java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:18:57.083 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.getClientByPhone(java.lang.String); target is of class [com.westwood.controller.ClientController]
2026-01-06 01:18:57.097 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.phone=?
2026-01-06 01:18:57.113 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 01:18:57.128 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 01:18:57.135 DEBUG [http-nio-8080-exec-5] [10761af6-a457-4d82-b33f-424aefdf67cc] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at
2026-01-06 01:19:25.289 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/bonus-types
2026-01-06 01:19:25.324 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 01:19:25.329 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 01:19:25.332 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/bonus-types
2026-01-06 01:19:25.350 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusTypeController.getAllBonusTypes(); target is of class [com.westwood.controller.BonusTypeController]
2026-01-06 01:19:25.356 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.BonusTypeController.getAllBonusTypes(); target is of class [com.westwood.controller.BonusTypeController]
2026-01-06 01:19:25.371 DEBUG [http-nio-8080-exec-6] [445cd340-e6d0-4e1a-89c6-246fe49a64c2] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0
2026-01-06 01:48:28.252  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=22m38s909ms).
2026-01-06 02:21:57.726  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=30m59s434ms).
2026-01-06 03:51:37.859  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h29m10s113ms).
2026-01-06 04:08:00.204  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m22s347ms).
2026-01-06 04:52:53.194  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=44m52s991ms).
2026-01-06 05:53:51.086  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h27s876ms).
2026-01-06 06:06:42.049  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=12m20s944ms).
2026-01-06 06:39:54.712  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=33m12s660ms).
2026-01-06 06:55:07.397  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m12s687ms).
2026-01-06 07:29:53.051  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=34m45s654ms).
2026-01-06 08:31:02.456  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h1m9s404ms).
2026-01-06 09:19:30.700  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=48m28s245ms).
2026-01-06 10:02:33.676  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=43m2s976ms).
2026-01-06 10:19:13.663  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m39s987ms).
2026-01-06 10:44:29.955  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=25m16s290ms).
2026-01-06 11:00:38.903  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m8s949ms).
2026-01-06 11:06:36.862  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m57s958ms).
2026-01-06 11:09:28.475  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m51s615ms).
2026-01-06 11:40:46.038  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=30m47s543ms).
2026-01-06 11:43:16.489  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m30s451ms).
2026-01-06 12:32:02.502  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=48m15s963ms).
2026-01-06 12:45:39.105  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=13m36s607ms).
2026-01-06 13:36:23.401  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=50m44s293ms).
2026-01-06 13:46:37.114  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=10m13s713ms).
2026-01-06 14:12:05.128  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=25m28s14ms).
2026-01-06 14:16:21.995  WARN [HikariPool-1 housekeeper] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m46s839ms).
2026-01-06 14:19:34.836  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 14:19:34.880  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 14:19:34.886  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 18:45:01.631  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 23 with PID 7548 (C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes started by user in C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend)
2026-01-06 18:45:01.634 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 18:45:01.635  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 18:45:04.014  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 18:45:04.100  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 74 ms. Found 7 JPA repository interfaces.
2026-01-06 18:45:06.042  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 18:45:06.087  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 18:45:06.088  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 18:45:06.306  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 18:45:06.310  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 4584 ms
2026-01-06 18:45:06.410  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 18:45:06.842  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 18:45:06.849  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 18:45:06.883  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 18:45:07.491  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 18:45:07.496  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 18:45:07.558  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 18:45:07.562  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.053s)
2026-01-06 18:45:07.570  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 18:45:07.615  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 18:45:07.630  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 18:45:07.671  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 18:45:07.685  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 18:45:07.699  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 18:45:07.725  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 18:45:07.736  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 18:45:07.770  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 18:45:07.832  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 18:45:07.847  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 18:45:07.857  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 18:45:07.878  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 18:45:07.895  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 18:45:07.914  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 18:45:07.931  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 18:45:07.956  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.200s)
2026-01-06 18:45:08.232  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 18:45:08.362  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 18:45:08.427  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 18:45:08.830  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 18:45:08.892  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 18:45:09.025  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 18:45:10.381  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 18:45:10.434 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 18:45:10.436 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 18:45:10.437 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 18:45:10.438 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 18:45:10.439 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 18:45:10.439 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 18:45:10.443 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 18:45:10.444 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 18:45:10.446 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 18:45:10.446 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 18:45:10.447 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 18:45:10.448 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 18:45:10.448 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 18:45:10.461  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 18:45:11.061 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 18:45:11.062 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 18:45:11.141  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 18:45:11.819  WARN [main] [] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'analyticsController' defined in file [C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes\com\westwood\controller\AnalyticsController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'analyticsServiceImpl' defined in file [C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes\com\westwood\service\impl\AnalyticsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'clientRepository' defined in com.westwood.repository.ClientRepository defined in @EnableJpaRepositories declared on JpaConfig: Could not create query for public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String); Reason: Using named parameters for method public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String) but parameter 'Optional[uuid]' not found in annotated query 'UPDATE Client c SET c.notes = :notes WHERE c.uuid = uuid'
2026-01-06 18:45:11.820  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 18:45:11.826  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 18:45:11.831  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 18:45:11.835  INFO [main] [] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2026-01-06 18:45:11.856  INFO [main] [] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2026-01-06 18:45:11.887 ERROR [main] [] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'analyticsController' defined in file [C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes\com\westwood\controller\AnalyticsController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'analyticsServiceImpl' defined in file [C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes\com\westwood\service\impl\AnalyticsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'clientRepository' defined in com.westwood.repository.ClientRepository defined in @EnableJpaRepositories declared on JpaConfig: Could not create query for public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String); Reason: Using named parameters for method public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String) but parameter 'Optional[uuid]' not found in annotated query 'UPDATE Client c SET c.notes = :notes WHERE c.uuid = uuid'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:971)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:625)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:335)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)
	at com.westwood.WestwoodBackendApplication.main(WestwoodBackendApplication.java:12)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'analyticsServiceImpl' defined in file [C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes\com\westwood\service\impl\AnalyticsServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'clientRepository' defined in com.westwood.repository.ClientRepository defined in @EnableJpaRepositories declared on JpaConfig: Could not create query for public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String); Reason: Using named parameters for method public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String) but parameter 'Optional[uuid]' not found in annotated query 'UPDATE Client c SET c.notes = :notes WHERE c.uuid = uuid'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1212)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 19 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'clientRepository' defined in com.westwood.repository.ClientRepository defined in @EnableJpaRepositories declared on JpaConfig: Could not create query for public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String); Reason: Using named parameters for method public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String) but parameter 'Optional[uuid]' not found in annotated query 'UPDATE Client c SET c.notes = :notes WHERE c.uuid = uuid'
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1806)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 33 common frames omitted
Caused by: org.springframework.data.repository.query.QueryCreationException: Could not create query for public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String); Reason: Using named parameters for method public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String) but parameter 'Optional[uuid]' not found in annotated query 'UPDATE Client c SET c.notes = :notes WHERE c.uuid = uuid'
	at org.springframework.data.repository.query.QueryCreationException.create(QueryCreationException.java:101)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.lookupQuery(QueryExecutorMethodInterceptor.java:119)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.mapMethodsToQuery(QueryExecutorMethodInterceptor.java:103)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.lambda$new$0(QueryExecutorMethodInterceptor.java:92)
	at java.base/java.util.Optional.map(Optional.java:260)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.<init>(QueryExecutorMethodInterceptor.java:92)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport.getRepository(RepositoryFactorySupport.java:357)
	at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.lambda$afterPropertiesSet$5(RepositoryFactoryBeanSupport.java:290)
	at org.springframework.data.util.Lazy.getNullable(Lazy.java:135)
	at org.springframework.data.util.Lazy.get(Lazy.java:113)
	at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.afterPropertiesSet(RepositoryFactoryBeanSupport.java:296)
	at org.springframework.data.jpa.repository.support.JpaRepositoryFactoryBean.afterPropertiesSet(JpaRepositoryFactoryBean.java:132)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1853)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1802)
	... 44 common frames omitted
Caused by: java.lang.IllegalStateException: Using named parameters for method public abstract void com.westwood.repository.ClientRepository.updateClientNotes(java.util.UUID,java.lang.String) but parameter 'Optional[uuid]' not found in annotated query 'UPDATE Client c SET c.notes = :notes WHERE c.uuid = uuid'
	at org.springframework.data.jpa.repository.query.JpaQueryMethod.assertParameterNamesInAnnotatedQuery(JpaQueryMethod.java:181)
	at org.springframework.data.jpa.repository.query.JpaQueryMethod.<init>(JpaQueryMethod.java:149)
	at org.springframework.data.jpa.repository.query.DefaultJpaQueryMethodFactory.build(DefaultJpaQueryMethodFactory.java:44)
	at org.springframework.data.jpa.repository.query.JpaQueryLookupStrategy$AbstractQueryLookupStrategy.resolveQuery(JpaQueryLookupStrategy.java:94)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.lookupQuery(QueryExecutorMethodInterceptor.java:115)
	... 56 common frames omitted

2026-01-06 18:46:40.576  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 23 with PID 7220 (C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes started by user in C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend)
2026-01-06 18:46:40.578 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 18:46:40.580  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 18:46:41.833  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 18:46:41.923  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 77 ms. Found 7 JPA repository interfaces.
2026-01-06 18:46:43.844  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 18:46:43.882  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 18:46:43.883  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 18:46:44.128  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 18:46:44.132  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 3462 ms
2026-01-06 18:46:44.250  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 18:46:44.689  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 18:46:44.696  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 18:46:44.726  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 18:46:45.534  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 18:46:45.546  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 18:46:45.646  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 18:46:45.651  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.058s)
2026-01-06 18:46:45.663  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 18:46:45.735  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 18:46:45.755  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 18:46:45.812  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 18:46:45.824  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 18:46:45.836  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 18:46:45.850  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 18:46:45.861  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 18:46:45.907  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 18:46:45.949  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 18:46:45.970  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 18:46:45.988  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 18:46:46.017  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 18:46:46.034  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 18:46:46.048  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 18:46:46.060  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 18:46:46.104  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.202s)
2026-01-06 18:46:46.367  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 18:46:46.615  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 18:46:46.681  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 18:46:47.057  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 18:46:47.110  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 18:46:47.235  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 18:46:48.621  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 18:46:48.655 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 18:46:48.657 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 18:46:48.658 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 18:46:48.659 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 18:46:48.660 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 18:46:48.661 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 18:46:48.664 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 18:46:48.665 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 18:46:48.666 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 18:46:48.667 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 18:46:48.668 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 18:46:48.669 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 18:46:48.670 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 18:46:48.687  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 18:46:49.237 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 18:46:49.238 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 18:46:49.400  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 18:46:50.761  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 18:46:50.762  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 18:46:51.126  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 18:46:51.558 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 18:46:52.229  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 18:46:52.241  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 12.575 seconds (process running for 13.686)
2026-01-06 18:47:46.572 DEBUG [http-nio-8080-exec-2] [e07b7f3c-1586-4a31-a5c6-3cd4e95ad56e] o.s.security.web.FilterChainProxy        : Securing GET /h2-console
2026-01-06 18:47:46.584 DEBUG [http-nio-8080-exec-2] [e07b7f3c-1586-4a31-a5c6-3cd4e95ad56e] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:46.589 DEBUG [http-nio-8080-exec-2] [e07b7f3c-1586-4a31-a5c6-3cd4e95ad56e] o.s.security.web.FilterChainProxy        : Secured GET /h2-console
2026-01-06 18:47:46.600 DEBUG [http-nio-8080-exec-3] [d021f2e1-d221-4049-9644-93ee7546dbe7] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/
2026-01-06 18:47:46.601 DEBUG [http-nio-8080-exec-3] [d021f2e1-d221-4049-9644-93ee7546dbe7] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:46.601 DEBUG [http-nio-8080-exec-3] [d021f2e1-d221-4049-9644-93ee7546dbe7] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/
2026-01-06 18:47:46.664 DEBUG [http-nio-8080-exec-5] [42c54f3a-052a-460f-8c51-154b021caff7] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/stylesheet.css
2026-01-06 18:47:46.664 DEBUG [http-nio-8080-exec-5] [42c54f3a-052a-460f-8c51-154b021caff7] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:46.665 DEBUG [http-nio-8080-exec-5] [42c54f3a-052a-460f-8c51-154b021caff7] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/stylesheet.css
2026-01-06 18:47:46.691 DEBUG [http-nio-8080-exec-1] [e1d8ede7-fce4-45e2-bacf-1e0b765eb8dc] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/login.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:46.692 DEBUG [http-nio-8080-exec-1] [e1d8ede7-fce4-45e2-bacf-1e0b765eb8dc] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:46.692 DEBUG [http-nio-8080-exec-1] [e1d8ede7-fce4-45e2-bacf-1e0b765eb8dc] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/login.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:46.757 DEBUG [http-nio-8080-exec-4] [d1287e4d-3f36-4c1a-80f2-1c3c6ff64691] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/background.gif
2026-01-06 18:47:46.758 DEBUG [http-nio-8080-exec-4] [d1287e4d-3f36-4c1a-80f2-1c3c6ff64691] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:46.758 DEBUG [http-nio-8080-exec-4] [d1287e4d-3f36-4c1a-80f2-1c3c6ff64691] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/background.gif
2026-01-06 18:47:47.149  INFO [http-nio-8080-exec-6] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 18:47:47.150  INFO [http-nio-8080-exec-6] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 18:47:47.151  INFO [http-nio-8080-exec-6] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2026-01-06 18:47:47.152 DEBUG [http-nio-8080-exec-6] [8319cbc1-4078-4a57-a2f1-4226127c3521] o.s.security.web.FilterChainProxy        : Securing GET /favicon.ico
2026-01-06 18:47:47.153 DEBUG [http-nio-8080-exec-6] [8319cbc1-4078-4a57-a2f1-4226127c3521] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:47.155 DEBUG [http-nio-8080-exec-6] [8319cbc1-4078-4a57-a2f1-4226127c3521] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 18:47:47.173 DEBUG [http-nio-8080-exec-6] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 18:47:47.173 DEBUG [http-nio-8080-exec-6] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:47.174 DEBUG [http-nio-8080-exec-6] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 18:47:58.974 DEBUG [http-nio-8080-exec-7] [57e1db12-477c-4095-a4c8-2e9b75d52e3f] o.s.security.web.FilterChainProxy        : Securing POST /h2-console/login.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:58.975 DEBUG [http-nio-8080-exec-7] [57e1db12-477c-4095-a4c8-2e9b75d52e3f] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:58.975 DEBUG [http-nio-8080-exec-7] [57e1db12-477c-4095-a4c8-2e9b75d52e3f] o.s.security.web.FilterChainProxy        : Secured POST /h2-console/login.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.021 DEBUG [http-nio-8080-exec-8] [de9450d9-d61e-462c-aaa7-25fd40b130fb] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/stylesheet.css
2026-01-06 18:47:59.022 DEBUG [http-nio-8080-exec-8] [de9450d9-d61e-462c-aaa7-25fd40b130fb] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.022 DEBUG [http-nio-8080-exec-8] [de9450d9-d61e-462c-aaa7-25fd40b130fb] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/stylesheet.css
2026-01-06 18:47:59.037 DEBUG [http-nio-8080-exec-9] [699fb662-e50f-400c-999d-ec1f1aa8ca59] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/header.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.038 DEBUG [http-nio-8080-exec-9] [699fb662-e50f-400c-999d-ec1f1aa8ca59] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.038 DEBUG [http-nio-8080-exec-10] [0f9059a1-6f54-4b9b-aef2-a4e6fcbfa70a] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tables.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.038 DEBUG [http-nio-8080-exec-9] [699fb662-e50f-400c-999d-ec1f1aa8ca59] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/header.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.039 DEBUG [http-nio-8080-exec-10] [0f9059a1-6f54-4b9b-aef2-a4e6fcbfa70a] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.039 DEBUG [http-nio-8080-exec-10] [0f9059a1-6f54-4b9b-aef2-a4e6fcbfa70a] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tables.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.040 DEBUG [http-nio-8080-exec-2] [baaebe3c-90ee-4e4a-a2f5-989cf00fc5df] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/query.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.040 DEBUG [http-nio-8080-exec-3] [b0bf3de0-94f8-4a94-bb34-aa292d42a999] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/help.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.040 DEBUG [http-nio-8080-exec-2] [baaebe3c-90ee-4e4a-a2f5-989cf00fc5df] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.040 DEBUG [http-nio-8080-exec-3] [b0bf3de0-94f8-4a94-bb34-aa292d42a999] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.041 DEBUG [http-nio-8080-exec-2] [baaebe3c-90ee-4e4a-a2f5-989cf00fc5df] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/query.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.041 DEBUG [http-nio-8080-exec-3] [b0bf3de0-94f8-4a94-bb34-aa292d42a999] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/help.jsp?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:47:59.061 DEBUG [http-nio-8080-exec-5] [e7e3baed-ac80-4f5d-a2f2-b2812e255587] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_disconnect.gif
2026-01-06 18:47:59.062 DEBUG [http-nio-8080-exec-4] [c16b9e5b-a3a9-4f2a-927c-61dc7eea0a72] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_refresh.gif
2026-01-06 18:47:59.062 DEBUG [http-nio-8080-exec-5] [e7e3baed-ac80-4f5d-a2f2-b2812e255587] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.062 DEBUG [http-nio-8080-exec-5] [e7e3baed-ac80-4f5d-a2f2-b2812e255587] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_disconnect.gif
2026-01-06 18:47:59.062 DEBUG [http-nio-8080-exec-4] [c16b9e5b-a3a9-4f2a-927c-61dc7eea0a72] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.062 DEBUG [http-nio-8080-exec-1] [514cb6c1-0c2b-4bcd-89de-0551db38ea92] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_line.gif
2026-01-06 18:47:59.063 DEBUG [http-nio-8080-exec-4] [c16b9e5b-a3a9-4f2a-927c-61dc7eea0a72] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_refresh.gif
2026-01-06 18:47:59.063 DEBUG [http-nio-8080-exec-1] [514cb6c1-0c2b-4bcd-89de-0551db38ea92] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.063 DEBUG [http-nio-8080-exec-1] [514cb6c1-0c2b-4bcd-89de-0551db38ea92] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_line.gif
2026-01-06 18:47:59.065 DEBUG [http-nio-8080-exec-6] [60bae1a3-21ed-4c90-a5af-4b146dc2e215] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_rollback.gif
2026-01-06 18:47:59.065 DEBUG [http-nio-8080-exec-7] [612ea389-4f81-42a5-b50a-1349eb1d983f] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_commit.gif
2026-01-06 18:47:59.065 DEBUG [http-nio-8080-exec-6] [60bae1a3-21ed-4c90-a5af-4b146dc2e215] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.065 DEBUG [http-nio-8080-exec-7] [612ea389-4f81-42a5-b50a-1349eb1d983f] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.065 DEBUG [http-nio-8080-exec-6] [60bae1a3-21ed-4c90-a5af-4b146dc2e215] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_rollback.gif
2026-01-06 18:47:59.065 DEBUG [http-nio-8080-exec-7] [612ea389-4f81-42a5-b50a-1349eb1d983f] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_commit.gif
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-3] [d9b30f07-4560-4b5e-9d06-e45a606b6d6f] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_stop.gif
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-9] [e32c090f-5a3f-4262-b703-900fa831e280] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_run_selected.gif
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-8] [4798d860-3909-47bd-862a-cab6f5a078e0] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_run.gif
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-3] [d9b30f07-4560-4b5e-9d06-e45a606b6d6f] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-9] [e32c090f-5a3f-4262-b703-900fa831e280] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-8] [4798d860-3909-47bd-862a-cab6f5a078e0] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-3] [d9b30f07-4560-4b5e-9d06-e45a606b6d6f] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_stop.gif
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-8] [4798d860-3909-47bd-862a-cab6f5a078e0] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_run.gif
2026-01-06 18:47:59.070 DEBUG [http-nio-8080-exec-9] [e32c090f-5a3f-4262-b703-900fa831e280] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_run_selected.gif
2026-01-06 18:47:59.073 DEBUG [http-nio-8080-exec-2] [bf779ead-4abc-4a56-8970-9a08593d3ee6] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_history.gif
2026-01-06 18:47:59.073 DEBUG [http-nio-8080-exec-5] [f11d57c8-e6a1-499e-b46d-89988a7e25a3] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_help.gif
2026-01-06 18:47:59.074 DEBUG [http-nio-8080-exec-5] [f11d57c8-e6a1-499e-b46d-89988a7e25a3] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.074 DEBUG [http-nio-8080-exec-2] [bf779ead-4abc-4a56-8970-9a08593d3ee6] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.074 DEBUG [http-nio-8080-exec-2] [bf779ead-4abc-4a56-8970-9a08593d3ee6] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_history.gif
2026-01-06 18:47:59.074 DEBUG [http-nio-8080-exec-5] [f11d57c8-e6a1-499e-b46d-89988a7e25a3] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_help.gif
2026-01-06 18:47:59.126 DEBUG [http-nio-8080-exec-4] [8b3d331a-1484-4a42-83b4-3d416a54b749] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree.js
2026-01-06 18:47:59.127 DEBUG [http-nio-8080-exec-4] [8b3d331a-1484-4a42-83b4-3d416a54b749] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.127 DEBUG [http-nio-8080-exec-4] [8b3d331a-1484-4a42-83b4-3d416a54b749] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree.js
2026-01-06 18:47:59.143 DEBUG [http-nio-8080-exec-3] [b6fd5455-cf57-45f0-b6bd-9b4f53de7015] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_column.gif
2026-01-06 18:47:59.143 DEBUG [http-nio-8080-exec-8] [dcc51ae6-c323-46a3-9b61-babf3a66e8a7] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_empty.gif
2026-01-06 18:47:59.143 DEBUG [http-nio-8080-exec-6] [148e5f0e-adb1-4530-8062-f4d29ee6c38b] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_database.gif
2026-01-06 18:47:59.143 DEBUG [http-nio-8080-exec-7] [1765d473-fc62-4149-bb84-e665d3d2c4d3] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_plus.gif
2026-01-06 18:47:59.143 DEBUG [http-nio-8080-exec-1] [26b4485a-010c-4eed-bf1d-ede14c64a9ce] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_minus.gif
2026-01-06 18:47:59.143 DEBUG [http-nio-8080-exec-9] [b597de0d-bcfb-42ad-abb3-0770bffc0c55] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_table.gif
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-8] [dcc51ae6-c323-46a3-9b61-babf3a66e8a7] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-1] [26b4485a-010c-4eed-bf1d-ede14c64a9ce] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-3] [b6fd5455-cf57-45f0-b6bd-9b4f53de7015] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-9] [b597de0d-bcfb-42ad-abb3-0770bffc0c55] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-6] [148e5f0e-adb1-4530-8062-f4d29ee6c38b] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-7] [1765d473-fc62-4149-bb84-e665d3d2c4d3] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-1] [26b4485a-010c-4eed-bf1d-ede14c64a9ce] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_minus.gif
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-8] [dcc51ae6-c323-46a3-9b61-babf3a66e8a7] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_empty.gif
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-3] [b6fd5455-cf57-45f0-b6bd-9b4f53de7015] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_column.gif
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-9] [b597de0d-bcfb-42ad-abb3-0770bffc0c55] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_table.gif
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-7] [1765d473-fc62-4149-bb84-e665d3d2c4d3] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_plus.gif
2026-01-06 18:47:59.144 DEBUG [http-nio-8080-exec-6] [148e5f0e-adb1-4530-8062-f4d29ee6c38b] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_database.gif
2026-01-06 18:47:59.152 DEBUG [http-nio-8080-exec-2] [fd3173cb-eac1-4989-923b-85f80f269a34] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_type.gif
2026-01-06 18:47:59.152 DEBUG [http-nio-8080-exec-10] [bbf6aa37-2597-4718-93f4-081e144d1e79] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_index.gif
2026-01-06 18:47:59.152 DEBUG [http-nio-8080-exec-5] [96bd4212-2da6-418c-9cfe-5aadfbf486c1] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_index_az.gif
2026-01-06 18:47:59.153 DEBUG [http-nio-8080-exec-10] [bbf6aa37-2597-4718-93f4-081e144d1e79] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.153 DEBUG [http-nio-8080-exec-2] [fd3173cb-eac1-4989-923b-85f80f269a34] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.153 DEBUG [http-nio-8080-exec-5] [96bd4212-2da6-418c-9cfe-5aadfbf486c1] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.153 DEBUG [http-nio-8080-exec-10] [bbf6aa37-2597-4718-93f4-081e144d1e79] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_index.gif
2026-01-06 18:47:59.153 DEBUG [http-nio-8080-exec-2] [fd3173cb-eac1-4989-923b-85f80f269a34] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_type.gif
2026-01-06 18:47:59.153 DEBUG [http-nio-8080-exec-5] [96bd4212-2da6-418c-9cfe-5aadfbf486c1] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_index_az.gif
2026-01-06 18:47:59.158 DEBUG [http-nio-8080-exec-4] [9be1f489-74ef-4851-a578-aec23a876d8e] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_folder.gif
2026-01-06 18:47:59.158 DEBUG [http-nio-8080-exec-4] [9be1f489-74ef-4851-a578-aec23a876d8e] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.159 DEBUG [http-nio-8080-exec-4] [9be1f489-74ef-4851-a578-aec23a876d8e] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_folder.gif
2026-01-06 18:47:59.159 DEBUG [http-nio-8080-exec-9] [ec682feb-0a6b-4105-9873-ba766b8312b1] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_view.gif
2026-01-06 18:47:59.160 DEBUG [http-nio-8080-exec-9] [ec682feb-0a6b-4105-9873-ba766b8312b1] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.160 DEBUG [http-nio-8080-exec-9] [ec682feb-0a6b-4105-9873-ba766b8312b1] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_view.gif
2026-01-06 18:47:59.161 DEBUG [http-nio-8080-exec-1] [33444720-f86b-48bd-ab85-b9eb4842038c] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_users.gif
2026-01-06 18:47:59.162 DEBUG [http-nio-8080-exec-1] [33444720-f86b-48bd-ab85-b9eb4842038c] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.162 DEBUG [http-nio-8080-exec-3] [87e34e91-2f99-4268-9223-e30e95fa2fb9] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_user.gif
2026-01-06 18:47:59.162 DEBUG [http-nio-8080-exec-7] [5bd5b160-ab71-4f30-954e-be8a275f4006] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_info.gif
2026-01-06 18:47:59.162 DEBUG [http-nio-8080-exec-3] [87e34e91-2f99-4268-9223-e30e95fa2fb9] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.162 DEBUG [http-nio-8080-exec-7] [5bd5b160-ab71-4f30-954e-be8a275f4006] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.162 DEBUG [http-nio-8080-exec-1] [33444720-f86b-48bd-ab85-b9eb4842038c] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_users.gif
2026-01-06 18:47:59.163 DEBUG [http-nio-8080-exec-3] [87e34e91-2f99-4268-9223-e30e95fa2fb9] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_user.gif
2026-01-06 18:47:59.163 DEBUG [http-nio-8080-exec-7] [5bd5b160-ab71-4f30-954e-be8a275f4006] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_info.gif
2026-01-06 18:47:59.207 DEBUG [http-nio-8080-exec-8] [7dd6dfc1-995a-4ab3-b809-c467a4aee4fb] o.s.security.web.FilterChainProxy        : Securing GET /favicon.ico
2026-01-06 18:47:59.208 DEBUG [http-nio-8080-exec-8] [7dd6dfc1-995a-4ab3-b809-c467a4aee4fb] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.210 DEBUG [http-nio-8080-exec-8] [7dd6dfc1-995a-4ab3-b809-c467a4aee4fb] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 18:47:59.212 DEBUG [http-nio-8080-exec-8] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 18:47:59.212 DEBUG [http-nio-8080-exec-8] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:47:59.213 DEBUG [http-nio-8080-exec-8] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 18:48:06.355 DEBUG [http-nio-8080-exec-6] [3fef255d-5c28-4bdd-8147-0f07fc847d12] o.s.security.web.FilterChainProxy        : Securing POST /h2-console/query.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:48:06.355 DEBUG [http-nio-8080-exec-6] [3fef255d-5c28-4bdd-8147-0f07fc847d12] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:48:06.355 DEBUG [http-nio-8080-exec-6] [3fef255d-5c28-4bdd-8147-0f07fc847d12] o.s.security.web.FilterChainProxy        : Secured POST /h2-console/query.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:48:06.375 DEBUG [http-nio-8080-exec-10] [a68ba1ed-b429-4ff3-8bb8-b3e49e1c72ac] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/table.js
2026-01-06 18:48:06.376 DEBUG [http-nio-8080-exec-10] [a68ba1ed-b429-4ff3-8bb8-b3e49e1c72ac] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:48:06.376 DEBUG [http-nio-8080-exec-10] [a68ba1ed-b429-4ff3-8bb8-b3e49e1c72ac] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/table.js
2026-01-06 18:48:16.315 DEBUG [http-nio-8080-exec-5] [a0bf95bb-efea-4456-9c06-51e23954182d] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/register
2026-01-06 18:48:16.316 DEBUG [http-nio-8080-exec-5] [a0bf95bb-efea-4456-9c06-51e23954182d] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:48:16.317 DEBUG [http-nio-8080-exec-5] [a0bf95bb-efea-4456-9c06-51e23954182d] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/register
2026-01-06 18:48:16.568 DEBUG [http-nio-8080-exec-5] [a0bf95bb-efea-4456-9c06-51e23954182d] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.username=? 
    fetch
        first ? rows only
2026-01-06 18:48:16.576 DEBUG [http-nio-8080-exec-5] [a0bf95bb-efea-4456-9c06-51e23954182d] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.email=? 
    fetch
        first ? rows only
2026-01-06 18:48:16.695 DEBUG [http-nio-8080-exec-5] [a0bf95bb-efea-4456-9c06-51e23954182d] org.hibernate.SQL                        : 
    insert 
    into
        users
        (account_status, activation_token, activation_token_expiry, active, created_at, email, first_name, last_name, password, updated_at, username, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 18:48:16.901 DEBUG [http-nio-8080-exec-5] [a0bf95bb-efea-4456-9c06-51e23954182d] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 18:48:36.691 DEBUG [http-nio-8080-exec-4] [aa2c0418-bb0c-446b-9878-3767cf230ca9] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/login
2026-01-06 18:48:36.691 DEBUG [http-nio-8080-exec-4] [aa2c0418-bb0c-446b-9878-3767cf230ca9] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:48:36.691 DEBUG [http-nio-8080-exec-4] [aa2c0418-bb0c-446b-9878-3767cf230ca9] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/login
2026-01-06 18:48:36.771 DEBUG [http-nio-8080-exec-4] [aa2c0418-bb0c-446b-9878-3767cf230ca9] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:48:36.781 DEBUG [http-nio-8080-exec-4] [aa2c0418-bb0c-446b-9878-3767cf230ca9] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:48:36.841 DEBUG [http-nio-8080-exec-4] [aa2c0418-bb0c-446b-9878-3767cf230ca9] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2026-01-06 18:49:10.262 DEBUG [http-nio-8080-exec-10] [3c38e1d4-d518-4e05-bcd0-73058e10141f] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 18:49:10.302 DEBUG [http-nio-8080-exec-10] [3c38e1d4-d518-4e05-bcd0-73058e10141f] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:49:10.303 DEBUG [http-nio-8080-exec-10] [3c38e1d4-d518-4e05-bcd0-73058e10141f] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:49:10.307 DEBUG [http-nio-8080-exec-10] [3c38e1d4-d518-4e05-bcd0-73058e10141f] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 18:49:26.074 DEBUG [http-nio-8080-exec-5] [71cb9746-5e0e-436f-bcd5-da6e0234d20a] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 18:49:26.077 DEBUG [http-nio-8080-exec-5] [71cb9746-5e0e-436f-bcd5-da6e0234d20a] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:49:26.078 DEBUG [http-nio-8080-exec-5] [71cb9746-5e0e-436f-bcd5-da6e0234d20a] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:49:26.080 DEBUG [http-nio-8080-exec-5] [71cb9746-5e0e-436f-bcd5-da6e0234d20a] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 18:49:26.083 DEBUG [http-nio-8080-exec-5] [71cb9746-5e0e-436f-bcd5-da6e0234d20a] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 18:49:26.122 DEBUG [http-nio-8080-exec-5] [71cb9746-5e0e-436f-bcd5-da6e0234d20a] horizationManagerBeforeMethodInterceptor : Failed to authorize ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController] with authorization manager org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager@22fc26e5 and decision ExpressionAuthorizationDecision [granted=false, expressionAttribute=hasAnyRole('SUDO', 'ADMIN')]
2026-01-06 18:50:00.610 DEBUG [http-nio-8080-exec-4] [bdb1cdfe-b233-47f3-86c5-57aa623eac40] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/register
2026-01-06 18:50:00.612 DEBUG [http-nio-8080-exec-4] [bdb1cdfe-b233-47f3-86c5-57aa623eac40] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:50:00.614 DEBUG [http-nio-8080-exec-4] [bdb1cdfe-b233-47f3-86c5-57aa623eac40] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:50:00.616 DEBUG [http-nio-8080-exec-4] [bdb1cdfe-b233-47f3-86c5-57aa623eac40] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/register
2026-01-06 18:50:00.618 DEBUG [http-nio-8080-exec-4] [bdb1cdfe-b233-47f3-86c5-57aa623eac40] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.username=? 
    fetch
        first ? rows only
2026-01-06 18:50:11.827 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/register
2026-01-06 18:50:11.830 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:50:11.832 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:50:11.836 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/register
2026-01-06 18:50:11.839 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.username=? 
    fetch
        first ? rows only
2026-01-06 18:50:11.841 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.email=? 
    fetch
        first ? rows only
2026-01-06 18:50:11.901 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] org.hibernate.SQL                        : 
    insert 
    into
        users
        (account_status, activation_token, activation_token_expiry, active, created_at, email, first_name, last_name, password, updated_at, username, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 18:50:11.903 DEBUG [http-nio-8080-exec-3] [4493b5f9-5479-47c5-bf7a-0c65e9f2adb5] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 18:50:23.627 DEBUG [http-nio-8080-exec-9] [ce7633a3-427b-4d33-ad26-1e392c4003d3] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/login
2026-01-06 18:50:23.630 DEBUG [http-nio-8080-exec-9] [ce7633a3-427b-4d33-ad26-1e392c4003d3] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:50:23.631 DEBUG [http-nio-8080-exec-9] [ce7633a3-427b-4d33-ad26-1e392c4003d3] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:50:23.633 DEBUG [http-nio-8080-exec-9] [ce7633a3-427b-4d33-ad26-1e392c4003d3] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/login
2026-01-06 18:50:23.636 DEBUG [http-nio-8080-exec-9] [ce7633a3-427b-4d33-ad26-1e392c4003d3] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:50:23.636 DEBUG [http-nio-8080-exec-9] [ce7633a3-427b-4d33-ad26-1e392c4003d3] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:50:23.694 DEBUG [http-nio-8080-exec-9] [ce7633a3-427b-4d33-ad26-1e392c4003d3] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2026-01-06 18:50:55.281 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 18:50:55.283 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:50:55.284 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:50:55.286 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 18:50:55.288 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 18:50:55.289 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 18:50:55.290 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        c1_0.id 
    from
        clients c1_0 
    where
        c1_0.phone=? 
    fetch
        first ? rows only
2026-01-06 18:50:55.294 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 18:50:55.297 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 18:50:55.301 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 18:50:55.302 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 18:50:55.307 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0
2026-01-06 18:50:55.312 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    insert 
    into
        clients
        (client_type, created_at, date_of_birth, name, notes, phone, referral_code, referrer_id, surname, updated_at, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 18:50:55.319 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 18:50:55.323 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 18:50:55.340 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at desc
2026-01-06 18:50:55.347 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 18:50:55.350 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 18:50:55.351  INFO [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] c.w.service.impl.EventBonusServiceImpl   : Welcome bonus granted to client: ab9d348e-771f-4e67-9851-a8b91dce9353
2026-01-06 18:50:55.355 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 18:50:55.356 DEBUG [http-nio-8080-exec-1] [8c41a7ae-1a89-4d76-86c0-1609725637ef] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 18:51:29.030 DEBUG [http-nio-8080-exec-7] [e9849686-5d8d-4bd8-81e5-751f130d2085] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/notes
2026-01-06 18:51:29.033 DEBUG [http-nio-8080-exec-7] [e9849686-5d8d-4bd8-81e5-751f130d2085] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:51:29.034 DEBUG [http-nio-8080-exec-7] [e9849686-5d8d-4bd8-81e5-751f130d2085] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:51:29.037 DEBUG [http-nio-8080-exec-7] [e9849686-5d8d-4bd8-81e5-751f130d2085] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/notes
2026-01-06 18:52:32.163 DEBUG [http-nio-8080-exec-6] [a7f185c1-2fbf-4be0-ab28-8d5f18802b08] o.s.security.web.FilterChainProxy        : Securing POST /h2-console/query.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:52:32.164 DEBUG [http-nio-8080-exec-6] [a7f185c1-2fbf-4be0-ab28-8d5f18802b08] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:52:32.164 DEBUG [http-nio-8080-exec-6] [a7f185c1-2fbf-4be0-ab28-8d5f18802b08] o.s.security.web.FilterChainProxy        : Secured POST /h2-console/query.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 18:52:32.178 DEBUG [http-nio-8080-exec-10] [dc035474-b6e5-493d-9a6c-0ad3fa0b86a9] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/stylesheet.css
2026-01-06 18:52:32.179 DEBUG [http-nio-8080-exec-10] [dc035474-b6e5-493d-9a6c-0ad3fa0b86a9] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:52:32.179 DEBUG [http-nio-8080-exec-2] [38846221-8176-4ff6-83ec-9b3c28ae6dfe] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/table.js
2026-01-06 18:52:32.179 DEBUG [http-nio-8080-exec-10] [dc035474-b6e5-493d-9a6c-0ad3fa0b86a9] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/stylesheet.css
2026-01-06 18:52:32.179 DEBUG [http-nio-8080-exec-2] [38846221-8176-4ff6-83ec-9b3c28ae6dfe] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 18:52:32.179 DEBUG [http-nio-8080-exec-2] [38846221-8176-4ff6-83ec-9b3c28ae6dfe] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/table.js
2026-01-06 18:52:46.609 DEBUG [http-nio-8080-exec-8] [c459b061-0fae-4abb-a4f6-3bd8f6f249ce] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/notes
2026-01-06 18:52:46.611 DEBUG [http-nio-8080-exec-8] [c459b061-0fae-4abb-a4f6-3bd8f6f249ce] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:52:46.612 DEBUG [http-nio-8080-exec-8] [c459b061-0fae-4abb-a4f6-3bd8f6f249ce] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:52:46.614 DEBUG [http-nio-8080-exec-8] [c459b061-0fae-4abb-a4f6-3bd8f6f249ce] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/notes
2026-01-06 18:53:07.827 DEBUG [http-nio-8080-exec-3] [9110decb-0b29-41ff-aca0-97bb6ea1c914] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/notes
2026-01-06 18:53:07.829 DEBUG [http-nio-8080-exec-3] [9110decb-0b29-41ff-aca0-97bb6ea1c914] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:53:07.830 DEBUG [http-nio-8080-exec-3] [9110decb-0b29-41ff-aca0-97bb6ea1c914] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:53:07.833 DEBUG [http-nio-8080-exec-3] [9110decb-0b29-41ff-aca0-97bb6ea1c914] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/notes
2026-01-06 18:53:19.918 DEBUG [http-nio-8080-exec-9] [0e1cee75-3376-446f-aa78-3a2dc27bfd78] o.s.security.web.FilterChainProxy        : Securing GET /api/v1/clients/notes
2026-01-06 18:53:19.921 DEBUG [http-nio-8080-exec-9] [0e1cee75-3376-446f-aa78-3a2dc27bfd78] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:53:19.921 DEBUG [http-nio-8080-exec-9] [0e1cee75-3376-446f-aa78-3a2dc27bfd78] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:53:19.924 DEBUG [http-nio-8080-exec-9] [0e1cee75-3376-446f-aa78-3a2dc27bfd78] o.s.security.web.FilterChainProxy        : Secured GET /api/v1/clients/notes
2026-01-06 18:55:47.344 DEBUG [http-nio-8080-exec-10] [a9f29cd3-e59f-46ad-aaa4-7930f707f722] o.s.security.web.FilterChainProxy        : Securing PUT /api/v1/clients/notes
2026-01-06 18:55:47.346 DEBUG [http-nio-8080-exec-10] [a9f29cd3-e59f-46ad-aaa4-7930f707f722] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 18:55:47.347 DEBUG [http-nio-8080-exec-10] [a9f29cd3-e59f-46ad-aaa4-7930f707f722] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 18:55:47.350 DEBUG [http-nio-8080-exec-10] [a9f29cd3-e59f-46ad-aaa4-7930f707f722] o.s.security.web.FilterChainProxy        : Secured PUT /api/v1/clients/notes
2026-01-06 18:55:47.355 DEBUG [http-nio-8080-exec-10] [a9f29cd3-e59f-46ad-aaa4-7930f707f722] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 18:55:47.355 DEBUG [http-nio-8080-exec-10] [a9f29cd3-e59f-46ad-aaa4-7930f707f722] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 18:55:47.360 DEBUG [http-nio-8080-exec-10] [a9f29cd3-e59f-46ad-aaa4-7930f707f722] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid is null
2026-01-06 19:00:19.931 DEBUG [http-nio-8080-exec-8] [ee2c706c-c1f0-41a2-a84f-0e2546b7a4e3] o.s.security.web.FilterChainProxy        : Securing PUT /api/v1/clients/notes
2026-01-06 19:00:19.933 DEBUG [http-nio-8080-exec-8] [ee2c706c-c1f0-41a2-a84f-0e2546b7a4e3] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:00:19.935 DEBUG [http-nio-8080-exec-8] [ee2c706c-c1f0-41a2-a84f-0e2546b7a4e3] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:00:19.937 DEBUG [http-nio-8080-exec-8] [ee2c706c-c1f0-41a2-a84f-0e2546b7a4e3] o.s.security.web.FilterChainProxy        : Secured PUT /api/v1/clients/notes
2026-01-06 19:00:19.938 DEBUG [http-nio-8080-exec-8] [ee2c706c-c1f0-41a2-a84f-0e2546b7a4e3] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:00:19.938 DEBUG [http-nio-8080-exec-8] [ee2c706c-c1f0-41a2-a84f-0e2546b7a4e3] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:00:19.941 DEBUG [http-nio-8080-exec-8] [ee2c706c-c1f0-41a2-a84f-0e2546b7a4e3] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid is null
2026-01-06 19:00:21.509 DEBUG [http-nio-8080-exec-3] [c09db019-f872-43ad-ba51-20683b631404] o.s.security.web.FilterChainProxy        : Securing PUT /api/v1/clients/notes
2026-01-06 19:00:21.516 DEBUG [http-nio-8080-exec-3] [c09db019-f872-43ad-ba51-20683b631404] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:00:21.518 DEBUG [http-nio-8080-exec-3] [c09db019-f872-43ad-ba51-20683b631404] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:00:21.522 DEBUG [http-nio-8080-exec-3] [c09db019-f872-43ad-ba51-20683b631404] o.s.security.web.FilterChainProxy        : Secured PUT /api/v1/clients/notes
2026-01-06 19:00:21.523 DEBUG [http-nio-8080-exec-3] [c09db019-f872-43ad-ba51-20683b631404] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:00:21.523 DEBUG [http-nio-8080-exec-3] [c09db019-f872-43ad-ba51-20683b631404] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:00:21.526 DEBUG [http-nio-8080-exec-3] [c09db019-f872-43ad-ba51-20683b631404] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid is null
2026-01-06 19:01:15.999  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 19:01:16.003  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 19:01:16.005  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 19:01:22.846  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 23 with PID 8264 (C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes started by user in C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend)
2026-01-06 19:01:22.850 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 19:01:22.851  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 19:01:24.125  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 19:01:24.245  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 102 ms. Found 7 JPA repository interfaces.
2026-01-06 19:01:26.201  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 19:01:26.255  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 19:01:26.256  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 19:01:26.421  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 19:01:26.424  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 3474 ms
2026-01-06 19:01:26.510  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 19:01:26.887  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 19:01:26.894  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 19:01:26.926  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 19:01:27.705  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 19:01:27.718  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 19:01:27.821  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 19:01:27.836  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.075s)
2026-01-06 19:01:27.865  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 19:01:28.005  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 19:01:28.023  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 19:01:28.079  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 19:01:28.096  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 19:01:28.106  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 19:01:28.121  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 19:01:28.130  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 19:01:28.163  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 19:01:28.205  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 19:01:28.232  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 19:01:28.242  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 19:01:28.264  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 19:01:28.283  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 19:01:28.300  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 19:01:28.312  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 19:01:28.356  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.188s)
2026-01-06 19:01:28.613  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 19:01:28.723  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 19:01:28.783  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 19:01:29.218  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 19:01:29.272  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 19:01:29.425  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 19:01:30.785  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 19:01:30.819 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 19:01:30.821 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 19:01:30.822 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 19:01:30.823 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 19:01:30.823 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 19:01:30.824 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 19:01:30.827 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 19:01:30.828 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 19:01:30.829 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 19:01:30.830 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 19:01:30.831 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 19:01:30.832 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 19:01:30.833 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 19:01:30.859  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 19:01:31.474 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 19:01:31.474 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 19:01:31.557  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 19:01:32.948  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 19:01:32.950  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 19:01:33.339  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 19:01:33.860 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 19:01:34.488  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 19:01:34.500  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 12.717 seconds (process running for 13.488)
2026-01-06 19:01:37.695  INFO [http-nio-8080-exec-4] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 19:01:37.695  INFO [http-nio-8080-exec-4] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 19:01:37.696  INFO [http-nio-8080-exec-4] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2026-01-06 19:01:37.722 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/register
2026-01-06 19:01:37.947 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:01:37.958 ERROR [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] c.w.security.JwtAuthenticationFilter     : Cannot set user authentication: {}

org.springframework.security.core.userdetails.UsernameNotFoundException: User not found with username: test
	at com.westwood.security.UserDetailsServiceImpl.lambda$loadUserByUsername$0(UserDetailsServiceImpl.java:23)
	at java.base/java.util.Optional.orElseThrow(Optional.java:403)
	at com.westwood.security.UserDetailsServiceImpl.loadUserByUsername(UserDetailsServiceImpl.java:23)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.westwood.security.UserDetailsServiceImpl$$SpringCGLIB$$0.loadUserByUsername(<generated>)
	at com.westwood.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:45)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.westwood.config.RequestIdFilter.doFilterInternal(RequestIdFilter.java:47)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1575)

2026-01-06 19:01:37.963 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:01:37.966 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/register
2026-01-06 19:01:38.070 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.username=? 
    fetch
        first ? rows only
2026-01-06 19:01:38.073 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.email=? 
    fetch
        first ? rows only
2026-01-06 19:01:38.213 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] org.hibernate.SQL                        : 
    insert 
    into
        users
        (account_status, activation_token, activation_token_expiry, active, created_at, email, first_name, last_name, password, updated_at, username, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 19:01:38.294 DEBUG [http-nio-8080-exec-4] [090a2369-b63d-4333-881b-b27e4feab4b4] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 19:01:42.340 DEBUG [http-nio-8080-exec-2] [64eaf408-22bb-4983-bffc-6800f0dca62b] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/login
2026-01-06 19:01:42.343 DEBUG [http-nio-8080-exec-2] [64eaf408-22bb-4983-bffc-6800f0dca62b] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:01:42.352 DEBUG [http-nio-8080-exec-2] [64eaf408-22bb-4983-bffc-6800f0dca62b] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:01:42.357 DEBUG [http-nio-8080-exec-2] [64eaf408-22bb-4983-bffc-6800f0dca62b] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/login
2026-01-06 19:01:42.420 DEBUG [http-nio-8080-exec-2] [64eaf408-22bb-4983-bffc-6800f0dca62b] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:01:42.421 DEBUG [http-nio-8080-exec-2] [64eaf408-22bb-4983-bffc-6800f0dca62b] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:01:42.479 DEBUG [http-nio-8080-exec-2] [64eaf408-22bb-4983-bffc-6800f0dca62b] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2026-01-06 19:01:56.853 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 19:01:56.856 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:01:56.856 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:01:56.858 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 19:01:56.872 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:01:56.906 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:01:56.908 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        c1_0.id 
    from
        clients c1_0 
    where
        c1_0.phone=? 
    fetch
        first ? rows only
2026-01-06 19:01:56.911 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 19:01:56.914 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 19:01:56.917 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 19:01:56.918 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 19:01:56.923 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0
2026-01-06 19:01:56.926 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    insert 
    into
        clients
        (client_type, created_at, date_of_birth, name, notes, phone, referral_code, referrer_id, surname, updated_at, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 19:01:56.933 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 19:01:56.937 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 19:01:56.957 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at desc
2026-01-06 19:01:56.964 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 19:01:56.968 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 19:01:56.970  INFO [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] c.w.service.impl.EventBonusServiceImpl   : Welcome bonus granted to client: 7c508cd0-8ae8-4110-82f0-156d15a9ead3
2026-01-06 19:01:56.974 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 19:01:56.974 DEBUG [http-nio-8080-exec-3] [20d60408-5081-499b-8064-05ef3d908d3c] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 19:03:42.422 DEBUG [http-nio-8080-exec-6] [323227a5-b78f-41d2-8b4f-1b2a3eb5f69b] o.s.security.web.FilterChainProxy        : Securing PUT /api/v1/clients/notes
2026-01-06 19:03:42.426 DEBUG [http-nio-8080-exec-6] [323227a5-b78f-41d2-8b4f-1b2a3eb5f69b] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:03:42.427 DEBUG [http-nio-8080-exec-6] [323227a5-b78f-41d2-8b4f-1b2a3eb5f69b] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:03:42.430 DEBUG [http-nio-8080-exec-6] [323227a5-b78f-41d2-8b4f-1b2a3eb5f69b] o.s.security.web.FilterChainProxy        : Secured PUT /api/v1/clients/notes
2026-01-06 19:03:42.435 DEBUG [http-nio-8080-exec-6] [323227a5-b78f-41d2-8b4f-1b2a3eb5f69b] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:03:42.436 DEBUG [http-nio-8080-exec-6] [323227a5-b78f-41d2-8b4f-1b2a3eb5f69b] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:03:56.897 DEBUG [http-nio-8080-exec-6] [323227a5-b78f-41d2-8b4f-1b2a3eb5f69b] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid is null
2026-01-06 19:03:56.962  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 19:03:56.963  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 19:03:56.967  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-06 19:04:11.634  INFO [main] [] c.westwood.WestwoodBackendApplication    : Starting WestwoodBackendApplication using Java 23 with PID 17516 (C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend\target\classes started by user in C:\Users\user\Desktop\koke\westFrontnd\westwood-loyalty-backend)
2026-01-06 19:04:11.636 DEBUG [main] [] c.westwood.WestwoodBackendApplication    : Running with Spring Boot v3.3.5, Spring v6.1.14
2026-01-06 19:04:11.637  INFO [main] [] c.westwood.WestwoodBackendApplication    : The following 1 profile is active: "dev"
2026-01-06 19:04:12.766  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-06 19:04:12.860  INFO [main] [] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 82 ms. Found 7 JPA repository interfaces.
2026-01-06 19:04:14.620  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-06 19:04:14.661  INFO [main] [] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-06 19:04:14.663  INFO [main] [] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
2026-01-06 19:04:14.916  INFO [main] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-06 19:04:14.919  INFO [main] [] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 3203 ms
2026-01-06 19:04:15.020  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-06 19:04:15.436  INFO [main] [] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:devdb user=SA
2026-01-06 19:04:15.443  INFO [main] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-06 19:04:15.487  INFO [main] [] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:devdb'
2026-01-06 19:04:16.244  INFO [main] [] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:devdb (H2 2.2)
2026-01-06 19:04:16.253  WARN [main] [] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-06 19:04:16.311  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-06 19:04:16.315  INFO [main] [] o.f.core.internal.command.DbValidate     : Successfully validated 14 migrations (execution time 00:00.038s)
2026-01-06 19:04:16.326  INFO [main] [] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-06 19:04:16.380  INFO [main] [] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-06 19:04:16.393  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "0 - create clients table"
2026-01-06 19:04:16.429  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - create users table"
2026-01-06 19:04:16.441  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "2 - create payment transactions table"
2026-01-06 19:04:16.451  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "3 - create bonus events table"
2026-01-06 19:04:16.472  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - create event store table"
2026-01-06 19:04:16.484  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "6 - add uuid to clients and users"
2026-01-06 19:04:16.533  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "7 - add user activation fields"
2026-01-06 19:04:16.567  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "8 - add date of birth to clients"
2026-01-06 19:04:16.578  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "9 - create bonus types table"
2026-01-06 19:04:16.586  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "10 - add referral fields to clients"
2026-01-06 19:04:16.603  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "11 - add bonus type to bonus granted"
2026-01-06 19:04:16.616  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "13 - add expiration to bonuses"
2026-01-06 19:04:16.629  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "14 - insert preconfigured bonus types"
2026-01-06 19:04:16.640  INFO [main] [] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "15 - refactor tags to entity"
2026-01-06 19:04:16.662  INFO [main] [] o.f.core.internal.command.DbMigrate      : Successfully applied 14 migrations to schema "PUBLIC", now at version v15 (execution time 00:00.165s)
2026-01-06 19:04:16.918  INFO [main] [] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-06 19:04:17.003  INFO [main] [] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.5.3.Final
2026-01-06 19:04:17.049  INFO [main] [] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-06 19:04:17.359  INFO [main] [] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-06 19:04:17.404  WARN [main] [] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-06 19:04:17.526  WARN [main] [] o.h.boot.model.internal.EntityBinder     : HHH000457: Joined inheritance hierarchy [com.westwood.domain.BonusEvent] defined explicit @DiscriminatorColumn.  Legacy Hibernate behavior was to ignore the @DiscriminatorColumn.  However, as part of issue HHH-6911 we now apply the explicit @DiscriminatorColumn.  If you would prefer the legacy behavior, enable the `hibernate.discriminator.ignore_explicit_for_joined` setting (hibernate.discriminator.ignore_explicit_for_joined=true)
2026-01-06 19:04:18.919  INFO [main] [] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-06 19:04:18.949 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_events 
       alter column event_type set data type varchar(31)
2026-01-06 19:04:18.950 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists bonus_types 
       alter column description set data type TEXT
2026-01-06 19:04:18.951 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       alter column notes set data type TEXT
2026-01-06 19:04:18.951 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column aggregate_type set data type varchar(255)
2026-01-06 19:04:18.951 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists event_store 
       alter column event_data set data type TEXT
2026-01-06 19:04:18.953 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists payment_transactions 
       alter column notes set data type TEXT
2026-01-06 19:04:18.956 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       drop constraint if exists idx_client_uuid
2026-01-06 19:04:18.957 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists clients 
       add constraint idx_client_uuid unique (uuid)
2026-01-06 19:04:18.958 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_aggregate_id 
       on event_store (aggregate_id)
2026-01-06 19:04:18.959 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_event_type 
       on event_store (event_type)
2026-01-06 19:04:18.960 DEBUG [main] [] org.hibernate.SQL                        : 
    create index idx_timestamp 
       on event_store (timestamp)
2026-01-06 19:04:18.961 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       drop constraint if exists idx_user_uuid
2026-01-06 19:04:18.961 DEBUG [main] [] org.hibernate.SQL                        : 
    alter table if exists users 
       add constraint idx_user_uuid unique (uuid)
2026-01-06 19:04:18.975  INFO [main] [] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 19:04:19.530 DEBUG [main] [] c.w.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2026-01-06 19:04:19.531 DEBUG [main] [] com.westwood.config.RequestIdFilter      : Filter 'requestIdFilter' configured for use
2026-01-06 19:04:19.621  INFO [main] [] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-06 19:04:21.056  INFO [main] [] eAuthenticationProviderManagerConfigurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2026-01-06 19:04:21.059  WARN [main] [] r$InitializeUserDetailsManagerConfigurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used for username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider.
2026-01-06 19:04:21.469  WARN [main] [] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-06 19:04:22.012 DEBUG [main] [] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-06 19:04:22.678  INFO [main] [] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-06 19:04:22.696  INFO [main] [] c.westwood.WestwoodBackendApplication    : Started WestwoodBackendApplication in 11.96 seconds (process running for 12.622)
2026-01-06 19:04:40.585  INFO [http-nio-8080-exec-2] [] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-06 19:04:40.585  INFO [http-nio-8080-exec-2] [] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-06 19:04:40.587  INFO [http-nio-8080-exec-2] [] o.s.web.servlet.DispatcherServlet        : Completed initialization in 2 ms
2026-01-06 19:04:40.605 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/register
2026-01-06 19:04:40.781 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:04:40.788 ERROR [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] c.w.security.JwtAuthenticationFilter     : Cannot set user authentication: {}

org.springframework.security.core.userdetails.UsernameNotFoundException: User not found with username: test
	at com.westwood.security.UserDetailsServiceImpl.lambda$loadUserByUsername$0(UserDetailsServiceImpl.java:23)
	at java.base/java.util.Optional.orElseThrow(Optional.java:403)
	at com.westwood.security.UserDetailsServiceImpl.loadUserByUsername(UserDetailsServiceImpl.java:23)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.westwood.security.UserDetailsServiceImpl$$SpringCGLIB$$0.loadUserByUsername(<generated>)
	at com.westwood.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:45)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.westwood.config.RequestIdFilter.doFilterInternal(RequestIdFilter.java:47)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1575)

2026-01-06 19:04:40.795 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:04:40.797 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/register
2026-01-06 19:04:40.911 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.username=? 
    fetch
        first ? rows only
2026-01-06 19:04:40.914 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] org.hibernate.SQL                        : 
    select
        u1_0.id 
    from
        users u1_0 
    where
        u1_0.email=? 
    fetch
        first ? rows only
2026-01-06 19:04:41.027 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] org.hibernate.SQL                        : 
    insert 
    into
        users
        (account_status, activation_token, activation_token_expiry, active, created_at, email, first_name, last_name, password, updated_at, username, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 19:04:41.114 DEBUG [http-nio-8080-exec-2] [b4e3ee30-049d-49e1-abf9-d3f1f13d1993] org.hibernate.SQL                        : 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2026-01-06 19:04:44.303 DEBUG [http-nio-8080-exec-3] [6b057532-f6d7-47b0-98fa-327bec21899d] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/auth/login
2026-01-06 19:04:44.306 DEBUG [http-nio-8080-exec-3] [6b057532-f6d7-47b0-98fa-327bec21899d] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:04:44.314 DEBUG [http-nio-8080-exec-3] [6b057532-f6d7-47b0-98fa-327bec21899d] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:04:44.319 DEBUG [http-nio-8080-exec-3] [6b057532-f6d7-47b0-98fa-327bec21899d] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/auth/login
2026-01-06 19:04:44.384 DEBUG [http-nio-8080-exec-3] [6b057532-f6d7-47b0-98fa-327bec21899d] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:04:44.385 DEBUG [http-nio-8080-exec-3] [6b057532-f6d7-47b0-98fa-327bec21899d] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:04:44.444 DEBUG [http-nio-8080-exec-3] [6b057532-f6d7-47b0-98fa-327bec21899d] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2026-01-06 19:05:04.514 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] o.s.security.web.FilterChainProxy        : Securing POST /api/v1/clients
2026-01-06 19:05:04.517 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:05:04.518 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:05:04.520 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] o.s.security.web.FilterChainProxy        : Secured POST /api/v1/clients
2026-01-06 19:05:04.534 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:05:04.573 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.createClient(com.westwood.common.dto.CreateClientRequest); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:05:04.575 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        c1_0.id 
    from
        clients c1_0 
    where
        c1_0.phone=? 
    fetch
        first ? rows only
2026-01-06 19:05:04.579 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 19:05:04.583 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 19:05:04.586 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        t1_0.id,
        t1_0.created_at,
        t1_0.name,
        t1_0.updated_at,
        t1_0.version 
    from
        tags t1_0 
    where
        t1_0.name=?
2026-01-06 19:05:04.588 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    insert 
    into
        tags
        (created_at, name, updated_at, version, id) 
    values
        (?, ?, ?, ?, default)
2026-01-06 19:05:04.595 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0
2026-01-06 19:05:04.600 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    insert 
    into
        clients
        (client_type, created_at, date_of_birth, name, notes, phone, referral_code, referrer_id, surname, updated_at, uuid, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2026-01-06 19:05:04.611 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        bt1_0.id,
        bt1_0.bonus_amount,
        bt1_0.bonus_percentage,
        bt1_0.created_at,
        bt1_0.description,
        bt1_0.enabled,
        bt1_0.expiration_days,
        bt1_0.milestone_threshold,
        bt1_0.name,
        bt1_0.type,
        bt1_0.updated_at,
        bt1_0.version 
    from
        bonus_types bt1_0 
    where
        bt1_0.type=? 
        and bt1_0.enabled
2026-01-06 19:05:04.616 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 19:05:04.649 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    select
        be1_0.id,
        be1_0.event_type,
        be1_0.bonus_amount,
        be1_0.client_id,
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version,
        be1_0.created_at,
        be1_0.event_id,
        be1_0.updated_at,
        be1_0.version,
        be1_1.bonus_percentage,
        be1_1.bonus_type_id,
        be1_1.expires_at,
        be1_1.grant_reason,
        be1_1.payment_amount,
        be1_1.payment_transaction_id,
        be1_2.final_payment_amount,
        be1_2.original_payment_amount,
        be1_2.payment_transaction_id 
    from
        bonus_events be1_0 
    left join
        bonus_granted be1_1 
            on be1_0.id=be1_1.id 
    left join
        bonus_used be1_2 
            on be1_0.id=be1_2.id 
    left join
        clients c1_0 
            on c1_0.id=be1_0.client_id 
    where
        be1_0.client_id=? 
    order by
        be1_0.created_at desc
2026-01-06 19:05:04.661 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    insert 
    into
        bonus_events
        (bonus_amount, client_id, created_at, event_id, updated_at, version, event_type, id) 
    values
        (?, ?, ?, ?, ?, ?, 'GRANTED', default)
2026-01-06 19:05:04.664 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    insert 
    into
        bonus_granted
        (bonus_percentage, bonus_type_id, expires_at, grant_reason, payment_amount, payment_transaction_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-06 19:05:04.667  INFO [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] c.w.service.impl.EventBonusServiceImpl   : Welcome bonus granted to client: 2b6efe0b-95a8-48fe-9a12-482f0df1cc48
2026-01-06 19:05:04.670 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 19:05:04.671 DEBUG [http-nio-8080-exec-4] [eb976937-4539-4e95-bd92-274a3cc9fcec] org.hibernate.SQL                        : 
    insert 
    into
        client_tag
        (client_id, tag_id) 
    values
        (?, ?)
2026-01-06 19:05:15.976 DEBUG [http-nio-8080-exec-5] [3cca64d4-313b-42f5-9aa8-57e97ef88160] o.s.security.web.FilterChainProxy        : Securing PUT /api/v1/clients/notes
2026-01-06 19:05:15.978 DEBUG [http-nio-8080-exec-5] [3cca64d4-313b-42f5-9aa8-57e97ef88160] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:05:15.979 DEBUG [http-nio-8080-exec-5] [3cca64d4-313b-42f5-9aa8-57e97ef88160] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:05:15.981 DEBUG [http-nio-8080-exec-5] [3cca64d4-313b-42f5-9aa8-57e97ef88160] o.s.security.web.FilterChainProxy        : Secured PUT /api/v1/clients/notes
2026-01-06 19:05:34.017 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] o.s.security.web.FilterChainProxy        : Securing PUT /api/v1/clients/notes
2026-01-06 19:05:34.019 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:05:34.020 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:05:34.023 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] o.s.security.web.FilterChainProxy        : Secured PUT /api/v1/clients/notes
2026-01-06 19:05:34.024 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:05:34.024 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:05:34.025 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 19:05:34.026 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 19:05:34.038 DEBUG [http-nio-8080-exec-7] [2aa1b581-c4d8-4df1-81f2-fb3145a9ac51] org.hibernate.SQL                        : 
    update
        clients c1_0 
    set
        notes=? 
    where
        c1_0.uuid=?
2026-01-06 19:05:48.954 DEBUG [http-nio-8080-exec-8] [ad6b7d2a-3cf1-42aa-a105-4a40bda78147] o.s.security.web.FilterChainProxy        : Securing POST /h2-console/query.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 19:05:48.954 DEBUG [http-nio-8080-exec-8] [ad6b7d2a-3cf1-42aa-a105-4a40bda78147] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:48.954 DEBUG [http-nio-8080-exec-8] [ad6b7d2a-3cf1-42aa-a105-4a40bda78147] o.s.security.web.FilterChainProxy        : Secured POST /h2-console/query.do?jsessionid=1ce93bfa1bd3fb50bd1634f6fb086c67
2026-01-06 19:05:48.985 DEBUG [http-nio-8080-exec-9] [8aad4c3d-39ee-4c15-b08a-eb3134f4c748] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/stylesheet.css
2026-01-06 19:05:48.986 DEBUG [http-nio-8080-exec-9] [8aad4c3d-39ee-4c15-b08a-eb3134f4c748] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:48.986 DEBUG [http-nio-8080-exec-9] [8aad4c3d-39ee-4c15-b08a-eb3134f4c748] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/stylesheet.css
2026-01-06 19:05:49.003 DEBUG [http-nio-8080-exec-10] [73569195-289d-4fbd-ae52-b5424cc2cecf] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/login.jsp?jsessionid=54bfe071d245b0331a58293d4742e1cc
2026-01-06 19:05:49.003 DEBUG [http-nio-8080-exec-10] [73569195-289d-4fbd-ae52-b5424cc2cecf] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:49.003 DEBUG [http-nio-8080-exec-10] [73569195-289d-4fbd-ae52-b5424cc2cecf] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/login.jsp?jsessionid=54bfe071d245b0331a58293d4742e1cc
2026-01-06 19:05:49.032 DEBUG [http-nio-8080-exec-1] [9b15308e-54b7-40c7-b912-9cdf6339d29f] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/login.jsp
2026-01-06 19:05:49.033 DEBUG [http-nio-8080-exec-1] [9b15308e-54b7-40c7-b912-9cdf6339d29f] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:49.033 DEBUG [http-nio-8080-exec-1] [9b15308e-54b7-40c7-b912-9cdf6339d29f] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/login.jsp
2026-01-06 19:05:49.037 DEBUG [http-nio-8080-exec-2] [33b98350-ab08-4786-8057-3ead1b9418e3] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/background.gif
2026-01-06 19:05:49.037 DEBUG [http-nio-8080-exec-2] [33b98350-ab08-4786-8057-3ead1b9418e3] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:49.038 DEBUG [http-nio-8080-exec-2] [33b98350-ab08-4786-8057-3ead1b9418e3] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/background.gif
2026-01-06 19:05:49.094 DEBUG [http-nio-8080-exec-3] [d7e1ddf1-ed1e-4554-a04d-684d691a65b4] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/login.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:49.095 DEBUG [http-nio-8080-exec-3] [d7e1ddf1-ed1e-4554-a04d-684d691a65b4] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:49.095 DEBUG [http-nio-8080-exec-3] [d7e1ddf1-ed1e-4554-a04d-684d691a65b4] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/login.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:49.235 DEBUG [http-nio-8080-exec-4] [10ef3259-e455-45d5-978c-c216201bbe76] o.s.security.web.FilterChainProxy        : Securing GET /favicon.ico
2026-01-06 19:05:49.235 DEBUG [http-nio-8080-exec-4] [10ef3259-e455-45d5-978c-c216201bbe76] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:49.236 DEBUG [http-nio-8080-exec-4] [10ef3259-e455-45d5-978c-c216201bbe76] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 19:05:49.247 DEBUG [http-nio-8080-exec-4] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 19:05:49.247 DEBUG [http-nio-8080-exec-4] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:49.247 DEBUG [http-nio-8080-exec-4] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 19:05:53.339 DEBUG [http-nio-8080-exec-5] [bde7a6b1-1af2-4092-8fec-222080bdcfdb] o.s.security.web.FilterChainProxy        : Securing POST /h2-console/login.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.339 DEBUG [http-nio-8080-exec-5] [bde7a6b1-1af2-4092-8fec-222080bdcfdb] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.340 DEBUG [http-nio-8080-exec-5] [bde7a6b1-1af2-4092-8fec-222080bdcfdb] o.s.security.web.FilterChainProxy        : Secured POST /h2-console/login.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.401 DEBUG [http-nio-8080-exec-6] [a261f504-e592-4191-af79-e2448e00e718] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/header.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.401 DEBUG [http-nio-8080-exec-7] [6c756319-b280-44d8-b2e5-d373e81172a7] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tables.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.401 DEBUG [http-nio-8080-exec-7] [6c756319-b280-44d8-b2e5-d373e81172a7] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.401 DEBUG [http-nio-8080-exec-6] [a261f504-e592-4191-af79-e2448e00e718] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.402 DEBUG [http-nio-8080-exec-6] [a261f504-e592-4191-af79-e2448e00e718] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/header.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.402 DEBUG [http-nio-8080-exec-7] [6c756319-b280-44d8-b2e5-d373e81172a7] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tables.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.402 DEBUG [http-nio-8080-exec-8] [f3755882-edd0-4a04-b6fe-6d393e532a1e] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/query.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.402 DEBUG [http-nio-8080-exec-9] [41fa221b-a0b5-4c54-aa93-1542ede97cbe] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/help.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.403 DEBUG [http-nio-8080-exec-9] [41fa221b-a0b5-4c54-aa93-1542ede97cbe] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.403 DEBUG [http-nio-8080-exec-8] [f3755882-edd0-4a04-b6fe-6d393e532a1e] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.403 DEBUG [http-nio-8080-exec-9] [41fa221b-a0b5-4c54-aa93-1542ede97cbe] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/help.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.403 DEBUG [http-nio-8080-exec-8] [f3755882-edd0-4a04-b6fe-6d393e532a1e] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/query.jsp?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:53.424 DEBUG [http-nio-8080-exec-10] [39ac8065-b1bf-476c-9687-e602504112ba] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_disconnect.gif
2026-01-06 19:05:53.424 DEBUG [http-nio-8080-exec-10] [39ac8065-b1bf-476c-9687-e602504112ba] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.424 DEBUG [http-nio-8080-exec-10] [39ac8065-b1bf-476c-9687-e602504112ba] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_disconnect.gif
2026-01-06 19:05:53.425 DEBUG [http-nio-8080-exec-2] [6e79cbdc-154f-475e-a097-06087102d8d7] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_refresh.gif
2026-01-06 19:05:53.425 DEBUG [http-nio-8080-exec-1] [714eac13-e19e-4f80-9acc-ebff44da4e34] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_line.gif
2026-01-06 19:05:53.426 DEBUG [http-nio-8080-exec-2] [6e79cbdc-154f-475e-a097-06087102d8d7] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.426 DEBUG [http-nio-8080-exec-1] [714eac13-e19e-4f80-9acc-ebff44da4e34] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.426 DEBUG [http-nio-8080-exec-1] [714eac13-e19e-4f80-9acc-ebff44da4e34] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_line.gif
2026-01-06 19:05:53.426 DEBUG [http-nio-8080-exec-2] [6e79cbdc-154f-475e-a097-06087102d8d7] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_refresh.gif
2026-01-06 19:05:53.431 DEBUG [http-nio-8080-exec-3] [2b4f7f79-91d0-4751-b906-770b9b04994d] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_rollback.gif
2026-01-06 19:05:53.431 DEBUG [http-nio-8080-exec-4] [53e249d9-c1f0-4768-b221-f103eb52cfdd] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_commit.gif
2026-01-06 19:05:53.431 DEBUG [http-nio-8080-exec-4] [53e249d9-c1f0-4768-b221-f103eb52cfdd] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.431 DEBUG [http-nio-8080-exec-3] [2b4f7f79-91d0-4751-b906-770b9b04994d] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.431 DEBUG [http-nio-8080-exec-4] [53e249d9-c1f0-4768-b221-f103eb52cfdd] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_commit.gif
2026-01-06 19:05:53.431 DEBUG [http-nio-8080-exec-3] [2b4f7f79-91d0-4751-b906-770b9b04994d] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_rollback.gif
2026-01-06 19:05:53.434 DEBUG [http-nio-8080-exec-5] [3b0691f3-f896-41a3-86df-87d3b676f915] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_run.gif
2026-01-06 19:05:53.434 DEBUG [http-nio-8080-exec-6] [137f5dbc-d2d1-46e5-8da1-4ae2b0bccd5b] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_run_selected.gif
2026-01-06 19:05:53.434 DEBUG [http-nio-8080-exec-9] [b2f160f6-a567-45e8-ac09-f10f930d74b9] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_stop.gif
2026-01-06 19:05:53.434 DEBUG [http-nio-8080-exec-6] [137f5dbc-d2d1-46e5-8da1-4ae2b0bccd5b] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.434 DEBUG [http-nio-8080-exec-9] [b2f160f6-a567-45e8-ac09-f10f930d74b9] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.434 DEBUG [http-nio-8080-exec-5] [3b0691f3-f896-41a3-86df-87d3b676f915] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.436 DEBUG [http-nio-8080-exec-6] [137f5dbc-d2d1-46e5-8da1-4ae2b0bccd5b] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_run_selected.gif
2026-01-06 19:05:53.436 DEBUG [http-nio-8080-exec-5] [3b0691f3-f896-41a3-86df-87d3b676f915] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_run.gif
2026-01-06 19:05:53.436 DEBUG [http-nio-8080-exec-9] [b2f160f6-a567-45e8-ac09-f10f930d74b9] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_stop.gif
2026-01-06 19:05:53.446 DEBUG [http-nio-8080-exec-8] [ce8b5799-1eed-476b-a406-fb2cb5a4c89f] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_history.gif
2026-01-06 19:05:53.446 DEBUG [http-nio-8080-exec-10] [b8c1b573-54d7-475e-970c-bdce841ee4ac] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/icon_help.gif
2026-01-06 19:05:53.446 DEBUG [http-nio-8080-exec-8] [ce8b5799-1eed-476b-a406-fb2cb5a4c89f] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.446 DEBUG [http-nio-8080-exec-10] [b8c1b573-54d7-475e-970c-bdce841ee4ac] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.447 DEBUG [http-nio-8080-exec-10] [b8c1b573-54d7-475e-970c-bdce841ee4ac] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_help.gif
2026-01-06 19:05:53.447 DEBUG [http-nio-8080-exec-8] [ce8b5799-1eed-476b-a406-fb2cb5a4c89f] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/icon_history.gif
2026-01-06 19:05:53.484 DEBUG [http-nio-8080-exec-2] [a1a59d75-f453-4f18-b924-7bcd9c18ce12] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree.js
2026-01-06 19:05:53.484 DEBUG [http-nio-8080-exec-2] [a1a59d75-f453-4f18-b924-7bcd9c18ce12] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.484 DEBUG [http-nio-8080-exec-2] [a1a59d75-f453-4f18-b924-7bcd9c18ce12] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree.js
2026-01-06 19:05:53.499 DEBUG [http-nio-8080-exec-3] [d266ef92-d4f4-480d-865b-f71767f12538] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_plus.gif
2026-01-06 19:05:53.499 DEBUG [http-nio-8080-exec-4] [9943533d-1ce7-4134-b8bc-44b42de977cd] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_database.gif
2026-01-06 19:05:53.499 DEBUG [http-nio-8080-exec-1] [879c1b81-8daa-4c83-bf24-b0fd2b3d6722] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_minus.gif
2026-01-06 19:05:53.500 DEBUG [http-nio-8080-exec-4] [9943533d-1ce7-4134-b8bc-44b42de977cd] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.500 DEBUG [http-nio-8080-exec-1] [879c1b81-8daa-4c83-bf24-b0fd2b3d6722] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.500 DEBUG [http-nio-8080-exec-3] [d266ef92-d4f4-480d-865b-f71767f12538] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.500 DEBUG [http-nio-8080-exec-3] [d266ef92-d4f4-480d-865b-f71767f12538] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_plus.gif
2026-01-06 19:05:53.500 DEBUG [http-nio-8080-exec-4] [9943533d-1ce7-4134-b8bc-44b42de977cd] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_database.gif
2026-01-06 19:05:53.500 DEBUG [http-nio-8080-exec-1] [879c1b81-8daa-4c83-bf24-b0fd2b3d6722] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_minus.gif
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-5] [e79bdd2a-61cb-4893-850c-bb8983a73990] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_column.gif
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-9] [d8f82234-ed11-485b-8e99-f37bcca0a227] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_empty.gif
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-6] [3e7c2644-f82d-44b0-8bdc-8f03eec9e9b4] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_table.gif
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-5] [e79bdd2a-61cb-4893-850c-bb8983a73990] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-9] [d8f82234-ed11-485b-8e99-f37bcca0a227] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-6] [3e7c2644-f82d-44b0-8bdc-8f03eec9e9b4] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-9] [d8f82234-ed11-485b-8e99-f37bcca0a227] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_empty.gif
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-6] [3e7c2644-f82d-44b0-8bdc-8f03eec9e9b4] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_table.gif
2026-01-06 19:05:53.501 DEBUG [http-nio-8080-exec-5] [e79bdd2a-61cb-4893-850c-bb8983a73990] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_column.gif
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-8] [c2ec89b6-d242-4204-8837-38b55433e16e] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_index.gif
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-10] [40eef60f-46af-464a-aec4-de318bf57472] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_type.gif
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-7] [c559d0f5-86a7-4def-bc80-9fb3a89aab38] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_index_az.gif
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-8] [c2ec89b6-d242-4204-8837-38b55433e16e] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-10] [40eef60f-46af-464a-aec4-de318bf57472] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-7] [c559d0f5-86a7-4def-bc80-9fb3a89aab38] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-10] [40eef60f-46af-464a-aec4-de318bf57472] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_type.gif
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-8] [c2ec89b6-d242-4204-8837-38b55433e16e] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_index.gif
2026-01-06 19:05:53.509 DEBUG [http-nio-8080-exec-7] [c559d0f5-86a7-4def-bc80-9fb3a89aab38] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_index_az.gif
2026-01-06 19:05:53.513 DEBUG [http-nio-8080-exec-8] [6d2a29c1-5791-449c-8356-836928bb81c6] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_folder.gif
2026-01-06 19:05:53.513 DEBUG [http-nio-8080-exec-1] [0d5471f9-e12a-4d8a-9295-b0317ad76571] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_view.gif
2026-01-06 19:05:53.513 DEBUG [http-nio-8080-exec-8] [6d2a29c1-5791-449c-8356-836928bb81c6] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.513 DEBUG [http-nio-8080-exec-1] [0d5471f9-e12a-4d8a-9295-b0317ad76571] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.513 DEBUG [http-nio-8080-exec-1] [0d5471f9-e12a-4d8a-9295-b0317ad76571] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_view.gif
2026-01-06 19:05:53.513 DEBUG [http-nio-8080-exec-8] [6d2a29c1-5791-449c-8356-836928bb81c6] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_folder.gif
2026-01-06 19:05:53.516 DEBUG [http-nio-8080-exec-3] [361bad4d-1d93-4bb0-8899-c312d6197c0a] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_users.gif
2026-01-06 19:05:53.516 DEBUG [http-nio-8080-exec-3] [361bad4d-1d93-4bb0-8899-c312d6197c0a] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.517 DEBUG [http-nio-8080-exec-5] [12466996-c7d9-4193-b0a3-3a5c33f70209] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_info.gif
2026-01-06 19:05:53.517 DEBUG [http-nio-8080-exec-4] [d6b9abc5-e121-4cfd-b644-741ab20d7919] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/tree_user.gif
2026-01-06 19:05:53.517 DEBUG [http-nio-8080-exec-3] [361bad4d-1d93-4bb0-8899-c312d6197c0a] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_users.gif
2026-01-06 19:05:53.517 DEBUG [http-nio-8080-exec-5] [12466996-c7d9-4193-b0a3-3a5c33f70209] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.517 DEBUG [http-nio-8080-exec-4] [d6b9abc5-e121-4cfd-b644-741ab20d7919] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.517 DEBUG [http-nio-8080-exec-5] [12466996-c7d9-4193-b0a3-3a5c33f70209] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_info.gif
2026-01-06 19:05:53.517 DEBUG [http-nio-8080-exec-4] [d6b9abc5-e121-4cfd-b644-741ab20d7919] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/tree_user.gif
2026-01-06 19:05:53.564 DEBUG [http-nio-8080-exec-6] [37239204-f2b0-4758-9f01-a1b543e1f770] o.s.security.web.FilterChainProxy        : Securing GET /favicon.ico
2026-01-06 19:05:53.565 DEBUG [http-nio-8080-exec-6] [37239204-f2b0-4758-9f01-a1b543e1f770] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.565 DEBUG [http-nio-8080-exec-6] [37239204-f2b0-4758-9f01-a1b543e1f770] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 19:05:53.567 DEBUG [http-nio-8080-exec-6] [] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-01-06 19:05:53.567 DEBUG [http-nio-8080-exec-6] [] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:53.567 DEBUG [http-nio-8080-exec-6] [] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2026-01-06 19:05:58.968 DEBUG [http-nio-8080-exec-9] [bf9c2358-b374-47aa-9920-d21f7e2cbc56] o.s.security.web.FilterChainProxy        : Securing POST /h2-console/query.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:58.968 DEBUG [http-nio-8080-exec-9] [bf9c2358-b374-47aa-9920-d21f7e2cbc56] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:58.968 DEBUG [http-nio-8080-exec-9] [bf9c2358-b374-47aa-9920-d21f7e2cbc56] o.s.security.web.FilterChainProxy        : Secured POST /h2-console/query.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:05:58.987 DEBUG [http-nio-8080-exec-7] [6998b26e-e06a-4dcb-9170-b4b92fdf80b3] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/table.js
2026-01-06 19:05:58.987 DEBUG [http-nio-8080-exec-2] [be3ef419-cc58-4259-8f77-3ec9cec7ed59] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/stylesheet.css
2026-01-06 19:05:58.987 DEBUG [http-nio-8080-exec-7] [6998b26e-e06a-4dcb-9170-b4b92fdf80b3] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:58.987 DEBUG [http-nio-8080-exec-2] [be3ef419-cc58-4259-8f77-3ec9cec7ed59] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:05:58.988 DEBUG [http-nio-8080-exec-2] [be3ef419-cc58-4259-8f77-3ec9cec7ed59] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/stylesheet.css
2026-01-06 19:05:58.988 DEBUG [http-nio-8080-exec-7] [6998b26e-e06a-4dcb-9170-b4b92fdf80b3] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/table.js
2026-01-06 19:06:20.385 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] o.s.security.web.FilterChainProxy        : Securing PUT /api/v1/clients/notes
2026-01-06 19:06:20.388 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] org.hibernate.SQL                        : 
    select
        u1_0.id,
        u1_0.account_status,
        u1_0.activation_token,
        u1_0.activation_token_expiry,
        u1_0.active,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.last_name,
        u1_0.password,
        u1_0.updated_at,
        u1_0.username,
        u1_0.uuid,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2026-01-06 19:06:20.390 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] org.hibernate.SQL                        : 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2026-01-06 19:06:20.391 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] o.s.security.web.FilterChainProxy        : Secured PUT /api/v1/clients/notes
2026-01-06 19:06:20.393 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] horizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:06:20.393 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] horizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.westwood.controller.ClientController.updateNotes(com.westwood.common.dto.ClientUpdateNotesDto); target is of class [com.westwood.controller.ClientController]
2026-01-06 19:06:20.395 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.client_type,
        c1_0.created_at,
        c1_0.date_of_birth,
        c1_0.name,
        c1_0.notes,
        c1_0.phone,
        c1_0.referral_code,
        c1_0.referrer_id,
        c1_0.surname,
        c1_0.updated_at,
        c1_0.uuid,
        c1_0.version 
    from
        clients c1_0 
    where
        c1_0.uuid=?
2026-01-06 19:06:20.397 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] org.hibernate.SQL                        : 
    select
        t1_0.client_id,
        t1_1.id,
        t1_1.created_at,
        t1_1.name,
        t1_1.updated_at,
        t1_1.version 
    from
        client_tag t1_0 
    join
        tags t1_1 
            on t1_1.id=t1_0.tag_id 
    where
        t1_0.client_id=?
2026-01-06 19:06:20.399 DEBUG [http-nio-8080-exec-10] [a88232a3-d014-4c50-960f-5a9b5f458d13] org.hibernate.SQL                        : 
    update
        clients c1_0 
    set
        notes=? 
    where
        c1_0.uuid=?
2026-01-06 19:06:22.942 DEBUG [http-nio-8080-exec-8] [04f7bf1e-1208-428c-85b8-20d34bc52edb] o.s.security.web.FilterChainProxy        : Securing POST /h2-console/query.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:06:22.943 DEBUG [http-nio-8080-exec-8] [04f7bf1e-1208-428c-85b8-20d34bc52edb] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:06:22.943 DEBUG [http-nio-8080-exec-8] [04f7bf1e-1208-428c-85b8-20d34bc52edb] o.s.security.web.FilterChainProxy        : Secured POST /h2-console/query.do?jsessionid=5329fe65c7195c19a9c665ee960766cb
2026-01-06 19:06:22.958 DEBUG [http-nio-8080-exec-3] [09ae3fcd-c76d-44b2-88b8-40856a9972fe] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/table.js
2026-01-06 19:06:22.958 DEBUG [http-nio-8080-exec-1] [570e567d-3614-44b4-bfe5-e8242b677360] o.s.security.web.FilterChainProxy        : Securing GET /h2-console/stylesheet.css
2026-01-06 19:06:22.958 DEBUG [http-nio-8080-exec-3] [09ae3fcd-c76d-44b2-88b8-40856a9972fe] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:06:22.958 DEBUG [http-nio-8080-exec-1] [570e567d-3614-44b4-bfe5-e8242b677360] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-01-06 19:06:22.958 DEBUG [http-nio-8080-exec-3] [09ae3fcd-c76d-44b2-88b8-40856a9972fe] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/table.js
2026-01-06 19:06:22.958 DEBUG [http-nio-8080-exec-1] [570e567d-3614-44b4-bfe5-e8242b677360] o.s.security.web.FilterChainProxy        : Secured GET /h2-console/stylesheet.css
2026-01-06 19:06:38.900  INFO [SpringApplicationShutdownHook] [] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-06 19:06:38.902  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-06 19:06:38.904  INFO [SpringApplicationShutdownHook] [] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
