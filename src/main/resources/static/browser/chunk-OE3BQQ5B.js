import{a as N}from"./chunk-DXH3P4LY.js";import{a as T}from"./chunk-TKABTXOR.js";import{a as I}from"./chunk-7HAO4Z2V.js";import{a as k}from"./chunk-KHO44KZO.js";import"./chunk-3B24VZJ2.js";import{a as E}from"./chunk-TMJHU5AU.js";import{$ as x,Aa as n,Ba as p,Db as w,Ha as m,Oa as i,Pa as d,Qa as c,S as f,Ya as C,_ as h,hb as P,ib as y,ka as r,na as v,ob as M,ra as g,va as l,wb as S,xa as b,ya as _,za as t,zb as O}from"./chunk-7F5AWDR7.js";var U=o=>["/clients",o];function B(o,u){o&1&&(t(0,"div",3),p(1,"app-loader"),n())}function L(o,u){if(o&1&&(t(0,"p",45),i(1),n()),o&2){let e=m(2);r(),d(e.user.phoneNumber)}}function z(o,u){if(o&1&&(t(0,"app-badge",71),i(1),n()),o&2){let e=m().$implicit,a=m(2);r(),c(" +",a.formatAmount(a.getBonusGranted(e))," ")}}function D(o,u){if(o&1&&(t(0,"app-badge",72),i(1),n()),o&2){let e=m().$implicit,a=m(2);r(),c(" -",a.formatAmount(a.getBonusUsed(e))," ")}}function A(o,u){o&1&&(t(0,"span",73),i(1,"\u2014"),n())}function F(o,u){if(o&1&&(t(0,"tr",46)(1,"td",47)(2,"span",48),i(3),n()(),t(4,"td",49)(5,"div",50)(6,"div",51),i(7),n(),t(8,"div",52)(9,"a",53)(10,"span",54),i(11),n()(),t(12,"span",55),i(13),n()()()(),t(14,"td",56)(15,"span",57),i(16),n()(),t(17,"td",58)(18,"div",59),g(19,z,2,1,"app-badge",60)(20,D,2,1,"app-badge",61)(21,A,2,0,"span",62),n()(),t(22,"td",63)(23,"span",64),i(24),n()(),t(25,"td",65)(26,"app-badge",66),i(27),n()(),t(28,"td",67)(29,"div",68)(30,"span",69),i(31),n(),t(32,"span",70),i(33),n()()()()),o&2){let e=u.$implicit,a=m(2);r(3),c("#",e.txId||e.id,""),r(4),c(" ",a.getInitials(e.clientName)," "),r(2),l("routerLink",C(17,U,e.clientId)),r(2),d(e.clientName),r(2),d(e.clientPhone),r(3),c("",a.formatAmount(e.amount)," \u20B8"),r(3),l("ngIf",a.getBonusGranted(e)>0),r(),l("ngIf",a.getBonusUsed(e)>0),r(),l("ngIf",a.getBonusGranted(e)===0&&a.getBonusUsed(e)===0),r(2),_("method-"+(a.getPaymentMethod(e)||"unknown")),r(),c(" ",a.getPaymentMethodLabel(a.getPaymentMethod(e))," "),r(2),l("badgeType",a.isRefunded(e)?"refund":"payment")("icon",a.isRefunded(e)?"refund":"payment"),r(),c(" ",a.isRefunded(e)?"\u0412\u043E\u0437\u0432\u0440\u0430\u0442":"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E"," "),r(4),d(a.getFormattedDate(e)),r(2),d(a.getFormattedTime(e))}}function R(o,u){o&1&&(t(0,"div",74),h(),t(1,"svg",17),p(2,"path",75)(3,"rect",76)(4,"path",77),n(),x(),t(5,"span"),i(6,"\u041D\u0435\u0442 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0439"),n()())}function G(o,u){if(o&1&&(t(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"div",8),i(5),n(),p(6,"div",9),n(),t(7,"div",10)(8,"div",11)(9,"h1",12),i(10),n(),t(11,"app-badge",13),i(12),n()(),t(13,"p",14),i(14),n(),g(15,L,2,1,"p",15),t(16,"div",16),h(),t(17,"svg",17),p(18,"path",18)(19,"path",19)(20,"path",20),n(),x(),t(21,"span"),i(22),n()()()()(),t(23,"div",21)(24,"div",22)(25,"div",23)(26,"div",24),h(),t(27,"svg",17),p(28,"path",25)(29,"circle",26),n()(),x(),t(30,"h3",27),i(31,"\u041B\u0438\u0447\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435"),n()()(),t(32,"div",28)(33,"div",29)(34,"span",30),i(35,"\u0418\u043C\u044F:"),n(),t(36,"span",31),i(37),n()(),t(38,"div",29)(39,"span",30),i(40,"\u0424\u0430\u043C\u0438\u043B\u0438\u044F:"),n(),t(41,"span",31),i(42),n()(),t(43,"div",29)(44,"span",30),i(45,"Email:"),n(),t(46,"span",31),i(47),n()(),t(48,"div",29)(49,"span",30),i(50,"\u0422\u0435\u043B\u0435\u0444\u043E\u043D:"),n(),t(51,"span",31),i(52),n()(),t(53,"div",29)(54,"span",30),i(55,"\u0420\u043E\u043B\u044C:"),n(),t(56,"span",31),i(57),n()(),t(58,"div",29)(59,"span",30),i(60,"\u0414\u0430\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438:"),n(),t(61,"span",31),i(62),n()()()(),t(63,"div",32)(64,"div",22)(65,"div",23)(66,"div",24),h(),t(67,"svg",17),p(68,"path",33),n()(),x(),t(69,"h3",27),i(70,"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0439"),n()()(),t(71,"div",34)(72,"table",35)(73,"thead")(74,"tr")(75,"th",36),i(76,"ID \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),n(),t(77,"th",37),i(78,"\u041A\u043B\u0438\u0435\u043D\u0442"),n(),t(79,"th",38),i(80,"\u0421\u0443\u043C\u043C\u0430"),n(),t(81,"th",39),i(82,"\u0411\u043E\u043D\u0443\u0441\u044B"),n(),t(83,"th",40),i(84,"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B"),n(),t(85,"th",41),i(86,"\u0421\u0442\u0430\u0442\u0443\u0441"),n(),t(87,"th",42),i(88,"\u0414\u0430\u0442\u0430 \u0438 \u0432\u0440\u0435\u043C\u044F"),n()()(),t(89,"tbody"),g(90,F,34,19,"tr",43),n()(),g(91,R,7,0,"div",44),n()()()),o&2){let e=m();r(5),c(" ",e.getInitials()," "),r(),b("active",e.user.status==="active"),r(4),d(e.getFullName()),r(),l("badgeType",e.getStatusBadgeType(e.user.status)),r(),c(" ",e.getStatusLabel(e.user.status)," "),r(2),d(e.user.email),r(),l("ngIf",e.user.phoneNumber),r(7),d(e.user.role),r(15),d(e.user.firstName),r(5),d(e.user.lastName),r(5),d(e.user.email),r(5),d(e.user.phoneNumber||"\u2014"),r(5),d(e.user.role),r(5),d(e.formatDate(e.user.createdAt)),r(28),l("ngForOf",e.userPayments),r(),l("ngIf",e.userPayments.length===0)}}var ee=(()=>{class o{pageHeaderService=f(k);route=f(S);usersService=f(N);toastService=f(E);user=null;userPayments=[];isLoading=!0;ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e?(this.pageHeaderService.setPageHeader("\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",[{label:"\u0413\u043B\u0430\u0432\u043D\u0430\u044F",route:"/home"},{label:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438",route:"/users"},{label:"\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F"}]),this.loadUser(e),this.loadTransactions(e)):(this.isLoading=!1,this.toastService.error("ID \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D"))}loadUser(e){this.usersService.getUserById(e).subscribe({next:a=>{this.user=this.mapApiUserToUser(a),this.isLoading=!1},error:a=>{let s=a.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F";this.toastService.error(s),this.isLoading=!1}})}loadTransactions(e){this.usersService.getUserTransactions(e).subscribe({next:a=>{this.userPayments=a.map(s=>this.mapTransactionToPayment(s))},error:a=>{let s=a.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439";this.toastService.error(s)}})}mapApiUserToUser(e){return{id:e.id,firstName:e.firstName,lastName:e.lastName,email:e.email,phoneNumber:e.phone||"\u2014",role:this.getRoleLabel(e.roles),status:this.mapAccountStatusToStatus(e.accountStatus,e.active),createdAt:e.createdAt||""}}mapAccountStatusToStatus(e,a){return e==="PENDING_ACTIVATION"?"invited":a===!1?"closed":"active"}getRoleLabel(e){return e.includes("SUDO")?"\u0421\u0443\u043F\u0435\u0440 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440":e.includes("ADMIN")?"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440":e.includes("MANAGER")?"\u041C\u0435\u043D\u0435\u0434\u0436\u0435\u0440":e.join(", ")}mapTransactionToPayment(e){let a=new Date(e.createdAt);return{id:e.txId,clientId:e.clientId,clientName:e.clientName,clientPhone:e.clientPhone,amount:e.amount,bonusEarned:e.bonusGranted,bonusUsed:e.bonusUsed,paymentMethod:e.paymentMethod||"unknown",isRefund:e.status==="REFUNDED",date:a.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}),time:a.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}}getBonusGranted(e){return e.bonusEarned||0}getBonusUsed(e){return e.bonusUsed||0}getPaymentMethod(e){return e.paymentMethod||"unknown"}isRefunded(e){return e.isRefund||!1}getFormattedDate(e){return e.date||""}getFormattedTime(e){return e.time||""}ngAfterViewInit(){let e=document.querySelector(".sidebar-content");e&&(e.scrollTop=0),window.scrollTo(0,0)}getFullName(){return this.user?`${this.user.firstName} ${this.user.lastName}`:""}getInitials(e){return e?e.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().slice(0,2):this.user?`${this.user.firstName.charAt(0)}${this.user.lastName.charAt(0)}`.toUpperCase():""}getStatusBadgeType(e){switch(e){case"active":return"success";case"invited":return"warning";case"closed":return"danger";default:return"secondary"}}getStatusLabel(e){switch(e){case"invited":return"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D";case"active":return"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0439";case"closed":return"\u0417\u0430\u043A\u0440\u044B\u0442\u044B\u0439";default:return e}}formatDate(e){return new Date(e).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}formatAmount(e){return e.toLocaleString("ru-RU")}getPaymentMethodLabel(e){switch(e){case"cash":return"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u0435";case"card":return"\u041A\u0430\u0440\u0442\u0430";case"online":return"\u041E\u043D\u043B\u0430\u0439\u043D";default:return e}}static \u0275fac=function(a){return new(a||o)};static \u0275cmp=v({type:o,selectors:[["app-user-profile-page"]],decls:3,vars:2,consts:[[1,"page-wrapper"],["class","loading-container",4,"ngIf"],["class","profile-container",4,"ngIf"],[1,"loading-container"],[1,"profile-container"],[1,"profile-header-card"],[1,"profile-header-content"],[1,"avatar-wrapper"],[1,"avatar-large"],[1,"status-indicator"],[1,"profile-main-info"],[1,"name-row"],[1,"profile-name"],["size","medium",3,"badgeType"],[1,"profile-email"],["class","profile-phone",4,"ngIf"],[1,"role-badge"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none"],["d","M12 2L2 7l10 5 10-5-10-5z","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M2 17l10 5 10-5","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M2 12l10 5 10-5","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"info-card"],[1,"card-header"],[1,"card-header-left"],[1,"card-icon"],["d","M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2","stroke","currentColor","stroke-width","1.5"],["cx","12","cy","7","r","4","stroke","currentColor","stroke-width","1.5"],[1,"card-title"],[1,"info-content"],[1,"info-row"],[1,"info-label"],[1,"info-value"],[1,"activity-card"],["d","M22 12h-4l-3 9L9 3l-3 9H2","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"payments-table-container"],[1,"payments-table"],[1,"th-id"],[1,"th-client"],[1,"th-amount"],[1,"th-bonuses"],[1,"th-method"],[1,"th-status"],[1,"th-date"],["class","payment-row",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"profile-phone"],[1,"payment-row"],[1,"td-id"],[1,"payment-id"],[1,"td-client"],[1,"client-cell"],[1,"client-avatar"],[1,"client-info"],[1,"client-name-link",3,"routerLink"],[1,"client-name"],[1,"client-phone"],[1,"td-amount"],[1,"amount-value"],[1,"td-bonuses"],[1,"bonus-info"],["badgeType","bonusGranted","size","medium","icon","star","class","bonus-badge",4,"ngIf"],["badgeType","bonusUsed","size","medium","icon","check","class","bonus-badge",4,"ngIf"],["class","bonus-none",4,"ngIf"],[1,"td-method"],[1,"method-badge"],[1,"td-status"],["size","medium",3,"badgeType","icon"],[1,"td-date"],[1,"date-info"],[1,"date-text"],[1,"time-text"],["badgeType","bonusGranted","size","medium","icon","star",1,"bonus-badge"],["badgeType","bonusUsed","size","medium","icon","check",1,"bonus-badge"],[1,"bonus-none"],[1,"empty-state"],["d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2","stroke","currentColor","stroke-width","1.5"],["x","9","y","3","width","6","height","4","rx","1","stroke","currentColor","stroke-width","1.5"],["d","M9 12h6M9 16h6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"]],template:function(a,s){a&1&&(t(0,"div",0),g(1,B,2,0,"div",1)(2,G,92,17,"div",2),n()),a&2&&(r(),l("ngIf",s.isLoading),r(),l("ngIf",!s.isLoading&&s.user))},dependencies:[M,P,y,w,O,I,T],styles:[".page-wrapper[_ngcontent-%COMP%]{min-height:100%;margin:-2rem;padding:2rem;background:linear-gradient(180deg,#f0fdf4,#f8fafc 50% 100%)}.profile-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;display:flex;flex-direction:column;gap:1.5rem}.profile-header-card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:2rem;box-shadow:0 1px 3px #0000000d}.profile-header-content[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:flex-start}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;flex-shrink:0}.avatar-large[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:20px;background:linear-gradient(135deg,#16a34a,#22c55e);display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:700;color:#fff}.status-indicator[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:24px;height:24px;border-radius:50%;background:#94a3b8;border:3px solid white}.status-indicator.active[_ngcontent-%COMP%]{background:#22c55e}.profile-main-info[_ngcontent-%COMP%]{flex:1}.name-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:.75rem}.profile-name[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#1f2937;margin:0}.profile-email[_ngcontent-%COMP%], .profile-phone[_ngcontent-%COMP%]{font-size:1rem;color:#64748b;margin:.5rem 0}.role-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;background:#f0fdf4;color:#16a34a;padding:.5rem 1rem;border-radius:12px;font-weight:600;font-size:.9375rem;margin-top:.75rem}.role-badge[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.info-card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:2rem;box-shadow:0 1px 3px #0000000d}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.card-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.card-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);display:flex;align-items:center;justify-content:center;color:#16a34a}.card-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#1f2937;margin:0}.info-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.info-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:.75rem 0;border-bottom:1px solid #f1f5f9}.info-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-label[_ngcontent-%COMP%]{font-weight:600;color:#64748b;min-width:150px;font-size:.9375rem}.info-value[_ngcontent-%COMP%]{color:#1f2937;font-size:.9375rem}.activity-card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:2rem;box-shadow:0 1px 3px #0000000d}.payments-table-container[_ngcontent-%COMP%]{overflow-x:auto}.payments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.payments-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#f8fafc}.payments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-size:.875rem;font-weight:600;color:#64748b;border-bottom:1px solid #e2e8f0}.payments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #f1f5f9}.payments-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8fafc}.payment-id[_ngcontent-%COMP%]{font-family:monospace;font-weight:600;color:#64748b;font-size:.875rem}.client-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.client-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);display:flex;align-items:center;justify-content:center;font-weight:600;color:#16a34a;font-size:.875rem;flex-shrink:0}.client-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.client-name-link[_ngcontent-%COMP%]{text-decoration:none;color:#1f2937;font-weight:600;font-size:.9375rem;transition:color .2s;cursor:pointer;display:inline-block}.client-name-link[_ngcontent-%COMP%]:hover{color:#16a34a}.client-name-link[_ngcontent-%COMP%]   .client-name[_ngcontent-%COMP%]{cursor:pointer}.client-phone[_ngcontent-%COMP%]{font-size:.8125rem;color:#64748b}.amount-value[_ngcontent-%COMP%]{font-weight:600;color:#1f2937;font-size:.9375rem}.bonus-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.bonus-badge[_ngcontent-%COMP%]{display:inline-block}.bonus-none[_ngcontent-%COMP%]{color:#94a3b8;font-size:.875rem}.method-badge[_ngcontent-%COMP%]{display:inline-block;padding:.375rem .75rem;border-radius:8px;font-size:.8125rem;font-weight:500}.method-cash[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.method-card[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.method-online[_ngcontent-%COMP%]{background:#dcfce7;color:#15803d}.date-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.date-text[_ngcontent-%COMP%]{font-size:.875rem;color:#1f2937;font-weight:500}.time-text[_ngcontent-%COMP%]{font-size:.8125rem;color:#64748b}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;color:#94a3b8;gap:1rem}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:48px;height:48px}.empty-state[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9375rem}"]})}return o})();export{ee as UserProfilePageComponent};
