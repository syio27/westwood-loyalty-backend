import{a as Ve,b as Le}from"./chunk-QSJC4XLA.js";import{a as Ae}from"./chunk-WRAFSANK.js";import{a as Ie}from"./chunk-OXHWY5E2.js";import{m as Ee}from"./chunk-NAUVD23N.js";import{a as G}from"./chunk-KZHT6NUY.js";import{a as De}from"./chunk-AYIUFZBC.js";import{a as q}from"./chunk-APN53XTZ.js";import{a as Be}from"./chunk-KHO44KZO.js";import"./chunk-3B24VZJ2.js";import{a as xe}from"./chunk-TMJHU5AU.js";import{b as ve,c as we,e as Me,g as ye,i as Pe,j as ke,p as Se,q as Te,t as Oe,v as z}from"./chunk-2HM6BEQO.js";import{n as Ce}from"./chunk-KOV5UQCB.js";import{a as be}from"./chunk-PQPVKKOU.js";import{$ as y,Aa as a,Ab as he,Ba as f,Ca as ae,Da as re,Db as F,Fa as C,Ga as _,Ha as l,Ia as V,Ja as L,Ka as se,La as le,Ma as ce,O as te,Oa as c,Pa as b,Qa as w,S as M,Ta as T,Ua as O,Va as E,X as ne,Xa as ue,Y as p,Ya as de,Z as m,Za as j,_ as h,_a as N,a as Z,b as $,da as S,e as Q,fb as pe,ha as X,hb as A,ia as W,ib as I,ja as ie,k as J,ka as r,m as K,ma as oe,na as P,nb as U,ob as B,ra as g,s as ee,t as Y,ub as me,va as s,vb as ge,xa as k,xb as fe,yb as _e,za as o,zb as R}from"./chunk-7F5AWDR7.js";var Fe=(()=>{class t{collapsedSource=new Q(!1);closedSource=new Q(!1);collapsed$=this.collapsedSource.asObservable();closed$=this.closedSource.asObservable();setCollapsed(e){this.collapsedSource.next(e)}setClosed(e){this.closedSource.next(e)}get isCollapsed(){return this.collapsedSource.value}get isClosed(){return this.closedSource.value}static \u0275fac=function(i){return new(i||t)};static \u0275prov=te({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ge=["*"],qe=t=>({exact:t}),Qe=()=>({exact:!1});function Je(t,d){if(t&1){let e=C();o(0,"div",16),_("click",function(){p(e);let n=l();return m(n.openSidebar())}),a()}}function Ke(t,d){if(t&1&&(o(0,"span",17),c(1),a()),t&2){let e=l();r(),b(e.logoText)}}function Ye(t,d){if(t&1){let e=C();o(0,"div",18)(1,"app-button",19),_("onClick",function(){p(e);let n=l();return m(n.onCreateClick())}),h(),o(2,"svg",20),f(3,"path",21),a(),y(),o(4,"span",22),c(5),a()()()}if(t&2){let e=l();r(),s("tooltip",e.createButtonLabel),r(4),b(e.createButtonLabel)}}function Xe(t,d){if(t&1){let e=C();o(0,"div",23)(1,"app-icon-button",24),_("onClick",function(){p(e);let n=l();return m(n.onCreateClick())}),h(),o(2,"svg",25),f(3,"path",21),a()()()}}function Ze(t,d){if(t&1&&(o(0,"span",34),c(1),a()),t&2){let e=l(2).$implicit;r(),b(e.label)}}function $e(t,d){if(t&1){let e=C();o(0,"a",31),_("click",function(){p(e);let n=l(3);return m(n.onMenuItemClick())}),h(),f(1,"svg",32),g(2,Ze,2,1,"span",33),a()}if(t&2){let e=l().$implicit,i=l(2);s("routerLink",e.route)("routerLinkActiveOptions",de(5,qe,e.exact!==!1))("title",i.isCollapsed()?e.label:""),r(),s("innerHTML",i.sanitizeHtml(e.iconPath),W),r(),s("ngIf",!i.isCollapsed())}}function et(t,d){if(t&1){let e=C();o(0,"a",31),_("click",function(){p(e);let n=l(4);return m(n.onMenuItemClick())}),h(),f(1,"svg",32),a()}if(t&2){let e=l(2).$implicit,i=l(2);k("active",i.isChildActive(e)),s("routerLink",e.children[0].route)("routerLinkActiveOptions",ue(6,Qe))("title",e.label),r(),s("innerHTML",i.sanitizeHtml(e.iconPath),W)}}function tt(t,d){if(t&1){let e=C();o(0,"button",40),_("click",function(){p(e);let n=l(2).$implicit,u=l(2);return m(u.toggleDropdown(n.label))}),h(),f(1,"svg",32),y(),o(2,"span",34),c(3),a(),h(),o(4,"svg",41),f(5,"path",42),a()()}if(t&2){let e=l(2).$implicit,i=l(2);k("expanded",i.expandedMenus[e.label])("active",i.isChildActive(e)),r(),s("innerHTML",i.sanitizeHtml(e.iconPath),W),r(2),b(e.label),r(),k("rotated",i.expandedMenus[e.label])}}function nt(t,d){if(t&1){let e=C();o(0,"a",43),_("click",function(){p(e);let n=l(4);return m(n.onMenuItemClick())}),h(),f(1,"svg",44),y(),o(2,"span",45),c(3),a()()}if(t&2){let e=d.$implicit,i=l(4);s("routerLink",e.route),r(),s("innerHTML",i.sanitizeHtml(e.iconPath),W),r(2),b(e.label)}}function it(t,d){if(t&1&&(o(0,"div",35),g(1,et,2,7,"a",36)(2,tt,6,8,"button",37),o(3,"div",38),g(4,nt,4,3,"a",39),a()()),t&2){let e=l().$implicit,i=l(2);r(),s("ngIf",i.isCollapsed()),r(),s("ngIf",!i.isCollapsed()),r(),k("open",i.expandedMenus[e.label]&&!i.isCollapsed()),r(),s("ngForOf",e.children)}}function ot(t,d){if(t&1&&(o(0,"li",28),g(1,$e,3,7,"a",29)(2,it,5,5,"div",30),a()),t&2){let e=d.$implicit;k("has-children",e.children==null?null:e.children.length),r(),s("ngIf",e.route&&!(e.children!=null&&e.children.length)),r(),s("ngIf",e.children==null?null:e.children.length)}}function at(t,d){if(t&1&&(o(0,"ul",26),g(1,ot,3,4,"li",27),a()),t&2){let e=l();r(),s("ngForOf",e.menuItems)}}function rt(t,d){t&1&&(o(0,"span",64),c(1,"\u041F\u0440\u043E\u0444\u0438\u043B\u044C"),a())}function st(t,d){t&1&&(o(0,"span",64),c(1,"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438"),a())}function lt(t,d){t&1&&(o(0,"span",64),c(1,"\u0412\u044B\u0439\u0442\u0438"),a())}function ct(t,d){if(t&1){let e=C();o(0,"div",46)(1,"div",47)(2,"a",48),h(),o(3,"svg",49),f(4,"path",50)(5,"circle",51),a(),g(6,rt,2,0,"span",52),a(),y(),o(7,"a",53),h(),o(8,"svg",49),f(9,"path",54)(10,"path",55),a(),g(11,st,2,0,"span",52),a(),y(),o(12,"div",56)(13,"button",57),_("click",function(){p(e);let n=l();return m(n.onLogoutClick())}),h(),o(14,"svg",49),f(15,"path",58)(16,"polyline",59)(17,"line",60),a(),g(18,lt,2,0,"span",52),a(),y(),o(19,"button",61),_("click",function(){p(e);let n=l();return m(n.toggleClosed())}),h(),o(20,"svg",62),f(21,"path",63),a()()()()()}if(t&2){let e=l();r(2),s("title",e.isCollapsed()?"\u041F\u0440\u043E\u0444\u0438\u043B\u044C":""),r(4),s("ngIf",!e.isCollapsed()),r(),s("title",e.isCollapsed()?"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438":""),r(4),s("ngIf",!e.isCollapsed()),r(2),s("title",e.isCollapsed()?"\u0412\u044B\u0439\u0442\u0438":""),r(5),s("ngIf",!e.isCollapsed()),r(),s("title",e.isCollapsed()?"\u0420\u0430\u0437\u0432\u0435\u0440\u043D\u0443\u0442\u044C":"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C"),r(),k("rotated",e.isCollapsed())}}var ze=(()=>{class t{sanitizer;isCollapsed=X(!1);isClosed=X(!1);isMobile=!1;expandedMenus={};menuItems=[{label:"\u0413\u043B\u0430\u0432\u043D\u0430\u044F",iconPath:'<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><polyline points="9,22 9,12 15,12 15,22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',route:"/home",exact:!0},{label:"\u041A\u043B\u0438\u0435\u043D\u0442\u044B",iconPath:'<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M23 21v-2a4 4 0 0 0-3-3.87" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',route:"/clients"},{label:"\u041F\u043B\u0430\u0442\u0435\u0436\u0438",iconPath:'<path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',route:"/payments"},{label:"\u041A\u043E\u043C\u043C\u0443\u043D\u0438\u043A\u0430\u0446\u0438\u0438",iconPath:'<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',children:[{label:"WhatsApp",iconPath:'<path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z" fill="currentColor"/><path d="M12 2C6.477 2 2 6.477 2 12c0 1.89.525 3.66 1.438 5.168L2 22l4.832-1.438A9.955 9.955 0 0012 22c5.523 0 10-4.477 10-10S17.523 2 12 2z" stroke="currentColor" stroke-width="1.5"/>',route:"/communications/whatsapp"}]},{label:"\u0411\u043E\u043D\u0443\u0441\u043D\u0430\u044F \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430",iconPath:'<path d="M20 12v10H4V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><rect x="2" y="7" width="20" height="5" rx="1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 22V7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 7c-2.5-2.5-5-3-5-5a2.5 2.5 0 0 1 5 0c0 2-2.5 2.5-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 7c2.5-2.5 5-3 5-5a2.5 2.5 0 0 0-5 0c0 2 2.5 2.5 5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',route:"/bonus-program",exact:!1},{label:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438",iconPath:'<path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',route:"/users"}];logoText="WestWood";createButtonLabel="\u041D\u043E\u0432\u0430\u044F \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u044F";collapsedChange=new S;closedChange=new S;createClick=new S;logoutClick=new S;constructor(e){this.sanitizer=e,typeof window<"u"&&(this.checkMobile(),window.addEventListener("resize",()=>{this.checkMobile()})),pe(()=>{let i=this.isCollapsed(),n=this.isClosed();this.collapsedChange.emit(i),this.closedChange.emit(n),this.sidebarService.setCollapsed(i),this.sidebarService.setClosed(n)})}sidebarService=M(Fe);transactionModalService=M(G);store=M(Ce);sanitizeHtml(e){return this.sanitizer.bypassSecurityTrustHtml(e)}checkMobile(){let e=this.isMobile;this.isMobile=window.innerWidth<768,this.isMobile&&!e?this.isClosed.set(!0):!this.isMobile&&e&&this.isClosed.set(!1)}toggleSidebar(){this.isCollapsed.update(e=>!e)}toggleClosed(){this.isMobile?this.isClosed.update(e=>!e):(this.isCollapsed.update(e=>!e),this.isClosed.set(!1))}openSidebar(){this.isClosed.set(!1)}closeSidebar(){this.isClosed.set(!0)}onMenuItemClick(){this.isMobile&&this.closeSidebar()}onCreateClick(){this.transactionModalService.open(),this.createClick.emit()}onLogoutClick(){this.store.dispatch(Ee()),this.logoutClick.emit()}toggleDropdown(e){this.isCollapsed()?this.expandedMenus[e]=!this.expandedMenus[e]:this.expandedMenus[e]=!this.expandedMenus[e]}isChildActive(e){if(!e.children)return!1;let i=window.location.pathname;return e.children.some(n=>i.startsWith(n.route))}static \u0275fac=function(i){return new(i||t)(oe(me))};static \u0275cmp=P({type:t,selectors:[["app-sidebar"]],inputs:{menuItems:"menuItems",logoText:"logoText",createButtonLabel:"createButtonLabel"},outputs:{collapsedChange:"collapsedChange",closedChange:"closedChange",createClick:"createClick",logoutClick:"logoutClick"},ngContentSelectors:Ge,decls:17,vars:14,consts:[["class","sidebar-overlay",3,"click",4,"ngIf"],[1,"sidebar-container"],[1,"sidebar"],[1,"sidebar-header"],[1,"sidebar-logo"],["routerLink","/home",1,"logo-link"],["viewBox","0 0 24 24","fill","none",1,"logo-icon"],["d","M12 2L2 7l10 5 10-5-10-5z","fill","currentColor","opacity","0.8"],["d","M2 17l10 5 10-5","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M2 12l10 5 10-5","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["class","logo-text",4,"ngIf"],["class","sidebar-create",4,"ngIf"],["class","sidebar-create-collapsed",4,"ngIf"],["class","sidebar-nav",4,"ngIf"],["class","sidebar-footer",4,"ngIf"],[1,"sidebar-content"],[1,"sidebar-overlay",3,"click"],[1,"logo-text"],[1,"sidebar-create"],["buttonType","ghost","size","medium",3,"onClick","tooltip"],["viewBox","0 0 24 24","fill","none",1,"create-icon"],["d","M6 12H18M12 6V18","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],[1,"create-label"],[1,"sidebar-create-collapsed"],["iconButtonType","ghost","size","large",3,"onClick"],["viewBox","0 0 24 24","fill","none"],[1,"sidebar-nav"],["class","nav-item",3,"has-children",4,"ngFor","ngForOf"],[1,"nav-item"],["routerLinkActive","active","class","nav-link",3,"routerLink","routerLinkActiveOptions","title","click",4,"ngIf"],["class","nav-dropdown",4,"ngIf"],["routerLinkActive","active",1,"nav-link",3,"click","routerLink","routerLinkActiveOptions","title"],["viewBox","0 0 24 24","fill","none",1,"nav-icon",3,"innerHTML"],["class","nav-label",4,"ngIf"],[1,"nav-label"],[1,"nav-dropdown"],["routerLinkActive","active","class","nav-link",3,"routerLink","routerLinkActiveOptions","title","active","click",4,"ngIf"],["class","nav-link nav-dropdown-toggle",3,"expanded","active","click",4,"ngIf"],[1,"nav-submenu"],["routerLinkActive","active","class","nav-sublink",3,"routerLink","click",4,"ngFor","ngForOf"],[1,"nav-link","nav-dropdown-toggle",3,"click"],["viewBox","0 0 24 24","fill","none",1,"dropdown-arrow"],["d","M6 9l6 6 6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["routerLinkActive","active",1,"nav-sublink",3,"click","routerLink"],["viewBox","0 0 24 24","fill","none",1,"nav-subicon",3,"innerHTML"],[1,"nav-sublabel"],[1,"sidebar-footer"],[1,"footer-actions"],["routerLink","/profile","routerLinkActive","active",1,"footer-link",3,"title"],["viewBox","0 0 24 24","fill","none",1,"footer-icon"],["d","M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","7","r","4","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["class","footer-label",4,"ngIf"],["routerLink","/settings","routerLinkActive","active",1,"footer-link",3,"title"],["d","M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"footer-bottom-row"],[1,"footer-link","logout-link",3,"click","title"],["d","M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["points","16,17 21,12 16,7","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["x1","21","y1","12","x2","9","y2","12","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"toggle-btn",3,"click","title"],["viewBox","0 0 24 24","fill","none",1,"toggle-icon"],["d","M15 18l-6-6 6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"footer-label"]],template:function(i,n){i&1&&(V(),g(0,Je,1,0,"div",0),o(1,"div",1)(2,"nav",2)(3,"div",3)(4,"div",4)(5,"a",5),h(),o(6,"svg",6),f(7,"path",7)(8,"path",8)(9,"path",9),a(),g(10,Ke,2,1,"span",10),a()()(),g(11,Ye,6,2,"div",11)(12,Xe,4,0,"div",12)(13,at,2,1,"ul",13)(14,ct,22,9,"div",14),a(),y(),o(15,"div",15),L(16),a()()),i&2&&(s("ngIf",n.isClosed()&&n.isMobile),r(),k("sidebar-collapsed",n.isCollapsed())("sidebar-closed",n.isClosed()),r(),k("collapsed",n.isCollapsed())("closed",n.isClosed()),r(8),s("ngIf",!n.isCollapsed()),r(),s("ngIf",!n.isCollapsed()&&!n.isClosed()),r(),s("ngIf",n.isCollapsed()&&!n.isClosed()),r(),s("ngIf",!n.isClosed()),r(),s("ngIf",!n.isClosed()))},dependencies:[B,A,I,F,R,he,be,z],styles:[".sidebar-container[_ngcontent-%COMP%]{display:flex;height:100vh;overflow-x:hidden}.sidebar[_ngcontent-%COMP%]{width:240px;background:#fff;border-right:1px solid #e5e7eb;height:100vh;position:fixed;left:0;top:0;display:flex;flex-direction:column;transition:width .2s cubic-bezier(.4,0,.2,1);z-index:100;overflow-y:auto;overflow-x:hidden}.sidebar.collapsed[_ngcontent-%COMP%]{width:64px}.sidebar.closed[_ngcontent-%COMP%]{transform:translate(-100%)}@media (min-width: 769px){.sidebar.closed[_ngcontent-%COMP%]{transform:translate(0);width:64px}.sidebar-container.sidebar-closed[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{margin-left:64px}}.sidebar-header[_ngcontent-%COMP%]{height:64px;display:flex;align-items:center;padding:0 16px;justify-content:left;overflow-x:hidden;border-bottom:1px solid #e5e7eb}.sidebar-logo[_ngcontent-%COMP%]{display:flex;justify-content:center}.logo-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;text-decoration:none;color:inherit}.logo-icon[_ngcontent-%COMP%]{width:28px;height:28px;color:#15803d;flex-shrink:0}.logo-text[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#1a202c;letter-spacing:-.02em;white-space:nowrap;overflow:hidden;transition:opacity .15s ease,width .15s ease}.sidebar.collapsed[_ngcontent-%COMP%]   .logo-link[_ngcontent-%COMP%]{justify-content:center}.sidebar-create[_ngcontent-%COMP%]{padding:12px}.sidebar-create-collapsed[_ngcontent-%COMP%]{padding:12px;display:flex;justify-content:center}.sidebar-create-collapsed[_ngcontent-%COMP%]   app-icon-button[_ngcontent-%COMP%]{width:44px;height:44px}[_nghost-%COMP%]     .sidebar-create-collapsed .icon-button{width:44px;height:44px;padding:0;display:flex;align-items:center;justify-content:center;background-color:var(--create-btn-bg, #f3f4f6)!important;border:1px solid var(--create-btn-border, #e5e7eb)!important}[_nghost-%COMP%]     .sidebar-create-collapsed .icon-button .icon-content{color:var(--create-icon-color, var(--primary-color, #15803d))!important}[_nghost-%COMP%]     .sidebar-create-collapsed .icon-button svg{width:32px;height:32px}[_nghost-%COMP%]     .sidebar-create-collapsed .icon-button:hover{background-color:var(--create-btn-bg-hover, #e5e7eb)!important}.sidebar-create[_ngcontent-%COMP%]   app-button[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]     .sidebar-create app-button button{width:100%;height:44px;display:flex;align-items:center;gap:8px;justify-content:flex-start;padding:12px;border-radius:8px;background-color:var(--create-btn-bg, #f3f4f6)!important;border:1px solid var(--create-btn-border, #e5e7eb)!important;color:#1f2937!important;font-weight:500;font-size:.875rem;box-sizing:border-box;overflow:hidden;white-space:nowrap}[_nghost-%COMP%]     .sidebar-create app-button button:hover{background-color:var(--create-btn-bg-hover, #e5e7eb)!important}[_nghost-%COMP%]     .sidebar-create app-button button:active{background-color:#d1d5db!important}[_nghost-%COMP%]     .sidebar-create app-button button svg.create-icon{width:32px;height:32px;color:var(--create-icon-color, var(--primary-color, #007bff));flex-shrink:0}.create-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-flex;align-items:center;line-height:1.5}.sidebar-create-collapsed[_ngcontent-%COMP%]   .icon-content[_ngcontent-%COMP%]{color:#fff}.create-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500}.sidebar-nav[_ngcontent-%COMP%]{list-style:none;padding:8px 12px;margin:0;flex:1;overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column;gap:4px}.sidebar-nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0;min-width:0}.nav-link[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px 12px;text-decoration:none;color:#6b7280;border-radius:8px;transition:all .15s ease;overflow:hidden;min-width:0}.nav-link[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#1f2937}.nav-link.active[_ngcontent-%COMP%]{background-color:#f0fdf4;color:#15803d}.nav-link.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{color:#15803d}.nav-icon[_ngcontent-%COMP%]{width:20px;height:20px;flex-shrink:0}.nav-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;white-space:nowrap;flex:1;overflow:hidden;text-overflow:ellipsis;min-width:0;opacity:1;transition:opacity .15s ease}.nav-dropdown[_ngcontent-%COMP%]{display:flex;flex-direction:column}.nav-dropdown-toggle[_ngcontent-%COMP%]{width:100%;background:none;border:none;font-family:inherit;cursor:pointer;text-align:left}.dropdown-arrow[_ngcontent-%COMP%]{width:16px;height:16px;flex-shrink:0;color:#9ca3af;transition:transform .2s ease}.dropdown-arrow.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.nav-submenu[_ngcontent-%COMP%]{max-height:0;overflow:hidden;transition:max-height .2s ease;padding-left:8px}.nav-submenu.open[_ngcontent-%COMP%]{max-height:200px}.nav-sublink[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:8px 12px 8px 24px;text-decoration:none;color:#6b7280;border-radius:6px;transition:all .15s ease;font-size:.8125rem}.nav-sublink[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#1f2937}.nav-sublink.active[_ngcontent-%COMP%]{background-color:#f0fdf4;color:#15803d}.nav-subicon[_ngcontent-%COMP%]{width:16px;height:16px;flex-shrink:0}.nav-sublabel[_ngcontent-%COMP%]{font-weight:500}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{justify-content:center;padding:10px}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-dropdown-toggle[_ngcontent-%COMP%]   .dropdown-arrow[_ngcontent-%COMP%]{display:none}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-submenu[_ngcontent-%COMP%]{position:absolute;left:64px;top:0;background:#fff;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 4px 12px #0000001a;padding:8px;max-height:none;width:max-content;min-width:160px;z-index:200}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-dropdown[_ngcontent-%COMP%]{position:relative}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-submenu[_ngcontent-%COMP%]   .nav-sublink[_ngcontent-%COMP%]{padding:8px 12px}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%], .sidebar.collapsed[_ngcontent-%COMP%]   .sidebar-create[_ngcontent-%COMP%], .sidebar.collapsed[_ngcontent-%COMP%]   .logo-text[_ngcontent-%COMP%], .sidebar.collapsed[_ngcontent-%COMP%]   .footer-label[_ngcontent-%COMP%]{opacity:0;width:0;overflow:hidden;pointer-events:none}@media (max-width: 768px){.sidebar.closed[_ngcontent-%COMP%]   .sidebar-logo[_ngcontent-%COMP%], .sidebar.closed[_ngcontent-%COMP%]   .sidebar-create[_ngcontent-%COMP%], .sidebar.closed[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]{display:none}}.sidebar-footer[_ngcontent-%COMP%]{padding:12px;border-top:1px solid #e5e7eb;margin-top:auto}.footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.footer-link[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px 12px;text-decoration:none;color:#6b7280;border-radius:8px;transition:all .15s ease;cursor:pointer;background:none;border:none;width:100%;font-size:.875rem;font-family:inherit}.footer-link[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#1f2937}.footer-link.active[_ngcontent-%COMP%]{background-color:#f0fdf4;color:#15803d}.footer-link.active[_ngcontent-%COMP%]   .footer-icon[_ngcontent-%COMP%]{color:#15803d}.footer-icon[_ngcontent-%COMP%]{width:20px;height:20px;flex-shrink:0}.footer-label[_ngcontent-%COMP%]{font-weight:500;white-space:nowrap;overflow:hidden;transition:opacity .15s ease,width .15s ease}.logout-link[_ngcontent-%COMP%]:hover, .logout-link[_ngcontent-%COMP%]:hover   .footer-icon[_ngcontent-%COMP%]{color:#dc2626}.footer-bottom-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:8px;padding-top:8px;border-top:1px solid #e5e7eb}.footer-bottom-row[_ngcontent-%COMP%]   .footer-link[_ngcontent-%COMP%]{flex:1}.toggle-btn[_ngcontent-%COMP%]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:8px;cursor:pointer;transition:all .15s ease;flex-shrink:0}.toggle-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb}.toggle-icon[_ngcontent-%COMP%]{width:18px;height:18px;color:#6b7280;transition:transform .2s ease}.toggle-icon.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.sidebar.collapsed[_ngcontent-%COMP%]   .footer-link[_ngcontent-%COMP%]{justify-content:center;padding:10px}.sidebar.collapsed[_ngcontent-%COMP%]   .footer-bottom-row[_ngcontent-%COMP%]{flex-direction:column;gap:4px}.sidebar.collapsed[_ngcontent-%COMP%]   .footer-bottom-row[_ngcontent-%COMP%]   .footer-link[_ngcontent-%COMP%]{flex:none;width:100%}.sidebar.collapsed[_ngcontent-%COMP%]   .toggle-btn[_ngcontent-%COMP%]{width:100%}.sidebar-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;z-index:99;backdrop-filter:blur(2px)}.sidebar-content[_ngcontent-%COMP%]{flex:1;margin-left:240px;transition:margin-left .2s cubic-bezier(.4,0,.2,1);will-change:margin-left;overflow-x:hidden;overflow-y:auto;height:100vh;width:calc(100vw - 240px);max-width:calc(100vw - 240px)}.sidebar-container.sidebar-collapsed[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{margin-left:64px;width:calc(100vw - 64px);max-width:calc(100vw - 64px)}.sidebar-container.sidebar-closed[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{margin-left:0;width:100vw;max-width:100vw}.sidebar[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}.sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{transform:translate(-100%)}.sidebar[_ngcontent-%COMP%]:not(.closed){transform:translate(0)}.sidebar-content[_ngcontent-%COMP%], .sidebar-container.sidebar-closed[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{margin-left:0;width:100vw;max-width:100vw}}"]})}return t})();function ut(t,d){if(t&1&&(o(0,"a",2),c(1),a()),t&2){let e=d.$implicit,i=d.last;k("last",i),s("routerLink",e.route)("href",e.url,ie),r(),w(" ",e.label," ")}}var We=(()=>{class t{items=[];static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["app-breadcrumbs"]],inputs:{items:"items"},decls:2,vars:1,consts:[[1,"breadcrumbs"],["class","breadcrumb-item",3,"routerLink","href","last",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"routerLink","href"]],template:function(i,n){i&1&&(o(0,"nav",0),g(1,ut,2,5,"a",1),a()),i&2&&(r(),s("ngForOf",n.items))},dependencies:[B,A,F,R],styles:['.breadcrumbs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem}.breadcrumb-item[_ngcontent-%COMP%]{color:#64748b;text-decoration:none;transition:color .2s ease}.breadcrumb-item[_ngcontent-%COMP%]:not(.last):hover{color:#007bff}.breadcrumb-item[_ngcontent-%COMP%]:not(.last):after{content:"\\203a";margin-left:.5rem;color:#cbd5e1}.breadcrumb-item.last[_ngcontent-%COMP%]{color:#1a202c;font-weight:500;cursor:default;pointer-events:none}']})}return t})();function dt(t,d){if(t&1&&f(0,"app-breadcrumbs",5),t&2){let e=l(2).ngIf;s("items",e.breadcrumbs)}}function pt(t,d){if(t&1&&(o(0,"h1",6),c(1),a()),t&2){let e=l(2).ngIf;r(),b(e.title)}}function mt(t,d){if(t&1&&(ae(0),g(1,dt,1,1,"app-breadcrumbs",3)(2,pt,2,1,"h1",4),re()),t&2){let e=l().ngIf;r(),s("ngIf",e.breadcrumbs.length),r(),s("ngIf",e.title)}}function gt(t,d){if(t&1&&(o(0,"div",1),g(1,mt,3,2,"ng-container",2),a()),t&2){let e=d.ngIf;r(),s("ngIf",e.title||e.breadcrumbs.length)}}var He=(()=>{class t{pageHeaderService=M(Be);static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["app-page-header"]],decls:2,vars:3,consts:[["class","page-header",4,"ngIf"],[1,"page-header"],[4,"ngIf"],[3,"items",4,"ngIf"],["class","page-title",4,"ngIf"],[3,"items"],[1,"page-title"]],template:function(i,n){i&1&&(g(0,gt,2,1,"div",0),j(1,"async")),i&2&&s("ngIf",N(1,1,n.pageHeaderService.headerData$))},dependencies:[B,I,U,F,We],styles:[".page-header[_ngcontent-%COMP%]{padding:1.5rem 0 3.5rem}[_nghost-%COMP%]     .breadcrumbs{margin-bottom:.5rem}.page-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#0f172a;margin:0;letter-spacing:-.02em}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{padding:1rem 0}.page-title[_ngcontent-%COMP%]{font-size:1.5rem}}"]})}return t})();var ft=["*"];function _t(t,d){if(t&1&&(o(0,"p"),c(1),a()),t&2){let e=l(2);r(),b(e.message)}}function ht(t,d){if(t&1){let e=C();o(0,"app-button",9),_("onClick",function(){p(e);let n=l(3);return m(n.onCancel())}),c(1),a()}if(t&2){let e=l(3);r(),w(" ",e.cancelLabel," ")}}function Ct(t,d){if(t&1){let e=C();o(0,"div",6),g(1,ht,2,1,"app-button",7),o(2,"app-button",8),_("onClick",function(){p(e);let n=l(2);return m(n.onConfirm())}),c(3),a()()}if(t&2){let e=l(2);r(),s("ngIf",e.cancelLabel),r(2),w(" ",e.confirmLabel," ")}}function xt(t,d){if(t&1){let e=C();o(0,"div",1)(1,"app-modal",2),_("closed",function(){p(e);let n=l();return m(n.onClose())}),o(2,"div",3),g(3,_t,2,1,"p",4),L(4),a(),g(5,Ct,4,2,"div",5),a()()}if(t&2){let e=l();r(),s("visible",e.visible)("title",e.title)("showCloseButton",e.dismissible)("showFooter",e.showActions)("size",e.size),r(2),s("ngIf",e.message),r(2),s("ngIf",e.showActions)}}var je=(()=>{class t{visible=!1;title="";message="";confirmLabel="\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C";cancelLabel="\u041E\u0442\u043C\u0435\u043D\u0430";showActions=!0;dismissible=!0;size="medium";confirmed=new S;cancelled=new S;closed=new S;onConfirm(){this.confirmed.emit()}onCancel(){this.cancelled.emit(),this.onClose()}onClose(){this.visible=!1,this.closed.emit()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["app-dialog"]],inputs:{visible:"visible",title:"title",message:"message",confirmLabel:"confirmLabel",cancelLabel:"cancelLabel",showActions:"showActions",dismissible:"dismissible",size:"size"},outputs:{confirmed:"confirmed",cancelled:"cancelled",closed:"closed"},ngContentSelectors:ft,decls:1,vars:1,consts:[["class","dialog-wrapper",4,"ngIf"],[1,"dialog-wrapper"],[3,"closed","visible","title","showCloseButton","showFooter","size"],[1,"dialog-content"],[4,"ngIf"],["modalFooter","",4,"ngIf"],["modalFooter",""],["buttonType","ghost",3,"onClick",4,"ngIf"],["buttonType","primary",3,"onClick"],["buttonType","ghost",3,"onClick"]],template:function(i,n){i&1&&(V(),g(0,xt,6,7,"div",0)),i&2&&s("ngIf",n.visible)},dependencies:[B,I,q,z],styles:[".dialog-wrapper[_ngcontent-%COMP%]     .modal-overlay{z-index:10001!important;background-color:#0009!important}.dialog-content[_ngcontent-%COMP%]{color:#1a202c;line-height:1.6}.dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}"]})}return t})();function bt(t,d){t&1&&(o(0,"div",16),h(),o(1,"svg",17),f(2,"circle",18)(3,"path",19),a(),c(4," \u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0434\u043B\u044F \u043F\u043E\u0438\u0441\u043A\u0430 \u0438\u043B\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u043A\u043B\u0438\u0435\u043D\u0442\u0430 "),a())}function vt(t,d){t&1&&(o(0,"div",20)(1,"span"),c(2,"\u041F\u043E\u0438\u0441\u043A \u043A\u043B\u0438\u0435\u043D\u0442\u0430..."),a()())}function wt(t,d){if(t&1){let e=C();o(0,"div",6)(1,"label",7),c(2,"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),a(),o(3,"div",8)(4,"input",9),E("ngModelChange",function(n){p(e);let u=l();return O(u.searchPhone,n)||(u.searchPhone=n),m(n)}),_("keypress",function(n){p(e);let u=l();return m(u.onSearchKeypress(n))}),a(),o(5,"button",10),_("click",function(){p(e);let n=l();return m(n.handleSearch())}),h(),o(6,"svg",11),f(7,"circle",12)(8,"path",13),a()()(),g(9,bt,5,0,"div",14)(10,vt,3,0,"div",15),a()}if(t&2){let e=l();r(4),T("ngModel",e.searchPhone),s("disabled",e.isLoading),r(),s("disabled",e.isLoading),r(4),s("ngIf",!e.isLoading),r(),s("ngIf",e.isLoading&&e.currentStep==="search")}}function Mt(t,d){t&1&&(h(),f(0,"path",53))}function yt(t,d){t&1&&(h(),f(0,"path",54))}function Pt(t,d){if(t&1&&(o(0,"span",57),c(1),a()),t&2){let e=d.$implicit;r(),b(e)}}function kt(t,d){if(t&1&&(o(0,"div",55),g(1,Pt,2,1,"span",56),a()),t&2){let e=l(2);r(),s("ngForOf",e.foundClient.tags)}}function St(t,d){t&1&&(o(0,"span",62),c(1,"\u0435\u0449\u0451..."),a())}function Tt(t,d){t&1&&(o(0,"span",63),c(1,"\u0441\u0432\u0435\u0440\u043D\u0443\u0442\u044C"),a())}function Ot(t,d){if(t&1){let e=C();o(0,"div",58),_("click",function(){p(e);let n=l(2);return m(n.toggleComment())}),o(1,"span",59),c(2),a(),g(3,St,2,0,"span",60)(4,Tt,2,0,"span",61),a()}if(t&2){let e=l(2);r(2),b(e.isCommentExpanded?e.foundClient.comment:e.getTruncatedComment(e.foundClient.comment)),r(),s("ngIf",!e.isCommentExpanded&&e.foundClient.comment.length>50),r(),s("ngIf",e.isCommentExpanded)}}function Et(t,d){if(t&1){let e=C();o(0,"div",64)(1,"label",65)(2,"input",66),E("ngModelChange",function(n){p(e);let u=l(2);return O(u.useBonuses,n)||(u.useBonuses=n),m(n)}),_("change",function(){p(e);let n=l(2);return m(n.onUseBonusesChange())}),a(),f(3,"span",67),o(4,"span",68),c(5,"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u044B"),a()(),o(6,"span",69),c(7),a()()}if(t&2){let e=l(2);r(2),T("ngModel",e.useBonuses),r(5),w("\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u043E: ",e.foundClient.balance,"")}}function Bt(t,d){if(t&1){let e=C();o(0,"div",70)(1,"label",7),c(2,"\u0421\u043F\u0438\u0441\u0430\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u043E\u0432"),a(),o(3,"input",71),E("ngModelChange",function(n){p(e);let u=l(2);return O(u.bonusesToUse,n)||(u.bonusesToUse=n),m(n)}),_("input",function(){p(e);let n=l(2);return m(n.onBonusesChange())}),a(),o(4,"div",72),c(5),a()()}if(t&2){let e=l(2);r(3),T("ngModel",e.bonusesToUse),s("max",e.getMaxBonuses()),r(2),w(" \u041C\u0430\u043A\u0441\u0438\u043C\u0443\u043C: ",e.getMaxBonuses()," \u0431\u043E\u043D\u0443\u0441\u043E\u0432 (\u0434\u043E 50% \u043E\u0442 \u0441\u0443\u043C\u043C\u044B) ")}}function It(t,d){if(t&1&&(o(0,"div",73)(1,"span",43),c(2,"\u0421\u043A\u0438\u0434\u043A\u0430 \u0431\u043E\u043D\u0443\u0441\u0430\u043C\u0438:"),a(),o(3,"span",46),c(4),a()()),t&2){let e=l(2);r(4),w("\u2212",e.bonusesToUse," \u20B8")}}function Dt(t,d){if(t&1&&(o(0,"div",74)(1,"span",43),c(2,"\u0411\u0443\u0434\u0435\u0442 \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E:"),a(),o(3,"span",75),c(4),a()()),t&2){let e=l(2);r(4),w("+",e.calculatedBonus," \u0431\u043E\u043D\u0443\u0441\u043E\u0432")}}function Vt(t,d){t&1&&(o(0,"div",76),h(),o(1,"svg",77),f(2,"path",78)(3,"path",79),a(),y(),o(4,"span"),c(5,"\u041F\u0440\u0438 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u0438 \u0431\u043E\u043D\u0443\u0441\u043E\u0432 \u043D\u043E\u0432\u044B\u0435 \u0431\u043E\u043D\u0443\u0441\u044B \u043D\u0435 \u043D\u0430\u0447\u0438\u0441\u043B\u044F\u044E\u0442\u0441\u044F"),a()())}function Lt(t,d){if(t&1){let e=C();o(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24),c(4),a(),o(5,"div",25)(6,"div",26),c(7),a(),o(8,"div",27)(9,"div",28),h(),o(10,"svg",29),f(11,"path",30),a(),c(12),a(),y(),o(13,"div",31),h(),o(14,"svg",32),g(15,Mt,1,0,"path",33)(16,yt,1,0,"path",34),a(),y(),o(17,"span"),c(18),a()()()()(),g(19,kt,2,1,"div",35)(20,Ot,5,3,"div",36),a(),o(21,"div",37)(22,"label",7),c(23,"\u0421\u0443\u043C\u043C\u0430 \u043F\u043E\u043A\u0443\u043F\u043A\u0438 (\u20B8)"),a(),o(24,"input",38),E("ngModelChange",function(n){p(e);let u=l();return O(u.purchaseAmount,n)||(u.purchaseAmount=n),m(n)}),_("input",function(){p(e);let n=l();return m(n.onAmountChange())}),a()(),g(25,Et,8,2,"div",39)(26,Bt,6,3,"div",40),o(27,"div",41)(28,"div",42)(29,"span",43),c(30,"ID \u043F\u043B\u0430\u0442\u0435\u0436\u0430:"),a(),o(31,"span",44),c(32),a()(),o(33,"div",45)(34,"span",43),c(35,"\u0421\u0443\u043C\u043C\u0430 \u043F\u043E\u043A\u0443\u043F\u043A\u0438:"),a(),o(36,"span",46),c(37),a()(),g(38,It,5,1,"div",47),o(39,"div",48)(40,"span",43),c(41,"\u041A \u043E\u043F\u043B\u0430\u0442\u0435:"),a(),o(42,"span",46),c(43),a()(),g(44,Dt,5,1,"div",49)(45,Vt,6,0,"div",50),a(),o(46,"button",51),_("click",function(){p(e);let n=l();return m(n.completeTransaction())}),c(47),a(),o(48,"button",52),_("click",function(){p(e);let n=l();return m(n.goBack())}),c(49,"\u2190 \u041D\u0430\u0437\u0430\u0434 \u043A \u043F\u043E\u0438\u0441\u043A\u0443"),a()()}if(t&2){let e=l();r(),k("business-client",e.foundClient.type==="business"),r(3),w(" ",e.getInitials(e.foundClient.name)," "),r(3),b(e.foundClient.name),r(5),w(" ",e.foundClient.balance," \u0431\u043E\u043D\u0443\u0441\u043E\u0432 "),r(3),s("ngIf",e.foundClient.type==="business"),r(),s("ngIf",e.foundClient.type==="individual"),r(2),b(e.foundClient.type==="business"?"\u0411\u0438\u0437\u043D\u0435\u0441":"\u0418\u043D\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043B\u044C\u043D\u044B\u0439"),r(),s("ngIf",e.foundClient.tags&&e.foundClient.tags.length>0),r(),s("ngIf",e.foundClient.comment),r(4),T("ngModel",e.purchaseAmount),r(),s("ngIf",e.foundClient&&e.foundClient.balance>0),r(),s("ngIf",e.useBonuses&&e.foundClient),r(6),w("#",e.paymentId||"\u2014",""),r(5),w("",e.purchaseAmount||0," \u20B8"),r(),s("ngIf",e.useBonuses&&e.bonusesToUse>0),r(5),w("",e.getFinalAmount()," \u20B8"),r(),s("ngIf",!e.useBonuses),r(),s("ngIf",e.useBonuses),r(),s("disabled",!e.purchaseAmount||e.purchaseAmount<=0||e.isLoading),r(),w(" ",e.isLoading?"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430...":"\u041F\u0440\u043E\u0432\u0435\u0441\u0442\u0438 \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u044E"," ")}}function At(t,d){if(t&1&&(o(0,"div",100),h(),o(1,"svg",101),f(2,"path",30),a(),y(),o(3,"div",102)(4,"span",103),c(5,"\u041F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u044B\u0439 \u0431\u043E\u043D\u0443\u0441"),a(),o(6,"span",104),c(7,"\u041A\u043B\u0438\u0435\u043D\u0442 \u043F\u043E\u043B\u0443\u0447\u0438\u0442 "),o(8,"strong"),c(9),a(),c(10," \u0431\u043E\u043D\u0443\u0441\u043E\u0432 \u043F\u043E\u0441\u043B\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F"),a()()()),t&2){let e=l(2);r(9),b(e.welcomeBonusAmount)}}function Ft(t,d){if(t&1){let e=C();o(0,"div",37)(1,"label",7),c(2,"\u0424\u0430\u043C\u0438\u043B\u0438\u044F (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)"),a(),o(3,"input",105),E("ngModelChange",function(n){p(e);let u=l(2);return O(u.newClientSurname,n)||(u.newClientSurname=n),m(n)}),a()()}if(t&2){let e=l(2);r(3),T("ngModel",e.newClientSurname)}}function zt(t,d){if(t&1){let e=C();o(0,"div",37)(1,"label",7),c(2,"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)"),a(),o(3,"input",106),E("ngModelChange",function(n){p(e);let u=l(2);return O(u.newClientBirthday,n)||(u.newClientBirthday=n),m(n)}),a()()}if(t&2){let e=l(2);r(3),T("ngModel",e.newClientBirthday)}}function Wt(t,d){t&1&&(o(0,"span",114),c(1,"\u2713"),a())}function Ht(t,d){if(t&1){let e=C();o(0,"button",112),_("click",function(){let n=p(e).$implicit,u=l(3);return m(u.addTag(n))}),c(1),g(2,Wt,2,0,"span",113),a()}if(t&2){let e=d.$implicit,i=l(3);k("selected",i.isTagSelected(e)),r(),w(" ",e," "),r(),s("ngIf",i.isTagSelected(e))}}function jt(t,d){if(t&1){let e=C();o(0,"div",107)(1,"div",108)(2,"span"),c(3,"\u041F\u043E\u043F\u0443\u043B\u044F\u0440\u043D\u044B\u0435 \u0442\u044D\u0433\u0438"),a(),o(4,"button",109),_("click",function(){p(e);let n=l(2);return m(n.showTagsDropdown=!1)}),c(5,"\xD7"),a()(),o(6,"div",110),g(7,Ht,3,4,"button",111),a()()}if(t&2){let e=l(2);r(7),s("ngForOf",e.availableTags)}}function Nt(t,d){if(t&1){let e=C();o(0,"div",80)(1,"div",81),h(),o(2,"svg",82),f(3,"circle",83)(4,"path",84),a(),c(5," \u041A\u043B\u0438\u0435\u043D\u0442 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D. \u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u043F\u0440\u043E\u0444\u0438\u043B\u044F. "),a(),g(6,At,11,1,"div",85),y(),o(7,"div",37)(8,"label",7),c(9,"\u0422\u0435\u043B\u0435\u0444\u043E\u043D"),a(),f(10,"input",86),a(),o(11,"div",37)(12,"label",7),c(13),a(),o(14,"input",87),E("ngModelChange",function(n){p(e);let u=l();return O(u.newClientName,n)||(u.newClientName=n),m(n)}),a()(),g(15,Ft,4,1,"div",88)(16,zt,4,1,"div",88),o(17,"div",37)(18,"label",7),c(19,"Email (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)"),a(),o(20,"input",89),E("ngModelChange",function(n){p(e);let u=l();return O(u.newClientEmail,n)||(u.newClientEmail=n),m(n)}),a()(),o(21,"div",37)(22,"label",7),c(23,"\u0422\u0438\u043F \u043A\u043B\u0438\u0435\u043D\u0442\u0430"),a(),o(24,"div",90)(25,"label",91)(26,"input",92),E("ngModelChange",function(n){p(e);let u=l();return O(u.newClientType,n)||(u.newClientType=n),m(n)}),a(),f(27,"span",93),o(28,"span",94),c(29,"\u0418\u043D\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043B\u044C\u043D\u044B\u0439"),a()(),o(30,"label",91)(31,"input",95),E("ngModelChange",function(n){p(e);let u=l();return O(u.newClientType,n)||(u.newClientType=n),m(n)}),a(),f(32,"span",93),o(33,"span",94),c(34,"\u0411\u0438\u0437\u043D\u0435\u0441"),a()()()(),o(35,"div",37)(36,"label",7),c(37,"\u0422\u044D\u0433\u0438"),a(),o(38,"input",96),E("ngModelChange",function(n){p(e);let u=l();return O(u.newClientTags,n)||(u.newClientTags=n),m(n)}),_("focus",function(){p(e);let n=l();return m(n.showTagsDropdown=!0)}),a(),o(39,"div",97),c(40,"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u044D\u0433\u0438 \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E \u0438\u043B\u0438 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430"),a(),g(41,jt,8,1,"div",98),a(),o(42,"div",37)(43,"label",7),c(44,"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)"),a(),o(45,"textarea",99),E("ngModelChange",function(n){p(e);let u=l();return O(u.newClientComment,n)||(u.newClientComment=n),m(n)}),a()(),o(46,"button",51),_("click",function(){p(e);let n=l();return m(n.createClient())}),c(47),a(),o(48,"button",52),_("click",function(){p(e);let n=l();return m(n.goBack())}),c(49,"\u2190 \u041D\u0430\u0437\u0430\u0434 \u043A \u043F\u043E\u0438\u0441\u043A\u0443"),a()()}if(t&2){let e=l();r(6),s("ngIf",e.welcomeBonusAmount>0),r(4),s("value",e.searchPhone),r(3),b(e.newClientType==="business"?"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u043B\u0438\u0435\u043D\u0442\u0430":"\u0418\u043C\u044F"),r(),T("ngModel",e.newClientName),s("placeholder",e.newClientType==="business"?"\u0422\u041E\u041E \xAB\u041A\u043B\u0438\u0435\u043D\u0442\xBB":"\u0418\u0432\u0430\u043D"),r(),s("ngIf",e.newClientType==="individual"),r(),s("ngIf",e.newClientType==="individual"),r(4),T("ngModel",e.newClientEmail),r(6),T("ngModel",e.newClientType),r(5),T("ngModel",e.newClientType),r(7),T("ngModel",e.newClientTags),r(3),s("ngIf",e.showTagsDropdown&&e.availableTags.length>0),r(4),T("ngModel",e.newClientComment),r(),s("disabled",!e.newClientName||e.isLoading),r(),w(" ",e.isLoading?"\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435...":"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430"," ")}}function Ut(t,d){if(t&1&&(o(0,"div",128)(1,"label",129),c(2,"\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0439 \u0448\u0430\u0431\u043B\u043E\u043D"),a(),o(3,"div",130)(4,"div",131)(5,"div",132),h(),o(6,"svg",133),f(7,"path",134)(8,"path",135),a()(),y(),o(9,"div",136)(10,"h4",137),c(11),a(),o(12,"span",138),c(13),a()()(),o(14,"div",139)(15,"p",140),c(16),a()()()()),t&2){let e=l(2);r(11),b(e.selectedWelcomeTemplate.name),r(2),b(e.selectedWelcomeTemplate.type==="bonus_accrued"?"\u041D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043D\u044B\u0435 \u0431\u043E\u043D\u0443\u0441\u044B":"\u0421\u0440\u043E\u043A \u0438\u0441\u0442\u0435\u0447\u0435\u043D\u0438\u044F \u0431\u043E\u043D\u0443\u0441\u043E\u0432"),r(3),b(e.selectedWelcomeTemplate.content)}}function Rt(t,d){t&1&&(o(0,"div",141),h(),o(1,"svg",142),f(2,"circle",83)(3,"path",84),a(),y(),o(4,"div",143)(5,"span",144),c(6,"\u0428\u0430\u0431\u043B\u043E\u043D \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D"),a(),o(7,"span",145),c(8,'\u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0448\u0430\u0431\u043B\u043E\u043D \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u0442\u0438\u043F\u0430 "BASIC_CASHBACK_BONUS_GRANT" \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445'),a()()())}function Gt(t,d){if(t&1&&(o(0,"div",146)(1,"label",147),c(2,"\u0421\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"),a(),o(3,"div",148)(4,"p",149),c(5),a()()()),t&2){let e=l(2);r(5),b(e.getFormattedMessage())}}function qt(t,d){if(t&1){let e=C();o(0,"app-button",150),_("click",function(){p(e);let n=l(2);return m(n.sendWelcomeMessage())}),h(),o(1,"svg",151),f(2,"path",152)(3,"path",153),a(),c(4),a()}if(t&2){let e=l(2);s("disabled",e.isSendingMessage),r(4),w(" ",e.isSendingMessage?"\u041E\u0442\u043F\u0440\u0430\u0432\u043A\u0430...":"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0432 WhatsApp"," ")}}function Qt(t,d){if(t&1&&(o(0,"div",115)(1,"div",116),g(2,Ut,17,3,"div",117)(3,Rt,9,0,"div",118),o(4,"div",119)(5,"label",120),c(6,"\u041D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430 \u043F\u043E\u043B\u0443\u0447\u0430\u0442\u0435\u043B\u044F"),a(),o(7,"div",121),h(),o(8,"svg",122),f(9,"path",123),a(),y(),o(10,"span",124),c(11),a()()(),g(12,Gt,6,1,"div",125),a(),o(13,"div",126),g(14,qt,5,2,"app-button",127),a()()),t&2){let e=l();r(2),s("ngIf",e.selectedWelcomeTemplate),r(),s("ngIf",!e.selectedWelcomeTemplate),r(8),b(e.getPhoneForMessage()),r(),s("ngIf",e.selectedWelcomeTemplate),r(2),s("ngIf",e.selectedWelcomeTemplate)}}var Ne=(()=>{class t{clientsService=M(Ie);paymentsService=M(De);messageTemplatesService=M(Ve);messagesService=M(Le);bonusTypesService=M(Ae);toastService=M(xe);visible=!1;welcomeMessageTemplates=[];visibleChange=new S;transactionComplete=new S;messageSent=new S;currentStep="search";searchPhone="";foundClient=null;purchaseAmount=null;calculatedBonus=0;useBonuses=!1;bonusesToUse=0;paymentId=null;draftPayment=null;isLoading=!1;bonusPercentage=null;newClientName="";newClientSurname="";newClientType="individual";newClientTags="";newClientComment="";newClientEmail="";newClientBirthday="";isCommentExpanded=!1;showTagsDropdown=!1;isSendingMessage=!1;pendingTransactionResult=null;selectedWelcomeTemplate=null;populatedMessageContent="";isNewlyCreatedClient=!1;availableTags=[];showCancelConfirmation=!1;welcomeBonusAmount=0;ngOnChanges(e){e.visible&&(this.toggleBodyScroll(e.visible.currentValue),e.visible.currentValue&&(this.loadAvailableTags(),this.loadWelcomeBonusAmount()))}loadWelcomeBonusAmount(){this.bonusTypesService.getBonusTypesByFlow("create_client").pipe(K(5e3),Y(e=>(console.warn("Error loading welcome bonus amount:",e),J(null)))).subscribe({next:e=>{e&&e.enabled&&e.bonusAmount!==null&&e.bonusAmount!==void 0?(this.welcomeBonusAmount=e.bonusAmount,console.log("Welcome bonus amount loaded:",this.welcomeBonusAmount)):this.welcomeBonusAmount=0}})}loadAvailableTags(){this.clientsService.getTags().subscribe({next:e=>{this.availableTags=Array.isArray(e)?e:[]},error:e=>{console.error("Error loading tags:",e),this.availableTags=[]}})}ngOnDestroy(){this.toggleBodyScroll(!1)}toggleBodyScroll(e){typeof document<"u"&&(document.body.style.overflow=e?"hidden":"")}getModalTitle(){switch(this.currentStep){case"search":return"\u041D\u043E\u0432\u0430\u044F \u043F\u0440\u043E\u0434\u0430\u0436\u0430";case"found":return"\u041E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u0435 \u043F\u043E\u043A\u0443\u043F\u043A\u0438";case"new":return"\u041D\u043E\u0432\u044B\u0439 \u043A\u043B\u0438\u0435\u043D\u0442";case"notify":return"\u0423\u0432\u0435\u0434\u043E\u043C\u0438\u0442\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430";default:return"\u041D\u043E\u0432\u0430\u044F \u043F\u0440\u043E\u0434\u0430\u0436\u0430"}}onClose(){let e=this.currentStep==="found"||this.currentStep==="new";this.draftPayment&&e?this.showCancelConfirmation=!0:this.closeModal()}confirmCancel(){if(this.currentStep==="notify"){this.showCancelConfirmation=!1,this.currentStep="found";return}this.draftPayment?this.paymentsService.deleteDraftPayment(this.draftPayment.txId).subscribe({next:()=>{this.toastService.success("\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A \u043F\u043B\u0430\u0442\u0435\u0436\u0430 \u0443\u0434\u0430\u043B\u0435\u043D"),this.showCancelConfirmation=!1,this.closeModal()},error:e=>{console.error("Error deleting draft payment:",e);let i=e.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A\u0430 \u043F\u043B\u0430\u0442\u0435\u0436\u0430";this.toastService.error(i),this.showCancelConfirmation=!1,this.closeModal()}}):(this.showCancelConfirmation=!1,this.closeModal())}closeModal(){this.resetForm(),this.visible=!1,this.visibleChange.emit(!1)}onSearchKeypress(e){e.key==="Enter"&&this.handleSearch()}handleSearch(){let e=this.searchPhone.trim();if(e.length<3){this.toastService.error("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430");return}this.isLoading=!0,this.clientsService.getClientByPhone(e).subscribe({next:i=>{this.foundClient={id:i.clientId,name:i.name,surname:i.surname||"",phone:e,balance:i.currentBonusBalance||0,type:i.clientType==="BUSINESS"?"business":"individual",tags:i.tags||[],comment:i.comment||void 0},this.isNewlyCreatedClient=!1,this.createDraftPayment()},error:i=>{if(i.status===404)this.isLoading=!1,this.currentStep="new";else{let n=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435 \u043A\u043B\u0438\u0435\u043D\u0442\u0430";this.toastService.error(n),this.isLoading=!1}}})}createDraftPayment(){if(!this.foundClient){console.error("createDraftPayment called but foundClient is null"),this.isLoading=!1;return}this.isLoading=!0,console.log("Loading bonus configuration for new_payment flow..."),this.bonusTypesService.getBonusTypesByFlow("new_payment").pipe(K(5e3),Y(e=>(console.warn("Error or timeout loading bonus configuration, continuing with default:",e),J(null)))).subscribe({next:e=>{console.log("Bonus type loaded:",e),e&&e.enabled&&e.bonusPercentage!==null&&e.bonusPercentage!==void 0?(this.bonusPercentage=e.bonusPercentage/100,console.log("Using bonus percentage:",e.bonusPercentage,"% (",this.bonusPercentage,"as decimal)")):(this.bonusPercentage=0,console.log("Bonus type is disabled or has no percentage, using 0%")),console.log("Creating draft payment for client:",this.foundClient.id),this.paymentsService.createDraftPayment({clientId:this.foundClient.id}).subscribe({next:i=>{console.log("Draft payment created:",i),this.draftPayment=i,this.paymentId=i.txId,this.currentStep="found",this.isLoading=!1,this.calculateBonus()},error:i=>{console.error("Error creating draft payment:",i);let n=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A\u0430 \u043F\u043B\u0430\u0442\u0435\u0436\u0430";this.toastService.error(n),this.isLoading=!1}})},error:e=>{console.error("Unexpected error in bonus config subscription:",e),this.bonusPercentage=0,this.paymentsService.createDraftPayment({clientId:this.foundClient.id}).subscribe({next:i=>{this.draftPayment=i,this.paymentId=i.txId,this.currentStep="found",this.isLoading=!1,this.calculateBonus()},error:i=>{let n=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A\u0430 \u043F\u043B\u0430\u0442\u0435\u0436\u0430";this.toastService.error(n),this.isLoading=!1}})}})}calculateBonus(){if(this.useBonuses)this.calculatedBonus=0;else{let e=this.bonusPercentage??0;this.calculatedBonus=Math.floor((this.purchaseAmount||0)*e)}}onAmountChange(){this.validateBonuses(),this.calculateBonus()}onUseBonusesChange(){this.useBonuses||(this.bonusesToUse=0),this.calculateBonus()}onBonusesChange(){this.validateBonuses(),this.calculateBonus()}validateBonuses(){let e=this.getMaxBonuses();this.bonusesToUse>e&&(this.bonusesToUse=e),this.bonusesToUse<0&&(this.bonusesToUse=0)}getMaxBonuses(){if(!this.foundClient||!this.purchaseAmount)return 0;let e=Math.floor(this.purchaseAmount*.5);return Math.min(this.foundClient.balance,e)}getFinalAmount(){let e=this.purchaseAmount||0,i=this.useBonuses?this.bonusesToUse:0;return Math.max(0,e-i)}completeTransaction(){if(!this.foundClient||!this.purchaseAmount||!this.draftPayment){this.toastService.error("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0432\u0441\u0435 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u043F\u043E\u043B\u044F");return}this.isLoading=!0;let e={originalAmount:this.purchaseAmount,bonusAmountUsed:this.useBonuses&&this.bonusesToUse>0?this.bonusesToUse:null,notes:"Payment for services"};console.log("=== COMPLETE PAYMENT REQUEST ==="),console.log("Payment TX ID:",this.draftPayment.txId),console.log("Full Request Payload:",JSON.stringify(e,null,2)),console.log("================================"),this.paymentsService.completePayment(this.draftPayment.txId,e).subscribe({next:()=>{let i={clientName:this.foundClient.name,phone:this.foundClient.phone,amount:this.purchaseAmount,bonuses:this.calculatedBonus,isNewClient:this.isNewlyCreatedClient};this.pendingTransactionResult=i,this.isLoading=!1,this.useBonuses&&this.bonusesToUse>0?this.finishTransaction():this.openSendMessageModal()},error:i=>{let n=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0438 \u043F\u043B\u0430\u0442\u0435\u0436\u0430";this.toastService.error(n),this.isLoading=!1}})}createClient(){if(!this.newClientName){this.toastService.error("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F \u043A\u043B\u0438\u0435\u043D\u0442\u0430");return}this.isLoading=!0;let e=this.newClientTags.split(",").map(x=>x.trim()).filter(x=>x.length>0),i=this.newClientName,n=this.newClientSurname;if(this.newClientType==="individual"&&!n){let x=this.newClientName.trim().split(/\s+/);x.length>1&&(i=x[0],n=x.slice(1).join(" "))}let u={phone:this.searchPhone.trim(),name:i,surname:n||void 0,dateOfBirth:this.newClientBirthday||null,notes:this.newClientComment||null,tags:e.length>0?e:void 0,clientType:this.newClientType==="business"?"BUSINESS":"INDIVIDUAL",referrerId:null,email:this.newClientEmail||null};console.log("=== CREATE CLIENT REQUEST ==="),console.log("Full Request Payload:",JSON.stringify(u,null,2)),console.log("============================"),this.clientsService.createClient(u).subscribe({next:x=>{this.clientsService.getClientByPhone(this.searchPhone.trim()).subscribe({next:v=>{this.foundClient={id:v.clientId,name:v.name,surname:v.surname||"",phone:this.searchPhone.trim(),balance:v.currentBonusBalance||0,type:v.clientType==="BUSINESS"?"business":"individual",tags:v.tags||[],comment:v.comment||void 0},this.isNewlyCreatedClient=!0,this.createDraftPayment()},error:v=>{console.warn("Failed to fetch client after creation, using created client data:",v),this.foundClient={id:x.id,name:x.name,surname:x.surname||"",phone:this.searchPhone.trim(),balance:0,type:x.clientType==="BUSINESS"?"business":"individual",tags:x.tags||[],comment:x.notes||void 0},this.isNewlyCreatedClient=!0,this.createDraftPayment()}})},error:x=>{let v=x.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u043A\u043B\u0438\u0435\u043D\u0442\u0430";this.toastService.error(v),this.isLoading=!1}})}openSendMessageModal(){if(!this.foundClient||!this.draftPayment)return;this.isLoading=!0;let e="BASIC_CASHBACK_BONUS_GRANT";this.messageTemplatesService.getAllTemplates(e).subscribe({next:i=>{if(i&&i.length>0){if(this.selectedWelcomeTemplate=i[0],!this.draftPayment){this.isLoading=!1,this.toastService.error("\u041E\u0448\u0438\u0431\u043A\u0430: \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A \u043F\u043B\u0430\u0442\u0435\u0436\u0430 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D");return}this.messageTemplatesService.getPopulatedTemplate(e,this.foundClient.id,this.draftPayment.txId).subscribe({next:n=>{this.populatedMessageContent=n.populatedContent,this.isLoading=!1,this.currentStep="notify"},error:n=>{console.error("Error loading populated template:",n),this.populatedMessageContent=this.getFormattedMessage(),this.isLoading=!1,this.currentStep="notify"}})}else this.selectedWelcomeTemplate=null,this.populatedMessageContent="",this.isLoading=!1,this.currentStep="notify"},error:i=>{console.error("Error loading template:",i),this.selectedWelcomeTemplate=null,this.populatedMessageContent="",this.isLoading=!1,this.currentStep="notify"}})}goBackFromNotify(){this.currentStep="found"}finishTransaction(){if(this.isSendingMessage=!1,this.pendingTransactionResult){let e=this.pendingTransactionResult;this.pendingTransactionResult=null,this.transactionComplete.emit(e),this.onClose()}}getClientNameForMessage(){return this.pendingTransactionResult?this.pendingTransactionResult.clientName:this.foundClient?.name||this.newClientName||"\u041A\u043B\u0438\u0435\u043D\u0442"}getAvatarLetterForMessage(){let e=this.getClientNameForMessage();return e?e[0].toUpperCase():"\u041A"}getPhoneForMessage(){return this.pendingTransactionResult?this.pendingTransactionResult.phone:this.foundClient?.phone||this.searchPhone||""}getFormattedMessage(){if(this.populatedMessageContent)return this.populatedMessageContent;if(!this.selectedWelcomeTemplate)return"\u0414\u043E\u0431\u0440\u043E \u043F\u043E\u0436\u0430\u043B\u043E\u0432\u0430\u0442\u044C! \u0421\u043F\u0430\u0441\u0438\u0431\u043E \u0437\u0430 \u043F\u043E\u043A\u0443\u043F\u043A\u0443.";let e=this.selectedWelcomeTemplate.content||"",i=this.getClientNameForMessage(),n=this.getPhoneForMessage();e=e.replace(/\{clientName\}/g,i),e=e.replace(/\{clientPhone\}/g,n),e=e.replace(/\{clientBonus\}/g,String(this.pendingTransactionResult?.bonuses||0)),e=e.replace(/\{clientBonusExp\}/g,"30 \u0434\u043D\u0435\u0439"),e=e.replace(/\{clientEmail\}/g,""),e=e.replace(/\{clientTotalAmount\}/g,String(this.pendingTransactionResult?.amount||0)),e=e.replace(/\{clientTotalTransactions\}/g,"1"),e=e.replace(/\{clientLastVisit\}/g,"\u0421\u0435\u0433\u043E\u0434\u043D\u044F");let u=document.createElement("div");return u.innerHTML=e,e=u.textContent||u.innerText||e,e}sendWelcomeMessage(){if(this.isSendingMessage||!this.foundClient)return;let e=this.getPhoneForMessage(),i=this.getFormattedMessage();if(!e||!i){this.toastService.error("\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430 \u0438\u043B\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435");return}this.isSendingMessage=!0,this.messagesService.sendMessage({clientId:this.foundClient.id,messageContent:i,channel:"WHATSAPP"}).subscribe({next:()=>{this.openWhatsAppWeb(e,i),this.toastService.success("\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u0437\u0430\u043F\u0438\u0441\u0430\u043D\u043E, \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F WhatsApp"),this.messageSent.emit({phone:e,message:i}),this.finishTransaction()},error:n=>{let u=n.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F";this.toastService.error(u),this.isSendingMessage=!1}})}openWhatsAppWeb(e,i){let n=e.replace(/[\s\-\(\)\+]/g,"");n.startsWith("8")&&(n="7"+n.substring(1));let u=encodeURIComponent(i),x=`https://wa.me/${n}?text=${u}`;window.open(x,"_blank")}goBack(){let e=this.currentStep==="found"||this.currentStep==="new"||this.currentStep==="notify";this.draftPayment&&e?this.showCancelConfirmation=!0:this.resetToSearch()}resetToSearch(){this.currentStep="search",this.foundClient=null,this.purchaseAmount=null,this.calculatedBonus=0,this.useBonuses=!1,this.bonusesToUse=0,this.draftPayment=null,this.paymentId=null,this.bonusPercentage=null,this.newClientName="",this.newClientSurname="",this.newClientEmail="",this.newClientBirthday="",this.newClientType="individual",this.newClientTags="",this.newClientComment="",this.isCommentExpanded=!1,this.showTagsDropdown=!1,this.isNewlyCreatedClient=!1}getInitials(e){return e.split(" ").map(i=>i[0]).join("").toUpperCase().substring(0,2)}toggleComment(){this.isCommentExpanded=!this.isCommentExpanded}getTruncatedComment(e){return e.length<=50?e:e.substring(0,50).trim()+"..."}addTag(e){let i=this.newClientTags.split(",").map(n=>n.trim()).filter(n=>n.length>0);if(i.includes(e)){let n=i.indexOf(e);i.splice(n,1)}else i.push(e);this.newClientTags=i.join(", ")}isTagSelected(e){return this.newClientTags.split(",").map(n=>n.trim()).filter(n=>n.length>0).includes(e)}resetForm(){this.currentStep="search",this.searchPhone="",this.foundClient=null,this.purchaseAmount=null,this.calculatedBonus=0,this.useBonuses=!1,this.bonusesToUse=0,this.paymentId=null,this.draftPayment=null,this.bonusPercentage=null,this.newClientName="",this.newClientSurname="",this.newClientEmail="",this.newClientBirthday="",this.newClientType="individual",this.newClientTags="",this.newClientComment="",this.isCommentExpanded=!1,this.showTagsDropdown=!1,this.pendingTransactionResult=null,this.selectedWelcomeTemplate=null,this.populatedMessageContent="",this.isSendingMessage=!1,this.isNewlyCreatedClient=!1,this.isLoading=!1,this.showCancelConfirmation=!1}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["app-transaction-modal"]],inputs:{visible:"visible",welcomeMessageTemplates:"welcomeMessageTemplates"},outputs:{visibleChange:"visibleChange",transactionComplete:"transactionComplete",messageSent:"messageSent"},features:[ne],decls:6,vars:9,consts:[[3,"closed","visible","title","showCloseButton"],["class","step-search",4,"ngIf"],["class","step-found",4,"ngIf"],["class","step-new",4,"ngIf"],["class","step-notify",4,"ngIf"],["title","\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u0435","message","\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043F\u043B\u0430\u0442\u0435\u0436\u0430? \u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A \u043F\u043B\u0430\u0442\u0435\u0436\u0430 \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043B\u0435\u043D.","confirmLabel","\u0414\u0430, \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C","cancelLabel","\u041D\u0435\u0442",3,"confirmed","cancelled","visible","dismissible"],[1,"step-search"],[1,"input-label"],[1,"search-row"],["type","tel","placeholder","8 900 000 00 00",1,"search-input",3,"ngModelChange","keypress","ngModel","disabled"],[1,"search-btn",3,"click","disabled"],["viewBox","0 0 24 24","fill","none",1,"search-icon"],["cx","11","cy","11","r","8","stroke","currentColor","stroke-width","2"],["d","M21 21l-4.35-4.35","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["class","search-hint",4,"ngIf"],["class","loading-indicator",4,"ngIf"],[1,"search-hint"],["viewBox","0 0 24 24","fill","none",1,"hint-icon"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","1.5"],["d","M12 16v-4M12 8h.01","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"loading-indicator"],[1,"step-found"],[1,"client-card"],[1,"client-card-header"],[1,"client-avatar"],[1,"client-info"],[1,"client-name"],[1,"client-bonus-row"],[1,"client-bonus"],["viewBox","0 0 24 24","fill","none",1,"star-icon"],["d","M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z","fill","currentColor"],[1,"client-type-badge"],["viewBox","0 0 24 24","fill","none",1,"type-icon"],["d","M20 7h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM10 4h4v3h-4V4z","fill","currentColor",4,"ngIf"],["d","M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z","fill","currentColor",4,"ngIf"],["class","client-tags",4,"ngIf"],["class","client-comment",3,"click",4,"ngIf"],[1,"form-group"],["type","number","placeholder","0.00","min","1",1,"form-input",3,"ngModelChange","input","ngModel"],["class","use-bonus-toggle",4,"ngIf"],["class","form-group bonus-input-group",4,"ngIf"],[1,"transaction-summary"],[1,"summary-row","payment-id"],[1,"summary-label"],[1,"summary-value","id-value"],[1,"summary-row"],[1,"summary-value"],["class","summary-row discount",4,"ngIf"],[1,"summary-row","total"],["class","summary-row earned",4,"ngIf"],["class","bonus-warning",4,"ngIf"],[1,"submit-btn",3,"click","disabled"],[1,"back-btn",3,"click"],["d","M20 7h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM10 4h4v3h-4V4z","fill","currentColor"],["d","M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z","fill","currentColor"],[1,"client-tags"],["class","client-tag",4,"ngFor","ngForOf"],[1,"client-tag"],[1,"client-comment",3,"click"],[1,"comment-text"],["class","comment-more",4,"ngIf"],["class","comment-less",4,"ngIf"],[1,"comment-more"],[1,"comment-less"],[1,"use-bonus-toggle"],[1,"toggle-label"],["type","checkbox",1,"toggle-checkbox",3,"ngModelChange","change","ngModel"],[1,"toggle-switch"],[1,"toggle-text"],[1,"available-bonus"],[1,"form-group","bonus-input-group"],["type","number","min","0","placeholder","0",1,"form-input",3,"ngModelChange","input","ngModel","max"],[1,"bonus-hint"],[1,"summary-row","discount"],[1,"summary-row","earned"],[1,"summary-value","bonus"],[1,"bonus-warning"],["viewBox","0 0 24 24","fill","none",1,"warning-icon"],["d","M12 9v4M12 17h.01","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["d","M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z","stroke","currentColor","stroke-width","2"],[1,"step-new"],[1,"alert-box"],["viewBox","0 0 24 24","fill","none",1,"alert-icon"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","2"],["d","M12 8v4M12 16h.01","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["class","bonus-hint-box",4,"ngIf"],["type","text","disabled","",1,"form-input","disabled",3,"value"],["type","text",1,"form-input",3,"ngModelChange","ngModel","placeholder"],["class","form-group",4,"ngIf"],["type","email","placeholder","client@mail.ru",1,"form-input",3,"ngModelChange","ngModel"],[1,"radio-group"],[1,"radio-label"],["type","radio","name","clientType","value","individual",1,"radio-input",3,"ngModelChange","ngModel"],[1,"radio-custom"],[1,"radio-text"],["type","radio","name","clientType","value","business",1,"radio-input",3,"ngModelChange","ngModel"],["type","text","placeholder","VIP, \u043F\u043E\u0441\u0442\u043E\u044F\u043D\u043D\u044B\u0439, \u043D\u043E\u0432\u044B\u0439...",1,"form-input",3,"ngModelChange","focus","ngModel"],[1,"input-hint"],["class","tags-dropdown",4,"ngIf"],["placeholder","\u0417\u0430\u043C\u0435\u0442\u043A\u0438 \u043E \u043A\u043B\u0438\u0435\u043D\u0442\u0435...","rows","3",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"bonus-hint-box"],["viewBox","0 0 24 24","fill","none",1,"bonus-icon"],[1,"bonus-text"],[1,"bonus-label"],[1,"bonus-value"],["type","text","placeholder","\u0418\u0432\u0430\u043D\u043E\u0432",1,"form-input",3,"ngModelChange","ngModel"],["type","date",1,"form-input",3,"ngModelChange","ngModel"],[1,"tags-dropdown"],[1,"tags-dropdown-header"],["type","button",1,"tags-dropdown-close",3,"click"],[1,"tags-dropdown-list"],["type","button","class","tag-option",3,"selected","click",4,"ngFor","ngForOf"],["type","button",1,"tag-option",3,"click"],["class","tag-check",4,"ngIf"],[1,"tag-check"],[1,"step-notify"],[1,"send-message-content"],["class","template-section",4,"ngIf"],["class","template-not-found",4,"ngIf"],[1,"phone-section"],[1,"phone-label"],[1,"phone-display"],["viewBox","0 0 24 24","fill","none",1,"phone-icon"],["d","M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z","stroke","currentColor","stroke-width","1.5"],[1,"phone-number"],["class","message-content-section",4,"ngIf"],[1,"notify-actions"],["buttonType","primary","size","large","class","send-message-btn",3,"disabled","click",4,"ngIf"],[1,"template-section"],[1,"template-section-label"],[1,"template-card-display"],[1,"template-card-header"],[1,"template-icon"],["viewBox","0 0 24 24","fill","none"],["d","M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z","stroke","currentColor","stroke-width","1.5"],["d","M14 2v6h6M16 13H8M16 17H8M10 9H8","stroke","currentColor","stroke-width","1.5"],[1,"template-info"],[1,"template-name-display"],[1,"template-type-badge"],[1,"template-content-display"],[1,"template-content-text"],[1,"template-not-found"],["viewBox","0 0 24 24","fill","none",1,"not-found-icon"],[1,"not-found-text"],[1,"not-found-title"],[1,"not-found-subtitle"],[1,"message-content-section"],[1,"message-content-label"],[1,"message-content-box"],[1,"message-text"],["buttonType","primary","size","large",1,"send-message-btn",3,"click","disabled"],["viewBox","0 0 24 24","fill","none",1,"whatsapp-icon"],["d","M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z","fill","currentColor"],["d","M12 2C6.477 2 2 6.477 2 12c0 1.89.525 3.66 1.438 5.168L2 22l4.832-1.438A9.955 9.955 0 0012 22c5.523 0 10-4.477 10-10S17.523 2 12 2z","fill","currentColor"]],template:function(i,n){i&1&&(o(0,"app-modal",0),_("closed",function(){return n.onClose()}),g(1,wt,11,5,"div",1)(2,Lt,50,21,"div",2)(3,Nt,50,15,"div",3)(4,Qt,15,5,"div",4),a(),o(5,"app-dialog",5),_("confirmed",function(){return n.confirmCancel()})("cancelled",function(){return n.showCancelConfirmation=!1}),a()),i&2&&(s("visible",n.visible)("title",n.getModalTitle())("showCloseButton",!0),r(),s("ngIf",n.currentStep==="search"),r(),s("ngIf",n.currentStep==="found"&&n.foundClient),r(),s("ngIf",n.currentStep==="new"),r(),s("ngIf",n.currentStep==="notify"),r(),s("visible",n.showCancelConfirmation)("dismissible",!1))},dependencies:[B,A,I,Oe,we,Pe,ve,ke,Me,Te,Se,ye,q,z,je],styles:['.input-label[_ngcontent-%COMP%]{display:block;font-size:.9rem;font-weight:600;color:#475569;margin-bottom:.5rem}.search-row[_ngcontent-%COMP%]{display:flex;gap:10px}.search-input[_ngcontent-%COMP%]{flex:1;padding:12px 16px;border:1px solid #cbd5e1;border-radius:10px;font-size:1rem;outline:none;transition:.2s}.search-input[_ngcontent-%COMP%]:focus{border-color:#16a34a;box-shadow:0 0 0 3px #dcfce7}.search-btn[_ngcontent-%COMP%]{background:#e2e8f0;border:none;padding:0 16px;border-radius:10px;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center}.search-btn[_ngcontent-%COMP%]:hover{background:#cbd5e1}.search-icon[_ngcontent-%COMP%]{width:20px;height:20px;color:#64748b}.search-hint[_ngcontent-%COMP%]{margin-top:1rem;color:#64748b;font-size:.85rem;display:flex;align-items:center;gap:8px}.hint-icon[_ngcontent-%COMP%]{width:16px;height:16px}.client-card[_ngcontent-%COMP%]{background:#16a34a;color:#fff;padding:16px;border-radius:16px;display:flex;flex-direction:column;gap:12px;margin:1rem 0 2.5rem;animation:_ngcontent-%COMP%_slideDown .3s ease}.client-card.business-client[_ngcontent-%COMP%]{background:#2563eb}.client-card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.client-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;background:#fff3;border:2px solid white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.1rem;flex-shrink:0}.client-info[_ngcontent-%COMP%]{flex:1}.client-name[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.client-bonus-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:4px}.client-bonus[_ngcontent-%COMP%]{background:#facc15;color:#713f12;font-size:.75rem;font-weight:700;padding:4px 10px;border-radius:20px;display:inline-flex;align-items:center;gap:4px;box-shadow:0 2px 4px #0000001a}.client-type-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;background:#fff3;padding:4px 10px;border-radius:20px;font-size:.75rem;font-weight:600;white-space:nowrap}.type-icon[_ngcontent-%COMP%]{width:14px;height:14px;color:#fff}.client-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.client-tag[_ngcontent-%COMP%]{background:#dcfce7e6;color:#15803d;font-size:.75rem;font-weight:600;padding:4px 10px;border-radius:12px}.client-card.business-client[_ngcontent-%COMP%]   .client-tag[_ngcontent-%COMP%]{background:#dbeafee6;color:#1e40af}.client-comment[_ngcontent-%COMP%]{background:#dcfce7e6;color:#15803d;font-size:.8rem;padding:10px 14px;border-radius:10px;cursor:pointer;transition:background .2s;line-height:1.4}.client-comment[_ngcontent-%COMP%]:hover{background:#dcfce7}.client-card.business-client[_ngcontent-%COMP%]   .client-comment[_ngcontent-%COMP%]{background:#dbeafee6;color:#1e40af}.client-card.business-client[_ngcontent-%COMP%]   .client-comment[_ngcontent-%COMP%]:hover{background:#dbeafe}.comment-text[_ngcontent-%COMP%]{display:inline}.comment-more[_ngcontent-%COMP%], .comment-less[_ngcontent-%COMP%]{color:#16a34a;font-weight:600;margin-left:4px}.star-icon[_ngcontent-%COMP%]{width:12px;height:12px}.check-icon[_ngcontent-%COMP%]{width:24px;height:24px;opacity:.5}.alert-box[_ngcontent-%COMP%]{background:#fff7ed;border:1px solid #fdba74;color:#9a3412;padding:12px;border-radius:12px;font-size:.9rem;display:flex;align-items:center;gap:8px;margin-bottom:1.5rem;animation:_ngcontent-%COMP%_slideDown .3s ease}.alert-icon[_ngcontent-%COMP%]{width:20px;height:20px;flex-shrink:0}.bonus-hint-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:1rem;background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #fcd34d;border-radius:12px;margin-bottom:1.5rem;animation:_ngcontent-%COMP%_slideDown .3s ease}.bonus-icon[_ngcontent-%COMP%]{width:32px;height:32px;color:#d97706;flex-shrink:0}.bonus-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.bonus-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:#92400e;text-transform:uppercase;letter-spacing:.5px}.bonus-value[_ngcontent-%COMP%]{font-size:.9rem;color:#78350f}.bonus-value[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#d97706;font-weight:700}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:1px solid #cbd5e1;border-radius:10px;font-size:1rem;outline:none;transition:.2s}.form-input[_ngcontent-%COMP%]:focus{border-color:#16a34a;box-shadow:0 0 0 3px #dcfce7}.form-input.disabled[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.form-input[type=date][_ngcontent-%COMP%]{font-family:inherit;color:#1f2937}.form-input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{cursor:pointer;opacity:.6}.form-input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator:hover{opacity:1}.input-hint[_ngcontent-%COMP%]{font-size:.75rem;color:#94a3b8;margin-top:.25rem}.tags-dropdown[_ngcontent-%COMP%]{margin-top:8px;background:#fff;border:1px solid #e2e8f0;border-radius:12px;box-shadow:0 4px 12px #0000001a;overflow:hidden}.tags-dropdown-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#f8fafc;border-bottom:1px solid #e2e8f0;font-size:.8rem;font-weight:600;color:#64748b}.tags-dropdown-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.25rem;color:#94a3b8;cursor:pointer;padding:0;line-height:1}.tags-dropdown-close[_ngcontent-%COMP%]:hover{color:#64748b}.tags-dropdown-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;padding:12px;max-height:150px;overflow-y:auto}.tag-option[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:20px;font-size:.8rem;font-weight:500;color:#15803d;cursor:pointer;transition:all .15s ease}.tag-option[_ngcontent-%COMP%]:hover{background:#dcfce7;border-color:#86efac}.tag-option.selected[_ngcontent-%COMP%]{background:#16a34a;border-color:#16a34a;color:#fff}.tag-check[_ngcontent-%COMP%]{font-size:.7rem}.form-textarea[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:1px solid #cbd5e1;border-radius:10px;font-size:1rem;font-family:inherit;outline:none;transition:.2s;resize:vertical;min-height:80px}.form-textarea[_ngcontent-%COMP%]:focus{border-color:#16a34a;box-shadow:0 0 0 3px #dcfce7}.radio-group[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.radio-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:.9rem;color:#374151}.radio-input[_ngcontent-%COMP%]{display:none}.radio-custom[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid #cbd5e1;border-radius:50%;position:relative;transition:.2s}.radio-custom[_ngcontent-%COMP%]:after{content:"";position:absolute;width:10px;height:10px;background:#16a34a;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);transition:.2s}.radio-input[_ngcontent-%COMP%]:checked + .radio-custom[_ngcontent-%COMP%]{border-color:#16a34a}.radio-input[_ngcontent-%COMP%]:checked + .radio-custom[_ngcontent-%COMP%]:after{transform:translate(-50%,-50%) scale(1)}.radio-text[_ngcontent-%COMP%]{font-weight:500}.use-bonus-toggle[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#f8fafc;border-radius:12px;margin-bottom:1rem}.toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.toggle-checkbox[_ngcontent-%COMP%]{display:none}.toggle-switch[_ngcontent-%COMP%]{width:44px;height:24px;background:#cbd5e1;border-radius:12px;position:relative;transition:.2s}.toggle-switch[_ngcontent-%COMP%]:after{content:"";position:absolute;width:20px;height:20px;background:#fff;border-radius:50%;top:2px;left:2px;transition:.2s;box-shadow:0 1px 3px #0003}.toggle-checkbox[_ngcontent-%COMP%]:checked + .toggle-switch[_ngcontent-%COMP%]{background:#16a34a}.toggle-checkbox[_ngcontent-%COMP%]:checked + .toggle-switch[_ngcontent-%COMP%]:after{left:22px}.toggle-text[_ngcontent-%COMP%]{font-weight:500;color:#1f2937}.available-bonus[_ngcontent-%COMP%]{font-size:.85rem;color:#16a34a;font-weight:600}.bonus-input-group[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideDown .2s ease}.bonus-hint[_ngcontent-%COMP%]{font-size:.8rem;color:#64748b;margin-top:.5rem}.transaction-summary[_ngcontent-%COMP%]{background:#f8fafc;border-radius:12px;padding:1rem;margin:1.5rem 0}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0}.summary-row[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #e2e8f0}.summary-row.payment-id[_ngcontent-%COMP%]{padding-bottom:.75rem;border-bottom:2px solid #e2e8f0;margin-bottom:.5rem}.summary-label[_ngcontent-%COMP%]{color:#64748b;font-size:.9rem}.summary-value[_ngcontent-%COMP%]{font-weight:600;color:#1f2937}.summary-value.id-value[_ngcontent-%COMP%]{font-family:Courier New,Monaco,Menlo,Consolas,monospace;font-size:.85rem;color:#475569;letter-spacing:.5px;background:#f1f5f9;padding:.375rem .75rem;border-radius:8px;font-weight:700;border:1px solid #e2e8f0}.summary-row.discount[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#dc2626}.summary-row.total[_ngcontent-%COMP%]{padding-top:.75rem}.summary-row.total[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]{font-weight:600;color:#1f2937}.summary-row.total[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{font-size:1.25rem;color:#16a34a}.summary-row.earned[_ngcontent-%COMP%]   .summary-value.bonus[_ngcontent-%COMP%]{color:#16a34a}.bonus-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;background:#fef3c7;border:1px solid #fcd34d;border-radius:8px;padding:.75rem;margin-top:.75rem;font-size:.85rem;color:#92400e}.bonus-warning[_ngcontent-%COMP%]   .warning-icon[_ngcontent-%COMP%]{width:18px;height:18px;flex-shrink:0;stroke:#f59e0b}.submit-btn[_ngcontent-%COMP%]{width:100%;background:#16a34a;color:#fff;padding:14px;border:none;border-radius:12px;font-weight:700;cursor:pointer;font-size:1rem;transition:.2s}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#14532d}.submit-btn[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:#64748b;cursor:pointer;margin-top:12px;font-size:.85rem;width:100%;text-align:center;padding:8px}.back-btn[_ngcontent-%COMP%]:hover{color:#16a34a}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.send-message-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:.5rem 0}.send-message-btn[_ngcontent-%COMP%]{width:100%;display:block}.send-message-btn[_ngcontent-%COMP%]     button{width:100%!important;justify-content:center}.template-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.template-section-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#475569}.template-card-display[_ngcontent-%COMP%]{background:#f8fafc;border:2px solid #e2e8f0;border-radius:12px;padding:1.25rem;transition:all .2s}.template-card-display[_ngcontent-%COMP%]:hover{border-color:#25d366;box-shadow:0 2px 8px #25d3661a}.template-card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}.template-icon[_ngcontent-%COMP%]{width:40px;height:40px;background:linear-gradient(135deg,#dcfce7,#bbf7d0);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.template-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;color:#16a34a}.template-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.template-name-display[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#1f2937;margin:0}.template-type-badge[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;background:#f1f5f9;padding:.25rem .5rem;border-radius:6px;display:inline-block;width:fit-content}.template-content-display[_ngcontent-%COMP%]{padding-top:1rem;border-top:1px solid #e2e8f0}.template-content-text[_ngcontent-%COMP%]{margin:0;font-size:.9375rem;line-height:1.6;color:#1f2937;white-space:pre-wrap;word-wrap:break-word}.template-not-found[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.5rem;background:#fef3c7;border:1px solid #fcd34d;border-radius:12px;margin-bottom:1.5rem}.not-found-icon[_ngcontent-%COMP%]{width:40px;height:40px;color:#d97706;flex-shrink:0}.not-found-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.not-found-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#92400e}.not-found-subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:#b45309}.phone-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.phone-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#475569}.phone-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px}.phone-icon[_ngcontent-%COMP%]{width:20px;height:20px;color:#16a34a;flex-shrink:0}.phone-number[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#1f2937;font-family:Courier New,monospace}.message-content-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.message-content-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#475569}.message-content-box[_ngcontent-%COMP%]{padding:1.25rem;background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;max-height:300px;overflow-y:auto}.message-text[_ngcontent-%COMP%]{margin:0;font-size:.9375rem;line-height:1.6;color:#1f2937;white-space:pre-wrap;word-wrap:break-word}.message-text[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:deep(.variable-tag){color:#169ea3!important;font-style:italic!important;font-weight:500!important;font-family:Courier New,Monaco,Menlo,Consolas,monospace!important;background:#169ea333!important;padding:2px 6px!important;border-radius:4px!important;border:1px solid rgba(22,158,163,.3)!important;display:inline!important}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.875rem;padding:1.25rem 0 0;border-top:2px solid #f1f5f9;margin-top:.5rem}.btn-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.send-icon[_ngcontent-%COMP%]{width:18px;height:18px}.step-notify[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideDown .3s ease}.notify-actions[_ngcontent-%COMP%]{margin-top:1.5rem}.send-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:#25d366}.send-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#128c7e}.whatsapp-icon[_ngcontent-%COMP%]{width:20px;height:20px}.loading-indicator[_ngcontent-%COMP%]{margin-top:1rem;text-align:center;color:#64748b;font-size:.9rem;padding:.75rem;background:#f8fafc;border-radius:8px}']})}return t})();var Jt=["sidebar"],Kt=["*"],Ue=(()=>{class t{sidebar;isSidebarCollapsed=!1;isSidebarClosed=!1;transactionModalService=M(G);welcomeMessageTemplates=[];ngOnInit(){this.loadWelcomeMessageTemplates()}onSidebarCollapsed(e){this.isSidebarCollapsed=e}onSidebarClosed(e){this.isSidebarClosed=e}onTransactionComplete(e){console.log("Transaction completed:",e)}onMessageSent(e){console.log("Message sent:",e);let i=encodeURIComponent(e.message),n=`https://wa.me/${e.phone.replace(/\D/g,"")}?text=${i}`;window.open(n,"_blank")}loadWelcomeMessageTemplates(){try{let e=localStorage.getItem("whatsapp_message_templates");if(e){let i=JSON.parse(e);this.welcomeMessageTemplates=i.map(n=>$(Z({},n),{createdAt:new Date(n.createdAt)}))}else this.welcomeMessageTemplates=[{id:"default",name:"\u041F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u043E\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435",type:"bonus_accrued",content:"\u0414\u043E\u0431\u0440\u043E \u043F\u043E\u0436\u0430\u043B\u043E\u0432\u0430\u0442\u044C, {clientName}! \u0421\u043F\u0430\u0441\u0438\u0431\u043E \u0437\u0430 \u043F\u043E\u043A\u0443\u043F\u043A\u0443. \u0412\u0430\u043C \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E {clientBonus} \u0431\u043E\u043D\u0443\u0441\u043E\u0432.",createdAt:new Date}]}catch(e){console.error("Failed to load templates",e),this.welcomeMessageTemplates=[]}}getHeaderMarginLeft(){return this.isSidebarClosed&&window.innerWidth<769?0:this.isSidebarClosed||this.isSidebarCollapsed?64:240}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["app-main-layout"]],viewQuery:function(i,n){if(i&1&&se(Jt,5),i&2){let u;le(u=ce())&&(n.sidebar=u.first)}},ngContentSelectors:Kt,decls:9,vars:4,consts:[["sidebar",""],[1,"main-layout"],[3,"collapsedChange","closedChange"],[1,"main-content-wrapper"],[1,"main-content"],[3,"visibleChange","transactionComplete","messageSent","visible","welcomeMessageTemplates"]],template:function(i,n){if(i&1){let u=C();V(),o(0,"div",1)(1,"app-sidebar",2,0),_("collapsedChange",function(v){return p(u),m(n.onSidebarCollapsed(v))})("closedChange",function(v){return p(u),m(n.onSidebarClosed(v))}),o(3,"div",3),f(4,"app-page-header"),o(5,"main",4),L(6),a()()()(),o(7,"app-transaction-modal",5),j(8,"async"),_("visibleChange",function(){return p(u),m(n.transactionModalService.close())})("transactionComplete",function(v){return p(u),m(n.onTransactionComplete(v))})("messageSent",function(v){return p(u),m(n.onMessageSent(v))}),a()}if(i&2){let u;r(7),s("visible",(u=N(8,2,n.transactionModalService.visible$))!==null&&u!==void 0?u:!1)("welcomeMessageTemplates",n.welcomeMessageTemplates)}},dependencies:[B,U,ze,He,Ne],styles:[".main-layout[_ngcontent-%COMP%]{min-height:100vh;display:flex;overflow-x:hidden;width:100%}.main-content-wrapper[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-height:100vh;padding:0 2rem;background-color:#f9fafb}app-page-header[_ngcontent-%COMP%]{display:block;background-color:#f9fafb}.main-content[_ngcontent-%COMP%]{flex:1;background-color:#f9fafb}@media (max-width: 768px){.main-content-wrapper[_ngcontent-%COMP%]{padding:0 1rem}}"]})}return t})();var ui=(()=>{class t{router=M(_e);ngOnInit(){this.router.events.pipe(ee(e=>e instanceof ge)).subscribe(()=>{setTimeout(()=>{let e=document.querySelector(".sidebar-content");e&&(e.scrollTop=0),window.scrollTo(0,0),document.documentElement.scrollTop=0,document.body.scrollTop=0},0)})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["app-main-layout-wrapper"]],decls:2,vars:0,template:function(i,n){i&1&&(o(0,"app-main-layout"),f(1,"router-outlet"),a())},dependencies:[fe,Ue],encapsulation:2})}return t})();export{ui as MainLayoutWrapperComponent};
