import{a as fe}from"./chunk-IC7AMJ5L.js";import{a as ve}from"./chunk-IOLITHIO.js";import{a as xe}from"./chunk-MH5U2N3I.js";import{a as he}from"./chunk-CYZPHOBD.js";import{a as _e}from"./chunk-BZO4P2NR.js";import{a as be}from"./chunk-IAU263BM.js";import{a as pe,b as me}from"./chunk-VU2JUFLK.js";import"./chunk-LAQDSUVH.js";import{a as ge}from"./chunk-Q2MMBZZQ.js";import"./chunk-3B24VZJ2.js";import{a as ce}from"./chunk-YDS2CTYG.js";import{a as ue}from"./chunk-G445VSQM.js";import"./chunk-EJCKFZHK.js";import{n as se,r as de}from"./chunk-WKHSVZ5J.js";import{a as le}from"./chunk-5EF6AKPJ.js";import{$ as _,Aa as A,Ca as n,Da as i,Ea as m,Eb as oe,Fa as X,Fb as ae,Ga as q,Ia as U,Ja as E,Jb as re,K as j,Ka as p,L as w,Sa as s,T as k,Ta as S,Ua as C,Va as K,Wa as J,Z as I,_ as T,aa as O,ab as V,d as N,fb as Z,k as M,lb as Q,ma as r,mb as ee,nb as te,oa as Y,ob as ne,pa as W,q as G,sb as ie,u as y,ua as b,xa as z,ya as d,za as B}from"./chunk-IGKWEZVA.js";var Ce=a=>["/clients",a];function Pe(a,u){a&1&&(n(0,"div",6),m(1,"app-loader",7),i()),a&2&&(r(),d("visible",!0)("overlay",!1))}function Me(a,u){if(a&1&&(n(0,"div",54)(1,"div",55)(2,"div",56),_(),n(3,"svg",57),m(4,"path",58),i()(),O(),n(5,"div",59)(6,"span",60),s(7,"\u0411\u043E\u043D\u0443\u0441\u044B \u0438\u0441\u0442\u0435\u043A\u0430\u044E\u0442 \u0432 \u0431\u043B\u0438\u0436\u0430\u0439\u0448\u0438\u0435 7 \u0434\u043D\u0435\u0439"),i(),n(8,"span",61),s(9),i()(),n(10,"a",62),_(),n(11,"svg",57),m(12,"path",63),i()()()()),a&2){let e=p(2);r(9),J("",e.expiringSoon.clientCount," ",e.expiringSoon.clientCount===1?"\u043A\u043B\u0438\u0435\u043D\u0442":e.expiringSoon.clientCount<5?"\u043A\u043B\u0438\u0435\u043D\u0442\u0430":"\u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432"," \xB7 ",e.formatAmount(e.expiringSoon.totalAmount)," \u20B8")}}function we(a,u){a&1&&(_(),n(0,"g"),m(1,"path",73),i())}function ke(a,u){a&1&&(_(),n(0,"g"),m(1,"path",58),i())}function Se(a,u){a&1&&(_(),n(0,"g"),m(1,"path",74)(2,"circle",75)(3,"path",76),i())}function Oe(a,u){a&1&&(_(),n(0,"g"),m(1,"path",77)(2,"rect",78)(3,"path",79),i())}function Ee(a,u){a&1&&(_(),n(0,"g",80),m(1,"path",81),i())}function Re(a,u){a&1&&(_(),n(0,"g"),m(1,"path",73)(2,"circle",82),i())}function Ie(a,u){a&1&&(_(),n(0,"g"),m(1,"rect",83)(2,"path",84),i())}function Te(a,u){a&1&&(_(),n(0,"g"),m(1,"rect",83)(2,"path",84)(3,"path",85),i())}function Ae(a,u){if(a&1&&(n(0,"span",86),s(1),i()),a&2){let e=p().$implicit;A("positive",e.changeType==="positive")("negative",e.changeType==="negative"),r(),C(" ",e.change," ")}}function De(a,u){if(a&1&&(n(0,"div",64)(1,"div",65)(2,"div",66),_(),n(3,"svg",67),b(4,we,2,0,"g",68)(5,ke,2,0,"g",68)(6,Se,4,0,"g",68)(7,Oe,4,0,"g",68)(8,Ee,2,0,"g",69)(9,Re,3,0,"g",68)(10,Ie,3,0,"g",68)(11,Te,4,0,"g",68),i()(),b(12,Ae,2,5,"span",70),i(),O(),n(13,"div",71),s(14),i(),n(15,"div",72),s(16),i()()),a&2){let e=u.$implicit;r(2),B("background",e.iconBg),r(),d("ngSwitch",e.iconId),r(),d("ngSwitchCase","revenue"),r(),d("ngSwitchCase","bonus"),r(),d("ngSwitchCase","clients"),r(),d("ngSwitchCase","transactions"),r(),d("ngSwitchCase","refunds"),r(),d("ngSwitchCase","average"),r(),d("ngSwitchCase","today"),r(),d("ngSwitchCase","month"),r(),d("ngIf",e.change),r(2),S(e.value),r(2),S(e.label)}}function Be(a,u){if(a&1&&(n(0,"div",92)(1,"span",93),s(2,"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E:"),i(),n(3,"span",98),s(4),i()()),a&2){let e=p().$implicit,t=p(2);r(4),C("-",t.formatAmount(e.bonusUsed),"")}}function He(a,u){if(a&1&&(n(0,"div",87),m(1,"div",88),n(2,"div",89)(3,"div",90),s(4),i(),n(5,"div",91)(6,"div",92)(7,"span",93),s(8,"\u0412\u044B\u0440\u0443\u0447\u043A\u0430:"),i(),n(9,"span",94),s(10),i()(),n(11,"div",92)(12,"span",93),s(13,"\u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439:"),i(),n(14,"span",95),s(15),i()(),n(16,"div",92)(17,"span",93),s(18,"\u041D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E:"),i(),n(19,"span",96),s(20),i()(),b(21,Be,5,1,"div",97),i()()()),a&2){let e=u.$implicit,t=u.last,o=p(2);B("left",e.x/600*100,"%")("top",e.y/300*100,"%"),r(),A("last-point",t),r(3),K("",e.day," ",o.getMonthName(),""),r(6),C("",o.formatAmount(e.revenue)," \u20B8"),r(5),S(e.transactions),r(5),C("+",o.formatAmount(e.bonusEarned),""),r(),d("ngIf",e.bonusUsed>0)}}function Fe(a,u){if(a&1&&(n(0,"span"),s(1),i()),a&2){let e=u.$implicit,t=u.index,o=p(2);B("left",o.getXAxisLabelPositions()[t]/600*100,"%"),r(),S(e)}}function Le(a,u){if(a&1&&(n(0,"app-badge",136),s(1),i()),a&2){let e=p().$implicit,t=p(2);r(),C(" +",t.formatAmount(e.bonusEarned)," ")}}function $e(a,u){if(a&1&&(n(0,"app-badge",137),s(1),i()),a&2){let e=p().$implicit,t=p(2);r(),C(" -",t.formatAmount(e.bonusUsed)," ")}}function ze(a,u){if(a&1&&(n(0,"app-badge",138),s(1),i()),a&2){let e=p().$implicit,t=p(2);r(),C(" -",t.formatAmount(e.bonusRevoked)," ")}}function Ue(a,u){a&1&&(n(0,"span",139),s(1,"\u2014"),i())}function Ve(a,u){if(a&1&&(n(0,"div",151),s(1),i()),a&2){let e=p(2).$implicit;r(),C(" ",e.refundReason," ")}}function Ne(a,u){a&1&&(n(0,"div",152),s(1," \u041D\u0435\u0442 \u043F\u0440\u0438\u0447\u0438\u043D\u044B \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430 "),i())}function Ge(a,u){if(a&1&&(n(0,"div",153),s(1),i()),a&2){let e=p(2).$implicit;r(),C(" ",e.initiatedBy," ")}}function je(a,u){a&1&&(n(0,"div",154),s(1," \u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D "),i())}function Ye(a,u){if(a&1&&(n(0,"tr",140)(1,"td",141)(2,"div",142)(3,"div",143)(4,"div",144)(5,"span",145),s(6,"\u041F\u0440\u0438\u0447\u0438\u043D\u0430 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430:"),i(),b(7,Ve,2,1,"div",146)(8,Ne,2,0,"div",147),i(),n(9,"div",148)(10,"span",145),s(11,"\u0418\u043D\u0438\u0446\u0438\u0430\u0442\u043E\u0440 \u043F\u043B\u0430\u0442\u0435\u0436\u0430:"),i(),b(12,Ge,2,1,"div",149)(13,je,2,0,"div",150),i()()()()()),a&2){let e=p().$implicit;r(7),d("ngIf",e.refundReason),r(),d("ngIf",!e.refundReason),r(4),d("ngIf",e.initiatedBy),r(),d("ngIf",!e.initiatedBy)}}function We(a,u){if(a&1){let e=U();X(0),n(1,"tr",99)(2,"td",100)(3,"span",101),E("click",function(){let o=I(e).$implicit,c=p(2);return T(c.openPaymentView(o.id))}),s(4),i()(),n(5,"td",102)(6,"div",103)(7,"div",104),s(8),i(),n(9,"div",105)(10,"a",106)(11,"span",107),s(12),i()(),n(13,"span",108),s(14),i()()()(),n(15,"td",109)(16,"span",110),s(17),i()(),n(18,"td",111)(19,"div",112),b(20,Le,2,1,"app-badge",113)(21,$e,2,1,"app-badge",114)(22,ze,2,1,"app-badge",115)(23,Ue,2,0,"span",116),i()(),n(24,"td",117),m(25,"app-badge",118),i(),n(26,"td",119)(27,"app-badge",120),s(28),i()(),n(29,"td",121)(30,"div",122)(31,"span",123),s(32),i(),n(33,"span",124),s(34),i()()(),n(35,"td",125)(36,"div",126)(37,"a",127)(38,"app-icon-button",128),_(),n(39,"svg",129),m(40,"path",130)(41,"circle",82),i()()(),O(),n(42,"app-icon-button",131),E("onClick",function(){let o=I(e).$implicit,c=p(2);return T(c.openRefundModal(o))}),_(),n(43,"svg",129),m(44,"path",132),i()(),O(),n(45,"app-icon-button",133),E("onClick",function(){let o=I(e).$implicit,c=p(2);return T(c.toggleRowExpansion(o.id))}),_(),n(46,"svg",57),m(47,"path",134),i()()()()(),b(48,Ye,14,4,"tr",135),q()}if(a&2){let e=u.$implicit,t=p(2);r(),A("expanded",t.isRowExpanded(e.id)),r(3),C("#",t.formatPaymentId(e.id),""),r(4),C(" ",t.getInitials(e.clientName)," "),r(2),d("routerLink",V(24,Ce,e.clientId)),r(2),S(e.clientName),r(2),S(e.clientPhone),r(3),C("",t.formatAmount(e.amount)," \u20B8"),r(3),d("ngIf",e.bonusEarned>0),r(),d("ngIf",e.bonusUsed>0),r(),d("ngIf",e.bonusRevoked>0),r(),d("ngIf",e.bonusEarned===0&&e.bonusUsed===0&&e.bonusRevoked===0),r(2),d("paymentMethod",t.getPaymentMethodForBadge(e.paymentMethod)),r(2),d("badgeType",e.isRefund?"refund":"payment")("icon",e.isRefund?"refund":"payment"),r(),C(" ",e.isRefund?"\u0412\u043E\u0437\u0432\u0440\u0430\u0442":"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E"," "),r(4),S(e.date),r(2),S(e.time),r(3),d("routerLink",V(26,Ce,e.clientId)),r(5),d("disabled",e.isRefund),r(3),d("tooltip",t.isRowExpanded(e.id)?"\u0421\u043A\u0440\u044B\u0442\u044C \u0434\u0435\u0442\u0430\u043B\u0438":"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0434\u0435\u0442\u0430\u043B\u0438"),r(),A("rotated",t.isRowExpanded(e.id)),r(2),d("ngIf",t.isRowExpanded(e.id))}}function Xe(a,u){if(a&1){let e=U();n(0,"div")(1,"div",8)(2,"app-button",9),E("onClick",function(){I(e);let o=p();return T(o.openTransactionModal())}),_(),n(3,"svg",10),m(4,"path",11),i(),O(),n(5,"span",12),s(6,"\u041D\u043E\u0432\u0430\u044F \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u044F"),i()()(),b(7,Me,13,3,"div",13),n(8,"div",14),b(9,De,17,14,"div",15),i(),n(10,"div",16)(11,"div",17)(12,"h3",18),s(13,"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u043C\u0435\u0441\u044F\u0446"),i(),n(14,"div",19)(15,"div",20)(16,"span"),s(17,"30 000"),i(),n(18,"span"),s(19,"25 000"),i(),n(20,"span"),s(21,"20 000"),i(),n(22,"span"),s(23,"15 000"),i(),n(24,"span"),s(25,"10 000"),i(),n(26,"span"),s(27,"5 000"),i(),n(28,"span"),s(29,"0"),i()(),n(30,"div",21)(31,"div",22),_(),n(32,"svg",23)(33,"defs")(34,"linearGradient",24),m(35,"stop",25)(36,"stop",26),i()(),n(37,"g",27),m(38,"line",28)(39,"line",29)(40,"line",30)(41,"line",31)(42,"line",32),i(),m(43,"path",33)(44,"path",34),i(),O(),n(45,"div",35),b(46,He,22,12,"div",36),i()(),n(47,"div",37),b(48,Fe,2,3,"span",38),i()()()()(),n(49,"div",39)(50,"div",40)(51,"h3",41),s(52,"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438"),i(),n(53,"a",42),s(54,"\u0421\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u0432\u0441\u0435 \u2192"),i()(),n(55,"div",43)(56,"table",44)(57,"thead")(58,"tr")(59,"th",45),s(60,"ID \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),i(),n(61,"th",46),s(62,"\u041A\u043B\u0438\u0435\u043D\u0442"),i(),n(63,"th",47),s(64,"\u0421\u0443\u043C\u043C\u0430"),i(),n(65,"th",48),s(66,"\u0411\u043E\u043D\u0443\u0441\u044B"),i(),n(67,"th",49),s(68,"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B"),i(),n(69,"th",50),s(70,"\u0421\u0442\u0430\u0442\u0443\u0441"),i(),n(71,"th",51),s(72,"\u0414\u0430\u0442\u0430 \u0438 \u0432\u0440\u0435\u043C\u044F"),i(),n(73,"th",52),s(74,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"),i()()(),n(75,"tbody"),b(76,We,49,28,"ng-container",53),i()()()()()}if(a&2){let e=p();r(7),d("ngIf",e.expiringSoon&&e.expiringSoon.clientCount>0),r(2),d("ngForOf",e.kpiCards),r(34),z("d",e.getAreaPath()),r(),z("d",e.getChartPath()),r(2),d("ngForOf",e.getChartData()),r(2),d("ngForOf",e.getXAxisLabels()),r(28),d("ngForOf",e.recentPayments)}}var _t=(()=>{class a{store;user$;pageHeaderService=k(ge);transactionModalService=k(pe);analyticsService=k(he);bonusesService=k(fe);paymentsService=k(me);toastService=k(ce);cdr=k(Z);showRefundModal=!1;selectedPaymentForRefund=null;showPaymentViewModal=!1;selectedPaymentTxId=null;selectedPaymentSearchResult=null;isProcessingRefund=!1;expandedRows=new Set;isLoading=!0;isChartLoading=!0;isLoadingPayments=!1;kpiCards=[];expiringSoon=null;recentPayments=[];destroy$=new N;router=k(oe);constructor(e){this.store=e,this.user$=this.store.select(de)}ngOnInit(){this.pageHeaderService.setPageHeader("\u0411\u044B\u0441\u0442\u0440\u044B\u0439 \u041E\u0431\u0437\u043E\u0440",[{label:"\u0413\u043B\u0430\u0432\u043D\u0430\u044F"}]),this.loadAnalyticsData(),this.loadChartData(),this.loadRecentPayments(),this.loadExpiringBonuses(),this.transactionModalService.transactionComplete$.pipe(j(this.destroy$)).subscribe(()=>{let e=this.router.url;(e==="/home"||e.startsWith("/home"))&&(this.loadAnalyticsData(),this.loadChartData(),this.loadRecentPayments(),this.loadExpiringBonuses())})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadAnalyticsData(){this.isLoading=!0,G({monthlyRevenue:this.analyticsService.getMonthlyRevenue().pipe(y(e=>(console.error("Error loading monthly revenue:",e),M({revenue:0,changePercent:0}))),w(e=>console.log("Monthly revenue response:",e))),dailyRevenue:this.analyticsService.getDailyRevenue().pipe(y(e=>(console.error("Error loading daily revenue:",e),M({revenue:0,changePercent:0}))),w(e=>console.log("Daily revenue response:",e))),dailyTransactions:this.analyticsService.getDailyTransactions().pipe(y(e=>(console.error("Error loading daily transactions:",e),M({count:0,changeAbsolute:0}))),w(e=>console.log("Daily transactions response:",e))),newClients:this.analyticsService.getNewClients("DAILY").pipe(y(e=>(console.error("Error loading new clients:",e),M({count:0,changeAbsolute:0,type:"NEW",period:"DAILY"}))),w(e=>console.log("New clients response:",e))),averageCheck:this.analyticsService.getAverageCheck("MONTHLY").pipe(y(e=>(console.error("Error loading average check:",e),M({averageCheck:0,changePercent:0}))),w(e=>console.log("Average check response:",e))),bonusesAccrued:this.analyticsService.getBonusesAccrued("MONTHLY").pipe(y(e=>(console.error("Error loading bonuses accrued:",e),M({amount:0,changePercentage:0}))),w(e=>console.log("Bonuses accrued response:",e))),dailyRefunds:this.analyticsService.getDailyRefunds().pipe(y(e=>(console.error("Error loading daily refunds:",e),M({count:0,changeAbsolute:0}))),w(e=>console.log("Daily refunds response:",e))),activeClients:this.analyticsService.getActiveClients().pipe(y(e=>(console.error("Error loading active clients:",e),M({count:0,changeAbsolute:0}))),w(e=>console.log("Active clients response:",e)))}).subscribe({next:e=>{console.log("All analytics data received:",e),console.log("Monthly revenue:",e.monthlyRevenue),console.log("Daily revenue:",e.dailyRevenue),console.log("Average check:",e.averageCheck),console.log("Bonuses accrued:",e.bonusesAccrued),this.updateKpiCards(e),this.isLoading=!1},error:e=>{console.error("Error loading analytics data:",e),this.isLoading=!1}})}loadExpiringBonuses(){this.bonusesService.getBonusesExpiringSoon().pipe(y(e=>(console.error("Error loading expiring bonuses:",e),M({clientCount:0,totalAmount:0,clients:[]})))).subscribe({next:e=>{this.expiringSoon=e.clientCount>0?e:null,this.cdr.markForCheck()}})}loadRecentPayments(){this.isLoadingPayments=!0,this.paymentsService.searchPayments({page:0,size:5,sortBy:"date",sortDirection:"DESC"}).pipe(y(e=>(console.error("Error loading recent payments:",e),M({content:[],totalElements:0,totalPages:0,page:0,size:5})))).subscribe({next:e=>{console.log("Recent payments received:",e),this.recentPayments=e.content.map(t=>this.convertPaymentToRecentPayment(t)),this.isLoadingPayments=!1,this.cdr.detectChanges()},error:e=>{console.error("Error in recent payments subscription:",e),this.isLoadingPayments=!1,this.cdr.detectChanges()}})}convertPaymentToRecentPayment(e){if(!e.createdAt){let x=new Date;return{id:e.txId||"",clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,bonusRevoked:e.bonusRevoked||0,paymentMethod:"card",isRefund:e.status==="REFUNDED"||e.refundedPaymentTxId!==null,date:x.toLocaleDateString("ru-RU"),time:x.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),initiatedBy:e.initiatedBy||null,refundReason:e.refundReason||null}}let t=new Date(e.createdAt);if(isNaN(t.getTime())){let x=new Date;t.setTime(x.getTime())}let o=String(t.getDate()).padStart(2,"0"),c=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear(),h=`${o}.${c}.${l}`,f=String(t.getHours()).padStart(2,"0"),v=String(t.getMinutes()).padStart(2,"0"),P=`${f}:${v}`,g="card";if(e.paymentMethod){let x=e.paymentMethod.toLowerCase();x.includes("cash")||x.includes("\u043D\u0430\u043B\u0438\u0447")?g="cash":x.includes("transfer")||x.includes("\u043F\u0435\u0440\u0435\u0432\u043E\u0434")?g="transfer":g="card"}return{id:e.txId||"",clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,bonusRevoked:e.bonusRevoked||0,paymentMethod:g,isRefund:e.status==="REFUNDED"||e.refundedPaymentTxId!==null,date:h,time:P,initiatedBy:e.initiatedBy||null,refundReason:e.refundReason||null}}loadChartData(){this.isChartLoading=!0;let e=new Date,t=e.getFullYear(),o=e.getMonth()+1;console.log("Loading chart data for:",t,o),this.analyticsService.getMonthlyRevenueChart(t,o).pipe(y(c=>{console.error("Error loading chart data:",c),console.error("Error status:",c.status);let l=t,h=o-1;return h<1&&(h=12,l=t-1),console.log("Trying fallback date:",l,h),this.analyticsService.getMonthlyRevenueChart(l,h).pipe(y(f=>(console.error("Fallback also failed:",f),M({dailyData:[],year:l,month:h}))))})).subscribe({next:c=>{console.log("Chart data received:",c),console.log("Chart data array length:",c.dailyData?.length);let l=c.dailyData||c.data||[];this.updateChartData(l),this.isChartLoading=!1,this.cdr.detectChanges()},error:c=>{console.error("Subscription error:",c),this.isChartLoading=!1,this.cdr.detectChanges()}})}updateKpiCards(e){let t=e.monthlyRevenue?.amount??e.monthlyRevenue?.revenue??0,o=e.monthlyRevenue?.changePercentage??e.monthlyRevenue?.changePercent,c=e.dailyRevenue?.amount??e.dailyRevenue?.revenue??0,l=e.dailyRevenue?.changePercentage??e.dailyRevenue?.changePercent,h=e.averageCheck?.amount??e.averageCheck?.averageCheck??0,f=e.averageCheck?.changePercentage??e.averageCheck?.changePercent,v=e.bonusesAccrued?.amount??e.bonusesAccrued?.count??0,P=e.bonusesAccrued?.changePercentage??e.bonusesAccrued?.changePercent;this.kpiCards=[{iconId:"month",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(t),label:"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u043C\u0435\u0441\u044F\u0446",change:o!=null?`${o>0?"+":""}${o.toFixed(0)}%`:void 0,changeType:o!=null&&o>=0?"positive":"negative"},{iconId:"revenue",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(c),label:"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u0441\u0435\u0433\u043E\u0434\u043D\u044F",change:l!=null?`${l>0?"+":""}${l.toFixed(0)}%`:void 0,changeType:l!=null&&l>=0?"positive":"negative"},{iconId:"transactions",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:(e.dailyTransactions?.count??0).toString(),label:"\u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439 \u0441\u0435\u0433\u043E\u0434\u043D\u044F",change:e.dailyTransactions?.changeAbsolute!=null?`${e.dailyTransactions.changeAbsolute>0?"+":""}${e.dailyTransactions.changeAbsolute}`:void 0,changeType:e.dailyTransactions?.changeAbsolute!=null&&e.dailyTransactions.changeAbsolute>=0?"positive":"negative"},{iconId:"clients",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:(e.newClients?.count??0).toString(),label:"\u041D\u043E\u0432\u044B\u0445 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432",change:e.newClients?.changeAbsolute!=null?`${e.newClients.changeAbsolute>0?"+":""}${e.newClients.changeAbsolute}`:void 0,changeType:e.newClients?.changeAbsolute!=null&&e.newClients.changeAbsolute>=0?"positive":"negative"},{iconId:"revenue",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(h),label:"\u0421\u0440\u0435\u0434\u043D\u0438\u0439 \u0447\u0435\u043A",change:f!=null?`${f>0?"+":""}${f.toFixed(0)}%`:void 0,changeType:f!=null&&f>=0?"positive":"negative"},{iconId:"bonus",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(v),label:"\u0411\u043E\u043D\u0443\u0441\u043E\u0432 \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E",change:P!=null?`${P>0?"+":""}${P.toFixed(0)}%`:void 0,changeType:P!=null&&P>=0?"positive":"negative"},{iconId:"refunds",iconBg:"linear-gradient(135deg, #fef2f2, #fee2e2)",value:(e.dailyRefunds?.count??0).toString(),label:"\u0412\u043E\u0437\u0432\u0440\u0430\u0442\u043E\u0432",change:e.dailyRefunds?.changeAbsolute!=null?`${e.dailyRefunds.changeAbsolute>0?"+":""}${e.dailyRefunds.changeAbsolute}`:void 0,changeType:e.dailyRefunds?.changeAbsolute!=null&&e.dailyRefunds.changeAbsolute>=0?"positive":"negative"},{iconId:"today",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:(e.activeClients?.count??0).toString(),label:"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432",change:e.activeClients?.changeAbsolute!=null?`${e.activeClients.changeAbsolute>0?"+":""}${e.activeClients.changeAbsolute}`:void 0,changeType:e.activeClients?.changeAbsolute!=null&&e.activeClients.changeAbsolute>=0?"positive":"negative"}]}updateChartData(e){if(console.log("Updating chart data with:",e),!e||e.length===0){console.log("Chart data is empty, clearing cache"),this._chartDataCache=null;return}let t=this.getDaysInCurrentMonth(),o=600,c=300,l=50,h=o-l*2,f=c-l*2,v=Math.max(...e.map(g=>g.revenue||g.amount||0),1);console.log("Max revenue for scaling:",v);let P=e.map(g=>{let x=g.day||g.dayNumber||1,H=t>1?(x-1)/(t-1):0,R=l+H*h,D=g.revenue||g.amount||0,F=c-l-D/v*f,L=g.transactionCount??g.transactions??0,$=g.bonusesGranted??g.bonusEarned??g.bonusesAccrued??0,ye=g.bonusesUsed??g.bonusUsed??0;return{x:R,y:F,day:x,revenue:D,transactions:L,bonusEarned:$,bonusUsed:ye}});console.log("Updated chart cache with",P.length,"points"),this._chartDataCache=P}formatCurrency(e,t=!0){if(e==null||isNaN(e))return t?"0 \u20B8":"0";let o=e.toLocaleString("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0});return t?`${o} \u20B8`:o}getInitials(e){if(!e||e.trim()==="")return"\u2014";let t=e.trim().split(" ").filter(o=>o.length>0);return t.length===0?"\u2014":t.map(o=>o[0]).join("").toUpperCase().slice(0,2)}formatAmount(e){return e.toLocaleString("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0})}formatPaymentId(e){if(!e)return"\u2014";if(e.includes("-"))return e;let t=parseInt(e,10);return isNaN(t)?e:`PAY-${String(t).padStart(3,"0")}`}getPaymentMethodForBadge(e){if(!e)return null;let t=e.toUpperCase();return t==="CASH"||t==="CARD"||t==="TRANSFER"?t:null}getPaymentMethodLabel(e){return{cash:"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u0435",card:"\u041A\u0430\u0440\u0442\u0430",transfer:"\u041F\u0435\u0440\u0435\u0432\u043E\u0434"}[e]||e}openTransactionModal(){this.transactionModalService.open()}openRefundModal(e){if(e.isRefund)return;this.isProcessingRefund=!1;let t={id:e.id,clientId:e.clientId,clientName:e.clientName,clientPhone:e.clientPhone,amount:e.amount,bonusEarned:e.bonusEarned,bonusUsed:e.bonusUsed,bonusRevoked:e.bonusRevoked,paymentMethod:e.paymentMethod,isRefund:e.isRefund,date:e.date,time:e.time};this.selectedPaymentForRefund=t,this.showRefundModal=!0}closeRefundModal(){this.isProcessingRefund||(this.showRefundModal=!1,this.selectedPaymentForRefund=null,this.isProcessingRefund=!1)}onRefundModalVisibleChange(e){!e&&!this.isProcessingRefund&&this.closeRefundModal()}confirmRefund(e){!e||this.isProcessingRefund||(this.isProcessingRefund=!0,this.paymentsService.refundPayment(e.id,{notes:e.refundReason||""}).subscribe({next:()=>{this.toastService.success("\u0412\u043E\u0437\u0432\u0440\u0430\u0442 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D"),this.loadRecentPayments(),this.isProcessingRefund=!1,this.showRefundModal=!1,this.selectedPaymentForRefund=null},error:t=>{console.error("Error processing refund:",t);let o=t?.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0438 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430";this.toastService.error(o)}}))}toggleRowExpansion(e){this.expandedRows.has(e)?this.expandedRows.delete(e):this.expandedRows.add(e)}isRowExpanded(e){return this.expandedRows.has(e)}getDaysInCurrentMonth(){let e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}getChartDataPoints(){if(this._chartDataCache&&this._chartDataCache.length>0)return this._chartDataCache;let e=this.getDaysInCurrentMonth(),t=600,o=300,c=50,l=t-c*2,h=o-c*2,f=[];if(e===0)return f;for(let v=1;v<=e;v++){let P=e>1?(v-1)/(e-1):0,g=c+P*l,x=5e3+v/e*2e4,H=Math.sin(v*.2)*2e3,R=Math.round(x+H),D=Math.floor(5+Math.random()*20+v/e*10),F=Math.round(R*.01*(.8+Math.random()*.4)),L=Math.round(R*.005*Math.random()),$=o-c-R/3e4*h;f.push({x:g,y:$,day:v,revenue:R,transactions:D,bonusEarned:F,bonusUsed:L})}return f}_chartDataCache=null;getChartData(){return this._chartDataCache&&this._chartDataCache.length>0?this._chartDataCache:this.isChartLoading?[]:this.getChartDataPoints()}getMonthName(){return["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][new Date().getMonth()]}getTransactionsText(e){let t=e%10,o=e%100;return o>=11&&o<=19?"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439":t===1?"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u044F":t>=2&&t<=4?"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0438":"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439"}getChartPath(){let e=this.getChartData();if(e.length===0)return"";let t=`M${e[0].x},${e[0].y}`;for(let o=1;o<e.length;o++)t+=` L${e[o].x},${e[o].y}`;return t}getAreaPath(){let e=this.getChartData();if(e.length===0)return"";let t=300,o=50,c=`M${e[0].x},${t-o}`;c+=` L${e[0].x},${e[0].y}`;for(let l=1;l<e.length;l++)c+=` L${e[l].x},${e[l].y}`;return c+=` L${e[e.length-1].x},${t-o} Z`,c}getXAxisLabels(){let e=this.getDaysInCurrentMonth(),t=[],o=[1,Math.ceil(e*.25),Math.ceil(e*.5),Math.ceil(e*.75),e];return[...new Set(o)].sort((l,h)=>l-h).map(l=>l.toString())}getXAxisLabelPositions(){let e=this.getDaysInCurrentMonth(),t=600,o=50,c=t-o*2;return this.getXAxisLabels().map(h=>{let f=parseInt(h,10),v=e>1?(f-1)/(e-1):0;return o+v*c})}openPaymentView(e){let t=this.recentPayments.find(o=>o.id===e);t&&(this.selectedPaymentSearchResult={txId:t.id,clientId:t.clientId,clientName:t.clientName,clientPhone:t.clientPhone,clientEmail:null,amount:t.amount,status:t.isRefund?"REFUNDED":"COMPLETED",paymentMethod:t.paymentMethod?.toUpperCase(),initiatedBy:t.initiatedBy||null,createdAt:t.date+"T"+t.time,refundedPaymentTxId:null,bonusGranted:t.bonusEarned,bonusUsed:t.bonusUsed,bonusRevoked:t.bonusRevoked,refundReason:t.refundReason||null}),this.selectedPaymentTxId=e,this.showPaymentViewModal=!0}closePaymentView(){this.showPaymentViewModal=!1,this.selectedPaymentTxId=null,this.selectedPaymentSearchResult=null}onPaymentUpdated(){this.loadRecentPayments()}static \u0275fac=function(t){return new(t||a)(Y(se))};static \u0275cmp=W({type:a,selectors:[["app-home-page"]],decls:6,vars:8,consts:[[1,"page-wrapper"],[1,"dashboard"],["class","page-loading-container",4,"ngIf"],[4,"ngIf"],[3,"visibleChange","confirm","visible","payment","isProcessing"],[3,"visibleChange","paymentUpdated","refundedPaymentClick","visible","paymentTxId","paymentSearchResult"],[1,"page-loading-container"],["type","logo","size","large",3,"visible","overlay"],[1,"dashboard-header"],["buttonType","primary","size","medium",3,"onClick"],["viewBox","0 0 24 24","fill","none",1,"create-icon"],["d","M6 12H18M12 6V18","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],[1,"create-label"],["class","expiring-bonuses-card",4,"ngIf"],[1,"kpi-grid"],["class","kpi-card",4,"ngFor","ngForOf"],[1,"charts-section"],[1,"chart-card","line-chart-card"],[1,"chart-title"],[1,"chart-container"],[1,"chart-y-axis"],[1,"chart-area"],[1,"chart-svg-wrapper"],["viewBox","0 0 600 300","preserveAspectRatio","none",1,"line-chart"],["id","chartGradient","x1","0%","y1","0%","x2","0%","y2","100%"],["offset","0%",2,"stop-color","#22c55e","stop-opacity","0.3"],["offset","100%",2,"stop-color","#22c55e","stop-opacity","0.02"],["stroke","#e2e8f0","stroke-width","1","opacity","0.5"],["x1","50","y1","50","x2","550","y2","50","vector-effect","non-scaling-stroke"],["x1","50","y1","100","x2","550","y2","100","vector-effect","non-scaling-stroke"],["x1","50","y1","150","x2","550","y2","150","vector-effect","non-scaling-stroke"],["x1","50","y1","200","x2","550","y2","200","vector-effect","non-scaling-stroke"],["x1","50","y1","250","x2","550","y2","250","vector-effect","non-scaling-stroke"],["fill","url(#chartGradient)"],["fill","none","stroke","#22c55e","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round","vector-effect","non-scaling-stroke"],[1,"chart-points"],["class","chart-point-wrapper",3,"left","top",4,"ngFor","ngForOf"],[1,"chart-x-axis"],[3,"left",4,"ngFor","ngForOf"],[1,"table-section"],[1,"table-header"],[1,"table-title"],["routerLink","/payments",1,"view-all-link"],[1,"table-container"],[1,"payments-table"],[1,"th-id"],[1,"th-client"],[1,"th-amount"],[1,"th-bonuses"],[1,"th-method"],[1,"th-status"],[1,"th-date"],[1,"th-actions"],[4,"ngFor","ngForOf"],[1,"expiring-bonuses-card"],[1,"expiring-bonuses-content"],[1,"expiring-bonuses-icon"],["viewBox","0 0 24 24","fill","none"],["d","M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z","stroke","currentColor","stroke-width","1.5"],[1,"expiring-bonuses-stats"],[1,"expiring-bonuses-label"],[1,"expiring-bonuses-value"],["routerLink","/bonus-expiring","title","\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u0441\u043F\u0438\u0441\u043A\u0443",1,"expiring-bonuses-link"],["d","M9 18l6-6-6-6","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"kpi-card"],[1,"kpi-header"],[1,"kpi-icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none",3,"ngSwitch"],[4,"ngSwitchCase"],["class","refunds-icon",4,"ngSwitchCase"],["class","kpi-change",3,"positive","negative",4,"ngIf"],[1,"kpi-value"],[1,"kpi-label"],["d","M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6","stroke","currentColor","stroke-width","1.5"],["d","M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2","stroke","currentColor","stroke-width","1.5"],["cx","9","cy","7","r","4","stroke","currentColor","stroke-width","1.5"],["d","M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75","stroke","currentColor","stroke-width","1.5"],["d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2","stroke","currentColor","stroke-width","1.5"],["x","9","y","3","width","6","height","4","rx","1","stroke","currentColor","stroke-width","1.5"],["d","M9 12h6M9 16h6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"],[1,"refunds-icon"],["_ngcontent-ng-c4142443301","","d","M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","3","stroke","currentColor","stroke-width","1.5"],["x","3","y","4","width","18","height","18","rx","2","stroke","currentColor","stroke-width","1.5"],["d","M16 2v4M8 2v4M3 10h18","stroke","currentColor","stroke-width","1.5"],["d","M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"kpi-change"],[1,"chart-point-wrapper"],[1,"chart-point"],[1,"chart-tooltip"],[1,"tooltip-day"],[1,"tooltip-stats"],[1,"tooltip-row"],[1,"tooltip-label"],[1,"tooltip-revenue"],[1,"tooltip-value"],[1,"tooltip-bonus-earned"],["class","tooltip-row",4,"ngIf"],[1,"tooltip-bonus-used"],[1,"payment-row"],[1,"td-id"],[1,"payment-id","clickable",3,"click"],[1,"td-client"],[1,"client-cell"],[1,"client-avatar"],[1,"client-info"],[1,"client-name-link",3,"routerLink"],[1,"client-name"],[1,"client-phone"],[1,"td-amount"],[1,"amount-value"],[1,"td-bonuses"],[1,"bonus-info"],["badgeType","bonusGranted","size","medium","icon","star","class","bonus-badge",4,"ngIf"],["badgeType","bonusUsed","size","medium","icon","check","class","bonus-badge",4,"ngIf"],["badgeType","refund","size","medium","icon","refund","class","bonus-badge",4,"ngIf"],["class","bonus-none",4,"ngIf"],[1,"td-method"],["badgeType","paymentMethod","size","medium",3,"paymentMethod"],[1,"td-status"],["size","medium",3,"badgeType","icon"],[1,"td-date"],[1,"date-info"],[1,"date-text"],[1,"time-text"],[1,"td-actions"],[1,"actions-cell"],[1,"action-link",3,"routerLink"],["iconButtonType","view","size","small","tooltip","\u041F\u0440\u043E\u0441\u043C\u043E\u0442\u0440 \u043A\u043B\u0438\u0435\u043D\u0442\u0430"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z","stroke","currentColor","stroke-width","1.5"],["iconButtonType","refund","size","small","tooltip","\u0412\u043E\u0437\u0432\u0440\u0430\u0442",3,"onClick","disabled"],["d","M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["iconButtonType","ghost","size","small",3,"onClick","tooltip"],["d","M6 9l6 6 6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["class","payment-details-row",4,"ngIf"],["badgeType","bonusGranted","size","medium","icon","star",1,"bonus-badge"],["badgeType","bonusUsed","size","medium","icon","check",1,"bonus-badge"],["badgeType","refund","size","medium","icon","refund",1,"bonus-badge"],[1,"bonus-none"],[1,"payment-details-row"],["colspan","9",1,"payment-details-cell"],[1,"payment-details-content"],[1,"refund-details-grid"],[1,"refund-reason-section"],[1,"refund-label"],["class","refund-reason-text",4,"ngIf"],["class","refund-reason-empty",4,"ngIf"],[1,"refund-by-section"],["class","refund-by-text",4,"ngIf"],["class","refund-by-empty",4,"ngIf"],[1,"refund-reason-text"],[1,"refund-reason-empty"],[1,"refund-by-text"],[1,"refund-by-empty"]],template:function(t,o){t&1&&(n(0,"div",0)(1,"div",1),b(2,Pe,2,2,"div",2)(3,Xe,77,7,"div",3),i(),n(4,"app-refund-confirmation-modal",4),E("visibleChange",function(l){return o.onRefundModalVisibleChange(l)})("confirm",function(l){return o.confirmRefund(l)}),i(),n(5,"app-payment-view-modal",5),E("visibleChange",function(){return o.closePaymentView()})("paymentUpdated",function(){return o.onPaymentUpdated()})("refundedPaymentClick",function(l){return o.openPaymentView(l)}),i()()),t&2&&(r(2),d("ngIf",o.isLoading||o.isChartLoading||o.isLoadingPayments),r(),d("ngIf",!o.isLoading&&!o.isChartLoading&&!o.isLoadingPayments),r(),d("visible",o.showRefundModal)("payment",o.selectedPaymentForRefund)("isProcessing",o.isProcessingRefund),r(),d("visible",o.showPaymentViewModal)("paymentTxId",o.selectedPaymentTxId)("paymentSearchResult",o.selectedPaymentSearchResult))},dependencies:[ie,Q,ee,te,ne,re,ae,_e,ue,ve,le,xe,be],styles:['[_nghost-%COMP%]{display:block;height:100%}.page-wrapper[_ngcontent-%COMP%]{min-height:100%;margin:-2rem;padding:2rem;background:linear-gradient(180deg,#f0fdf4,#f8fafc 50% 100%)}.dashboard[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;position:relative;min-height:400px}.page-loading-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:60vh;width:100%}.dashboard-header[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:flex-start;margin-bottom:2rem}.dashboard-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#0f172a;margin:0 0 .25rem}.refunds-icon[_ngcontent-%COMP%]{color:#dc2626}.dashboard-subtitle[_ngcontent-%COMP%]{font-size:.9375rem;color:#64748b;margin:0}.new-transaction-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:#16a34a;color:#fff;border:none;border-radius:12px;font-size:.9375rem;font-weight:600;cursor:pointer;transition:all .2s ease}.new-transaction-btn[_ngcontent-%COMP%]:hover{background:#15803d}.new-transaction-btn[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:18px;height:18px}.expiring-bonuses-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #fcd34d;border-radius:16px;padding:1rem 1.25rem;margin-bottom:1.5rem}.expiring-bonuses-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.expiring-bonuses-icon[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;background:#d9770626;display:flex;align-items:center;justify-content:center;flex-shrink:0}.expiring-bonuses-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px;color:#d97706}.expiring-bonuses-stats[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.expiring-bonuses-label[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:600;color:#92400e}.expiring-bonuses-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#78350f}.expiring-bonuses-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:10px;background:#d9770633;color:#b45309;transition:background .2s,color .2s}.expiring-bonuses-link[_ngcontent-%COMP%]:hover{background:#d977064d;color:#92400e}.expiring-bonuses-link[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.kpi-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1.5rem;margin-bottom:2rem}@media (max-width: 1400px){.kpi-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (max-width: 1000px){.kpi-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 600px){.kpi-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.kpi-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;border:1px solid rgba(0,0,0,.06);box-shadow:0 1px 3px #00000008,0 3px 6px #00000008}.kpi-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem}.kpi-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.25rem}.kpi-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px;color:#16a34a;display:block}.kpi-change[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:600;padding:.25rem .625rem;border-radius:20px;background:#f0fdf4;color:#16a34a}.kpi-change.positive[_ngcontent-%COMP%]{background:#f0fdf4;color:#16a34a}.kpi-change.negative[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626}.kpi-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#0f172a;margin-bottom:.25rem}.kpi-label[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b}.charts-section[_ngcontent-%COMP%]{display:grid;// grid-template-columns: 2fr 1fr;// gap: 1.5rem;margin-bottom:2rem}@media (max-width: 1024px){.charts-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.chart-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 1px 3px #0000000d}.chart-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#0f172a;margin:0 0 1.5rem}.line-chart-card[_ngcontent-%COMP%]{min-height:350px;overflow:visible}.chart-container[_ngcontent-%COMP%]{display:flex;height:320px;overflow:visible}.chart-y-axis[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;padding-right:1rem;font-size:.75rem;color:#94a3b8}.chart-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-height:0;overflow:visible}.chart-svg-wrapper[_ngcontent-%COMP%]{flex:1;position:relative;min-height:280px;overflow:visible}.line-chart[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.chart-points[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:visible}.chart-point-wrapper[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%,-50%);cursor:pointer;z-index:1;pointer-events:auto;padding:8px}.chart-point-wrapper[_ngcontent-%COMP%]:hover{z-index:10}.chart-point[_ngcontent-%COMP%]{width:10px;height:10px;background:#22c55e;border-radius:50%;transition:transform .15s ease,box-shadow .15s ease}.chart-point-wrapper[_ngcontent-%COMP%]:hover   .chart-point[_ngcontent-%COMP%]{transform:scale(1.3);box-shadow:0 0 0 4px #22c55e33}.chart-point.last-point[_ngcontent-%COMP%]{width:12px;height:12px;background:#fff;border:2.5px solid #22c55e;box-sizing:border-box}.chart-tooltip[_ngcontent-%COMP%]{position:absolute;bottom:calc(100% + 10px);left:50%;transform:translate(-50%) translateY(6px) scale(.97);background:#1f2937;color:#fff;padding:.625rem .875rem;border-radius:8px;font-size:.8125rem;white-space:nowrap;opacity:0;visibility:hidden;transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:0 4px 12px #00000026;pointer-events:none}.chart-tooltip[_ngcontent-%COMP%]:after{content:"";position:absolute;top:100%;left:50%;transform:translate(-50%);border:6px solid transparent;border-top-color:#1f2937;transition:opacity .3s ease}.chart-point-wrapper[_ngcontent-%COMP%]:hover   .chart-tooltip[_ngcontent-%COMP%]{opacity:1;visibility:visible;transform:translate(-50%) translateY(0) scale(1)}.tooltip-day[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;padding-bottom:.375rem;border-bottom:1px solid #374151;color:#f3f4f6}.tooltip-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.tooltip-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.tooltip-label[_ngcontent-%COMP%]{color:#9ca3af;font-size:.75rem}.tooltip-value[_ngcontent-%COMP%]{color:#f3f4f6;font-weight:500}.tooltip-revenue[_ngcontent-%COMP%]{color:#22c55e;font-weight:600}.tooltip-bonus-earned[_ngcontent-%COMP%]{color:#fbbf24;font-weight:600}.tooltip-bonus-used[_ngcontent-%COMP%]{color:#f472b6;font-weight:600}.chart-x-axis[_ngcontent-%COMP%]{position:relative;height:20px;padding-top:.5rem;font-size:.75rem;color:#94a3b8}.chart-x-axis[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%)}.donut-chart-card[_ngcontent-%COMP%]{display:flex;flex-direction:column}.donut-container[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;padding:1rem}.donut-chart[_ngcontent-%COMP%]{width:180px;height:180px}.donut-legend[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:2rem;padding-top:1rem}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;color:#64748b}.legend-color[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:3px}.legend-color.active[_ngcontent-%COMP%]{background:#16a34a}.legend-color.forecast[_ngcontent-%COMP%]{background:#dcfce7}.table-section[_ngcontent-%COMP%]{margin-bottom:2rem}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.table-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#0f172a;margin:0}.view-all-link[_ngcontent-%COMP%]{font-size:.875rem;color:#16a34a;text-decoration:none;font-weight:500;transition:color .2s ease}.view-all-link[_ngcontent-%COMP%]:hover{color:#15803d}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 1px 3px #00000014;border:1px solid #e5e7eb;overflow:hidden}.payments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.payments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-size:.75rem;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.5px;background:#f8fafc;border-bottom:1px solid #e5e7eb}.payments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #f1f5f9}.payment-row[_ngcontent-%COMP%]{transition:background .15s}.payment-row[_ngcontent-%COMP%]:hover{background:#f8fafc}.payment-row[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.td-id[_ngcontent-%COMP%]{min-width:100px}.payment-id[_ngcontent-%COMP%]{font-family:monospace;font-weight:600;color:#64748b;font-size:.875rem}.payment-id.clickable[_ngcontent-%COMP%]{color:#64748b;cursor:pointer;text-decoration:underline;transition:color .2s}.payment-id.clickable[_ngcontent-%COMP%]:hover{color:#475569}.client-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.client-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);color:#16a34a;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600;flex-shrink:0}.client-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.15rem}.client-name-link[_ngcontent-%COMP%]{text-decoration:none;color:inherit;transition:color .15s}.client-name-link[_ngcontent-%COMP%]:hover{color:#16a34a}.client-name[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#1f2937;cursor:pointer}.client-name-link[_ngcontent-%COMP%]:hover   .client-name[_ngcontent-%COMP%]{color:#16a34a}.client-phone[_ngcontent-%COMP%]{font-size:.8rem;color:#64748b}.amount-value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;color:#16a34a}.bonus-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.bonus-badge[_ngcontent-%COMP%]{display:inline-block}.bonus-none[_ngcontent-%COMP%]{font-size:.8rem;color:#94a3b8}.date-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.15rem}.date-text[_ngcontent-%COMP%]{font-size:.85rem;color:#1f2937;font-weight:500}.time-text[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b}.actions-cell[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.action-link[_ngcontent-%COMP%]{display:inline-flex;text-decoration:none;color:inherit}.payments-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.payment-details-row[_ngcontent-%COMP%]{background:transparent}.payments-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.payment-details-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:none;padding:0}.payment-details-cell[_ngcontent-%COMP%]{padding:0!important;background:transparent}.payment-details-content[_ngcontent-%COMP%]{padding:1rem 1.5rem;overflow:hidden;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;max-height:0}to{opacity:1;max-height:300px}}.refund-details-grid[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:2rem}.refund-reason-section[_ngcontent-%COMP%]{flex:1;text-align:left}.refund-by-section[_ngcontent-%COMP%]{flex:0 0 auto;text-align:right;min-width:200px}.refund-reason-section[_ngcontent-%COMP%], .refund-by-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.refund-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#475569}.refund-reason-text[_ngcontent-%COMP%]{padding:.75rem;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#1f2937;line-height:1.6;white-space:pre-wrap;text-align:left}.refund-by-text[_ngcontent-%COMP%]{padding:.75rem 0;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#1f2937;line-height:1.6;white-space:pre-wrap;text-align:right}.refund-reason-empty[_ngcontent-%COMP%]{padding:.75rem;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#94a3b8;font-style:italic;text-align:left}.refund-by-empty[_ngcontent-%COMP%]{padding:.75rem 0;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#94a3b8;font-style:italic;text-align:right}.actions-cell[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transition:transform .3s ease}.actions-cell[_ngcontent-%COMP%]   svg.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]     app-button svg, app-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px;flex-shrink:0;display:block}[_nghost-%COMP%]     app-button.size-small svg, app-button.size-small[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.btn-icon[_ngcontent-%COMP%]{width:18px;height:18px;flex-shrink:0;display:block}[_nghost-%COMP%]     .dashboard-header app-button button{height:44px;padding:0 1rem}[_nghost-%COMP%]     .dashboard-header app-button button svg.create-icon{width:32px;height:32px;flex-shrink:0}[_nghost-%COMP%]     app-button button .create-label{display:inline-flex;align-items:center;line-height:1.5}@media (max-width: 768px){.page-wrapper[_ngcontent-%COMP%]{margin:-1rem;padding:1rem}.dashboard-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.new-transaction-btn[_ngcontent-%COMP%]{width:100%;justify-content:center}.clients-table[_ngcontent-%COMP%]{display:block;overflow-x:auto}}']})}return a})();export{_t as HomePageComponent};
