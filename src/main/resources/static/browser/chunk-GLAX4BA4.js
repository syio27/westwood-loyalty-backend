import{a as Ue}from"./chunk-TPQAXWM3.js";import{a as Ne}from"./chunk-UTZWVQ3H.js";import"./chunk-4ZMSAZVT.js";import{a as Ae}from"./chunk-LMU3Y3VK.js";import{a as De}from"./chunk-MVEYV5FG.js";import{a as Y}from"./chunk-IC7AMJ5L.js";import{a as Re}from"./chunk-IOLITHIO.js";import{a as Le}from"./chunk-MH5U2N3I.js";import{a as ze}from"./chunk-CYZPHOBD.js";import{a as Fe}from"./chunk-BZO4P2NR.js";import{a as je}from"./chunk-IAU263BM.js";import{a as Te,b as Ve}from"./chunk-VU2JUFLK.js";import{a as Be}from"./chunk-LAQDSUVH.js";import{a as Ie}from"./chunk-Q2MMBZZQ.js";import"./chunk-3B24VZJ2.js";import{a as Q}from"./chunk-YDS2CTYG.js";import{a as Se}from"./chunk-G445VSQM.js";import{c as U,e as H,g as W,i as Pe,m as ye,n as we,o as Me,p as Oe,q as Ee,s as ke,u as G}from"./chunk-EJCKFZHK.js";import{a as ve}from"./chunk-5EF6AKPJ.js";import{$ as x,$a as pe,Aa as O,Ba as de,Bb as _e,Ca as n,Da as a,Ea as _,Eb as be,Fa as q,Fb as he,Ga as K,Gb as xe,Ia as C,Ja as g,Jb as Ce,K as le,Ka as u,La as ue,Ma as ce,Na as z,Oa as F,Pa as R,Qa as L,Ra as ee,Sa as s,T,Ta as y,Ua as v,Va as te,Xa as E,Ya as k,Z as p,Za as S,_ as m,aa as P,ab as me,bb as ne,cb as ie,d as re,ea as B,fb as ge,la as J,lb as j,ma as r,mb as N,oa as Z,pa as D,q as se,sb as A,ua as b,xa as $,ya as d,yb as fe}from"./chunk-IGKWEZVA.js";var We=(()=>{class o{bonusesService;toast;visible=!1;clientId=null;bonusBalance=0;visibleChange=new B;bonusAdjusted=new B;isAdd=!0;amount=null;reason="";isSubmitting=!1;constructor(e,i){this.bonusesService=e,this.toast=i}formatAmount(e){return new Intl.NumberFormat("ru-RU").format(e)}isValid(){let e=this.amount??0;return!(e<=0||!this.isAdd&&e>this.bonusBalance||!this.reason?.trim())}onClose(){this.isSubmitting||(this.reset(),this.visibleChange.emit(!1))}reset(){this.isAdd=!0,this.amount=null,this.reason=""}onSubmit(){if(!this.clientId||!this.isValid()||this.isSubmitting)return;let e=Math.round(Number(this.amount));this.isSubmitting=!0;let i={amount:e,reason:this.reason.trim()};(this.isAdd?this.bonusesService.grantBonus(this.clientId,i):this.bonusesService.revokeBonus(this.clientId,i)).subscribe({next:()=>{this.toast.success(this.isAdd?"\u0411\u043E\u043D\u0443\u0441\u044B \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u044B":"\u0411\u043E\u043D\u0443\u0441\u044B \u0441\u043F\u0438\u0441\u0430\u043D\u044B"),this.reset(),this.visibleChange.emit(!1),this.bonusAdjusted.emit(),this.isSubmitting=!1},error:l=>{this.isSubmitting=!1;let f=l?.error?.message||(this.isAdd?"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043D\u0430\u0447\u0438\u0441\u043B\u0438\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u044B":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043F\u0438\u0441\u0430\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u044B");this.toast.error(f)}})}static \u0275fac=function(i){return new(i||o)(Z(Y),Z(Q))};static \u0275cmp=D({type:o,selectors:[["app-adjust-bonus-modal"]],inputs:{visible:"visible",clientId:"clientId",bonusBalance:"bonusBalance"},outputs:{visibleChange:"visibleChange",bonusAdjusted:"bonusAdjusted"},decls:29,vars:15,consts:[[3,"visibleChange","visible","title","showCloseButton","showFooter"],[1,"adjust-bonus-content"],[1,"adjust-bonus-subtitle"],[1,"toggle-pill"],["type","button",1,"toggle-seg","toggle-add",3,"click"],["viewBox","0 0 24 24","fill","none"],["d","M12 5v14M5 12h14","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["type","button",1,"toggle-seg","toggle-deduct",3,"click"],["d","M5 12h14","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"form-group"],[1,"amount-row"],["type","number","placeholder","0",1,"amount-input",3,"ngModelChange","ngModel","min","max"],[1,"currency-icon"],["type","text","placeholder","\u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440, \u043A\u043E\u043C\u043F\u0435\u043D\u0441\u0430\u0446\u0438\u044F, \u0431\u043E\u043D\u0443\u0441 \u043A\u043E \u0434\u043D\u044E \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F, \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u0431\u0430\u043B\u0430\u043D\u0441\u0430.",1,"reason-input",3,"ngModelChange","ngModel"],["modalFooter","",1,"modal-footer-actions"],["type","button",1,"footer-cancel",3,"click"],["buttonType","primary",3,"onClick","disabled","loading"]],template:function(i,t){i&1&&(n(0,"app-modal",0),g("visibleChange",function(){return t.onClose()}),n(1,"div",1)(2,"p",2),s(3,"\u0412\u0440\u0443\u0447\u043D\u0443\u044E \u0434\u043E\u0431\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0438\u043B\u0438 \u0432\u044B\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0431\u043E\u043D\u0443\u0441\u044B \u0438\u0437 \u0441\u0447\u0435\u0442\u0430 \u043A\u043B\u0438\u0435\u043D\u0442\u0430."),a(),n(4,"div",3)(5,"button",4),g("click",function(){return t.isAdd=!0}),x(),n(6,"svg",5),_(7,"path",6),a(),s(8," \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u044B "),a(),P(),n(9,"button",7),g("click",function(){return t.isAdd=!1}),x(),n(10,"svg",5),_(11,"path",8),a(),s(12," \u0412\u044B\u0447\u0435\u0441\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u044B "),a()(),P(),n(13,"div",9)(14,"label"),s(15,"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E"),a(),n(16,"div",10)(17,"input",11),S("ngModelChange",function(f){return k(t.amount,f)||(t.amount=f),f}),a(),n(18,"span",12),s(19,"\u20B8"),a()()(),n(20,"div",9)(21,"label"),s(22,"\u041F\u0440\u0438\u0447\u0438\u043D\u0430 (\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)"),a(),n(23,"input",13),S("ngModelChange",function(f){return k(t.reason,f)||(t.reason=f),f}),a()()(),n(24,"div",14)(25,"button",15),g("click",function(){return t.onClose()}),s(26,"\u041E\u0442\u043C\u0435\u043D\u0430"),a(),n(27,"app-button",16),g("onClick",function(){return t.onSubmit()}),s(28),a()()()),i&2&&(d("visible",t.visible)("title","\u0421\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u043D\u044B\u0439 \u0431\u0430\u043B\u0430\u043D\u0441")("showCloseButton",!0)("showFooter",!0),r(5),O("active",t.isAdd),r(4),O("active",!t.isAdd),r(8),E("ngModel",t.amount),d("min",1)("max",t.isAdd?null:t.bonusBalance),r(6),E("ngModel",t.reason),r(4),d("disabled",!t.isValid()||t.isSubmitting)("loading",t.isSubmitting),r(),v(" ",t.isAdd?"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u044B":"\u0412\u044B\u0447\u0435\u0441\u0442\u044C \u0431\u043E\u043D\u0443\u0441\u044B"," "))},dependencies:[A,G,U,Pe,H,Ee,Oe,W,Be,Se],styles:[".adjust-bonus-content[_ngcontent-%COMP%]{padding:.25rem 0 1rem}.adjust-bonus-subtitle[_ngcontent-%COMP%]{margin:0 0 1.25rem;font-size:.9375rem;color:#64748b;font-weight:400;line-height:1.4}.toggle-pill[_ngcontent-%COMP%]{display:flex;width:100%;margin-bottom:1.5rem;border-radius:10px;overflow:hidden;background:#f1f5f9;border:1px solid #e2e8f0}.toggle-seg[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1rem;border:none;font-size:.9375rem;font-weight:600;cursor:pointer;transition:background .2s,color .2s;background:transparent;color:#475569}.toggle-seg[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.toggle-seg.toggle-add[_ngcontent-%COMP%], .toggle-seg.toggle-deduct[_ngcontent-%COMP%]{border-radius:0}.toggle-seg.toggle-add.active[_ngcontent-%COMP%]{background:#16a34a;color:#fff}.toggle-seg.toggle-add.active[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#fff}.toggle-seg.toggle-deduct.active[_ngcontent-%COMP%]{background:#16a34a;color:#fff}.toggle-seg.toggle-deduct.active[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#fff}.toggle-seg[_ngcontent-%COMP%]:not(.active):hover{background:#e2e8f0;color:#334155}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:600;color:#1e293b;margin-bottom:.5rem}.amount-row[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid #e2e8f0;border-radius:10px;background:#fff;overflow:hidden}.amount-input[_ngcontent-%COMP%]{flex:1;min-width:0;padding:.75rem 1rem;border:none;font-size:1rem;color:#1e293b;background:transparent}.amount-input[_ngcontent-%COMP%]:focus{outline:none}.amount-input[_ngcontent-%COMP%]::placeholder{color:#94a3b8}.currency-icon[_ngcontent-%COMP%]{padding:0 1rem;font-size:1rem;font-weight:500;color:#64748b;border-left:1px solid #e2e8f0}.reason-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid #e2e8f0;border-radius:10px;font-size:.9375rem;background:#fff;color:#1e293b;font-family:inherit;transition:border-color .2s}.reason-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#16a34a}.reason-input[_ngcontent-%COMP%]::placeholder{color:#94a3b8;font-style:italic}.modal-footer-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;gap:1rem}.footer-cancel[_ngcontent-%COMP%]{padding:.5rem .75rem;border:none;background:none;font-size:.9375rem;font-weight:500;color:#475569;cursor:pointer;transition:color .15s}.footer-cancel[_ngcontent-%COMP%]:hover{color:#1e293b}"]})}return o})();var et=["addTagInput"];function tt(o,c){if(o&1&&(n(0,"span",13),s(1),a()),o&2){let e=u();r(),y(e.label)}}function nt(o,c){if(o&1){let e=C();n(0,"span",14)(1,"span",15),s(2),a(),n(3,"button",16),g("click",function(){let t=p(e).index,l=u();return m(l.removeTag(t))}),x(),n(4,"svg",5),_(5,"path",17),a()()()}if(o&2){let e=c.$implicit;r(2),y(e)}}function it(o,c){if(o&1){let e=C();n(0,"span",20),g("click",function(){p(e);let t=u(2);return m(t.startAddTag())}),x(),n(1,"svg",5),_(2,"path",21),a(),s(3," \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0435\u0433 "),a()}}function ot(o,c){if(o&1){let e=C();n(0,"span",22)(1,"input",23,0),S("ngModelChange",function(t){p(e);let l=u(2);return k(l.newTagValue,t)||(l.newTagValue=t),m(t)}),g("keydown.enter",function(){p(e);let t=u(2);return m(t.commitAddTag())})("keydown.escape",function(){p(e);let t=u(2);return m(t.cancelAddTag())})("blur",function(){p(e);let t=u(2);return m(t.commitAddTag())})("focus",function(){p(e);let t=u(2);return m(t.showDropdown=!0)}),a()()}if(o&2){let e=u(2);r(),E("ngModel",e.newTagValue)}}function at(o,c){if(o&1&&(q(0),b(1,it,4,0,"span",18)(2,ot,3,1,"span",19),K()),o&2){let e=u();r(),d("ngIf",!e.isAddingTag),r(),d("ngIf",e.isAddingTag)}}function rt(o,c){if(o&1){let e=C();n(0,"button",29),g("mousedown",function(t){let l=p(e).$implicit;return u(2).addFromDropdown(l),m(t.preventDefault())}),s(1),a()}if(o&2){let e=c.$implicit;r(),v(" ",e," ")}}function st(o,c){if(o&1){let e=C();n(0,"div",24)(1,"div",25)(2,"span"),s(3,"\u041F\u043E\u043F\u0443\u043B\u044F\u0440\u043D\u044B\u0435 \u0442\u044D\u0433\u0438"),a(),n(4,"button",26),g("click",function(){p(e);let t=u();return m(t.showDropdown=!1)}),s(5,"\xD7"),a()(),n(6,"div",27),b(7,rt,2,1,"button",28),a()()}if(o&2){let e=u();r(7),d("ngForOf",e.getFilteredAvailable())}}function lt(o,c){o&1&&(n(0,"p",30),s(1,"\u041D\u0435\u0442 \u0442\u0435\u0433\u043E\u0432"),a())}var $e=(()=>{class o{tags=[];availableTags=[];label="";tagsChange=new B;addTagInputRef;isEditing=!1;isAddingTag=!1;showDropdown=!1;newTagValue="";shouldFocusAddInput=!1;ngAfterViewChecked(){this.shouldFocusAddInput&&this.addTagInputRef?.nativeElement&&(this.shouldFocusAddInput=!1,this.addTagInputRef.nativeElement.focus())}getFilteredAvailable(){if(!this.availableTags?.length)return[];let e=new Set(this.tags.map(i=>i.toLowerCase()));return this.availableTags.filter(i=>!e.has(i.toLowerCase()))}removeTag(e){let i=this.tags[e],t=this.tags.filter((l,f)=>f!==e);this.tagsChange.emit({tags:t,removedTag:i})}startAddTag(){this.isAddingTag=!0,this.showDropdown=!0,this.newTagValue="",this.shouldFocusAddInput=!0}commitAddTag(){let e=this.newTagValue?.trim();if(this.isAddingTag=!1,this.showDropdown=!1,this.newTagValue="",!e)return;let i=e.slice(0,50);this.tags.some(t=>t.toLowerCase()===i.toLowerCase())||this.tagsChange.emit({tags:[...this.tags,i]})}cancelAddTag(){this.isAddingTag=!1,this.showDropdown=!1,this.newTagValue=""}addFromDropdown(e){this.tags.some(i=>i.toLowerCase()===e.toLowerCase())||this.tagsChange.emit({tags:[...this.tags,e]})}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=D({type:o,selectors:[["app-inline-tags"]],viewQuery:function(i,t){if(i&1&&F(et,5),i&2){let l;R(l=L())&&(t.addTagInputRef=l.first)}},inputs:{tags:"tags",availableTags:"availableTags",label:"label"},outputs:{tagsChange:"tagsChange"},decls:12,vars:8,consts:[["addTagInput",""],[1,"inline-tags"],[1,"tags-header"],["class","tags-label",4,"ngIf"],["type","button",1,"edit-icon-btn",3,"click"],["viewBox","0 0 24 24","fill","none"],["d","M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"tags-row"],["class","tag-pill",4,"ngFor","ngForOf"],[4,"ngIf"],["class","tags-dropdown",4,"ngIf"],["class","no-tags",4,"ngIf"],[1,"tags-label"],[1,"tag-pill"],[1,"tag-text"],["type","button","aria-label","\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0442\u0435\u0433",1,"tag-remove",3,"click"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["class","add-tag-trigger",3,"click",4,"ngIf"],["class","tag-pill tag-input-pill",4,"ngIf"],[1,"add-tag-trigger",3,"click"],["d","M12 5v14M5 12h14","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"tag-pill","tag-input-pill"],["type","text","placeholder","\u0422\u0435\u0433...","maxlength","50",1,"tag-input",3,"ngModelChange","keydown.enter","keydown.escape","blur","focus","ngModel"],[1,"tags-dropdown"],[1,"tags-dropdown-header"],["type","button",1,"tags-dropdown-close",3,"click"],[1,"tags-dropdown-list"],["type","button","class","tag-option",3,"mousedown",4,"ngFor","ngForOf"],["type","button",1,"tag-option",3,"mousedown"],[1,"no-tags"]],template:function(i,t){i&1&&(n(0,"div",1)(1,"div",2),b(2,tt,2,1,"span",3),n(3,"button",4),g("click",function(){return t.isEditing=!t.isEditing}),x(),n(4,"svg",5),_(5,"path",6)(6,"path",7),a()()(),P(),n(7,"div",8),b(8,nt,6,1,"span",9)(9,at,3,2,"ng-container",10),a(),b(10,st,8,1,"div",11)(11,lt,2,0,"p",12),a()),i&2&&(r(2),d("ngIf",t.label),r(),O("active",t.isEditing),$("aria-label",t.isEditing?"\u0421\u043A\u0440\u044B\u0442\u044C \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u0435\u0433\u0430":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0435\u0433"),r(5),d("ngForOf",t.tags),r(),d("ngIf",t.isEditing),r(),d("ngIf",t.showDropdown&&t.getFilteredAvailable().length>0),r(),d("ngIf",t.tags.length===0&&!t.isAddingTag))},dependencies:[A,j,N,G,U,H,ke,W],styles:[".inline-tags[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;position:relative}.tags-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem}.tags-label[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600;color:#64748b}.edit-icon-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;padding:0;border:none;background:transparent;color:#64748b;border-radius:6px;cursor:pointer;transition:color .12s ease,background .12s ease}.edit-icon-btn[_ngcontent-%COMP%]:hover{background:#f1f5f9;color:#16a34a}.edit-icon-btn.active[_ngcontent-%COMP%]{background:#f0fdf4;color:#16a34a}.edit-icon-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.tags-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:.4rem}.tag-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem .25rem .65rem;background:#dcfce7;color:#16a34a;border-radius:9999px;font-size:.8125rem;font-weight:500;transition:background .1s ease,box-shadow .1s ease}.tag-pill[_ngcontent-%COMP%]:hover   .tag-remove[_ngcontent-%COMP%]{opacity:1}.tag-text[_ngcontent-%COMP%]{line-height:1.2}.tag-remove[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:16px;height:16px;padding:0;border:none;background:transparent;color:#16a34a;border-radius:50%;cursor:pointer;opacity:.5;transition:opacity .1s ease,background .1s ease}.tag-remove[_ngcontent-%COMP%]:hover{opacity:1;background:#16a34a33}.tag-remove[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:10px;height:10px}.add-tag-trigger[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .5rem;color:#64748b;font-size:.8125rem;font-weight:500;cursor:pointer;border-radius:9999px;border:1px dashed #cbd5e1;background:transparent;transition:border-color .12s ease,color .12s ease,background .12s ease}.add-tag-trigger[_ngcontent-%COMP%]:hover{border-color:#16a34a;color:#16a34a;background:#f0fdf4}.add-tag-trigger[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.tag-input-pill[_ngcontent-%COMP%]{padding:.2rem .5rem;background:#fff;border:1px solid #e2e8f0}.tag-input[_ngcontent-%COMP%]{width:6rem;min-width:4rem;padding:.1rem 0;border:none;font-size:.8125rem;font-weight:500;color:#1e293b;background:transparent;outline:none}.tag-input[_ngcontent-%COMP%]::placeholder{color:#94a3b8}.tags-dropdown[_ngcontent-%COMP%]{margin-top:6px;background:#fff;border:1px solid #e2e8f0;border-radius:12px;box-shadow:0 4px 12px #0000001a;overflow:hidden;z-index:50}.tags-dropdown-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#f8fafc;border-bottom:1px solid #e2e8f0;font-size:.75rem;font-weight:600;color:#64748b}.tags-dropdown-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.1rem;color:#94a3b8;cursor:pointer;padding:0;line-height:1}.tags-dropdown-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;padding:10px;max-height:140px;overflow-y:auto}.tag-option[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:5px 10px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:20px;font-size:.8rem;font-weight:500;color:#15803d;cursor:pointer;transition:all .12s ease}.tag-option[_ngcontent-%COMP%]:hover{background:#dcfce7;border-color:#86efac}.no-tags[_ngcontent-%COMP%]{margin:0;font-size:.8125rem;color:#94a3b8;font-style:italic}"]})}return o})();var dt=["container"],ut=["dropdown"],ct=["arrowBtn"],pt=[[["","mainIcon",""]]],mt=["[mainIcon]"];function gt(o,c){if(o&1){let e=C();n(0,"button",13,3),g("click",function(){let t=p(e).$implicit,l=u(2);return m(l.selectItem(t))})("keydown.enter",function(t){let l=p(e).$implicit;return u(2).selectItem(l),m(t.preventDefault())})("keydown.space",function(t){let l=p(e).$implicit;return u(2).selectItem(l),m(t.preventDefault())}),s(2),a()}if(o&2){let e=c.$implicit;r(2),v(" ",e.label," ")}}function ft(o,c){if(o&1){let e=C();n(0,"div",11,2),g("keydown",function(t){p(e);let l=u();return m(l.onDropdownKeydown(t))}),b(2,gt,3,1,"button",12),a()}if(o&2){let e=u();r(2),d("ngForOf",e.items)}}var qe=(()=>{class o{mainLabel="";items=[];mainClick=new B;itemSelect=new B;containerRef;dropdownRef;arrowBtnRef;open=!1;onDocumentClick(e){if(!this.open)return;let i=this.containerRef?.nativeElement;i&&!i.contains(e.target)&&(this.open=!1)}onEscape(){this.open=!1}ngAfterViewInit(){}onMainClick(){this.mainClick.emit()}toggleDropdown(e){e.preventDefault(),e.stopPropagation(),this.open=!this.open,this.open&&this.dropdownRef?.nativeElement&&this.dropdownRef.nativeElement.querySelector(".split-button-item")?.focus()}onArrowKeydown(e){if((e.key==="Enter"||e.key===" ")&&(e.preventDefault(),this.open=!this.open,this.open&&this.dropdownRef?.nativeElement)){let i=this.dropdownRef.nativeElement.querySelector(".split-button-item");setTimeout(()=>i?.focus(),0)}}onDropdownKeydown(e){let i=this.dropdownRef?.nativeElement?.querySelectorAll(".split-button-item");if(!i?.length)return;let t=e.target,l=Array.from(i).indexOf(t);e.key==="ArrowDown"&&l<i.length-1?(e.preventDefault(),i[l+1].focus()):e.key==="ArrowUp"&&l>0?(e.preventDefault(),i[l-1].focus()):e.key==="Escape"&&(e.preventDefault(),this.open=!1,this.arrowBtnRef?.nativeElement?.focus())}selectItem(e){this.itemSelect.emit(e.id),this.open=!1}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=D({type:o,selectors:[["app-split-button"]],viewQuery:function(i,t){if(i&1&&(F(dt,5),F(ut,5),F(ct,5)),i&2){let l;R(l=L())&&(t.containerRef=l.first),R(l=L())&&(t.dropdownRef=l.first),R(l=L())&&(t.arrowBtnRef=l.first)}},hostBindings:function(i,t){i&1&&g("click",function(f){return t.onDocumentClick(f)},!1,J)("keydown.escape",function(){return t.onEscape()},!1,J)},inputs:{mainLabel:"mainLabel",items:"items"},outputs:{mainClick:"mainClick",itemSelect:"itemSelect"},ngContentSelectors:mt,decls:11,vars:6,consts:[["container",""],["arrowBtn",""],["dropdown",""],["itemBtn",""],[1,"split-button"],["type","button","aria-haspopup","listbox",1,"split-button-main",3,"click"],[1,"split-button-label"],["type","button","aria-haspopup","listbox",1,"split-button-arrow",3,"click","keydown"],["viewBox","0 0 24 24","fill","none",1,"arrow-icon"],["d","M7 10l5 5 5-5","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["class","split-button-dropdown","role","listbox",3,"keydown",4,"ngIf"],["role","listbox",1,"split-button-dropdown",3,"keydown"],["type","button","class","split-button-item","role","option","tabindex","0",3,"click","keydown.enter","keydown.space",4,"ngFor","ngForOf"],["type","button","role","option","tabindex","0",1,"split-button-item",3,"click","keydown.enter","keydown.space"]],template:function(i,t){if(i&1){let l=C();ue(pt),n(0,"div",4,0)(2,"button",5),g("click",function(){return p(l),m(t.onMainClick())}),ce(3),n(4,"span",6),s(5),a()(),n(6,"button",7,1),g("click",function(V){return p(l),m(t.toggleDropdown(V))})("keydown",function(V){return p(l),m(t.onArrowKeydown(V))}),x(),n(8,"svg",8),_(9,"path",9),a()(),b(10,ft,3,1,"div",10),a()}i&2&&(r(2),$("aria-label",t.mainLabel)("aria-expanded",t.open),r(3),y(t.mainLabel),r(),$("aria-label","\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u043C\u0435\u043D\u044E")("aria-expanded",t.open),r(4),d("ngIf",t.open))},dependencies:[A,j,N],styles:[".split-button[_ngcontent-%COMP%]{display:inline-flex;width:100%;position:relative;border-radius:10px;overflow:visible;box-shadow:0 1px 2px #0000000d}.split-button-main[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.875rem .75rem .875rem 1rem;background:#16a34a;color:#fff;border:none;border-radius:10px 0 0 10px;font-weight:600;font-size:.9rem;cursor:pointer;transition:background .15s ease;min-width:0}.split-button-main[_ngcontent-%COMP%]:hover{background:#15803d}.split-button-main[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #16a34a66}.split-button-main[_ngcontent-%COMP%]     svg{width:18px;height:18px;flex-shrink:0}.split-button-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.split-button-arrow[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;flex-shrink:0;padding:0;background:#16a34a;color:#fff;border:none;border-left:1px solid rgba(255,255,255,.25);border-radius:0 10px 10px 0;cursor:pointer;transition:background .15s ease}.split-button-arrow[_ngcontent-%COMP%]:hover{background:#15803d}.split-button-arrow[_ngcontent-%COMP%]:focus{outline:none;box-shadow:inset 0 0 0 2px #fff6}.arrow-icon[_ngcontent-%COMP%]{width:18px;height:18px}.split-button-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin-top:4px;background:#fff;border:1px solid #e2e8f0;border-radius:10px;box-shadow:0 4px 12px #0000001f;overflow:hidden;z-index:100;min-width:100%}.split-button-item[_ngcontent-%COMP%]{display:block;width:100%;padding:.65rem 1rem;border:none;background:transparent;font-size:.9rem;font-weight:500;color:#1e293b;text-align:left;cursor:pointer;transition:background .1s ease}.split-button-item[_ngcontent-%COMP%]:hover, .split-button-item[_ngcontent-%COMP%]:focus{background:#f0fdf4;outline:none}.split-button-item[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #f1f5f9}"]})}return o})();var _t=()=>["/clients"],bt=o=>["/users",o];function ht(o,c){o&1&&(n(0,"div",11),_(1,"app-loader",12),a()),o&2&&(r(),d("visible",!0)("overlay",!1))}function xt(o,c){o&1&&_(0,"app-not-found-state",13)}function Ct(o,c){o&1&&(x(),n(0,"svg",17),_(1,"path",44)(2,"path",45),a())}function vt(o,c){o&1&&(x(),n(0,"svg",17),_(1,"path",46)(2,"circle",47),a())}function Pt(o,c){if(o&1){let e=C();n(0,"button",85),g("click",function(){p(e);let t=u(3);return m(t.startEditPersonal())}),x(),n(1,"svg",17),_(2,"path",86)(3,"path",87),a()()}}function yt(o,c){if(o&1){let e=C();n(0,"div",88)(1,"button",89),g("click",function(){p(e);let t=u(3);return m(t.savePersonal())}),s(2,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"),a(),n(3,"button",90),g("click",function(){p(e);let t=u(3);return m(t.cancelEditPersonal())}),s(4,"\u041E\u0442\u043C\u0435\u043D\u0430"),a()()}if(o&2){let e=u(3);r(),d("disabled",e.isSavingPersonal),r(2),d("disabled",e.isSavingPersonal)}}function wt(o,c){if(o&1&&(n(0,"span",91),s(1),a()),o&2){let e=u(3);r(),y(e.client.firstName)}}function Mt(o,c){if(o&1){let e=C();n(0,"input",92),S("ngModelChange",function(t){p(e);let l=u(3);return k(l.editedPersonal.firstName,t)||(l.editedPersonal.firstName=t),m(t)}),a()}if(o&2){let e=u(3);E("ngModel",e.editedPersonal.firstName)}}function Ot(o,c){if(o&1&&(n(0,"span",91),s(1),a()),o&2){let e=u(4);r(),y(e.client.lastName)}}function Et(o,c){if(o&1){let e=C();n(0,"input",92),S("ngModelChange",function(t){p(e);let l=u(4);return k(l.editedPersonal.lastName,t)||(l.editedPersonal.lastName=t),m(t)}),a()}if(o&2){let e=u(4);E("ngModel",e.editedPersonal.lastName)}}function kt(o,c){if(o&1&&(n(0,"div",72)(1,"span",73),s(2,"\u0424\u0430\u043C\u0438\u043B\u0438\u044F"),a(),b(3,Ot,2,1,"span",74)(4,Et,1,1,"input",75),a()),o&2){let e=u(3);r(3),d("ngIf",!e.isEditingPersonal),r(),d("ngIf",e.isEditingPersonal)}}function St(o,c){if(o&1&&(n(0,"span",91),s(1),a()),o&2){let e=u(3);r(),y(e.client.dateOfBirth?e.formatDate(e.client.dateOfBirth):"\u2014")}}function Tt(o,c){if(o&1){let e=C();n(0,"input",93),S("ngModelChange",function(t){p(e);let l=u(3);return k(l.editedPersonal.dateOfBirth,t)||(l.editedPersonal.dateOfBirth=t),m(t)}),a()}if(o&2){let e=u(3);E("ngModel",e.editedPersonal.dateOfBirth)}}function It(o,c){if(o&1&&(n(0,"span",91),s(1),a()),o&2){let e=u(3);r(),y(e.client.type==="business"?"\u0411\u0438\u0437\u043D\u0435\u0441":"\u0418\u043D\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043B\u044C\u043D\u044B\u0439")}}function Bt(o,c){if(o&1){let e=C();n(0,"select",94),S("ngModelChange",function(t){p(e);let l=u(3);return k(l.editedPersonal.type,t)||(l.editedPersonal.type=t),m(t)}),n(1,"option",95),s(2,"\u0418\u043D\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043B\u044C\u043D\u044B\u0439"),a(),n(3,"option",96),s(4,"\u0411\u0438\u0437\u043D\u0435\u0441"),a()()}if(o&2){let e=u(3);E("ngModel",e.editedPersonal.type)}}function Dt(o,c){if(o&1){let e=C();n(0,"button",85),g("click",function(){p(e);let t=u(3);return m(t.startEditContacts())}),x(),n(1,"svg",17),_(2,"path",86)(3,"path",87),a()()}}function At(o,c){if(o&1){let e=C();n(0,"div",88)(1,"button",89),g("click",function(){p(e);let t=u(3);return m(t.saveContacts())}),s(2,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"),a(),n(3,"button",90),g("click",function(){p(e);let t=u(3);return m(t.cancelEditContacts())}),s(4,"\u041E\u0442\u043C\u0435\u043D\u0430"),a()()}if(o&2){let e=u(3);r(),d("disabled",e.isSavingContacts),r(2),d("disabled",e.isSavingContacts)}}function Vt(o,c){if(o&1&&(n(0,"span",91),s(1),ne(2,"phoneFormat"),a()),o&2){let e=u(3);r(),y(ie(2,1,e.client.phone))}}function zt(o,c){if(o&1){let e=C();n(0,"input",97),S("ngModelChange",function(t){p(e);let l=u(3);return k(l.editedContacts.phone,t)||(l.editedContacts.phone=t),m(t)}),a()}if(o&2){let e=u(3);E("ngModel",e.editedContacts.phone)}}function Ft(o,c){if(o&1&&(n(0,"span",98),s(1),a()),o&2){let e=u(3);r(),y(e.client.email||"\u2014")}}function Rt(o,c){if(o&1){let e=C();n(0,"input",99),S("ngModelChange",function(t){p(e);let l=u(3);return k(l.editedContacts.email,t)||(l.editedContacts.email=t),m(t)}),a()}if(o&2){let e=u(3);E("ngModel",e.editedContacts.email),d("disabled",!0)}}function Lt(o,c){if(o&1){let e=C();n(0,"button",85),g("click",function(){p(e);let t=u(3);return m(t.startEditComment())}),x(),n(1,"svg",17),_(2,"path",86)(3,"path",87),a()()}}function jt(o,c){if(o&1){let e=C();n(0,"div",88)(1,"button",89),g("click",function(){p(e);let t=u(3);return m(t.saveComment())}),s(2,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"),a(),n(3,"button",90),g("click",function(){p(e);let t=u(3);return m(t.cancelEditComment())}),s(4,"\u041E\u0442\u043C\u0435\u043D\u0430"),a()()}if(o&2){let e=u(3);r(),d("disabled",e.isSavingComment),r(2),d("disabled",e.isSavingComment)}}function Nt(o,c){if(o&1&&(n(0,"p",100),s(1),a()),o&2){let e=u(3);r(),y(e.client.comment||"\u041D\u0435\u0442 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F")}}function Ut(o,c){if(o&1){let e=C();n(0,"textarea",101),S("ngModelChange",function(t){p(e);let l=u(3);return k(l.editedComment,t)||(l.editedComment=t),m(t)}),a()}if(o&2){let e=u(3);E("ngModel",e.editedComment)}}function Ht(o,c){if(o&1&&(n(0,"div",48)(1,"div",49)(2,"div",50)(3,"h3",51),s(4,"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u0435\u043B\u0438"),a()(),n(5,"div",52)(6,"div",53)(7,"div",54),x(),n(8,"svg",17),_(9,"path",55)(10,"rect",56)(11,"path",57),a()(),P(),n(12,"div",58)(13,"span",59),s(14),a(),n(15,"span",60),s(16,"\u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439"),a()()(),n(17,"div",53)(18,"div",61),x(),n(19,"svg",17),_(20,"path",62),a()(),P(),n(21,"div",58)(22,"span",59),s(23),a(),n(24,"span",60),s(25,"\u041E\u0431\u0449\u0430\u044F \u0441\u0443\u043C\u043C\u0430"),a()()(),n(26,"div",53)(27,"div",63),x(),n(28,"svg",17),_(29,"path",64),a()(),P(),n(30,"div",58)(31,"span",59),s(32),a(),n(33,"span",60),s(34,"\u0411\u043E\u043D\u0443\u0441\u043E\u0432 \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E"),a()()(),n(35,"div",53)(36,"div",65),x(),n(37,"svg",17),_(38,"circle",66)(39,"path",67),a()(),P(),n(40,"div",58)(41,"span",59),s(42),a(),n(43,"span",60),s(44,"\u0411\u043E\u043D\u0443\u0441\u043E\u0432 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E"),a()()()()(),n(45,"div",68)(46,"div",49)(47,"div",50)(48,"h3",51),s(49,"\u041B\u0438\u0447\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435"),a(),b(50,Pt,4,0,"button",69)(51,yt,5,2,"div",70),a(),n(52,"div",71)(53,"div",72)(54,"span",73),s(55),a(),b(56,wt,2,1,"span",74)(57,Mt,1,1,"input",75),a(),b(58,kt,5,2,"div",76),n(59,"div",72)(60,"span",73),s(61,"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F"),a(),b(62,St,2,1,"span",74)(63,Tt,1,1,"input",77),a(),n(64,"div",72)(65,"span",73),s(66,"\u0422\u0438\u043F \u043A\u043B\u0438\u0435\u043D\u0442\u0430"),a(),b(67,It,2,1,"span",74)(68,Bt,5,1,"select",78),a()()(),n(69,"div",49)(70,"div",50)(71,"h3",51),s(72,"\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B"),a(),b(73,Dt,4,0,"button",69)(74,At,5,2,"div",70),a(),n(75,"div",71)(76,"div",72)(77,"span",73),s(78,"\u0422\u0435\u043B\u0435\u0444\u043E\u043D"),a(),b(79,Vt,3,3,"span",74)(80,zt,1,1,"input",79),a(),n(81,"div",72)(82,"span",73),s(83,"Email"),a(),b(84,Ft,2,1,"span",80)(85,Rt,1,2,"input",81),a()()()(),n(86,"div",49)(87,"div",50)(88,"h3",51),s(89,"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439"),a(),b(90,Lt,4,0,"button",69)(91,jt,5,2,"div",70),a(),n(92,"div",82),b(93,Nt,2,1,"p",83)(94,Ut,1,1,"textarea",84),a()()()),o&2){let e=u(2);r(14),y(e.clientTotals.totalPayments),r(9),v("",e.formatAmount(e.clientTotals.totalRevenue)," \u20B8"),r(9),y(e.formatAmount(e.clientTotals.totalBonusesGranted)),r(10),y(e.formatAmount(e.clientTotals.totalBonusesUsed)),r(8),d("ngIf",!e.isEditingPersonal),r(),d("ngIf",e.isEditingPersonal),r(4),y(!e.isEditingPersonal&&e.client.type==="business"||e.isEditingPersonal&&e.editedPersonal.type==="business"?"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435":"\u0418\u043C\u044F"),r(),d("ngIf",!e.isEditingPersonal),r(),d("ngIf",e.isEditingPersonal),r(),d("ngIf",!e.isEditingPersonal&&e.client.type!=="business"||e.isEditingPersonal&&e.editedPersonal.type!=="business"),r(4),d("ngIf",!e.isEditingPersonal),r(),d("ngIf",e.isEditingPersonal),r(4),d("ngIf",!e.isEditingPersonal),r(),d("ngIf",e.isEditingPersonal),r(5),d("ngIf",!e.isEditingContacts),r(),d("ngIf",e.isEditingContacts),r(5),d("ngIf",!e.isEditingContacts),r(),d("ngIf",e.isEditingContacts),r(4),d("ngIf",!e.isEditingContacts),r(),d("ngIf",e.isEditingContacts),r(5),d("ngIf",!e.isEditingComment),r(),d("ngIf",e.isEditingComment),r(2),d("ngIf",!e.isEditingComment),r(),d("ngIf",e.isEditingComment)}}function Wt(o,c){o&1&&(n(0,"div",48)(1,"div",102),x(),n(2,"svg",17),_(3,"path",33)(4,"path",34),a(),P(),n(5,"h2"),s(6,"\u0421\u043A\u043E\u0440\u043E"),a(),n(7,"p"),s(8,'\u0420\u0430\u0437\u0434\u0435\u043B "\u041A\u043E\u0448\u0435\u043B\u0435\u043A" \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u0441\u044F \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u043A\u0435'),a()()())}function Gt(o,c){if(o&1&&(n(0,"app-badge",138),s(1),a()),o&2){let e=u().$implicit,i=u(4);r(),v(" -",i.formatAmount(e.amount)," ")}}function $t(o,c){if(o&1&&(n(0,"app-badge",139),s(1),a()),o&2){let e=u().$implicit,i=u(4);r(),v(" ",i.formatAmount(e.amount)," ")}}function qt(o,c){if(o&1&&(n(0,"app-badge",139),s(1),a()),o&2){let e=u().$implicit,i=u(4);r(),v(" -",i.formatAmount(e.amount)," \u20B8 ")}}function Kt(o,c){if(o&1&&(n(0,"app-badge",140),s(1),a()),o&2){let e,i=u().$implicit,t=u(4);r(),v(" ",t.formatAmount((e=i.originalAmount)!==null&&e!==void 0?e:i.amount)," ")}}function Qt(o,c){if(o&1&&(n(0,"app-badge",141),s(1),a()),o&2){let e,i=u().$implicit,t=u(4);r(),v(" +",t.formatAmount((e=i.originalAmount)!==null&&e!==void 0?e:i.amount)," ")}}function Yt(o,c){o&1&&(n(0,"span",142),s(1,"\u2014"),a())}function Xt(o,c){o&1&&(n(0,"app-badge",143),s(1," \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E "),a())}function Jt(o,c){o&1&&(n(0,"app-badge",144),s(1," \u041E\u0442\u043E\u0437\u0432\u0430\u043D\u043E "),a())}function Zt(o,c){if(o&1&&(n(0,"app-badge",145),s(1),a()),o&2){let e=u().$implicit,i=u(4);d("badgeType",i.getDaysUntilExpiry(e.expiresAt)<=0?"bonusExpired":i.getDaysUntilExpiry(e.expiresAt)<=7?"warning":"success"),r(),te(" ",i.formatAmount(e.remainingAmount),"",e.originalAmount!=null?" \u0438\u0437 "+i.formatAmount(e.originalAmount):""," \u20B8 ")}}function en(o,c){o&1&&(n(0,"app-badge",146),s(1," \u0418\u0441\u0442\u0435\u043A "),a())}function tn(o,c){if(o&1&&(n(0,"app-badge",150),s(1),a()),o&2){let e=u(2).$implicit,i=u(4);d("badgeType",i.getDaysUntilExpiry(e.expiresAt)<=7?"warning":"success"),r(),te(" ",i.getDaysUntilExpiry(e.expiresAt)," ",i.getDaysText(i.getDaysUntilExpiry(e.expiresAt))," ")}}function nn(o,c){if(o&1&&(n(0,"span",147)(1,"span",148),s(2),a(),b(3,tn,2,3,"app-badge",149),a()),o&2){let e=u().$implicit,i=u(4);r(2),y(i.formatDate(e.expiresAt)),r(),d("ngIf",i.getDaysUntilExpiry(e.expiresAt)>0)}}function on(o,c){o&1&&(n(0,"span",142),s(1,"\u2014"),a())}function an(o,c){if(o&1&&(n(0,"div",163),s(1),a()),o&2){let e=u(2).$implicit;r(),v(" ",e.refundReason," ")}}function rn(o,c){o&1&&(n(0,"div",164),s(1," \u041F\u0440\u0438\u0447\u0438\u043D\u0430 \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430 "),a())}function sn(o,c){if(o&1&&(n(0,"a",165),s(1),a()),o&2){let e=u(2).$implicit;d("routerLink",me(2,bt,e.initiatedById)),r(),v(" ",e.initiatedBy==="SYSTEM"?"\u0421\u0438\u0441\u0442\u0435\u043C\u0430":e.initiatedBy," ")}}function ln(o,c){if(o&1&&(n(0,"div",166),s(1),a()),o&2){let e=u(2).$implicit;r(),v(" ",e.initiatedBy==="SYSTEM"?"\u0421\u0438\u0441\u0442\u0435\u043C\u0430":e.initiatedBy," ")}}function dn(o,c){o&1&&(n(0,"div",167),s(1," \u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D "),a())}function un(o,c){if(o&1&&(n(0,"tr",151)(1,"td",152)(2,"div",153)(3,"div",154)(4,"div",155)(5,"span",156),s(6,"\u041F\u0440\u0438\u0447\u0438\u043D\u0430 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430:"),a(),b(7,an,2,1,"div",157)(8,rn,2,0,"div",158),a(),n(9,"div",159)(10,"span",156),s(11,"\u0418\u043D\u0438\u0446\u0438\u0430\u0442\u043E\u0440:"),a(),b(12,sn,2,4,"a",160)(13,ln,2,1,"div",161)(14,dn,2,0,"div",162),a()()()()()),o&2){let e=u().$implicit;r(7),d("ngIf",e.refundReason),r(),d("ngIf",!e.refundReason),r(4),d("ngIf",e.initiatedBy&&e.initiatedById),r(),d("ngIf",e.initiatedBy&&!e.initiatedById),r(),d("ngIf",!e.initiatedBy)}}function cn(o,c){if(o&1){let e=C();q(0),n(1,"tr")(2,"td")(3,"span",120),s(4),a()(),n(5,"td")(6,"div",121),b(7,Gt,2,1,"app-badge",122)(8,$t,2,1,"app-badge",123)(9,qt,2,1,"app-badge",123)(10,Kt,2,1,"app-badge",124)(11,Qt,2,1,"app-badge",125),a()(),n(12,"td")(13,"div",126),b(14,Yt,2,0,"span",127)(15,Xt,2,0,"app-badge",128)(16,Jt,2,0,"app-badge",129)(17,Zt,2,3,"app-badge",130)(18,en,2,0,"app-badge",131),a()(),n(19,"td")(20,"span",132),s(21),a()(),n(22,"td"),b(23,nn,4,2,"span",133)(24,on,2,0,"span",127),a(),n(25,"td")(26,"div",134)(27,"app-icon-button",135),g("onClick",function(){let t=p(e).$implicit,l=u(4);return m(l.toggleBonusRow(t.id))}),x(),n(28,"svg",17),_(29,"path",136),a()()()()(),b(30,un,15,5,"tr",137),K()}if(o&2){let e=c.$implicit,i=u(4);r(),O("expired",i.getDaysUntilExpiry(e.expiresAt)<=0&&!e.used&&e.type!=="refund"&&e.type!=="manual_revoke")("expiring-soon",i.getDaysUntilExpiry(e.expiresAt)<=7&&i.getDaysUntilExpiry(e.expiresAt)>0)("used",e.used)("refund",e.type==="refund")("manual-revoke",e.type==="manual_revoke"),r(2),de("bonus-type-"+e.type),r(),v(" ",i.getBonusTypeLabel(e.type)," "),r(3),d("ngIf",e.used),r(),d("ngIf",e.type==="refund"),r(),d("ngIf",e.type==="manual_revoke"),r(),d("ngIf",e.type!=="refund"&&e.type!=="manual_revoke"&&!e.used&&i.getDaysUntilExpiry(e.expiresAt)<=0),r(),d("ngIf",e.type!=="refund"&&e.type!=="manual_revoke"&&!e.used&&i.getDaysUntilExpiry(e.expiresAt)>0),r(3),d("ngIf",e.type==="manual_revoke"),r(),d("ngIf",e.used),r(),d("ngIf",e.type==="refund"),r(),d("ngIf",e.type!=="refund"&&e.type!=="manual_revoke"&&!e.used&&e.remainingAmount!=null),r(),d("ngIf",e.type!=="refund"&&e.type!=="manual_revoke"&&!e.used&&e.remainingAmount==null&&i.getDaysUntilExpiry(e.expiresAt)<=0),r(3),y(e.used||e.type==="refund"||e.type==="manual_revoke"?"\u2014":i.formatDate(e.issuedAt)),r(2),d("ngIf",!(e.used||e.type==="refund"||e.type==="manual_revoke")),r(),d("ngIf",e.used||e.type==="refund"||e.type==="manual_revoke"),r(3),d("tooltip",i.isBonusRowExpanded(e.id)?"\u0421\u043A\u0440\u044B\u0442\u044C \u0434\u0435\u0442\u0430\u043B\u0438":"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0434\u0435\u0442\u0430\u043B\u0438"),r(),O("rotated",i.isBonusRowExpanded(e.id)),r(2),d("ngIf",i.isBonusRowExpanded(e.id))}}function pn(o,c){if(o&1&&(n(0,"div",117)(1,"table",118)(2,"thead")(3,"tr")(4,"th"),s(5,"\u0422\u0438\u043F \u0431\u043E\u043D\u0443\u0441\u0430"),a(),n(6,"th"),s(7,"\u0421\u0443\u043C\u043C\u0430 \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u0438\u044F"),a(),n(8,"th"),s(9,"\u041E\u0441\u0442\u0430\u0442\u043E\u043A \u0431\u043E\u043D\u0443\u0441\u0430"),a(),n(10,"th"),s(11,"\u041D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E"),a(),n(12,"th"),s(13,"\u0418\u0441\u0442\u0435\u043A\u0430\u0435\u0442"),a(),n(14,"th"),s(15,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"),a()()(),n(16,"tbody"),b(17,cn,31,30,"ng-container",119),a()()()),o&2){u();let e=ee(28);r(17),d("ngForOf",e.paginatedData)}}function mn(o,c){o&1&&(n(0,"div",168),x(),n(1,"svg",17),_(2,"path",64),a(),P(),n(3,"span"),s(4,"\u041D\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u0431\u043E\u043D\u0443\u0441\u043E\u0432"),a()())}function gn(o,c){if(o&1&&(n(0,"div",48)(1,"div",103)(2,"div",104)(3,"div",105)(4,"div",106),x(),n(5,"svg",17),_(6,"path",64),a()(),P(),n(7,"div",107)(8,"h3",51),s(9,"\u0414\u0435\u0442\u0430\u043B\u0438 \u0431\u043E\u043D\u0443\u0441\u043E\u0432"),a(),n(10,"div",108)(11,"div",109)(12,"span",60),s(13,"\u041E\u0441\u0442\u0430\u043B\u043E\u0441\u044C:"),a(),n(14,"span",110),s(15),a()(),n(16,"div",109)(17,"span",60),s(18,"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E:"),a(),n(19,"span",111),s(20),a()(),n(21,"div",109)(22,"span",60),s(23,"\u0421\u0433\u043E\u0440\u0435\u043B\u043E:"),a(),n(24,"span",112),s(25),a()()()()()(),n(26,"div",113)(27,"app-paginated-table-wrapper",114,0),b(29,pn,18,1,"div",115)(30,mn,5,0,"div",116),a()()()()),o&2){let e=u(2);r(15),v("",e.formatAmount(e.bonusBalance)," \u20B8"),r(5),v("",e.formatAmount(e.getUsedBonusesTotal())," \u20B8"),r(5),v("",e.formatAmount(e.getExpiredBonusesTotal())," \u20B8"),r(2),d("paginationEnabled",!0)("data",e.bonusesDetails)("defaultPageSize",10),r(2),d("ngIf",e.bonusesDetails.length>0),r(),d("ngIf",e.bonusesDetails.length===0)}}function fn(o,c){if(o&1&&(n(0,"app-badge",141),s(1),a()),o&2){let e=u().$implicit,i=u(3);r(),v(" +",i.formatAmount(e.bonusEarned)," ")}}function _n(o,c){if(o&1&&(n(0,"app-badge",138),s(1),a()),o&2){let e=u().$implicit,i=u(3);r(),v(" -",i.formatAmount(e.bonusUsed)," ")}}function bn(o,c){if(o&1&&(n(0,"app-badge",139),s(1),a()),o&2){let e=u().$implicit,i=u(3);r(),v(" -",i.formatAmount(e.bonusRevoked)," ")}}function hn(o,c){o&1&&(n(0,"span",200),s(1,"\u2014"),a())}function xn(o,c){if(o&1){let e=C();n(0,"tr",181)(1,"td",182)(2,"span",183),g("click",function(){let t=p(e).$implicit,l=u(3);return m(l.openPaymentView(t.id))}),s(3),a()(),n(4,"td",184)(5,"span",185),s(6),a()(),n(7,"td",186)(8,"div",121),b(9,fn,2,1,"app-badge",125)(10,_n,2,1,"app-badge",122)(11,bn,2,1,"app-badge",123)(12,hn,2,0,"span",187),a()(),n(13,"td",188),_(14,"app-badge",189),a(),n(15,"td",190)(16,"app-badge",191),s(17),a()(),n(18,"td",192)(19,"div",193)(20,"span",194),s(21),a(),n(22,"span",195),s(23),a()()(),n(24,"td",196)(25,"div",134)(26,"app-icon-button",197),g("onClick",function(){let t=p(e).$implicit,l=u(3);return m(l.openRefundModal(t))}),x(),n(27,"svg",198),_(28,"path",199),a()()()()()}if(o&2){let e=c.$implicit,i=u(3);r(3),y(e.id),r(3),v("",i.formatAmount(e.amount)," \u20B8"),r(3),d("ngIf",e.bonusEarned>0),r(),d("ngIf",e.bonusUsed>0),r(),d("ngIf",e.bonusRevoked>0),r(),d("ngIf",e.bonusEarned===0&&e.bonusUsed===0&&e.bonusRevoked===0),r(2),d("paymentMethod",i.getPaymentMethodForBadge(e.paymentMethod)),r(2),d("badgeType",e.isRefund?"refund":"payment")("icon",e.isRefund?"refund":"payment"),r(),v(" ",e.isRefund?"\u0412\u043E\u0437\u0432\u0440\u0430\u0442":"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E"," "),r(4),y(e.date),r(2),y(e.time),r(3),d("disabled",e.isRefund)}}function Cn(o,c){o&1&&(n(0,"div",168),x(),n(1,"svg",198),_(2,"path",201)(3,"rect",56),a(),P(),n(4,"span"),s(5,"\u041F\u043B\u0430\u0442\u0435\u0436\u0438 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B"),a()())}function vn(o,c){if(o&1&&(n(0,"div",48)(1,"div",169)(2,"div",50)(3,"div",105)(4,"div",106),x(),n(5,"svg",17),_(6,"path",37),a()(),P(),n(7,"h3",51),s(8,"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u043F\u043B\u0430\u0442\u0435\u0436\u0435\u0439"),a()(),n(9,"span",170),s(10),a()(),n(11,"app-paginated-table-wrapper",171,1)(13,"div",117)(14,"table",172)(15,"thead")(16,"tr")(17,"th",173),s(18,"ID \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),a(),n(19,"th",174),s(20,"\u0421\u0443\u043C\u043C\u0430"),a(),n(21,"th",175),s(22,"\u0411\u043E\u043D\u0443\u0441\u044B"),a(),n(23,"th",176),s(24,"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B"),a(),n(25,"th",177),s(26,"\u0421\u0442\u0430\u0442\u0443\u0441"),a(),n(27,"th",178),s(28,"\u0414\u0430\u0442\u0430 \u0438 \u0432\u0440\u0435\u043C\u044F"),a(),n(29,"th",179),s(30,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"),a()()(),n(31,"tbody"),b(32,xn,29,13,"tr",180),a()(),b(33,Cn,6,0,"div",116),a()()()()),o&2){let e=ee(12),i=u(2);r(10),v("",i.payments.length," \u043F\u043B\u0430\u0442\u0435\u0436\u0435\u0439"),r(),d("paginationEnabled",!0)("data",i.payments)("defaultPageSize",15),r(21),d("ngForOf",e.paginatedData),r(),d("ngIf",i.payments.length===0)}}function Pn(o,c){o&1&&(n(0,"div",48)(1,"div",102),x(),n(2,"svg",17),_(3,"path",38)(4,"path",39),a(),P(),n(5,"h2"),s(6,"\u0421\u043A\u043E\u0440\u043E"),a(),n(7,"p"),s(8,'\u0420\u0430\u0437\u0434\u0435\u043B "\u0416\u0443\u0440\u043D\u0430\u043B \u0430\u0443\u0434\u0438\u0442\u0430" \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u0441\u044F \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u043A\u0435'),a()()())}function yn(o,c){if(o&1){let e=C();n(0,"div",14)(1,"div",15)(2,"a",16),x(),n(3,"svg",17),_(4,"path",18),a(),P(),n(5,"span"),s(6,"\u041A\u043B\u0438\u0435\u043D\u0442\u044B"),a()(),n(7,"div",19),b(8,Ct,3,0,"svg",20)(9,vt,3,0,"svg",20),s(10),a(),n(11,"h1",21),s(12),a(),n(13,"p",22),s(14),ne(15,"phoneFormat"),a(),n(16,"div",23)(17,"app-inline-tags",24),g("tagsChange",function(t){p(e);let l=u();return m(l.onInlineTagsChange(t))}),a()(),n(18,"div",25)(19,"app-split-button",26),g("mainClick",function(){p(e);let t=u();return m(t.openCreatePayment())})("itemSelect",function(t){p(e);let l=u();return m(l.onSplitButtonItemSelect(t))}),x(),n(20,"svg",27),_(21,"path",28),a()()(),P(),n(22,"nav",29)(23,"a",30),x(),n(24,"svg",17),_(25,"path",31)(26,"path",32),a(),P(),n(27,"span"),s(28,"\u041E\u0431\u0449\u0435\u0435"),a()(),n(29,"a",30),x(),n(30,"svg",17),_(31,"path",33)(32,"path",34),a(),P(),n(33,"span"),s(34,"\u041A\u043E\u0448\u0435\u043B\u0435\u043A"),a(),n(35,"span",35),s(36,"\u0421\u043A\u043E\u0440\u043E"),a()(),n(37,"a",30),x(),n(38,"svg",17),_(39,"path",36),a(),P(),n(40,"span"),s(41,"\u0414\u0435\u0442\u0430\u043B\u0438 \u0431\u043E\u043D\u0443\u0441\u043E\u0432"),a()(),n(42,"a",30),x(),n(43,"svg",17),_(44,"path",37),a(),P(),n(45,"span"),s(46,"\u0414\u0435\u0442\u0430\u043B\u0438 \u043F\u043B\u0430\u0442\u0435\u0436\u0435\u0439"),a()(),n(47,"a",30),x(),n(48,"svg",17),_(49,"path",38)(50,"path",39),a(),P(),n(51,"span"),s(52,"\u0416\u0443\u0440\u043D\u0430\u043B \u0430\u0443\u0434\u0438\u0442\u0430"),a(),n(53,"span",35),s(54,"\u0421\u043A\u043E\u0440\u043E"),a()()(),n(55,"button",40),g("click",function(){p(e);let t=u();return m(t.openDeleteModal())}),x(),n(56,"svg",17),_(57,"path",41),a(),P(),n(58,"span"),s(59,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430"),a()()(),n(60,"div",42),b(61,Ht,95,24,"div",43)(62,Wt,9,0,"div",43)(63,gn,31,8,"div",43)(64,vn,34,6,"div",43)(65,Pn,9,0,"div",43),a()()}if(o&2){let e=u();r(2),d("routerLink",pe(38,_t)),r(5),O("business",e.client.type==="business"),r(),d("ngIf",e.client.type==="business"),r(),d("ngIf",e.client.type==="individual"),r(),v(" ",e.client.type==="business"?"\u0411\u0438\u0437\u043D\u0435\u0441":"\u0418\u043D\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043B\u044C\u043D\u044B\u0439"," "),r(2),y(e.getFullName()),r(2),y(ie(15,36,e.client.phone)),r(3),d("tags",e.client.tags)("availableTags",e.availableTags),r(2),d("items",e.splitButtonItems),r(4),O("active",e.activeView==="general"),z("routerLink","/clients/",e.client.id,"/general"),r(6),O("active",e.activeView==="wallet"),z("routerLink","/clients/",e.client.id,"/wallet"),r(8),O("active",e.activeView==="bonus-details"),z("routerLink","/clients/",e.client.id,"/bonus-details"),r(5),O("active",e.activeView==="payment-details"),z("routerLink","/clients/",e.client.id,"/payment-details"),r(5),O("active",e.activeView==="audit-logs"),z("routerLink","/clients/",e.client.id,"/audit-logs"),r(14),d("ngIf",e.activeView==="general"),r(),d("ngIf",e.activeView==="wallet"),r(),d("ngIf",e.activeView==="bonus-details"),r(),d("ngIf",e.activeView==="payment-details"),r(),d("ngIf",e.activeView==="audit-logs")}}function wn(o,c){if(o&1){let e=C();n(0,"div",205)(1,"div",206),x(),n(2,"svg",17),_(3,"path",207),a()(),P(),n(4,"h3",208),s(5,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430?"),a(),n(6,"p",209),s(7," \u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430 "),n(8,"strong"),s(9),a(),s(10,"?"),_(11,"br"),s(12," \u042D\u0442\u043E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C. \u0412\u0441\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u043A\u043B\u0438\u0435\u043D\u0442\u0430, \u0432\u043A\u043B\u044E\u0447\u0430\u044F \u0438\u0441\u0442\u043E\u0440\u0438\u044E \u043F\u043B\u0430\u0442\u0435\u0436\u0435\u0439 \u0438 \u0431\u043E\u043D\u0443\u0441\u043E\u0432, \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B. "),a(),n(13,"div",210)(14,"button",211),g("click",function(){p(e);let t=u(2);return m(t.closeDeleteModal())}),s(15,"\u041E\u0442\u043C\u0435\u043D\u0430"),a(),n(16,"button",212),g("click",function(){p(e);let t=u(2);return m(t.proceedToDeleteStep2())}),s(17,"\u0414\u0430, \u0443\u0434\u0430\u043B\u0438\u0442\u044C"),a()()()}if(o&2){let e=u(2);r(9),y(e.getFullName())}}function Mn(o,c){o&1&&(n(0,"span"),s(1,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0432\u0441\u0435\u0433\u0434\u0430"),a())}function On(o,c){o&1&&(n(0,"span"),s(1,"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435..."),a())}function En(o,c){if(o&1){let e=C();n(0,"div",205)(1,"div",213),x(),n(2,"svg",17),_(3,"path",214),a()(),P(),n(4,"h3",208),s(5,"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435"),a(),n(6,"p",209),s(7," \u0414\u043B\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043B\u043E\u0432\u043E "),n(8,"strong",215),s(9,"\u0443\u0434\u0430\u043B\u0438\u0442\u044C"),a()(),n(10,"input",216),S("ngModelChange",function(t){p(e);let l=u(2);return k(l.deleteConfirmationWord,t)||(l.deleteConfirmationWord=t),m(t)}),g("keydown.enter",function(){p(e);let t=u(2);return m(t.confirmDelete())}),a(),n(11,"div",210)(12,"button",211),g("click",function(){p(e);let t=u(2);return m(t.closeDeleteModal())}),s(13,"\u041E\u0442\u043C\u0435\u043D\u0430"),a(),n(14,"button",217),g("click",function(){p(e);let t=u(2);return m(t.confirmDelete())}),b(15,Mn,2,0,"span",218)(16,On,2,0,"span",218),a()()()}if(o&2){let e=u(2);r(10),E("ngModel",e.deleteConfirmationWord),r(4),d("disabled",e.deleteConfirmationWord!=="\u0443\u0434\u0430\u043B\u0438\u0442\u044C"||e.isDeletingClient),r(),d("ngIf",!e.isDeletingClient),r(),d("ngIf",e.isDeletingClient)}}function kn(o,c){if(o&1){let e=C();n(0,"div",202),g("click",function(){p(e);let t=u();return m(t.closeDeleteModal())}),n(1,"div",203),g("click",function(t){return p(e),m(t.stopPropagation())}),b(2,wn,18,1,"div",204)(3,En,17,4,"div",204),a()()}if(o&2){let e=u();r(2),d("ngIf",e.deleteStep===1),r(),d("ngIf",e.deleteStep===2)}}var Si=(()=>{class o{pageHeaderService=T(Ie);route=T(_e);router=T(be);titleService=T(fe);clientsService=T(Ae);paymentsService=T(Ve);bonusesService=T(Y);analyticsService=T(ze);toastService=T(Q);transactionModalService=T(Te);cdr=T(ge);destroy$=new re;clientId="";isLoading=!0;clientNotFound=!1;client=null;clientDetails=null;clientTotals={totalPayments:0,totalRevenue:0,totalBonusesGranted:0,totalBonusesUsed:0};bonusBalance=0;activeView="general";isEditingComment=!1;editedComment="";isSavingComment=!1;isEditingTags=!1;editedTags=[];newTagInput="";showTagsDropdown=!1;isSavingTags=!1;availableTags=[];isEditingPersonal=!1;isSavingPersonal=!1;editedPersonal={firstName:"",lastName:"",type:"individual",dateOfBirth:null};isEditingContacts=!1;isSavingContacts=!1;editedContacts={phone:"",email:""};isBonusesExpanded=!1;bonusesDetails=[];expandedBonusRows=new Set;expandedMobileBonusCards=new Set;expandedMobilePaymentCards=new Set;payments=[];showRefundModal=!1;selectedPaymentForRefund=null;showAdjustBonusModal=!1;splitButtonItems=[{id:"create-payment",label:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u043B\u0430\u0442\u0435\u0436"},{id:"adjust-bonus",label:"\u0420\u0435\u0433\u0443\u043B\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0431\u043E\u043D\u0443\u0441"}];showPaymentViewModal=!1;selectedPaymentTxId=null;selectedPaymentSearchResult=null;showDeleteModal=!1;deleteStep=1;deleteConfirmationWord="";isDeletingClient=!1;ngOnInit(){this.pageHeaderService.setPageHeader("\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430",[{label:"\u0413\u043B\u0430\u0432\u043D\u0430\u044F",route:"/home"},{label:"\u041A\u043B\u0438\u0435\u043D\u0442\u044B",route:"/clients"},{label:"\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430"}]),this.route.params.subscribe(e=>{this.clientId=e.id;let i=e.section;i&&["general","wallet","bonus-details","payment-details","audit-logs"].includes(i)?this.activeView=i:this.clientId&&!i&&this.router.navigate(["/clients",this.clientId,"general"],{replaceUrl:!0}),this.clientId&&this.loadClientData()}),this.transactionModalService.transactionComplete$.pipe(le(this.destroy$)).subscribe(()=>{this.router.url.startsWith("/clients/")&&this.clientId&&this.loadClientData()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadClientData(){this.isLoading=!0;let e=this.clientsService.getClientById(this.clientId),i=this.paymentsService.getClientPayments(this.clientId,0,100),t=this.bonusesService.getClientBonusHistory(this.clientId,0,100),l=this.bonusesService.getClientBonusBalance(this.clientId),f=this.analyticsService.getClientTotals(this.clientId),V=this.clientsService.getTags();se({client:e,payments:i,bonusHistory:t,bonusBalance:l,totals:f,tags:V}).subscribe({next:({client:w,payments:X,bonusHistory:Ke,bonusBalance:Qe,totals:Ye,tags:ae})=>{this.clientDetails=w;let Xe=`${w.name}${w.surname?" "+w.surname:""}`.trim();this.titleService.setTitle(`Westwood - Client - ${Xe}`),this.client={id:w.id,firstName:w.name,lastName:w.surname||"",phone:w.phone,email:w.email,tags:w.tags||[],comment:w.notes,type:w.clientType==="BUSINESS"?"business":"individual",dateOfBirth:w.dateOfBirth??null};let Je=X?.content||[];this.payments=Je.map(h=>{try{return this.mapPaymentToItem(h)}catch(M){return console.error("Error mapping payment:",h,M),null}}).filter(h=>h!==null).sort((h,M)=>{try{let I=new Date(`${h.date} ${h.time}`);return new Date(`${M.date} ${M.time}`).getTime()-I.getTime()}catch(I){return console.error("Error sorting payments:",I),0}});let Ze=Ke?.content||[];this.bonusesDetails=Ze.map(h=>{try{let M="purchase";h.eventType==="MANUAL_REVOKE"?M="manual_revoke":h.grantReason==="WELCOME"?M="welcome":h.eventType==="GRANTED"||h.eventType==="USED"?M="purchase":h.eventType==="REVOKED"?M="refund":h.eventType==="EXPIRED"&&(M="loyalty");let I={id:String(h.id),type:M,amount:h.bonusAmount,issuedAt:new Date(h.createdAt),expiresAt:h.expiresAt?new Date(h.expiresAt):new Date(Date.now()+90*24*60*60*1e3),used:h.eventType==="USED",refundReason:h.revokeReason||void 0,initiatedBy:h.initiatedByUserName??h.revokedByUserName??void 0,initiatedById:h.initiatedByUserId!=null?String(h.initiatedByUserId):void 0};return h.originalAmount!=null&&(I.originalAmount=h.originalAmount),h.remainingAmount!=null&&(I.remainingAmount=h.remainingAmount),h.eventType==="MANUAL_REVOKE"&&(I.revokedByUserName=h.revokedByUserName??void 0,I.revokedAt=h.revokedAt?new Date(h.revokedAt):new Date(h.createdAt)),I}catch(M){return console.error("Error mapping bonus:",h,M),null}}).filter(h=>h!==null),this.bonusBalance=Qe?.currentBalance??0,this.clientTotals=Ye||{totalPayments:0,totalRevenue:0,totalBonusesGranted:0,totalBonusesUsed:0},this.availableTags=Array.isArray(ae)?ae:[],console.log("Loaded available tags:",this.availableTags),this.isLoading=!1,this.cdr.detectChanges()},error:w=>{if(console.error("Error loading client data:",w),console.error("Error details:",{status:w.status,statusText:w.statusText,url:w.url,error:w.error,clientId:this.clientId}),w.status===404){this.clientNotFound=!0,this.isLoading=!1;return}this.loadClientDataIndividually();let X=w.error?.message||`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u043A\u043B\u0438\u0435\u043D\u0442\u0430 (${w.status||"unknown"})`;this.toastService.error(X)}})}loadClientDataIndividually(){this.clientsService.getClientById(this.clientId).subscribe({next:e=>{this.clientDetails=e;let i=`${e.name}${e.surname?" "+e.surname:""}`.trim();this.titleService.setTitle(`Westwood - Client - ${i}`),this.client={id:e.id,firstName:e.name,lastName:e.surname||"",phone:e.phone,email:e.email,tags:e.tags||[],comment:e.notes,type:e.clientType==="BUSINESS"?"business":"individual",dateOfBirth:e.dateOfBirth??null},this.isLoading=!1,this.cdr.detectChanges()},error:e=>{console.error("Error loading client:",e),e.status===404&&(this.clientNotFound=!0),this.isLoading=!1}}),this.paymentsService.getClientPayments(this.clientId,0,100).subscribe({next:e=>{let i=e?.content||[];this.payments=i.map(t=>{try{return this.mapPaymentToItem(t)}catch(l){return console.error("Error mapping payment:",t,l),null}}).filter(t=>t!==null).sort((t,l)=>{try{let f=new Date(`${t.date} ${t.time}`);return new Date(`${l.date} ${l.time}`).getTime()-f.getTime()}catch{return 0}}),this.cdr.detectChanges()},error:e=>{console.error("Error loading payments:",e),this.payments=[]}}),this.bonusesService.getClientBonusHistory(this.clientId,0,100).subscribe({next:e=>{let i=e?.content||[];this.bonusesDetails=i.map(t=>{try{let l="purchase";t.eventType==="MANUAL_REVOKE"?l="manual_revoke":t.grantReason==="WELCOME"?l="welcome":t.eventType==="GRANTED"||t.eventType==="USED"?l="purchase":t.eventType==="REVOKED"?l="refund":t.eventType==="EXPIRED"&&(l="loyalty");let f={id:String(t.id),type:l,amount:t.bonusAmount,issuedAt:new Date(t.createdAt),expiresAt:t.expiresAt?new Date(t.expiresAt):new Date(Date.now()+90*24*60*60*1e3),used:t.eventType==="USED",refundReason:t.revokeReason||void 0,initiatedBy:t.initiatedByUserName??t.revokedByUserName??void 0,initiatedById:t.initiatedByUserId!=null?String(t.initiatedByUserId):void 0};return t.originalAmount!=null&&(f.originalAmount=t.originalAmount),t.remainingAmount!=null&&(f.remainingAmount=t.remainingAmount),t.eventType==="MANUAL_REVOKE"&&(f.revokedByUserName=t.revokedByUserName??void 0,f.revokedAt=t.revokedAt?new Date(t.revokedAt):new Date(t.createdAt)),f}catch(l){return console.error("Error mapping bonus:",t,l),null}}).filter(t=>t!==null),this.cdr.detectChanges()},error:e=>{console.error("Error loading bonus history:",e),this.bonusesDetails=[]}}),this.bonusesService.getClientBonusBalance(this.clientId).subscribe({next:e=>{this.bonusBalance=e?.currentBalance??0,this.cdr.detectChanges()},error:e=>{console.error("Error loading bonus balance:",e),this.bonusBalance=0}}),this.analyticsService.getClientTotals(this.clientId).subscribe({next:e=>{this.clientTotals=e||{totalPayments:0,totalRevenue:0,totalBonusesGranted:0,totalBonusesUsed:0},this.cdr.detectChanges()},error:e=>{console.error("Error loading client totals:",e),this.clientTotals={totalPayments:0,totalRevenue:0,totalBonusesGranted:0,totalBonusesUsed:0}}}),this.clientsService.getTags().subscribe({next:e=>{this.availableTags=Array.isArray(e)?e:[],this.cdr.detectChanges()},error:e=>{console.error("Error loading tags:",e),this.availableTags=[]}})}mapPaymentToItem(e){if(!e)return console.warn("Invalid payment data: payment is null/undefined"),null;if(!e.createdAt){console.warn("Invalid payment data: missing createdAt",e);let i=new Date;return{id:e.txId||"unknown",clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,bonusRevoked:e.bonusRevoked||0,paymentMethod:e.paymentMethod?.toLowerCase()||"cash",isRefund:e.status==="REFUNDED"||!!e.refundedPaymentTxId,date:this.formatDate(i),time:this.formatTime(i)}}try{let i=new Date(e.createdAt);if(isNaN(i.getTime())){console.warn("Invalid date format:",e.createdAt);let f=new Date;return{id:e.txId,clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,bonusRevoked:e.bonusRevoked||0,paymentMethod:e.paymentMethod?.toLowerCase()||"cash",isRefund:e.status==="REFUNDED"||!!e.refundedPaymentTxId,date:this.formatDate(f),time:this.formatTime(f)}}let t=this.formatDate(i),l=this.formatTime(i);return{id:e.txId,clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,bonusRevoked:e.bonusRevoked||0,paymentMethod:e.paymentMethod?.toLowerCase()||"cash",isRefund:e.status==="REFUNDED"||!!e.refundedPaymentTxId,date:t,time:l}}catch(i){console.error("Error mapping payment:",i,e);let t=new Date;return{id:e.txId||"unknown",clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,bonusRevoked:e.bonusRevoked||0,paymentMethod:"cash",isRefund:!1,date:this.formatDate(t),time:this.formatTime(t)}}}ngAfterViewInit(){let e=document.querySelector(".sidebar-content");e&&(e.scrollTop=0),window.scrollTo(0,0)}getFullName(){return this.client?`${this.client.firstName} ${this.client.lastName}`.trim():""}getInitials(e){if(e)return e.split(" ").map(f=>f.charAt(0)).join("").toUpperCase().slice(0,2);if(!this.client)return"";let i=this.client.firstName.charAt(0).toUpperCase(),t=this.client.lastName?this.client.lastName.charAt(0).toUpperCase():"";return i+t}startEditTags(){this.client&&(this.editedTags=[...this.client.tags],this.isEditingTags=!0,this.newTagInput="",this.showTagsDropdown=!1,console.log("Started editing tags. Available tags:",this.availableTags))}addTag(){!this.client||!this.newTagInput.trim()||(this.client.tags.includes(this.newTagInput.trim())||this.client.tags.push(this.newTagInput.trim()),this.newTagInput="")}addTagFromDropdown(e){this.client&&(this.client.tags.includes(e)||this.client.tags.push(e),this.showTagsDropdown=!1)}getFilteredTags(){if(!this.client)return[];if(!this.availableTags||this.availableTags.length===0)return console.warn("Available tags is empty:",this.availableTags),[];let e=this.newTagInput.toLowerCase(),i=this.availableTags.filter(t=>!this.client.tags.includes(t)&&(e===""||t.toLowerCase().includes(e)));return console.log("Filtered tags:",{availableTags:this.availableTags,clientTags:this.client.tags,searchTerm:e,filtered:i}),i}removeTag(e){this.client&&this.client.tags.splice(e,1)}saveTags(){if(!this.client)return;this.isSavingTags=!0;let e={tags:this.client.tags};console.log("Update Client Tags - Request Payload:",{clientId:this.clientId,payload:e}),this.clientsService.updateClientTags(this.clientId,e).subscribe({next:()=>{this.toastService.success("\u0422\u0435\u0433\u0438 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B"),this.isEditingTags=!1,this.newTagInput="",this.showTagsDropdown=!1,this.isSavingTags=!1},error:i=>{let t=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0442\u0435\u0433\u043E\u0432";this.toastService.error(t),this.cancelEditTags(),this.isSavingTags=!1}})}cancelEditTags(){this.client&&(this.client.tags=[...this.editedTags],this.isEditingTags=!1,this.newTagInput="",this.showTagsDropdown=!1)}startEditComment(){this.client&&(this.editedComment=this.client.comment||"",this.isEditingComment=!0)}saveComment(){if(!this.client)return;this.isSavingComment=!0;let e={notes:this.editedComment};console.log("Update Client Notes - Request Payload:",{clientId:this.clientId,payload:e}),this.clientsService.updateClientNotes(this.clientId,e).subscribe({next:()=>{this.client.comment=this.editedComment,this.toastService.success("\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D"),this.isEditingComment=!1,this.isSavingComment=!1},error:i=>{let t=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F";this.toastService.error(t),this.isSavingComment=!1}})}cancelEditComment(){this.isEditingComment=!1,this.editedComment=""}startEditPersonal(){this.client&&(this.editedPersonal={firstName:this.client.firstName,lastName:this.client.lastName,type:this.client.type,dateOfBirth:this.client.dateOfBirth??null},this.isEditingPersonal=!0)}savePersonal(){if(!this.client||!this.clientDetails)return;this.isSavingPersonal=!0;let e=this.editedPersonal.dateOfBirth??this.clientDetails.dateOfBirth,i={phone:this.clientDetails.phone,name:this.editedPersonal.firstName,surname:this.editedPersonal.type==="business"?null:this.editedPersonal.lastName?.trim()||void 0,dateOfBirth:e!=null&&String(e).trim()!==""?String(e).trim():null,notes:this.clientDetails.notes,tags:this.clientDetails.tags||[],clientType:this.editedPersonal.type==="business"?"BUSINESS":"INDIVIDUAL",referrerId:this.clientDetails.referrerId};console.log("Update Client (Personal Data) - Request Payload:",{clientId:this.clientId,payload:i}),this.clientsService.updateClient(this.clientId,i).subscribe({next:t=>{this.clientDetails=t,this.client.firstName=t.name,this.client.lastName=t.surname||"",this.client.type=t.clientType==="BUSINESS"?"business":"individual",this.client.dateOfBirth=t.dateOfBirth??null,this.toastService.success("\u041B\u0438\u0447\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B"),this.isEditingPersonal=!1,this.isSavingPersonal=!1},error:t=>{let l=t.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u043B\u0438\u0447\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445";this.toastService.error(l),this.isSavingPersonal=!1}})}cancelEditPersonal(){this.isEditingPersonal=!1}startEditContacts(){this.client&&(this.editedContacts={phone:this.client.phone,email:this.client.email||""},this.isEditingContacts=!0)}saveContacts(){if(!this.client||!this.clientDetails)return;this.isSavingContacts=!0;let e={phone:this.editedContacts.phone,name:this.clientDetails.name,surname:this.clientDetails.surname||"",dateOfBirth:this.clientDetails.dateOfBirth,notes:this.clientDetails.notes,tags:this.clientDetails.tags||[],clientType:this.clientDetails.clientType,referrerId:this.clientDetails.referrerId};console.log("Update Client (Contacts) - Request Payload:",{clientId:this.clientId,payload:e}),this.clientsService.updateClient(this.clientId,e).subscribe({next:i=>{this.clientDetails=i,this.client.phone=i.phone,this.toastService.success("\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B"),this.isEditingContacts=!1,this.isSavingContacts=!1},error:i=>{let t=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445";this.toastService.error(t),this.isSavingContacts=!1}})}cancelEditContacts(){this.isEditingContacts=!1}formatPaymentId(e){return e}formatAmount(e){return e.toLocaleString("ru-RU")}getPaymentMethodForBadge(e){if(!e)return null;let i=e.toUpperCase();return i==="CASH"||i==="CARD"||i==="TRANSFER"?i:null}getPaymentMethodLabel(e){return{cash:"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u0435",card:"\u041A\u0430\u0440\u0442\u0430",transfer:"\u041F\u0435\u0440\u0435\u0432\u043E\u0434"}[e]||e}openRefundModal(e){this.client&&(this.selectedPaymentForRefund={id:e.id,clientId:this.clientId,clientName:this.getFullName(),clientPhone:this.client.phone,amount:e.amount,bonusEarned:e.bonusEarned,bonusUsed:e.bonusUsed,bonusRevoked:e.bonusRevoked,paymentMethod:e.paymentMethod,isRefund:e.isRefund,date:e.date,time:e.time},this.showRefundModal=!0)}closeRefundModal(){this.showRefundModal=!1,this.selectedPaymentForRefund=null}openPaymentView(e){let i=this.payments.find(t=>t.id===e);i&&(this.selectedPaymentSearchResult={txId:i.id,clientId:this.clientId,clientName:this.getFullName(),clientPhone:this.client?.phone||"",clientEmail:this.client?.email||null,amount:i.amount,status:i.isRefund?"REFUNDED":"COMPLETED",paymentMethod:i.paymentMethod?.toUpperCase(),initiatedBy:null,createdAt:i.date+"T"+i.time,refundedPaymentTxId:null,bonusGranted:i.bonusEarned,bonusUsed:i.bonusUsed,bonusRevoked:i.bonusRevoked,refundReason:null}),this.selectedPaymentTxId=e,this.showPaymentViewModal=!0}onPaymentUpdated(){this.loadClientData()}confirmRefund(e){this.selectedPaymentForRefund&&this.paymentsService.refundPayment(this.selectedPaymentForRefund.id,{notes:e}).subscribe({next:()=>{this.toastService.success("\u0412\u043E\u0437\u0432\u0440\u0430\u0442 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D"),this.closeRefundModal(),this.loadClientData()},error:i=>{let t=i.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u0438 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430";this.toastService.error(t)}})}formatTime(e){let i=String(e.getHours()).padStart(2,"0"),t=String(e.getMinutes()).padStart(2,"0");return`${i}:${t}`}getBonusTypeLabel(e){return{welcome:"\u041F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u044B\u0439",referral:"\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439",purchase:"\u0417\u0430 \u043F\u043E\u043A\u0443\u043F\u043A\u0443",promotion:"\u0410\u043A\u0446\u0438\u044F",loyalty:"\u041B\u043E\u044F\u043B\u044C\u043D\u043E\u0441\u0442\u044C",refund:"\u041E\u0442\u043E\u0437\u0432\u0430\u043D\u043E",used:"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E",granted:"\u041D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E",manual_revoke:"\u0421\u043F\u0438\u0441\u0430\u043D\u043E \u0432\u0440\u0443\u0447\u043D\u0443\u044E"}[e]||e}getDaysUntilExpiry(e){let i=new Date,l=new Date(e).getTime()-i.getTime();return Math.ceil(l/(1e3*60*60*24))}getDaysText(e){return e===1?"\u0434\u0435\u043D\u044C":e>=2&&e<=4?"\u0434\u043D\u044F":"\u0434\u043D\u0435\u0439"}formatDate(e){return(typeof e=="string"?new Date(e):e).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}toggleBonusesExpanded(){this.isBonusesExpanded=!this.isBonusesExpanded}getActiveBonusesTotal(){let e=new Date;return this.bonusesDetails.filter(i=>!i.used&&new Date(i.expiresAt)>e).reduce((i,t)=>i+t.amount,0)}getUsedBonusesTotal(){return this.bonusesDetails.filter(e=>e.used).reduce((e,i)=>e+i.amount,0)}getExpiredBonusesTotal(){let e=new Date;return this.bonusesDetails.filter(i=>!i.used&&i.type!=="refund"&&new Date(i.expiresAt)<=e).reduce((i,t)=>i+t.amount,0)}toggleBonusRow(e){this.expandedBonusRows.has(e)?this.expandedBonusRows.delete(e):this.expandedBonusRows.add(e)}isBonusRowExpanded(e){return this.expandedBonusRows.has(e)}toggleMobileBonusCard(e){this.expandedMobileBonusCards.has(e)?this.expandedMobileBonusCards.delete(e):this.expandedMobileBonusCards.add(e)}isMobileBonusExpanded(e){return this.expandedMobileBonusCards.has(e)}toggleMobilePaymentCard(e){this.expandedMobilePaymentCards.has(e)?this.expandedMobilePaymentCards.delete(e):this.expandedMobilePaymentCards.add(e)}isMobilePaymentExpanded(e){return this.expandedMobilePaymentCards.has(e)}openCreatePayment(){this.client&&this.transactionModalService.open(this.client.phone)}openAdjustBonusModal(){this.showAdjustBonusModal=!0}onSplitButtonItemSelect(e){e==="create-payment"?this.openCreatePayment():e==="adjust-bonus"&&this.openAdjustBonusModal()}onInlineTagsChange(e){if(!this.client||!this.clientId)return;let i=[...this.client.tags];this.client.tags=e.tags,this.clientsService.updateClientTags(this.clientId,{tags:e.tags}).subscribe({next:()=>{if(e.removedTag){let t=e.removedTag;this.toastService.showWithAction("\u0422\u0435\u0433 \u0443\u0434\u0430\u043B\u0451\u043D",{label:"\u041E\u0442\u043C\u0435\u043D\u0430",callback:()=>{let l=[...this.client.tags,t];this.client.tags=l,this.clientsService.updateClientTags(this.clientId,{tags:l}).subscribe({next:()=>{},error:()=>this.toastService.error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C \u0442\u0435\u0433")})}},"success",4e3)}},error:t=>{this.client&&(this.client.tags=i),this.toastService.error(t?.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0442\u0435\u0433\u043E\u0432")}})}onBonusAdjusted(){this.loadClientData()}openDeleteModal(){this.showDeleteModal=!0,this.deleteStep=1,this.deleteConfirmationWord="",this.isDeletingClient=!1}closeDeleteModal(){this.showDeleteModal=!1,this.deleteStep=1,this.deleteConfirmationWord="",this.isDeletingClient=!1}proceedToDeleteStep2(){this.deleteStep=2}confirmDelete(){if(this.deleteConfirmationWord!=="\u0443\u0434\u0430\u043B\u0438\u0442\u044C"){this.toastService.error('\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043B\u043E\u0432\u043E "\u0443\u0434\u0430\u043B\u0438\u0442\u044C" \u0434\u043B\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F');return}this.isDeletingClient=!0,this.clientsService.deleteClient(this.clientId).subscribe({next:()=>{this.toastService.success("\u041A\u043B\u0438\u0435\u043D\u0442 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D"),this.closeDeleteModal(),this.router.navigate(["/clients"])},error:e=>{let i=e.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u043A\u043B\u0438\u0435\u043D\u0442\u0430";this.toastService.error(i),this.isDeletingClient=!1}})}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=D({type:o,selectors:[["app-profile-page"]],decls:9,vars:12,consts:[["paginatedBonuses",""],["paginatedTable",""],[1,"page-wrapper"],[1,"profile-container-wrapper"],["class","page-loading-container",4,"ngIf"],["title","\u041A\u043B\u0438\u0435\u043D\u0442 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D","description","\u041A \u0441\u043E\u0436\u0430\u043B\u0435\u043D\u0438\u044E, \u0437\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u043C\u044B\u0439 \u043A\u043B\u0438\u0435\u043D\u0442 \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0438\u043B\u0438 \u0431\u044B\u043B \u0443\u0434\u0430\u043B\u0435\u043D.","backLink","/clients","backText","\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u043A \u043A\u043B\u0438\u0435\u043D\u0442\u0430\u043C",4,"ngIf"],["class","profile-layout",4,"ngIf"],[3,"visibleChange","confirm","visible","payment"],[3,"visibleChange","bonusAdjusted","visible","clientId","bonusBalance"],[3,"visibleChange","paymentUpdated","visible","paymentTxId","paymentSearchResult"],["class","delete-modal-overlay",3,"click",4,"ngIf"],[1,"page-loading-container"],["type","logo","size","large",3,"visible","overlay"],["title","\u041A\u043B\u0438\u0435\u043D\u0442 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D","description","\u041A \u0441\u043E\u0436\u0430\u043B\u0435\u043D\u0438\u044E, \u0437\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u043C\u044B\u0439 \u043A\u043B\u0438\u0435\u043D\u0442 \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0438\u043B\u0438 \u0431\u044B\u043B \u0443\u0434\u0430\u043B\u0435\u043D.","backLink","/clients","backText","\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u043A \u043A\u043B\u0438\u0435\u043D\u0442\u0430\u043C"],[1,"profile-layout"],[1,"profile-sidebar"],[1,"back-link",3,"routerLink"],["viewBox","0 0 24 24","fill","none"],["d","M19 12H5M12 19l-7-7 7-7","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"client-type-badge-sidebar"],["viewBox","0 0 24 24","fill","none",4,"ngIf"],[1,"client-name-sidebar"],[1,"client-phone-sidebar"],[1,"tags-section-sidebar"],["label","\u0422\u0435\u0433\u0438",3,"tagsChange","tags","availableTags"],[1,"split-button-wrap"],["mainLabel","\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u043B\u0430\u0442\u0435\u0436",3,"mainClick","itemSelect","items"],["mainIcon","","viewBox","0 0 24 24","fill","none"],["d","M12 5v14M5 12h14","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"profile-nav","profile-nav-scroll"],["routerLinkActive","active",1,"nav-item",3,"routerLink"],["d","M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z","stroke","currentColor","stroke-width","1.5"],["d","M9 22V12h6v10","stroke","currentColor","stroke-width","1.5"],["d","M21 4H3a2 2 0 00-2 2v12a2 2 0 002 2h18a2 2 0 002-2V6a2 2 0 00-2-2z","stroke","currentColor","stroke-width","1.5"],["d","M1 10h22","stroke","currentColor","stroke-width","1.5"],[1,"nav-badge","nav-badge-soon"],["d","M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z","stroke","currentColor","stroke-width","1.5"],["d","M22 12h-4l-3 9L9 3l-3 9H2","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z","stroke","currentColor","stroke-width","1.5"],["d","M14 2v6h6M16 13H8M16 17H8M10 9H8","stroke","currentColor","stroke-width","1.5"],[1,"nav-item","delete-nav-item",3,"click"],["d","M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14zM10 11v6M14 11v6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"profile-content"],["class","view-content",4,"ngIf"],["d","M20 7H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z","stroke","currentColor","stroke-width","1.5"],["d","M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2","stroke","currentColor","stroke-width","1.5"],["d","M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2","stroke","currentColor","stroke-width","1.5"],["cx","12","cy","7","r","4","stroke","currentColor","stroke-width","1.5"],[1,"view-content"],[1,"content-card"],[1,"card-header"],[1,"card-title"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-icon","transactions"],["d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["x","9","y","3","width","6","height","4","rx","1","stroke","currentColor","stroke-width","1.5"],["d","M9 12h6M9 16h6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-icon","total-sum"],["d","M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"stat-icon","bonuses-earned"],["d","M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"stat-icon","bonuses-used"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","1.5"],["d","M8 12l3 3 5-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"details-grid","details-grid-general"],["class","card-edit-btn",3,"click",4,"ngIf"],["class","card-actions",4,"ngIf"],[1,"info-list"],[1,"info-row"],[1,"info-label"],["class","info-value",4,"ngIf"],["class","info-input",3,"ngModel","ngModelChange",4,"ngIf"],["class","info-row",4,"ngIf"],["class","info-input","type","date",3,"ngModel","ngModelChange",4,"ngIf"],["class","info-select",3,"ngModel","ngModelChange",4,"ngIf"],["class","info-input","type","tel",3,"ngModel","ngModelChange",4,"ngIf"],["class","info-value email",4,"ngIf"],["class","info-input","type","email","placeholder","Email \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D \u0434\u043B\u044F \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F",3,"ngModel","disabled","ngModelChange",4,"ngIf"],[1,"comment-body"],["class","comment-text",4,"ngIf"],["class","comment-textarea","placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043E \u043A\u043B\u0438\u0435\u043D\u0442\u0435...","rows","3",3,"ngModel","ngModelChange",4,"ngIf"],[1,"card-edit-btn",3,"click"],["d","M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"card-actions"],[1,"save-btn",3,"click","disabled"],[1,"cancel-btn",3,"click","disabled"],[1,"info-value"],[1,"info-input",3,"ngModelChange","ngModel"],["type","date",1,"info-input",3,"ngModelChange","ngModel"],[1,"info-select",3,"ngModelChange","ngModel"],["value","individual"],["value","business"],["type","tel",1,"info-input",3,"ngModelChange","ngModel"],[1,"info-value","email"],["type","email","placeholder","Email \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D \u0434\u043B\u044F \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F",1,"info-input",3,"ngModelChange","ngModel","disabled"],[1,"comment-text"],["placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043E \u043A\u043B\u0438\u0435\u043D\u0442\u0435...","rows","3",1,"comment-textarea",3,"ngModelChange","ngModel"],[1,"coming-soon-card"],[1,"content-card","bonuses-details-card"],[1,"card-header","bonuses-card-header"],[1,"card-header-left"],[1,"card-icon"],[1,"card-title-section"],[1,"bonuses-stats"],[1,"stat-item"],[1,"stat-value","active"],[1,"stat-value","used"],[1,"stat-value","expired"],[1,"bonuses-content"],["paginationKey","bonuses",3,"paginationEnabled","data","defaultPageSize"],["class","table-container",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"table-container"],[1,"bonuses-table"],[4,"ngFor","ngForOf"],[1,"bonus-type-badge"],[1,"bonus-info"],["badgeType","bonusUsed","size","medium","icon","check","class","bonus-badge",4,"ngIf"],["badgeType","refund","size","medium","icon","refund","class","bonus-badge",4,"ngIf"],["badgeType","bonusExpired","size","medium","icon","expired","class","bonus-badge",4,"ngIf"],["badgeType","bonusGranted","size","medium","icon","star","class","bonus-badge",4,"ngIf"],[1,"bonus-remaining-badges"],["class","bonus-empty-cell",4,"ngIf"],["badgeType","bonusUsed","size","medium","icon","used",4,"ngIf"],["badgeType","refund","size","medium","icon","refund",4,"ngIf"],["size","medium",3,"badgeType",4,"ngIf"],["badgeType","bonusExpired","size","medium","icon","expired",4,"ngIf"],[1,"bonus-date"],["class","bonus-expiry-cell",4,"ngIf"],[1,"actions-cell"],["iconButtonType","ghost","size","medium",1,"view-svg-btn",3,"onClick","tooltip"],["d","M6 9l6 6 6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["class","bonus-details-row",4,"ngIf"],["badgeType","bonusUsed","size","medium","icon","check",1,"bonus-badge"],["badgeType","refund","size","medium","icon","refund",1,"bonus-badge"],["badgeType","bonusExpired","size","medium","icon","expired",1,"bonus-badge"],["badgeType","bonusGranted","size","medium","icon","star",1,"bonus-badge"],[1,"bonus-empty-cell"],["badgeType","bonusUsed","size","medium","icon","used"],["badgeType","refund","size","medium","icon","refund"],["size","medium",3,"badgeType"],["badgeType","bonusExpired","size","medium","icon","expired"],[1,"bonus-expiry-cell"],[1,"bonus-expiry-date"],["size","medium","class","expires-in-badge",3,"badgeType",4,"ngIf"],["size","medium",1,"expires-in-badge",3,"badgeType"],[1,"bonus-details-row"],["colspan","6",1,"bonus-details-cell"],[1,"bonus-details-content"],[1,"bonus-details-grid"],[1,"refund-reason-section"],[1,"refund-reason-label"],["class","refund-reason-text",4,"ngIf"],["class","refund-reason-empty",4,"ngIf"],[1,"bonus-initiated-by-section"],["class","bonus-initiated-by-link",3,"routerLink",4,"ngIf"],["class","bonus-initiated-by-text",4,"ngIf"],["class","bonus-initiated-by-empty",4,"ngIf"],[1,"refund-reason-text"],[1,"refund-reason-empty"],[1,"bonus-initiated-by-link",3,"routerLink"],[1,"bonus-initiated-by-text"],[1,"bonus-initiated-by-empty"],[1,"empty-state"],[1,"content-card","payments-card"],[1,"payments-count"],["paginationKey","payments",3,"paginationEnabled","data","defaultPageSize"],[1,"payments-table"],[1,"th-id"],[1,"th-amount"],[1,"th-bonuses"],[1,"th-method"],[1,"th-status"],[1,"th-date"],[1,"th-actions"],["class","payment-row",4,"ngFor","ngForOf"],[1,"payment-row"],[1,"td-id"],[1,"payment-id","clickable",3,"click"],[1,"td-amount"],[1,"amount-value"],[1,"td-bonuses"],["class","bonus-none",4,"ngIf"],[1,"td-method"],["badgeType","paymentMethod","size","medium",3,"paymentMethod"],[1,"td-status"],["size","medium",3,"badgeType","icon"],[1,"td-date"],[1,"date-info"],[1,"date-text"],[1,"time-text"],[1,"td-actions"],["iconButtonType","refund","size","small","tooltip","\u0412\u043E\u0437\u0432\u0440\u0430\u0442",3,"onClick","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none"],["d","M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"bonus-none"],["d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2","stroke","currentColor","stroke-width","1.5"],[1,"delete-modal-overlay",3,"click"],[1,"delete-modal",3,"click"],["class","delete-modal-content",4,"ngIf"],[1,"delete-modal-content"],[1,"delete-modal-icon","warning"],["d","M12 9v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"delete-modal-title"],[1,"delete-modal-description"],[1,"delete-modal-actions"],[1,"delete-modal-btn","cancel",3,"click"],[1,"delete-modal-btn","confirm",3,"click"],[1,"delete-modal-icon","danger"],["d","M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14zM10 11v6M14 11v6","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"confirm-word"],["type","text","placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043B\u043E\u0432\u043E \u0434\u043B\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F",1,"delete-confirm-input",3,"ngModelChange","keydown.enter","ngModel"],[1,"delete-modal-btn","delete",3,"click","disabled"],[4,"ngIf"]],template:function(i,t){if(i&1&&(n(0,"div",2)(1,"div",3),b(2,ht,2,2,"div",4)(3,xt,1,0,"app-not-found-state",5)(4,yn,66,39,"div",6),a()(),n(5,"app-refund-confirmation-modal",7),g("visibleChange",function(){return t.closeRefundModal()})("confirm",function(f){return t.confirmRefund(f.refundReason||"")}),a(),n(6,"app-adjust-bonus-modal",8),g("visibleChange",function(f){return t.showAdjustBonusModal=f})("bonusAdjusted",function(){return t.onBonusAdjusted()}),a(),n(7,"app-payment-view-modal",9),g("visibleChange",function(f){return t.showPaymentViewModal=f})("paymentUpdated",function(){return t.onPaymentUpdated()}),a(),b(8,kn,4,2,"div",10)),i&2){let l;r(2),d("ngIf",t.isLoading),r(),d("ngIf",!t.isLoading&&t.clientNotFound),r(),d("ngIf",t.client&&!t.isLoading&&!t.clientNotFound),r(),d("visible",t.showRefundModal)("payment",t.selectedPaymentForRefund),r(),d("visible",t.showAdjustBonusModal)("clientId",(l=t.client==null?null:t.client.id)!==null&&l!==void 0?l:null)("bonusBalance",t.bonusBalance),r(),d("visible",t.showPaymentViewModal)("paymentTxId",t.selectedPaymentTxId)("paymentSearchResult",t.selectedPaymentSearchResult),r(),d("ngIf",t.showDeleteModal)}},dependencies:[A,j,N,G,we,Me,U,ye,H,W,Fe,ve,Re,Ce,he,xe,Ne,je,Ue,Le,We,$e,qe,De],styles:[`.page-wrapper[_ngcontent-%COMP%]{min-height:100%;margin:-2rem;padding:2rem;background:linear-gradient(180deg,#f0fdf4,#f8fafc 50% 100%)}.profile-container-wrapper[_ngcontent-%COMP%]{position:relative;min-height:400px}.profile-layout[_ngcontent-%COMP%]{display:flex;gap:2rem;max-width:1400px;margin:0 auto}.profile-sidebar[_ngcontent-%COMP%]{width:280px;flex-shrink:0;background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb;max-height:calc(100vh - 4rem);position:sticky;top:2rem;display:flex;flex-direction:column;z-index:20;isolation:isolate}.profile-nav-scroll[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column;gap:.5rem}.back-link[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#64748b;text-decoration:none;font-size:.9rem;margin-bottom:1.5rem;padding:.5rem;border-radius:8px;transition:all .2s}.back-link[_ngcontent-%COMP%]:hover{background:#f1f5f9;color:#1f2937}.back-link[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.client-type-badge-sidebar[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.4rem .75rem;background:#f0fdf4;color:#16a34a;border-radius:8px;font-size:.8rem;font-weight:600;margin-bottom:1rem}.client-type-badge-sidebar.business[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.client-type-badge-sidebar[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.client-name-sidebar[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1f2937;margin:0 0 .25rem;line-height:1.3}.client-phone-sidebar[_ngcontent-%COMP%]{font-size:.9rem;color:#64748b;margin:0 0 1rem;line-height:1.3}.tags-section-sidebar[_ngcontent-%COMP%]{margin-bottom:1.5rem}.tags-section-sidebar[_ngcontent-%COMP%]   .inline-tags[_ngcontent-%COMP%]{--tag-transition: .12s ease}.client-tag-sidebar[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.3rem .65rem;background:#dcfce7;color:#16a34a;border-radius:16px;font-size:.75rem;font-weight:500}.no-tags[_ngcontent-%COMP%]{color:#94a3b8;font-size:.85rem;font-style:italic}.split-button-wrap[_ngcontent-%COMP%]{margin-bottom:1.5rem}.profile-nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.profile-nav[_ngcontent-%COMP%]   a.nav-item[_ngcontent-%COMP%]{text-decoration:none;box-sizing:border-box}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:transparent;border:none;border-radius:10px;color:#64748b;font-size:.9rem;font-weight:500;cursor:pointer;transition:all .2s;text-align:left}.nav-item[_ngcontent-%COMP%]:hover{background:#f1f5f9;color:#1f2937}.nav-item.active[_ngcontent-%COMP%]{background:#f0fdf4;color:#16a34a;font-weight:600}.nav-item.delete-nav-item[_ngcontent-%COMP%]{color:#dc2626;margin-top:1rem;padding-top:1rem;border-top:1px solid #e5e7eb}.nav-item.delete-nav-item[_ngcontent-%COMP%]:hover{background:#fef2f2;color:#b91c1c}.nav-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;flex-shrink:0}.nav-badge[_ngcontent-%COMP%]{margin-left:auto;font-size:.7rem;font-weight:600;padding:.2rem .5rem;border-radius:6px}.nav-badge-soon[_ngcontent-%COMP%]{background:#fef08a;color:#854d0e}.profile-content[_ngcontent-%COMP%]{flex:1;min-width:0}.view-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.details-grid-general[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem}.content-card[_ngcontent-%COMP%]{position:relative;background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb}.coming-soon-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:4rem 2rem;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb;text-align:center;display:flex;flex-direction:column;align-items:center;gap:1rem}.coming-soon-card[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:64px;height:64px;color:#94a3b8}.coming-soon-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1f2937;margin:0}.coming-soon-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;color:#64748b;margin:0}@media (max-width: 1024px){.profile-layout[_ngcontent-%COMP%]{flex-direction:column;gap:1.5rem}.profile-sidebar[_ngcontent-%COMP%]{width:100%;position:static}}@media (max-width: 768px){.profile-sidebar[_ngcontent-%COMP%]{padding:1rem;max-height:none}.profile-nav-scroll[_ngcontent-%COMP%]{overflow:visible;max-height:none}.profile-nav[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;gap:.5rem}.nav-item[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:.85rem}.nav-item.delete-nav-item[_ngcontent-%COMP%]{width:100%;margin-top:.5rem;padding-top:.75rem}}.tags-container-content[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}.profile-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.page-loading-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:60vh;width:100%}.profile-header-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb;margin-bottom:1rem;position:relative}.profile-header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem;padding:1.5rem 2rem}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;flex-shrink:0}.avatar-large[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#16a34a,#22c55e);color:#fff;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:600;letter-spacing:1px}.status-indicator[_ngcontent-%COMP%]{position:absolute;bottom:2px;right:2px;width:14px;height:14px;border-radius:50%;background:#94a3b8;border:2px solid white}.status-indicator.active[_ngcontent-%COMP%]{background:#22c55e}.profile-main-info[_ngcontent-%COMP%]{flex:1;min-width:0;position:relative}.delete-client-btn[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:#fef2f2;border:1px solid #fecaca;width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#dc2626;transition:all .2s ease;z-index:10}.delete-client-btn[_ngcontent-%COMP%]:hover{background:#fee2e2;border-color:#fca5a5;color:#b91c1c}.delete-client-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.name-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.25rem}.profile-name[_ngcontent-%COMP%]{font-size:1.35rem;font-weight:600;color:#111827;margin:0}.client-type-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .6rem;background:#f0fdf4;color:#16a34a;border-radius:6px;font-size:.75rem;font-weight:500}.client-type-badge.business[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.client-type-badge[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.profile-phone[_ngcontent-%COMP%]{font-size:.9rem;color:#6b7280;margin:0 0 .75rem}.tags-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.tags-container[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center}.client-tag[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .75rem;background:#dcfce7;color:#16a34a;border-radius:20px;font-size:.8rem;font-weight:500}.remove-tag-btn[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;color:#16a34a;display:flex;align-items:center;justify-content:center;width:14px;height:14px;border-radius:50%;transition:all .15s}.remove-tag-btn[_ngcontent-%COMP%]:hover{background:#15803d33}.remove-tag-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:10px;height:10px}.add-tag-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.add-tag-input[_ngcontent-%COMP%]{padding:.35rem .75rem;border:1.5px solid #e2e8f0;border-radius:20px;font-size:.8rem;width:110px;outline:none;background:linear-gradient(to bottom,#fff,#f8fafc);color:#374151;font-weight:500;transition:all .2s ease;box-shadow:0 1px 2px #0000000a}.add-tag-input[_ngcontent-%COMP%]:hover{border-color:#cbd5e1}.add-tag-input[_ngcontent-%COMP%]:focus{border-color:#22c55e;background:#fff;box-shadow:0 0 0 3px #22c55e1a}.add-tag-input[_ngcontent-%COMP%]::placeholder{color:#94a3b8;font-weight:400}.add-tag-confirm-btn[_ngcontent-%COMP%]{background:#16a34a;border:none;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff}.add-tag-confirm-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:12px;height:12px}.edit-tags-btn[_ngcontent-%COMP%]{background:#f0fdf4;border:1px dashed #16A34A;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#16a34a;transition:all .15s}.edit-tags-btn[_ngcontent-%COMP%]:hover{background:#dcfce7}.edit-tags-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.tags-actions[_ngcontent-%COMP%]{display:flex;gap:.35rem}.save-tags-btn[_ngcontent-%COMP%], .cancel-tags-btn[_ngcontent-%COMP%]{background:none;border:none;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s}.save-tags-btn[_ngcontent-%COMP%]{background:#16a34a;color:#fff}.save-tags-btn[_ngcontent-%COMP%]:hover{background:#14532d}.cancel-tags-btn[_ngcontent-%COMP%]{background:#f3f4f6;color:#6b7280}.cancel-tags-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb}.save-tags-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%], .cancel-tags-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.tags-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:500px;margin-top:6px;background:#fff;border:1px solid #e2e8f0;border-radius:10px;box-shadow:0 4px 12px #0000001a;overflow:hidden;z-index:100;animation:_ngcontent-%COMP%_dropdownFadeIn .15s ease}@keyframes _ngcontent-%COMP%_dropdownFadeIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.tags-dropdown-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:6px 10px;background:#f8fafc;border-bottom:1px solid #e2e8f0;font-size:.7rem;font-weight:700;color:#64748b}.tags-dropdown-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1rem;color:#94a3b8;cursor:pointer;padding:0;line-height:1;width:18px;height:18px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .15s}.tags-dropdown-close[_ngcontent-%COMP%]:hover{color:#ef4444;background:#fef2f2}.tags-dropdown-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;padding:8px;max-height:80px;overflow-y:auto}.tag-option[_ngcontent-%COMP%]{padding:.25rem .6rem;background:#dcfce7;border:1px solid #bbf7d0;color:#16a34a;border-radius:16px;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .15s ease}.tag-option[_ngcontent-%COMP%]:hover{background:#bbf7d0;border-color:#22c55e}.tags-row[_ngcontent-%COMP%]{position:relative}.comment-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb;margin-bottom:1.5rem;padding:1.25rem 1.5rem}.comment-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem}.comment-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9rem;font-weight:600;color:#374151}.comment-title[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px;color:#16a34a}.edit-comment-btn[_ngcontent-%COMP%]{background:none;border:none;padding:.4rem;cursor:pointer;color:#6b7280;border-radius:6px;transition:all .15s}.edit-comment-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#16a34a}.edit-comment-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.comment-actions[_ngcontent-%COMP%], .card-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.save-btn[_ngcontent-%COMP%], .cancel-btn[_ngcontent-%COMP%]{padding:.4rem .75rem;border-radius:6px;font-size:.8rem;font-weight:500;cursor:pointer;border:none}.save-btn[_ngcontent-%COMP%]{background:#16a34a;color:#fff}.save-btn[_ngcontent-%COMP%]:hover{background:#14532d}.cancel-btn[_ngcontent-%COMP%]{background:#f3f4f6;color:#6b7280}.cancel-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb}.comment-text[_ngcontent-%COMP%]{font-size:.9rem;color:#4b5563;margin:0;line-height:1.5}.comment-textarea[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem;border:1.5px solid #e2e8f0;border-radius:12px;font-size:.9rem;font-family:inherit;resize:vertical;min-height:80px;background:linear-gradient(to bottom,#fff,#f8fafc);color:#374151;line-height:1.6;transition:all .2s ease;box-shadow:0 1px 2px #0000000a}.comment-textarea[_ngcontent-%COMP%]:hover{border-color:#cbd5e1;background:linear-gradient(to bottom,#fff,#f1f5f9)}.comment-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#22c55e;background:#fff;box-shadow:0 0 0 4px #22c55e1f,0 2px 4px #0000000d}.comment-textarea[_ngcontent-%COMP%]::placeholder{color:#94a3b8}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.25rem;display:flex;align-items:center;gap:1rem;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb}.stat-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center}.stat-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:22px;height:22px}.stat-icon.transactions[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dcfce7,#bbf7d0);color:#16a34a}.stat-icon.total-sum[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dbeafe,#bfdbfe);color:#1d4ed8}.stat-icon.bonuses-earned[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fde68a);color:#d97706}.stat-icon.bonuses-used[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fce7f3,#fbcfe8);color:#db2777}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#1f2937}.stat-label[_ngcontent-%COMP%]{font-size:.8rem;color:#64748b}.bonuses-details-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb}.bonuses-details-card[_ngcontent-%COMP%]   .bonuses-card-header[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid #f1f5f9}.bonuses-details-card[_ngcontent-%COMP%]   .bonuses-card-header[_ngcontent-%COMP%]   .card-header-left[_ngcontent-%COMP%]{flex:1}.bonuses-content[_ngcontent-%COMP%]{padding:0}.card-title-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;flex:1}.bonuses-stats[_ngcontent-%COMP%]{display:flex;gap:1.5rem;flex-wrap:wrap}.stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.stat-label[_ngcontent-%COMP%]{font-size:.8125rem;color:#64748b;font-weight:500}.stat-value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:700}.collapse-btn[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem;cursor:pointer;color:#64748b;border-radius:8px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.collapse-btn[_ngcontent-%COMP%]:hover{background:#f1f5f9;color:#1f2937}.collapse-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;transition:transform .2s ease}.collapse-btn.collapsed[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:rotate(-90deg)}.bonuses-content[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{overflow-x:auto}.bonuses-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.bonuses-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#f8fafc}.bonuses-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.875rem 1rem;text-align:left;font-size:.75rem;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid #e5e7eb}.bonuses-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.875rem 1rem;border-bottom:1px solid #f1f5f9}.bonuses-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child, .bonuses-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{width:80px;text-align:center}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background .15s}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8fafc}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.expired[_ngcontent-%COMP%], .bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.expired[_ngcontent-%COMP%]:hover, .bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.expiring-soon[_ngcontent-%COMP%], .bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.expiring-soon[_ngcontent-%COMP%]:hover{background:transparent}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.used[_ngcontent-%COMP%]{background:transparent;opacity:1}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.refund[_ngcontent-%COMP%], .bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.refund[_ngcontent-%COMP%]:hover, .bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.manual-revoke[_ngcontent-%COMP%], .bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.manual-revoke[_ngcontent-%COMP%]:hover{background:transparent}.manual-revoke-audit[_ngcontent-%COMP%], .remaining-amount[_ngcontent-%COMP%]{font-size:.875rem;color:#475569}.bonus-expiry-cell[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.375rem;align-items:flex-start}.bonus-expiry-cell[_ngcontent-%COMP%]   .expires-in-badge[_ngcontent-%COMP%]{flex-shrink:0}.bonus-empty-cell[_ngcontent-%COMP%]{color:#94a3b8}.bonus-remaining-badges[_ngcontent-%COMP%]{display:flex;align-items:center}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.bonus-details-row[_ngcontent-%COMP%]{background:transparent}.bonuses-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.bonus-details-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:none;padding:0}.bonus-details-cell[_ngcontent-%COMP%]{padding:0!important;background:transparent}.bonus-details-content[_ngcontent-%COMP%]{padding:1rem 1.5rem;overflow:hidden;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;max-height:0}to{opacity:1;max-height:300px}}.bonus-details-grid[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:2rem}.refund-reason-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.5rem;text-align:left}.bonus-initiated-by-section[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-direction:column;gap:.5rem;text-align:right;min-width:200px}.refund-reason-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#475569}.refund-reason-text[_ngcontent-%COMP%]{padding:.75rem;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#1f2937;line-height:1.6;white-space:pre-wrap;text-align:left}.refund-reason-empty[_ngcontent-%COMP%]{padding:.75rem;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#94a3b8;font-style:italic;text-align:left}.bonus-initiated-by-link[_ngcontent-%COMP%]{display:inline-block;padding:.75rem 0;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#1f2937;line-height:1.6;white-space:pre-wrap;text-align:right;text-decoration:none;cursor:pointer;transition:color .2s ease}.bonus-initiated-by-link[_ngcontent-%COMP%]:hover{color:#16a34a}.bonus-initiated-by-text[_ngcontent-%COMP%]{padding:.75rem 0;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#1f2937;line-height:1.6;white-space:pre-wrap;text-align:right}.bonus-initiated-by-empty[_ngcontent-%COMP%]{padding:.75rem 0;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#94a3b8;font-style:italic;text-align:right}.actions-cell[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transition:transform .3s ease}.actions-cell[_ngcontent-%COMP%]   svg.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.bonus-type-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-size:.875rem;font-weight:600;color:#1f2937}.bonus-type-badge.bonus-type-welcome[_ngcontent-%COMP%]{// color: #1e40af;color:#1f2937}.bonus-type-badge.bonus-type-referral[_ngcontent-%COMP%]{// color: #92400e;color:#1f2937}.bonus-type-badge.bonus-type-purchase[_ngcontent-%COMP%]{// color: #15803d;color:#1f2937}.bonus-type-badge.bonus-type-promotion[_ngcontent-%COMP%]{// color: #be185d;color:#1f2937}.bonus-type-badge.bonus-type-loyalty[_ngcontent-%COMP%]{// color: #3730a3;color:#1f2937}.bonus-type-badge.bonus-type-refund[_ngcontent-%COMP%]{// color: #dc2626;color:#1f2937}.bonus-amount[_ngcontent-%COMP%]{font-size:.9375rem;font-weight:600;color:#fbbf24;display:flex;align-items:center;gap:.5rem}.bonus-amount.expired-amount[_ngcontent-%COMP%]{color:#94a3b8;text-decoration:line-through}.bonus-date[_ngcontent-%COMP%], .bonus-expiry-date[_ngcontent-%COMP%]{font-size:.875rem;color:#1f2937;font-weight:500}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:1rem}.details-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb}.card-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.25rem;padding-bottom:1rem;border-bottom:1px solid #f1f5f9}.card-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.card-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#dcfce7,#bbf7d0);display:flex;align-items:center;justify-content:center;color:#16a34a}.card-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.card-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#1f2937;margin:0}.card-edit-btn[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem;cursor:pointer;color:#6b7280;border-radius:8px;transition:all .15s}.card-edit-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#16a34a}.card-edit-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.info-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.875rem}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.info-label[_ngcontent-%COMP%]{font-size:.9rem;color:#64748b}.info-value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500;color:#1f2937}.info-value.email[_ngcontent-%COMP%]{color:#16a34a}.info-input[_ngcontent-%COMP%]{padding:.625rem 1rem;border:1.5px solid #e2e8f0;border-radius:10px;font-size:.9rem;font-family:inherit;text-align:right;width:200px;background:linear-gradient(to bottom,#fff,#f8fafc);color:#1f2937;font-weight:500;transition:all .2s ease;box-shadow:0 1px 2px #0000000a}.info-input[_ngcontent-%COMP%]:hover{border-color:#cbd5e1;background:linear-gradient(to bottom,#fff,#f1f5f9)}.info-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#22c55e;background:#fff;box-shadow:0 0 0 4px #22c55e1f,0 2px 4px #0000000d}.info-input[_ngcontent-%COMP%]::placeholder{color:#94a3b8;font-weight:400}.info-input[_ngcontent-%COMP%]:disabled{background:#f1f5f9;color:#94a3b8;cursor:not-allowed;opacity:.6}.info-input[_ngcontent-%COMP%]:disabled:hover{border-color:#e2e8f0;background:#f1f5f9}.info-select[_ngcontent-%COMP%]{padding:.625rem 2.5rem .625rem 1rem;border:1.5px solid #e2e8f0;border-radius:10px;font-size:.9rem;font-family:inherit;width:200px;background:linear-gradient(to bottom,#fff,#f8fafc);color:#1f2937;font-weight:500;transition:all .2s ease;box-shadow:0 1px 2px #0000000a;cursor:pointer;appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2315803d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .75rem center;background-size:16px}.info-select[_ngcontent-%COMP%]:hover{border-color:#22c55e;background-color:#f0fdf4;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2315803d' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E")}.info-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#22c55e;background-color:#fff;box-shadow:0 0 0 4px #22c55e1f,0 2px 4px #0000000d}.info-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#fff;color:#1f2937;font-weight:500}.info-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:hover, .info-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:checked{background:linear-gradient(to right,#f0fdf4,#dcfce7);color:#16a34a}.payments-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 1px 3px #0000001a;border:1px solid #e5e7eb}.payments-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{margin-bottom:1rem}.payments-count[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b;font-weight:500}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.payments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.payments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.875rem 1rem;text-align:left;font-size:.75rem;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.5px;background:#f8fafc;border-bottom:1px solid #e5e7eb}.payments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.875rem 1rem;border-bottom:1px solid #f1f5f9}.payment-row[_ngcontent-%COMP%]{transition:background .15s}.payment-row[_ngcontent-%COMP%]:hover{background:#f8fafc}.payment-row[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.td-id[_ngcontent-%COMP%]{min-width:100px}.payment-id[_ngcontent-%COMP%]{font-family:monospace;font-weight:600;color:#64748b;font-size:.875rem}.payment-id.clickable[_ngcontent-%COMP%]{cursor:pointer;text-decoration:underline;transition:color .15s ease}.payment-id.clickable[_ngcontent-%COMP%]:hover{color:#475569}.td-client[_ngcontent-%COMP%]{min-width:200px}.client-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.client-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);display:flex;align-items:center;justify-content:center;font-weight:600;color:#16a34a;font-size:.875rem;flex-shrink:0}.client-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.client-name-link[_ngcontent-%COMP%]{text-decoration:none;color:#1f2937;font-weight:600;font-size:.9375rem;transition:color .2s;cursor:pointer;display:inline-block}.client-name-link[_ngcontent-%COMP%]:hover{color:#16a34a}.client-phone[_ngcontent-%COMP%]{font-size:.8125rem;color:#64748b}.amount-value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;color:#16a34a}.bonus-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.bonus-badge[_ngcontent-%COMP%]{display:inline-block}.bonus-none[_ngcontent-%COMP%]{font-size:.8rem;color:#94a3b8}.date-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.15rem}.date-text[_ngcontent-%COMP%]{font-size:.85rem;color:#1f2937;font-weight:500}.time-text[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b}.th-actions[_ngcontent-%COMP%], .td-actions[_ngcontent-%COMP%]{width:60px;text-align:center}.actions-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 2rem;color:#94a3b8}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:48px;height:48px;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem}@media (max-width: 1200px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 768px){.page-wrapper[_ngcontent-%COMP%]{margin:-1rem;padding:1rem}.profile-header-card[_ngcontent-%COMP%]{border-radius:12px;margin-bottom:1rem}.profile-header-content[_ngcontent-%COMP%]{flex-direction:column;align-items:center;text-align:center;padding:1.5rem 1rem;position:relative}.avatar-wrapper[_ngcontent-%COMP%]{margin-bottom:.5rem}.avatar-large[_ngcontent-%COMP%]{width:80px;height:80px;font-size:1.5rem}.profile-main-info[_ngcontent-%COMP%]{width:100%;padding-right:0;padding-top:.5rem}.delete-client-btn[_ngcontent-%COMP%]{top:1rem;right:1rem}.name-row[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:.5rem;padding-right:0;margin-top:.5rem}.profile-name[_ngcontent-%COMP%]{font-size:1.25rem;word-break:break-word;padding-right:0}.profile-phone[_ngcontent-%COMP%]{font-size:.9rem;margin:.5rem 0}.tags-row[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:.75rem}.tags-container[_ngcontent-%COMP%]{justify-content:center;width:100%}.comment-card[_ngcontent-%COMP%], .details-card[_ngcontent-%COMP%]{border-radius:12px;padding:1.25rem 1rem}.card-header[_ngcontent-%COMP%]{margin-bottom:1rem}.card-title[_ngcontent-%COMP%]{font-size:1.125rem}.info-list[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem;padding:.75rem 0}.info-label[_ngcontent-%COMP%]{min-width:auto;font-size:.875rem}.info-value[_ngcontent-%COMP%]{font-size:.875rem}.stats-grid[_ngcontent-%COMP%], .details-grid[_ngcontent-%COMP%], .details-grid-general[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.bonuses-table[_ngcontent-%COMP%], .payments-table[_ngcontent-%COMP%]{display:none}.mobile-bonuses-cards[_ngcontent-%COMP%], .mobile-payments-cards[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}}@media (min-width: 769px){.mobile-bonuses-cards[_ngcontent-%COMP%], .mobile-payments-cards[_ngcontent-%COMP%]{display:none}}.mobile-bonuses-cards[_ngcontent-%COMP%]{display:none;flex-direction:column;gap:.75rem;width:100%}.mobile-bonus-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1rem;box-shadow:0 1px 2px #0000000d;width:100%}.mobile-bonus-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;cursor:pointer}.mobile-bonus-card-main[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;flex:1}.mobile-bonus-type[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#1f2937}.mobile-bonus-amount[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#d97706}.mobile-bonus-expand[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;color:#64748b;transition:transform .2s}.mobile-bonus-expand.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.mobile-bonus-details[_ngcontent-%COMP%]{margin-top:.75rem;padding-top:.75rem;border-top:1px solid #e5e7eb;display:none}.mobile-bonus-details.expanded[_ngcontent-%COMP%]{display:block}.mobile-bonus-detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem;font-size:.875rem}.mobile-bonus-detail-label[_ngcontent-%COMP%]{color:#64748b}.mobile-bonus-detail-value[_ngcontent-%COMP%]{color:#1f2937;font-weight:500}.mobile-payment-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1rem;box-shadow:0 1px 2px #0000000d}.mobile-payment-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;cursor:pointer}.mobile-payment-card-main[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;flex:1}.mobile-payment-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.875rem;font-weight:600;color:#64748b}.mobile-payment-amount[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#16a34a}.mobile-payment-expand[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;color:#64748b;transition:transform .2s}.mobile-payment-expand.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.mobile-payment-details[_ngcontent-%COMP%]{margin-top:.75rem;padding-top:.75rem;border-top:1px solid #e5e7eb;display:none}.mobile-payment-details.expanded[_ngcontent-%COMP%]{display:block}.mobile-payment-detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem;font-size:.875rem}.mobile-payment-detail-label[_ngcontent-%COMP%]{color:#64748b}.mobile-payment-detail-value[_ngcontent-%COMP%]{color:#1f2937;font-weight:500}.mobile-refund-btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#fef2f2;border:1px solid #fecaca;border-radius:8px;color:#dc2626;font-weight:600;font-size:.875rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.5rem;margin-top:.5rem;transition:all .2s}.mobile-refund-btn[_ngcontent-%COMP%]:hover{background:#fee2e2;border-color:#fca5a5}.mobile-refund-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.delete-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .2s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.delete-modal[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 20px 60px #0003;max-width:420px;width:90%;animation:_ngcontent-%COMP%_slideUp .3s ease}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.delete-modal-content[_ngcontent-%COMP%]{padding:2rem;display:flex;flex-direction:column;align-items:center;text-align:center}.delete-modal-icon[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:1.25rem}.delete-modal-icon.warning[_ngcontent-%COMP%]{background:#fef3c7;color:#d97706}.delete-modal-icon.danger[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.delete-modal-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:32px;height:32px}.delete-modal-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#1f2937;margin:0 0 .75rem}.delete-modal-description[_ngcontent-%COMP%]{font-size:.9rem;color:#6b7280;line-height:1.6;margin:0 0 1.5rem}.delete-modal-description[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1f2937}.confirm-word[_ngcontent-%COMP%]{color:#dc2626;background:#fee2e2;padding:.125rem .5rem;border-radius:4px;font-family:monospace;font-size:.95rem}.delete-confirm-input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem;border:2px solid #e5e7eb;border-radius:10px;font-size:1rem;font-family:inherit;text-align:center;margin-bottom:1.5rem;transition:all .2s ease}.delete-confirm-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#dc2626;box-shadow:0 0 0 3px #dc26261a}.delete-confirm-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.delete-modal-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;width:100%}.delete-modal-btn[_ngcontent-%COMP%]{flex:1;padding:.875rem 1.5rem;border-radius:10px;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s ease;border:none}.delete-modal-btn.cancel[_ngcontent-%COMP%]{background:#f3f4f6;color:#6b7280}.delete-modal-btn.cancel[_ngcontent-%COMP%]:hover{background:#e5e7eb;color:#374151}.delete-modal-btn.confirm[_ngcontent-%COMP%]{background:#fef3c7;color:#d97706}.delete-modal-btn.confirm[_ngcontent-%COMP%]:hover{background:#fde68a;color:#b45309}.delete-modal-btn.delete[_ngcontent-%COMP%]{background:#dc2626;color:#fff}.delete-modal-btn.delete[_ngcontent-%COMP%]:hover:not(:disabled){background:#b91c1c}.delete-modal-btn.delete[_ngcontent-%COMP%]:disabled{background:#fca5a5;cursor:not-allowed}`]})}return o})();export{Si as ProfilePageComponent};
