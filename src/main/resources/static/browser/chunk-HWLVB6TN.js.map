{
  "version": 3,
  "sources": ["src/app/core/services/analytics.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { environment } from '../../../environments/environment';\n\nexport interface MonthlyRevenueResponse {\n  amount: number;\n  changePercentage?: number;\n  period?: string;\n  // Fallback for backward compatibility\n  revenue?: number;\n  changePercent?: number;\n}\n\nexport interface DailyRevenueResponse {\n  amount: number;\n  changePercentage?: number;\n  period?: string;\n  date?: string;\n  // Fallback for backward compatibility\n  revenue?: number;\n  changePercent?: number;\n}\n\nexport interface AverageCheckResponse {\n  amount: number;\n  changePercentage?: number;\n  period?: string;\n  // Fallback for backward compatibility\n  averageCheck?: number;\n  changePercent?: number;\n}\n\nexport interface OverallTotalsResponse {\n  totalPayments: number;\n  totalRevenue: number;\n  totalBonusesGranted: number;\n  totalClients: number;\n}\n\nexport interface DailyTransactionsResponse {\n  count: number;\n  changeAbsolute?: number;\n  date?: string;\n}\n\nexport interface NewClientsResponse {\n  count: number;\n  changeAbsolute: number;\n  type: 'NEW';\n  period: 'DAILY' | 'MONTHLY';\n}\n\nexport interface BonusesAccruedResponse {\n  amount: number;\n  changePercentage?: number;\n  period?: string;\n  // Fallback for backward compatibility\n  count?: number;\n  changePercent?: number;\n}\n\nexport interface DailyRefundsResponse {\n  count: number;\n  changeAbsolute?: number;\n  date?: string;\n}\n\nexport interface ActiveClientsResponse {\n  count: number;\n  changeAbsolute?: number;\n  period?: string;\n}\n\nexport interface ChartDataPoint {\n  day: number;\n  revenue: number;\n  transactionCount: number;\n  bonusesGranted: number;\n  bonusesUsed: number;\n  // Fallback fields for backward compatibility\n  transactions?: number;\n  bonusEarned?: number;\n  bonusUsed?: number;\n}\n\nexport interface MonthlyRevenueChartResponse {\n  dailyData: ChartDataPoint[];\n  year: number;\n  month: number;\n  // Fallback for backward compatibility\n  data?: ChartDataPoint[];\n}\n\nexport interface ClientTotalsResponse {\n  totalPayments: number;\n  totalRevenue: number;\n  totalBonusesGranted: number;\n  totalBonusesUsed: number;\n}\n\n/** KPI Dashboard (kpi-analytics) */\nexport interface KpiDashboardResponse {\n  period: { from: string; to: string };\n  revenue: {\n    totalRevenue: number;\n    incrementalRevenue: number;\n    incrementalRevenuePercentage: number;\n  };\n  uplift: {\n    aovUplift: number;\n    avgCheckWithBonus: number;\n    avgCheckRegular: number;\n  };\n  retention: {\n    retentionRate: number;\n    returningClientsCount: number;\n    totalActiveClients: number;\n  };\n  efficiency: {\n    redemptionRate: number;\n    effectiveDiscount: number;\n    burnRate: number;\n    burnedAmount: number;\n  };\n}\n\nexport interface TopCustomerResponse {\n  id: number;\n  clientId: string;\n  name: string;\n  totalSpent: number;\n  paymentsCount: number;\n  averageOrderValue: number;\n}\n\nexport interface BonusesInCirculationResponse {\n  amount: number;\n}\n\nexport interface SalesByLoyaltyResponse {\n  loyaltyCount: number;\n  nonLoyaltyCount: number;\n  loyaltyPercent: number;\n  nonLoyaltyPercent: number;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AnalyticsService {\n  private readonly apiUrl = `${environment.apiUrl}/analytics`;\n  private readonly kpiApiUrl = `${environment.apiUrl}/kpi-analytics`;\n\n  constructor(private http: HttpClient) {}\n\n  /**\n   * Get monthly revenue\n   * @returns Observable with monthly revenue data\n   */\n  getMonthlyRevenue(): Observable<MonthlyRevenueResponse> {\n    return this.http.get<MonthlyRevenueResponse>(`${this.apiUrl}/revenue/monthly`);\n  }\n\n  /**\n   * Get daily revenue\n   * @returns Observable with daily revenue data\n   */\n  getDailyRevenue(): Observable<DailyRevenueResponse> {\n    return this.http.get<DailyRevenueResponse>(`${this.apiUrl}/revenue/daily`);\n  }\n\n  /**\n   * Get average check for a specific period\n   * @param period - Period type: 'DAILY' or 'MONTHLY'\n   * @returns Observable with average check data\n   */\n  getAverageCheck(period: 'DAILY' | 'MONTHLY' = 'MONTHLY'): Observable<AverageCheckResponse> {\n    const params = new HttpParams().set('period', period);\n    return this.http.get<AverageCheckResponse>(`${this.apiUrl}/average-check`, { params });\n  }\n\n  /**\n   * Get overall totals (total payments, total revenue, total bonuses granted)\n   * @returns Observable with overall totals data\n   */\n  getOverallTotals(): Observable<OverallTotalsResponse> {\n    return this.http.get<OverallTotalsResponse>(`${this.apiUrl}/totals/overall`);\n  }\n\n  /**\n   * Get daily transaction count\n   * @returns Observable with daily transactions data\n   */\n  getDailyTransactions(): Observable<DailyTransactionsResponse> {\n    return this.http.get<DailyTransactionsResponse>(`${this.apiUrl}/transactions/daily`);\n  }\n\n  /**\n   * Get new clients count\n   * @param period - Period type: 'DAILY' or 'MONTHLY'\n   * @returns Observable with new clients data\n   */\n  getNewClients(period: 'DAILY' | 'MONTHLY' = 'DAILY'): Observable<NewClientsResponse> {\n    const params = new HttpParams().set('period', period);\n    return this.http.get<NewClientsResponse>(`${this.apiUrl}/clients/new/daily`, { params });\n  }\n\n  /**\n   * Get bonuses accrued\n   * @param period - Period type: 'DAILY' or 'MONTHLY'\n   * @returns Observable with bonuses accrued data\n   */\n  getBonusesAccrued(period: 'DAILY' | 'MONTHLY' = 'MONTHLY'): Observable<BonusesAccruedResponse> {\n    const params = new HttpParams().set('period', period);\n    return this.http.get<BonusesAccruedResponse>(`${this.apiUrl}/bonuses/accrued`, { params });\n  }\n\n  /**\n   * Get daily refunds count\n   * @returns Observable with daily refunds data\n   */\n  getDailyRefunds(): Observable<DailyRefundsResponse> {\n    return this.http.get<DailyRefundsResponse>(`${this.apiUrl}/refunds/daily`);\n  }\n\n  /**\n   * Get active clients count\n   * @returns Observable with active clients data\n   */\n  getActiveClients(): Observable<ActiveClientsResponse> {\n    return this.http.get<ActiveClientsResponse>(`${this.apiUrl}/clients/active`);\n  }\n\n  /**\n   * Get monthly revenue chart data\n   * @param year - Year (optional, defaults to current year)\n   * @param month - Month 1-12 (optional, defaults to current month)\n   * @returns Observable with chart data\n   */\n  getMonthlyRevenueChart(year?: number, month?: number): Observable<MonthlyRevenueChartResponse> {\n    const now = new Date();\n    const currentYear = year ?? now.getFullYear();\n    const currentMonth = month ?? now.getMonth() + 1;\n    \n    const params = new HttpParams()\n      .set('year', currentYear.toString())\n      .set('month', currentMonth.toString());\n    \n    return this.http.get<MonthlyRevenueChartResponse>(`${this.apiUrl}/revenue/monthly/chart`, { params });\n  }\n  /**\n   * Get client totals for dashboard\n   * @param clientId - Client ID\n   * @returns Observable with client totals data\n  */\n  getClientTotals(clientId: string): Observable<ClientTotalsResponse> {\n    return this.http.get<ClientTotalsResponse>(`${this.apiUrl}/clients/${clientId}/totals`);\n  }\n\n  /**\n   * Get KPI dashboard metrics for period [from, to] (ISO-8601).\n   */\n  getKpiDashboard(from: string, to: string): Observable<KpiDashboardResponse> {\n    const params = new HttpParams().set('from', from).set('to', to);\n    return this.http.get<KpiDashboardResponse>(`${this.kpiApiUrl}/dashboard-metrics`, { params });\n  }\n\n  /**\n   * Get top 10 customers by total spent.\n   */\n  getTopCustomers(): Observable<TopCustomerResponse[]> {\n    return this.http.get<TopCustomerResponse[]>(`${this.apiUrl}/top-customers`);\n  }\n\n  /**\n   * Get total bonuses in circulation (active, usable by clients).\n   */\n  getBonusesInCirculation(): Observable<BonusesInCirculationResponse> {\n    return this.http.get<BonusesInCirculationResponse>(`${this.apiUrl}/bonuses/in-circulation`);\n  }\n\n  /**\n   * Get all-time sales split: loyalty (bonus used) vs non-loyalty.\n   */\n  getSalesByLoyalty(): Observable<SalesByLoyaltyResponse> {\n    return this.http.get<SalesByLoyaltyResponse>(`${this.apiUrl}/bonuses/sales-by-loyalty`);\n  }\n\n  /**\n   * Get KPI report for a bonus type (or all when bonusTypeId is null) in period [from, to] (ISO-8601).\n   */\n  getBonusTypeReport(bonusTypeId: number | null, from: string, to: string): Observable<BonusTypeReportResponse> {\n    let params = new HttpParams().set('from', from).set('to', to);\n    if (bonusTypeId != null) {\n      params = params.set('bonusTypeId', bonusTypeId.toString());\n    }\n    return this.http.get<BonusTypeReportResponse>(`${this.apiUrl}/bonus-type-report`, { params });\n  }\n}\n\nexport interface MonthlyReportPoint {\n  month: string;\n  yearMonth: string;\n  avgCheckWithBonus: number;\n  avgCheckWithoutBonus: number;\n  transactionCountWithBonus: number;\n  transactionCountWithoutBonus: number;\n  /** Total revenue for the month (optional for backward compatibility). */\n  revenue?: number;\n}\n\nexport interface BonusTypeReportResponse {\n  bonusTypeId: number | null;\n  bonusTypeName: string;\n  periodFrom: string;\n  periodTo: string;\n  transactionCount: number;\n  transactionCountWithoutBonus: number;\n  avgCheckWithBonus: number;\n  avgCheckWithoutBonus: number;\n  totalGranted: number;\n  inCirculation: number;\n  burnedAmount: number;\n  spentAmount: number;\n  redemptionRatePercent: number;\n  effectiveDiscountPercent: number;\n  burnRatePercent: number;\n  aovUpliftPercent: number;\n  incrementalRevenuePercent: number;\n  retentionRatePercent: number;\n  conversionRatePercent: number;\n  cac: number;\n  monthlyData: MonthlyReportPoint[] | null;\n}\n"],
  "mappings": "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",
  "names": []
}
