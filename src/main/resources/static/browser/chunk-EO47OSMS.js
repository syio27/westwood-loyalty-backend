import{a as me}from"./chunk-HWRKGI32.js";import{a as ge}from"./chunk-5QV5TA3C.js";import{a as pe}from"./chunk-7HAO4Z2V.js";import{a as se}from"./chunk-D64DWGP3.js";import{a as le}from"./chunk-KZHT6NUY.js";import{a as ue}from"./chunk-AYIUFZBC.js";import"./chunk-APN53XTZ.js";import{a as de}from"./chunk-KHO44KZO.js";import"./chunk-3B24VZJ2.js";import{a as ae}from"./chunk-TMJHU5AU.js";import{v as ce}from"./chunk-2HM6BEQO.js";import{n as oe}from"./chunk-KOV5UQCB.js";import{a as re}from"./chunk-PQPVKKOU.js";import{$ as E,Aa as n,Ba as h,Ca as Y,Da as W,Db as ie,Fa as X,Ga as I,Ha as v,K as w,Oa as s,Pa as k,Qa as x,Ra as q,S,Y as $,Ya as N,Z as z,_ as b,bb as K,hb as J,ib as Z,jb as Q,k as P,ka as r,kb as ee,ma as V,na as G,ob as te,q as U,ra as M,t as y,ua as L,va as d,wa as D,xa as R,ya as j,za as t,zb as ne}from"./chunk-7F5AWDR7.js";var he=a=>["/clients",a];function ve(a,u){a&1&&(b(),t(0,"g"),h(1,"path",57),n())}function be(a,u){a&1&&(b(),t(0,"g"),h(1,"path",58),n())}function _e(a,u){a&1&&(b(),t(0,"g"),h(1,"path",59)(2,"circle",60)(3,"path",61),n())}function xe(a,u){a&1&&(b(),t(0,"g"),h(1,"path",62)(2,"rect",63)(3,"path",64),n())}function Ce(a,u){a&1&&(b(),t(0,"g",65),h(1,"path",66),n())}function ye(a,u){a&1&&(b(),t(0,"g"),h(1,"path",57)(2,"circle",67),n())}function Me(a,u){a&1&&(b(),t(0,"g"),h(1,"rect",68)(2,"path",69),n())}function Pe(a,u){a&1&&(b(),t(0,"g"),h(1,"rect",68)(2,"path",69)(3,"path",70),n())}function we(a,u){if(a&1&&(t(0,"span",71),s(1),n()),a&2){let e=v().$implicit;R("positive",e.changeType==="positive")("negative",e.changeType==="negative"),r(),x(" ",e.change," ")}}function ke(a,u){if(a&1&&(t(0,"div",48)(1,"div",49)(2,"div",50),b(),t(3,"svg",51),M(4,ve,2,0,"g",52)(5,be,2,0,"g",52)(6,_e,4,0,"g",52)(7,xe,4,0,"g",52)(8,Ce,2,0,"g",53)(9,ye,3,0,"g",52)(10,Me,3,0,"g",52)(11,Pe,4,0,"g",52),n()(),M(12,we,2,5,"span",54),n(),E(),t(13,"div",55),s(14),n(),t(15,"div",56),s(16),n()()),a&2){let e=u.$implicit;r(2),D("background",e.iconBg),r(),d("ngSwitch",e.iconId),r(),d("ngSwitchCase","revenue"),r(),d("ngSwitchCase","bonus"),r(),d("ngSwitchCase","clients"),r(),d("ngSwitchCase","transactions"),r(),d("ngSwitchCase","refunds"),r(),d("ngSwitchCase","average"),r(),d("ngSwitchCase","today"),r(),d("ngSwitchCase","month"),r(),d("ngIf",e.change),r(2),k(e.value),r(2),k(e.label)}}function Se(a,u){if(a&1&&(t(0,"div",77)(1,"span",78),s(2,"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E:"),n(),t(3,"span",83),s(4),n()()),a&2){let e=v().$implicit,i=v();r(4),x("-",i.formatAmount(e.bonusUsed),"")}}function Oe(a,u){if(a&1&&(t(0,"div",72),h(1,"div",73),t(2,"div",74)(3,"div",75),s(4),n(),t(5,"div",76)(6,"div",77)(7,"span",78),s(8,"\u0412\u044B\u0440\u0443\u0447\u043A\u0430:"),n(),t(9,"span",79),s(10),n()(),t(11,"div",77)(12,"span",78),s(13,"\u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439:"),n(),t(14,"span",80),s(15),n()(),t(16,"div",77)(17,"span",78),s(18,"\u041D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E:"),n(),t(19,"span",81),s(20),n()(),M(21,Se,5,1,"div",82),n()()()),a&2){let e=u.$implicit,i=u.last,o=v();D("left",e.x/600*100,"%")("top",e.y/300*100,"%"),r(),R("last-point",i),r(3),q("",e.day," ",o.getMonthName(),""),r(6),x("",o.formatAmount(e.revenue)," \u20B8"),r(5),k(e.transactions),r(5),x("+",o.formatAmount(e.bonusEarned),""),r(),d("ngIf",e.bonusUsed>0)}}function Ee(a,u){if(a&1&&(t(0,"span"),s(1),n()),a&2){let e=u.$implicit,i=u.index,o=v();D("left",o.getXAxisLabelPositions()[i]/600*100,"%"),r(),k(e)}}function Re(a,u){if(a&1&&(t(0,"app-badge",121),s(1),n()),a&2){let e=v().$implicit,i=v();r(),x(" +",i.formatAmount(e.bonusEarned)," ")}}function Ie(a,u){if(a&1&&(t(0,"app-badge",122),s(1),n()),a&2){let e=v().$implicit,i=v();r(),x(" -",i.formatAmount(e.bonusUsed)," ")}}function Te(a,u){a&1&&(t(0,"span",123),s(1,"\u2014"),n())}function De(a,u){if(a&1&&(t(0,"div",135),s(1),n()),a&2){let e=v(2).$implicit;r(),x(" ",e.refundReason," ")}}function Ae(a,u){a&1&&(t(0,"div",136),s(1," \u041D\u0435\u0442 \u043F\u0440\u0438\u0447\u0438\u043D\u044B \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430 "),n())}function Be(a,u){if(a&1&&(t(0,"div",137),s(1),n()),a&2){let e=v(2).$implicit;r(),x(" ",e.initiatedBy," ")}}function Fe(a,u){a&1&&(t(0,"div",138),s(1," \u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D "),n())}function He(a,u){if(a&1&&(t(0,"tr",124)(1,"td",125)(2,"div",126)(3,"div",127)(4,"div",128)(5,"span",129),s(6,"\u041F\u0440\u0438\u0447\u0438\u043D\u0430 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430:"),n(),M(7,De,2,1,"div",130)(8,Ae,2,0,"div",131),n(),t(9,"div",132)(10,"span",129),s(11,"\u0418\u043D\u0438\u0446\u0438\u0430\u0442\u043E\u0440 \u043F\u043B\u0430\u0442\u0435\u0436\u0430:"),n(),M(12,Be,2,1,"div",133)(13,Fe,2,0,"div",134),n()()()()()),a&2){let e=v().$implicit;r(7),d("ngIf",e.refundReason),r(),d("ngIf",!e.refundReason),r(4),d("ngIf",e.initiatedBy),r(),d("ngIf",!e.initiatedBy)}}function $e(a,u){if(a&1){let e=X();Y(0),t(1,"tr",84)(2,"td",85)(3,"span",86),s(4),n()(),t(5,"td",87)(6,"div",88)(7,"div",89),s(8),n(),t(9,"div",90)(10,"a",91)(11,"span",92),s(12),n()(),t(13,"span",93),s(14),n()()()(),t(15,"td",94)(16,"span",95),s(17),n()(),t(18,"td",96)(19,"div",97),M(20,Re,2,1,"app-badge",98)(21,Ie,2,1,"app-badge",99)(22,Te,2,0,"span",100),n()(),t(23,"td",101)(24,"span",102),s(25),n()(),t(26,"td",103)(27,"app-badge",104),s(28),n()(),t(29,"td",105)(30,"div",106)(31,"span",107),s(32),n(),t(33,"span",108),s(34),n()()(),t(35,"td",109)(36,"div",110)(37,"a",111)(38,"app-icon-button",112),b(),t(39,"svg",113),h(40,"path",114)(41,"circle",67),n()()(),E(),t(42,"app-icon-button",115),I("onClick",function(){let o=$(e).$implicit,c=v();return z(c.openRefundModal(o))}),b(),t(43,"svg",113),h(44,"path",116),n()(),E(),t(45,"app-icon-button",117),I("onClick",function(){let o=$(e).$implicit,c=v();return z(c.toggleRowExpansion(o.id))}),b(),t(46,"svg",118),h(47,"path",119),n()()()()(),M(48,He,14,4,"tr",120),W()}if(a&2){let e=u.$implicit,i=v();r(),R("expanded",i.isRowExpanded(e.id)),r(3),x("#",i.formatPaymentId(e.id),""),r(4),x(" ",i.getInitials(e.clientName)," "),r(2),d("routerLink",N(25,he,e.clientId)),r(2),k(e.clientName),r(2),k(e.clientPhone),r(3),x("",i.formatAmount(e.amount)," \u20B8"),r(3),d("ngIf",e.bonusEarned>0),r(),d("ngIf",e.bonusUsed>0),r(),d("ngIf",e.bonusEarned===0&&e.bonusUsed===0),r(2),j("method-"+e.paymentMethod),r(),x(" ",i.getPaymentMethodLabel(e.paymentMethod)," "),r(2),d("badgeType",e.isRefund?"refund":"payment")("icon",e.isRefund?"refund":"payment"),r(),x(" ",e.isRefund?"\u0412\u043E\u0437\u0432\u0440\u0430\u0442":"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E"," "),r(4),k(e.date),r(2),k(e.time),r(3),d("routerLink",N(27,he,e.clientId)),r(5),d("disabled",e.isRefund),r(3),d("tooltip",i.isRowExpanded(e.id)?"\u0421\u043A\u0440\u044B\u0442\u044C \u0434\u0435\u0442\u0430\u043B\u0438":"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0434\u0435\u0442\u0430\u043B\u0438"),r(),R("rotated",i.isRowExpanded(e.id)),r(2),d("ngIf",i.isRowExpanded(e.id))}}var ot=(()=>{class a{store;user$;pageHeaderService=S(de);transactionModalService=S(le);analyticsService=S(ge);paymentsService=S(ue);toastService=S(ae);cdr=S(K);showRefundModal=!1;selectedPaymentForRefund=null;isProcessingRefund=!1;expandedRows=new Set;isLoading=!0;isChartLoading=!0;isLoadingPayments=!1;kpiCards=[{iconId:"month",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:"1 245 890 \u20B8",label:"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u043C\u0435\u0441\u044F\u0446",change:"+18%",changeType:"positive"},{iconId:"revenue",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:"35 634 \u20B8",label:"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u0441\u0435\u0433\u043E\u0434\u043D\u044F",change:"+24%",changeType:"positive"},{iconId:"transactions",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:"18",label:"\u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439 \u0441\u0435\u0433\u043E\u0434\u043D\u044F",change:"+3",changeType:"positive"},{iconId:"clients",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:"2",label:"\u041D\u043E\u0432\u044B\u0445 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432",change:"+5",changeType:"positive"},{iconId:"revenue",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:"17 817 \u20B8",label:"\u0421\u0440\u0435\u0434\u043D\u0438\u0439 \u0447\u0435\u043A",change:"+8%",changeType:"positive"},{iconId:"bonus",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:"3 563",label:"\u0411\u043E\u043D\u0443\u0441\u043E\u0432 \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E",change:"+12%",changeType:"positive"},{iconId:"refunds",iconBg:"linear-gradient(135deg, #fef2f2, #fee2e2)",value:"2",label:"\u0412\u043E\u0437\u0432\u0440\u0430\u0442\u043E\u0432",change:"-1",changeType:"negative"},{iconId:"today",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:"156",label:"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432",change:"+12",changeType:"positive"}];recentPayments=[];constructor(e){this.store=e,this.user$=this.store.select(se)}ngOnInit(){this.pageHeaderService.setPageHeader("\u0411\u044B\u0441\u0442\u0440\u044B\u0439 \u041E\u0431\u0437\u043E\u0440",[{label:"\u0413\u043B\u0430\u0432\u043D\u0430\u044F"}]),this.loadAnalyticsData(),this.loadChartData(),this.loadRecentPayments()}loadAnalyticsData(){this.isLoading=!0,U({monthlyRevenue:this.analyticsService.getMonthlyRevenue().pipe(y(e=>(console.error("Error loading monthly revenue:",e),P({revenue:0,changePercent:0}))),w(e=>console.log("Monthly revenue response:",e))),dailyRevenue:this.analyticsService.getDailyRevenue().pipe(y(e=>(console.error("Error loading daily revenue:",e),P({revenue:0,changePercent:0}))),w(e=>console.log("Daily revenue response:",e))),dailyTransactions:this.analyticsService.getDailyTransactions().pipe(y(e=>(console.error("Error loading daily transactions:",e),P({count:0,changeAbsolute:0}))),w(e=>console.log("Daily transactions response:",e))),newClients:this.analyticsService.getNewClients("DAILY").pipe(y(e=>(console.error("Error loading new clients:",e),P({count:0,changeAbsolute:0,type:"NEW",period:"DAILY"}))),w(e=>console.log("New clients response:",e))),averageCheck:this.analyticsService.getAverageCheck("MONTHLY").pipe(y(e=>(console.error("Error loading average check:",e),P({averageCheck:0,changePercent:0}))),w(e=>console.log("Average check response:",e))),bonusesAccrued:this.analyticsService.getBonusesAccrued("MONTHLY").pipe(y(e=>(console.error("Error loading bonuses accrued:",e),P({amount:0,changePercentage:0}))),w(e=>console.log("Bonuses accrued response:",e))),dailyRefunds:this.analyticsService.getDailyRefunds().pipe(y(e=>(console.error("Error loading daily refunds:",e),P({count:0,changeAbsolute:0}))),w(e=>console.log("Daily refunds response:",e))),activeClients:this.analyticsService.getActiveClients().pipe(y(e=>(console.error("Error loading active clients:",e),P({count:0,changeAbsolute:0}))),w(e=>console.log("Active clients response:",e)))}).subscribe({next:e=>{console.log("All analytics data received:",e),console.log("Monthly revenue:",e.monthlyRevenue),console.log("Daily revenue:",e.dailyRevenue),console.log("Average check:",e.averageCheck),console.log("Bonuses accrued:",e.bonusesAccrued),this.updateKpiCards(e),this.isLoading=!1},error:e=>{console.error("Error loading analytics data:",e),this.isLoading=!1}})}loadRecentPayments(){this.isLoadingPayments=!0,this.paymentsService.searchPayments({page:0,size:5,sortBy:"date",sortDirection:"DESC"}).pipe(y(e=>(console.error("Error loading recent payments:",e),P({content:[],totalElements:0,totalPages:0,page:0,size:5})))).subscribe({next:e=>{console.log("Recent payments received:",e),this.recentPayments=e.content.map(i=>this.convertPaymentToRecentPayment(i)),this.isLoadingPayments=!1,this.cdr.detectChanges()},error:e=>{console.error("Error in recent payments subscription:",e),this.isLoadingPayments=!1,this.cdr.detectChanges()}})}convertPaymentToRecentPayment(e){if(!e.createdAt){let _=new Date;return{id:e.txId||"",clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,paymentMethod:"card",isRefund:e.status==="REFUNDED"||e.refundedPaymentTxId!==null,date:_.toLocaleDateString("ru-RU"),time:_.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),initiatedBy:e.initiatedBy||null,refundReason:e.refundReason||null}}let i=new Date(e.createdAt);if(isNaN(i.getTime())){let _=new Date;i.setTime(_.getTime())}let o=String(i.getDate()).padStart(2,"0"),c=String(i.getMonth()+1).padStart(2,"0"),l=i.getFullYear(),p=`${o}.${c}.${l}`,m=String(i.getHours()).padStart(2,"0"),f=String(i.getMinutes()).padStart(2,"0"),C=`${m}:${f}`,g="card";if(e.paymentMethod){let _=e.paymentMethod.toLowerCase();_.includes("cash")||_.includes("\u043D\u0430\u043B\u0438\u0447")?g="cash":_.includes("online")||_.includes("\u043E\u043D\u043B\u0430\u0439\u043D")?g="online":g="card"}return{id:e.txId||"",clientId:e.clientId||"",clientName:e.clientName||"\u2014",clientPhone:e.clientPhone||"\u2014",amount:e.amount||0,bonusEarned:e.bonusGranted||0,bonusUsed:e.bonusUsed||0,paymentMethod:g,isRefund:e.status==="REFUNDED"||e.refundedPaymentTxId!==null,date:p,time:C,initiatedBy:e.initiatedBy||null,refundReason:e.refundReason||null}}loadChartData(){this.isChartLoading=!0;let e=new Date,i=e.getFullYear(),o=e.getMonth()+1;console.log("Loading chart data for:",i,o),this.analyticsService.getMonthlyRevenueChart(i,o).pipe(y(c=>{console.error("Error loading chart data:",c),console.error("Error status:",c.status);let l=i,p=o-1;return p<1&&(p=12,l=i-1),console.log("Trying fallback date:",l,p),this.analyticsService.getMonthlyRevenueChart(l,p).pipe(y(m=>(console.error("Fallback also failed:",m),P({dailyData:[],year:l,month:p}))))})).subscribe({next:c=>{console.log("Chart data received:",c),console.log("Chart data array length:",c.dailyData?.length);let l=c.dailyData||c.data||[];this.updateChartData(l),this.isChartLoading=!1,this.cdr.detectChanges()},error:c=>{console.error("Subscription error:",c),this.isChartLoading=!1,this.cdr.detectChanges()}})}updateKpiCards(e){let i=e.monthlyRevenue?.amount??e.monthlyRevenue?.revenue??0,o=e.monthlyRevenue?.changePercentage??e.monthlyRevenue?.changePercent,c=e.dailyRevenue?.amount??e.dailyRevenue?.revenue??0,l=e.dailyRevenue?.changePercentage??e.dailyRevenue?.changePercent,p=e.averageCheck?.amount??e.averageCheck?.averageCheck??0,m=e.averageCheck?.changePercentage??e.averageCheck?.changePercent,f=e.bonusesAccrued?.amount??e.bonusesAccrued?.count??0,C=e.bonusesAccrued?.changePercentage??e.bonusesAccrued?.changePercent;this.kpiCards=[{iconId:"month",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(i),label:"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u043C\u0435\u0441\u044F\u0446",change:o!=null?`${o>0?"+":""}${o.toFixed(0)}%`:void 0,changeType:o!=null&&o>=0?"positive":"negative"},{iconId:"revenue",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(c),label:"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u0441\u0435\u0433\u043E\u0434\u043D\u044F",change:l!=null?`${l>0?"+":""}${l.toFixed(0)}%`:void 0,changeType:l!=null&&l>=0?"positive":"negative"},{iconId:"transactions",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:(e.dailyTransactions?.count??0).toString(),label:"\u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439 \u0441\u0435\u0433\u043E\u0434\u043D\u044F",change:e.dailyTransactions?.changeAbsolute!=null?`${e.dailyTransactions.changeAbsolute>0?"+":""}${e.dailyTransactions.changeAbsolute}`:void 0,changeType:e.dailyTransactions?.changeAbsolute!=null&&e.dailyTransactions.changeAbsolute>=0?"positive":"negative"},{iconId:"clients",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:(e.newClients?.count??0).toString(),label:"\u041D\u043E\u0432\u044B\u0445 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432",change:e.newClients?.changeAbsolute!=null?`${e.newClients.changeAbsolute>0?"+":""}${e.newClients.changeAbsolute}`:void 0,changeType:e.newClients?.changeAbsolute!=null&&e.newClients.changeAbsolute>=0?"positive":"negative"},{iconId:"revenue",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(p),label:"\u0421\u0440\u0435\u0434\u043D\u0438\u0439 \u0447\u0435\u043A",change:m!=null?`${m>0?"+":""}${m.toFixed(0)}%`:void 0,changeType:m!=null&&m>=0?"positive":"negative"},{iconId:"bonus",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:this.formatCurrency(f),label:"\u0411\u043E\u043D\u0443\u0441\u043E\u0432 \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E",change:C!=null?`${C>0?"+":""}${C.toFixed(0)}%`:void 0,changeType:C!=null&&C>=0?"positive":"negative"},{iconId:"refunds",iconBg:"linear-gradient(135deg, #fef2f2, #fee2e2)",value:(e.dailyRefunds?.count??0).toString(),label:"\u0412\u043E\u0437\u0432\u0440\u0430\u0442\u043E\u0432",change:e.dailyRefunds?.changeAbsolute!=null?`${e.dailyRefunds.changeAbsolute>0?"+":""}${e.dailyRefunds.changeAbsolute}`:void 0,changeType:e.dailyRefunds?.changeAbsolute!=null&&e.dailyRefunds.changeAbsolute>=0?"positive":"negative"},{iconId:"today",iconBg:"linear-gradient(135deg, #f0fdf4, #dcfce7)",value:(e.activeClients?.count??0).toString(),label:"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432",change:e.activeClients?.changeAbsolute!=null?`${e.activeClients.changeAbsolute>0?"+":""}${e.activeClients.changeAbsolute}`:void 0,changeType:e.activeClients?.changeAbsolute!=null&&e.activeClients.changeAbsolute>=0?"positive":"negative"}]}updateChartData(e){if(console.log("Updating chart data with:",e),!e||e.length===0){console.log("Chart data is empty, clearing cache"),this._chartDataCache=null;return}let i=this.getDaysInCurrentMonth(),o=600,c=300,l=50,p=o-l*2,m=c-l*2,f=Math.max(...e.map(g=>g.revenue||g.amount||0),1);console.log("Max revenue for scaling:",f);let C=e.map(g=>{let _=g.day||g.dayNumber||1,A=i>1?(_-1)/(i-1):0,O=l+A*p,T=g.revenue||g.amount||0,B=c-l-T/f*m,F=g.transactionCount??g.transactions??0,H=g.bonusesGranted??g.bonusEarned??g.bonusesAccrued??0,fe=g.bonusesUsed??g.bonusUsed??0;return{x:O,y:B,day:_,revenue:T,transactions:F,bonusEarned:H,bonusUsed:fe}});console.log("Updated chart cache with",C.length,"points"),this._chartDataCache=C}formatCurrency(e,i=!0){if(e==null||isNaN(e))return i?"0 \u20B8":"0";let o=e.toLocaleString("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0});return i?`${o} \u20B8`:o}getInitials(e){if(!e||e.trim()==="")return"\u2014";let i=e.trim().split(" ").filter(o=>o.length>0);return i.length===0?"\u2014":i.map(o=>o[0]).join("").toUpperCase().slice(0,2)}formatAmount(e){return e.toLocaleString("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0})}formatPaymentId(e){if(!e)return"\u2014";if(e.includes("-"))return e;let i=parseInt(e,10);return isNaN(i)?e:`PAY-${String(i).padStart(3,"0")}`}getPaymentMethodLabel(e){return{cash:"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u0435",card:"\u041A\u0430\u0440\u0442\u0430",online:"\u041E\u043D\u043B\u0430\u0439\u043D"}[e]||e}openTransactionModal(){this.transactionModalService.open()}openRefundModal(e){if(e.isRefund)return;this.isProcessingRefund=!1;let i={id:e.id,clientId:e.clientId,clientName:e.clientName,clientPhone:e.clientPhone,amount:e.amount,bonusEarned:e.bonusEarned,bonusUsed:e.bonusUsed,paymentMethod:e.paymentMethod,isRefund:e.isRefund,date:e.date,time:e.time};this.selectedPaymentForRefund=i,this.showRefundModal=!0}closeRefundModal(){this.isProcessingRefund||(this.showRefundModal=!1,this.selectedPaymentForRefund=null,this.isProcessingRefund=!1)}onRefundModalVisibleChange(e){!e&&!this.isProcessingRefund&&this.closeRefundModal()}confirmRefund(e){!e||this.isProcessingRefund||(this.isProcessingRefund=!0,this.paymentsService.refundPayment(e.id,{notes:e.refundReason||""}).subscribe({next:()=>{this.toastService.success("\u0412\u043E\u0437\u0432\u0440\u0430\u0442 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D"),this.loadRecentPayments(),this.isProcessingRefund=!1,this.showRefundModal=!1,this.selectedPaymentForRefund=null},error:i=>{console.error("Error processing refund:",i);let o=i?.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0438 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430";this.toastService.error(o)}}))}toggleRowExpansion(e){this.expandedRows.has(e)?this.expandedRows.delete(e):this.expandedRows.add(e)}isRowExpanded(e){return this.expandedRows.has(e)}getDaysInCurrentMonth(){let e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}getChartDataPoints(){if(this._chartDataCache&&this._chartDataCache.length>0)return this._chartDataCache;let e=this.getDaysInCurrentMonth(),i=600,o=300,c=50,l=i-c*2,p=o-c*2,m=[];if(e===0)return m;for(let f=1;f<=e;f++){let C=e>1?(f-1)/(e-1):0,g=c+C*l,_=5e3+f/e*2e4,A=Math.sin(f*.2)*2e3,O=Math.round(_+A),T=Math.floor(5+Math.random()*20+f/e*10),B=Math.round(O*.01*(.8+Math.random()*.4)),F=Math.round(O*.005*Math.random()),H=o-c-O/3e4*p;m.push({x:g,y:H,day:f,revenue:O,transactions:T,bonusEarned:B,bonusUsed:F})}return m}_chartDataCache=null;getChartData(){return this._chartDataCache&&this._chartDataCache.length>0?this._chartDataCache:this.isChartLoading?[]:this.getChartDataPoints()}getMonthName(){return["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][new Date().getMonth()]}getTransactionsText(e){let i=e%10,o=e%100;return o>=11&&o<=19?"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439":i===1?"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u044F":i>=2&&i<=4?"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0438":"\u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439"}getChartPath(){let e=this.getChartData();if(e.length===0)return"";let i=`M${e[0].x},${e[0].y}`;for(let o=1;o<e.length;o++)i+=` L${e[o].x},${e[o].y}`;return i}getAreaPath(){let e=this.getChartData();if(e.length===0)return"";let i=300,o=50,c=`M${e[0].x},${i-o}`;c+=` L${e[0].x},${e[0].y}`;for(let l=1;l<e.length;l++)c+=` L${e[l].x},${e[l].y}`;return c+=` L${e[e.length-1].x},${i-o} Z`,c}getXAxisLabels(){let e=this.getDaysInCurrentMonth(),i=[],o=[1,Math.ceil(e*.25),Math.ceil(e*.5),Math.ceil(e*.75),e];return[...new Set(o)].sort((l,p)=>l-p).map(l=>l.toString())}getXAxisLabelPositions(){let e=this.getDaysInCurrentMonth(),i=600,o=50,c=i-o*2;return this.getXAxisLabels().map(p=>{let m=parseInt(p,10),f=e>1?(m-1)/(e-1):0;return o+f*c})}static \u0275fac=function(i){return new(i||a)(V(oe))};static \u0275cmp=G({type:a,selectors:[["app-home-page"]],decls:78,vars:9,consts:[[1,"page-wrapper"],[1,"dashboard"],[1,"dashboard-header"],["buttonType","primary","size","medium",3,"onClick"],["viewBox","0 0 24 24","fill","none",1,"create-icon"],["d","M6 12H18M12 6V18","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],[1,"create-label"],[1,"kpi-grid"],["class","kpi-card",4,"ngFor","ngForOf"],[1,"charts-section"],[1,"chart-card","line-chart-card"],[1,"chart-title"],[1,"chart-container"],[1,"chart-y-axis"],[1,"chart-area"],[1,"chart-svg-wrapper"],["viewBox","0 0 600 300","preserveAspectRatio","none",1,"line-chart"],["id","chartGradient","x1","0%","y1","0%","x2","0%","y2","100%"],["offset","0%",2,"stop-color","#22c55e","stop-opacity","0.3"],["offset","100%",2,"stop-color","#22c55e","stop-opacity","0.02"],["stroke","#e2e8f0","stroke-width","1","opacity","0.5"],["x1","50","y1","50","x2","550","y2","50","vector-effect","non-scaling-stroke"],["x1","50","y1","100","x2","550","y2","100","vector-effect","non-scaling-stroke"],["x1","50","y1","150","x2","550","y2","150","vector-effect","non-scaling-stroke"],["x1","50","y1","200","x2","550","y2","200","vector-effect","non-scaling-stroke"],["x1","50","y1","250","x2","550","y2","250","vector-effect","non-scaling-stroke"],["fill","url(#chartGradient)"],["fill","none","stroke","#22c55e","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round","vector-effect","non-scaling-stroke"],[1,"chart-points"],["class","chart-point-wrapper",3,"left","top",4,"ngFor","ngForOf"],[1,"chart-x-axis"],[3,"left",4,"ngFor","ngForOf"],[1,"table-section"],[1,"table-header"],[1,"table-title"],["routerLink","/payments",1,"view-all-link"],[1,"table-container"],[1,"payments-table"],[1,"th-id"],[1,"th-client"],[1,"th-amount"],[1,"th-bonuses"],[1,"th-method"],[1,"th-status"],[1,"th-date"],[1,"th-actions"],[4,"ngFor","ngForOf"],[3,"visibleChange","confirm","visible","payment","isProcessing"],[1,"kpi-card"],[1,"kpi-header"],[1,"kpi-icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none",3,"ngSwitch"],[4,"ngSwitchCase"],["class","refunds-icon",4,"ngSwitchCase"],["class","kpi-change",3,"positive","negative",4,"ngIf"],[1,"kpi-value"],[1,"kpi-label"],["d","M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6","stroke","currentColor","stroke-width","1.5"],["d","M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z","stroke","currentColor","stroke-width","1.5"],["d","M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2","stroke","currentColor","stroke-width","1.5"],["cx","9","cy","7","r","4","stroke","currentColor","stroke-width","1.5"],["d","M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75","stroke","currentColor","stroke-width","1.5"],["d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2","stroke","currentColor","stroke-width","1.5"],["x","9","y","3","width","6","height","4","rx","1","stroke","currentColor","stroke-width","1.5"],["d","M9 12h6M9 16h6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"],[1,"refunds-icon"],["_ngcontent-ng-c4142443301","","d","M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","3","stroke","currentColor","stroke-width","1.5"],["x","3","y","4","width","18","height","18","rx","2","stroke","currentColor","stroke-width","1.5"],["d","M16 2v4M8 2v4M3 10h18","stroke","currentColor","stroke-width","1.5"],["d","M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"kpi-change"],[1,"chart-point-wrapper"],[1,"chart-point"],[1,"chart-tooltip"],[1,"tooltip-day"],[1,"tooltip-stats"],[1,"tooltip-row"],[1,"tooltip-label"],[1,"tooltip-revenue"],[1,"tooltip-value"],[1,"tooltip-bonus-earned"],["class","tooltip-row",4,"ngIf"],[1,"tooltip-bonus-used"],[1,"payment-row"],[1,"td-id"],[1,"payment-id"],[1,"td-client"],[1,"client-cell"],[1,"client-avatar"],[1,"client-info"],[1,"client-name-link",3,"routerLink"],[1,"client-name"],[1,"client-phone"],[1,"td-amount"],[1,"amount-value"],[1,"td-bonuses"],[1,"bonus-info"],["badgeType","bonusGranted","size","medium","icon","star","class","bonus-badge",4,"ngIf"],["badgeType","bonusUsed","size","medium","icon","check","class","bonus-badge",4,"ngIf"],["class","bonus-none",4,"ngIf"],[1,"td-method"],[1,"method-badge"],[1,"td-status"],["size","medium",3,"badgeType","icon"],[1,"td-date"],[1,"date-info"],[1,"date-text"],[1,"time-text"],[1,"td-actions"],[1,"actions-cell"],[1,"action-link",3,"routerLink"],["iconButtonType","view","size","small","tooltip","\u041F\u0440\u043E\u0441\u043C\u043E\u0442\u0440 \u043A\u043B\u0438\u0435\u043D\u0442\u0430"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z","stroke","currentColor","stroke-width","1.5"],["iconButtonType","refund","size","small","tooltip","\u0412\u043E\u0437\u0432\u0440\u0430\u0442",3,"onClick","disabled"],["d","M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["iconButtonType","ghost","size","small",3,"onClick","tooltip"],["viewBox","0 0 24 24","fill","none"],["d","M6 9l6 6 6-6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["class","payment-details-row",4,"ngIf"],["badgeType","bonusGranted","size","medium","icon","star",1,"bonus-badge"],["badgeType","bonusUsed","size","medium","icon","check",1,"bonus-badge"],[1,"bonus-none"],[1,"payment-details-row"],["colspan","9",1,"payment-details-cell"],[1,"payment-details-content"],[1,"refund-details-grid"],[1,"refund-reason-section"],[1,"refund-label"],["class","refund-reason-text",4,"ngIf"],["class","refund-reason-empty",4,"ngIf"],[1,"refund-by-section"],["class","refund-by-text",4,"ngIf"],["class","refund-by-empty",4,"ngIf"],[1,"refund-reason-text"],[1,"refund-reason-empty"],[1,"refund-by-text"],[1,"refund-by-empty"]],template:function(i,o){i&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-button",3),I("onClick",function(){return o.openTransactionModal()}),b(),t(4,"svg",4),h(5,"path",5),n(),E(),t(6,"span",6),s(7,"\u041D\u043E\u0432\u0430\u044F \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u044F"),n()()(),t(8,"div",7),M(9,ke,17,14,"div",8),n(),t(10,"div",9)(11,"div",10)(12,"h3",11),s(13,"\u0412\u044B\u0440\u0443\u0447\u043A\u0430 \u0437\u0430 \u043C\u0435\u0441\u044F\u0446"),n(),t(14,"div",12)(15,"div",13)(16,"span"),s(17,"30 000"),n(),t(18,"span"),s(19,"25 000"),n(),t(20,"span"),s(21,"20 000"),n(),t(22,"span"),s(23,"15 000"),n(),t(24,"span"),s(25,"10 000"),n(),t(26,"span"),s(27,"5 000"),n(),t(28,"span"),s(29,"0"),n()(),t(30,"div",14)(31,"div",15),b(),t(32,"svg",16)(33,"defs")(34,"linearGradient",17),h(35,"stop",18)(36,"stop",19),n()(),t(37,"g",20),h(38,"line",21)(39,"line",22)(40,"line",23)(41,"line",24)(42,"line",25),n(),h(43,"path",26)(44,"path",27),n(),E(),t(45,"div",28),M(46,Oe,22,12,"div",29),n()(),t(47,"div",30),M(48,Ee,2,3,"span",31),n()()()()(),t(49,"div",32)(50,"div",33)(51,"h3",34),s(52,"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438"),n(),t(53,"a",35),s(54,"\u0421\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u0432\u0441\u0435 \u2192"),n()(),t(55,"div",36)(56,"table",37)(57,"thead")(58,"tr")(59,"th",38),s(60,"ID \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),n(),t(61,"th",39),s(62,"\u041A\u043B\u0438\u0435\u043D\u0442"),n(),t(63,"th",40),s(64,"\u0421\u0443\u043C\u043C\u0430"),n(),t(65,"th",41),s(66,"\u0411\u043E\u043D\u0443\u0441\u044B"),n(),t(67,"th",42),s(68,"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B"),n(),t(69,"th",43),s(70,"\u0421\u0442\u0430\u0442\u0443\u0441"),n(),t(71,"th",44),s(72,"\u0414\u0430\u0442\u0430 \u0438 \u0432\u0440\u0435\u043C\u044F"),n(),t(73,"th",45),s(74,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"),n()()(),t(75,"tbody"),M(76,$e,49,29,"ng-container",46),n()()()()(),t(77,"app-refund-confirmation-modal",47),I("visibleChange",function(l){return o.onRefundModalVisibleChange(l)})("confirm",function(l){return o.confirmRefund(l)}),n()()),i&2&&(r(9),d("ngForOf",o.kpiCards),r(34),L("d",o.getAreaPath()),r(),L("d",o.getChartPath()),r(2),d("ngForOf",o.getChartData()),r(2),d("ngForOf",o.getXAxisLabels()),r(28),d("ngForOf",o.recentPayments),r(),d("visible",o.showRefundModal)("payment",o.selectedPaymentForRefund)("isProcessing",o.isProcessingRefund))},dependencies:[te,J,Z,Q,ee,ie,ne,pe,ce,me,re],styles:['[_nghost-%COMP%]{display:block;height:100%}.page-wrapper[_ngcontent-%COMP%]{min-height:100%;margin:-2rem;padding:2rem;background:linear-gradient(180deg,#f0fdf4,#f8fafc 50% 100%)}.dashboard[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}.dashboard-header[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:flex-start;margin-bottom:2rem}.dashboard-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#0f172a;margin:0 0 .25rem}.refunds-icon[_ngcontent-%COMP%]{color:#dc2626}.dashboard-subtitle[_ngcontent-%COMP%]{font-size:.9375rem;color:#64748b;margin:0}.new-transaction-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:#16a34a;color:#fff;border:none;border-radius:12px;font-size:.9375rem;font-weight:600;cursor:pointer;transition:all .2s ease}.new-transaction-btn[_ngcontent-%COMP%]:hover{background:#15803d}.new-transaction-btn[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:18px;height:18px}.kpi-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1.5rem;margin-bottom:2rem}@media (max-width: 1400px){.kpi-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (max-width: 1000px){.kpi-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 600px){.kpi-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.kpi-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;border:1px solid rgba(0,0,0,.06);box-shadow:0 1px 3px #00000008,0 3px 6px #00000008}.kpi-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem}.kpi-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.25rem}.kpi-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px;color:#16a34a;display:block}.kpi-change[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:600;padding:.25rem .625rem;border-radius:20px;background:#f0fdf4;color:#16a34a}.kpi-change.positive[_ngcontent-%COMP%]{background:#f0fdf4;color:#16a34a}.kpi-change.negative[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626}.kpi-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#0f172a;margin-bottom:.25rem}.kpi-label[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b}.charts-section[_ngcontent-%COMP%]{display:grid;// grid-template-columns: 2fr 1fr;// gap: 1.5rem;margin-bottom:2rem}@media (max-width: 1024px){.charts-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.chart-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 1px 3px #0000000d}.chart-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#0f172a;margin:0 0 1.5rem}.line-chart-card[_ngcontent-%COMP%]{min-height:350px;overflow:visible}.chart-container[_ngcontent-%COMP%]{display:flex;height:320px;overflow:visible}.chart-y-axis[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;padding-right:1rem;font-size:.75rem;color:#94a3b8}.chart-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-height:0;overflow:visible}.chart-svg-wrapper[_ngcontent-%COMP%]{flex:1;position:relative;min-height:280px;overflow:visible}.line-chart[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.chart-points[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:visible}.chart-point-wrapper[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%,-50%);cursor:pointer;z-index:1;pointer-events:auto;padding:8px}.chart-point-wrapper[_ngcontent-%COMP%]:hover{z-index:10}.chart-point[_ngcontent-%COMP%]{width:10px;height:10px;background:#22c55e;border-radius:50%;transition:transform .15s ease,box-shadow .15s ease}.chart-point-wrapper[_ngcontent-%COMP%]:hover   .chart-point[_ngcontent-%COMP%]{transform:scale(1.3);box-shadow:0 0 0 4px #22c55e33}.chart-point.last-point[_ngcontent-%COMP%]{width:12px;height:12px;background:#fff;border:2.5px solid #22c55e;box-sizing:border-box}.chart-tooltip[_ngcontent-%COMP%]{position:absolute;bottom:calc(100% + 10px);left:50%;transform:translate(-50%) translateY(6px) scale(.97);background:#1f2937;color:#fff;padding:.625rem .875rem;border-radius:8px;font-size:.8125rem;white-space:nowrap;opacity:0;visibility:hidden;transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:0 4px 12px #00000026;pointer-events:none}.chart-tooltip[_ngcontent-%COMP%]:after{content:"";position:absolute;top:100%;left:50%;transform:translate(-50%);border:6px solid transparent;border-top-color:#1f2937;transition:opacity .3s ease}.chart-point-wrapper[_ngcontent-%COMP%]:hover   .chart-tooltip[_ngcontent-%COMP%]{opacity:1;visibility:visible;transform:translate(-50%) translateY(0) scale(1)}.tooltip-day[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;padding-bottom:.375rem;border-bottom:1px solid #374151;color:#f3f4f6}.tooltip-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.tooltip-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.tooltip-label[_ngcontent-%COMP%]{color:#9ca3af;font-size:.75rem}.tooltip-value[_ngcontent-%COMP%]{color:#f3f4f6;font-weight:500}.tooltip-revenue[_ngcontent-%COMP%]{color:#22c55e;font-weight:600}.tooltip-bonus-earned[_ngcontent-%COMP%]{color:#fbbf24;font-weight:600}.tooltip-bonus-used[_ngcontent-%COMP%]{color:#f472b6;font-weight:600}.chart-x-axis[_ngcontent-%COMP%]{position:relative;height:20px;padding-top:.5rem;font-size:.75rem;color:#94a3b8}.chart-x-axis[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%)}.donut-chart-card[_ngcontent-%COMP%]{display:flex;flex-direction:column}.donut-container[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;padding:1rem}.donut-chart[_ngcontent-%COMP%]{width:180px;height:180px}.donut-legend[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:2rem;padding-top:1rem}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;color:#64748b}.legend-color[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:3px}.legend-color.active[_ngcontent-%COMP%]{background:#16a34a}.legend-color.forecast[_ngcontent-%COMP%]{background:#dcfce7}.table-section[_ngcontent-%COMP%]{margin-bottom:2rem}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.table-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#0f172a;margin:0}.view-all-link[_ngcontent-%COMP%]{font-size:.875rem;color:#16a34a;text-decoration:none;font-weight:500;transition:color .2s ease}.view-all-link[_ngcontent-%COMP%]:hover{color:#15803d}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 1px 3px #00000014;border:1px solid #e5e7eb;overflow:hidden}.payments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.payments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-size:.75rem;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.5px;background:#f8fafc;border-bottom:1px solid #e5e7eb}.payments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #f1f5f9}.payment-row[_ngcontent-%COMP%]{transition:background .15s}.payment-row[_ngcontent-%COMP%]:hover{background:#f8fafc}.payment-row[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.td-id[_ngcontent-%COMP%]{min-width:100px}.payment-id[_ngcontent-%COMP%]{font-family:monospace;font-weight:600;color:#64748b;font-size:.875rem}.client-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.client-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);color:#16a34a;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600;flex-shrink:0}.client-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.15rem}.client-name-link[_ngcontent-%COMP%]{text-decoration:none;color:inherit;transition:color .15s}.client-name-link[_ngcontent-%COMP%]:hover{color:#16a34a}.client-name[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#1f2937;cursor:pointer}.client-name-link[_ngcontent-%COMP%]:hover   .client-name[_ngcontent-%COMP%]{color:#16a34a}.client-phone[_ngcontent-%COMP%]{font-size:.8rem;color:#64748b}.amount-value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;color:#16a34a}.bonus-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.bonus-badge[_ngcontent-%COMP%]{display:inline-block}.bonus-none[_ngcontent-%COMP%]{font-size:.8rem;color:#94a3b8}.method-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:12px;font-size:.75rem;font-weight:600}.method-badge.method-cash[_ngcontent-%COMP%]{background:#dcfce7;color:#16a34a}.method-badge.method-card[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.method-badge.method-online[_ngcontent-%COMP%]{background:#fef3c7;color:#d97706}.date-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.15rem}.date-text[_ngcontent-%COMP%]{font-size:.85rem;color:#1f2937;font-weight:500}.time-text[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b}.actions-cell[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.action-link[_ngcontent-%COMP%]{display:inline-flex;text-decoration:none;color:inherit}.payments-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.payment-details-row[_ngcontent-%COMP%]{background:transparent}.payments-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.payment-details-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:none;padding:0}.payment-details-cell[_ngcontent-%COMP%]{padding:0!important;background:transparent}.payment-details-content[_ngcontent-%COMP%]{padding:1rem 1.5rem;overflow:hidden;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;max-height:0}to{opacity:1;max-height:300px}}.refund-details-grid[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:2rem}.refund-reason-section[_ngcontent-%COMP%]{flex:1;text-align:left}.refund-by-section[_ngcontent-%COMP%]{flex:0 0 auto;text-align:right;min-width:200px}.refund-reason-section[_ngcontent-%COMP%], .refund-by-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.refund-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#475569}.refund-reason-text[_ngcontent-%COMP%]{padding:.75rem;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#1f2937;line-height:1.6;white-space:pre-wrap;text-align:left}.refund-by-text[_ngcontent-%COMP%]{padding:.75rem 0;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#1f2937;line-height:1.6;white-space:pre-wrap;text-align:right}.refund-reason-empty[_ngcontent-%COMP%]{padding:.75rem;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#94a3b8;font-style:italic;text-align:left}.refund-by-empty[_ngcontent-%COMP%]{padding:.75rem 0;background:transparent;border:none;border-radius:0;font-size:.875rem;color:#94a3b8;font-style:italic;text-align:right}.actions-cell[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transition:transform .3s ease}.actions-cell[_ngcontent-%COMP%]   svg.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]     app-button svg, app-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px;flex-shrink:0;display:block}[_nghost-%COMP%]     app-button.size-small svg, app-button.size-small[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.btn-icon[_ngcontent-%COMP%]{width:18px;height:18px;flex-shrink:0;display:block}[_nghost-%COMP%]     .dashboard-header app-button button{height:44px;padding:0 1rem}[_nghost-%COMP%]     .dashboard-header app-button button svg.create-icon{width:32px;height:32px;flex-shrink:0}[_nghost-%COMP%]     app-button button .create-label{display:inline-flex;align-items:center;line-height:1.5}@media (max-width: 768px){.page-wrapper[_ngcontent-%COMP%]{margin:-1rem;padding:1rem}.dashboard-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.new-transaction-btn[_ngcontent-%COMP%]{width:100%;justify-content:center}.clients-table[_ngcontent-%COMP%]{display:block;overflow-x:auto}}']})}return a})();export{ot as HomePageComponent};
