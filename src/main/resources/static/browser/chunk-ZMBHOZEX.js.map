{
  "version": 3,
  "sources": ["src/app/core/services/transaction-modal.service.ts", "src/app/core/services/payments.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\n\nexport interface TransactionResult {\n  clientName: string;\n  phone: string;\n  amount: number;\n  bonuses: number;\n  isNewClient: boolean;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TransactionModalService {\n  private visibleSource = new BehaviorSubject<boolean>(false);\n  visible$: Observable<boolean> = this.visibleSource.asObservable();\n\n  private transactionCompleteSource = new Subject<TransactionResult>();\n  transactionComplete$: Observable<TransactionResult> = this.transactionCompleteSource.asObservable();\n\n  open(): void {\n    this.visibleSource.next(true);\n  }\n\n  close(): void {\n    this.visibleSource.next(false);\n  }\n\n  toggle(): void {\n    this.visibleSource.next(!this.visibleSource.value);\n  }\n\n  emitTransactionComplete(result: TransactionResult): void {\n    this.transactionCompleteSource.next(result);\n  }\n}\n\n", "import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { environment } from '../../../environments/environment';\n\nexport interface PaymentSearchRequest {\n  paymentId?: string;\n  clientName?: string;\n  phone?: string;\n  periodFrom?: string | null;\n  periodTo?: string | null;\n  paymentMethod?: string | null;\n  paymentType?: 'ALL' | 'PAID' | 'REFUND';\n  sortBy?: 'date' | 'amount' | 'clientName';\n  sortDirection?: 'ASC' | 'DESC';\n  page?: number;\n  size?: number;\n}\n\nexport interface PaymentSearchResult {\n  txId: string;\n  clientId: string;\n  clientName: string;\n  clientPhone: string;\n  clientEmail: string | null;\n  amount: number;\n  status: string;\n  paymentMethod: string | null;\n  initiatedBy: string | null;\n  createdAt: string;\n  refundedPaymentTxId: string | null;\n  bonusGranted: number;\n  bonusUsed: number;\n  bonusRevoked: number;\n  refundReason: string | null;\n}\n\nexport interface PaymentSearchResponse {\n  content: PaymentSearchResult[];\n  totalElements: number;\n  totalPages: number;\n  page: number;\n  size: number;\n}\n\nexport interface RefundRequest {\n  notes: string;\n}\n\nexport interface CreateDraftPaymentRequest {\n  clientId: string;\n}\n\nexport interface DraftPaymentResponse {\n  txId: string;\n  clientId: string;\n  clientName: string;\n  enteredByUserId: string;\n  enteredByUsername: string;\n  amount: number;\n  notes: string | null;\n  status: string;\n  refundedPaymentTxId: string | null;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface CompletePaymentRequest {\n  originalAmount: number;\n  bonusAmountUsed: number | null;\n  notes: string;\n  paymentMethod?: 'CASH' | 'CARD' | 'TRANSFER';\n}\n\nexport interface BonusRevocationDto {\n  id: number;\n  bonusAmount: number;\n  revokeReason: string;\n  revokedAt: string;\n  refundTxId: string;\n  revokedByUsername: string;\n}\n\nexport interface PaymentTransactionDto {\n  txId: string;\n  clientId: string;\n  clientName: string;\n  enteredByUserId: string;\n  enteredByUsername: string;\n  amount: number;\n  notes: string | null;\n  status: string;\n  paymentMethod: 'CASH' | 'CARD' | 'TRANSFER' | null;\n  refundedPaymentTxId: string | null;\n  createdAt: string;\n  updatedAt: string;\n  bonusRevocations?: BonusRevocationDto[];\n}\n\nexport interface UpdatePaymentMethodRequest {\n  paymentMethod: 'CASH' | 'CARD' | 'TRANSFER';\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PaymentsService {\n  private readonly apiUrl = `${environment.apiUrl}/payments`;\n\n  constructor(private http: HttpClient) {}\n\n  /**\n   * Search payments with filters and pagination\n   */\n  searchPayments(request: PaymentSearchRequest): Observable<PaymentSearchResponse> {\n    return this.http.post<PaymentSearchResponse>(`${this.apiUrl}/search`, request);\n  }\n\n  /**\n   * Refund a payment\n   */\n  refundPayment(paymentTxId: string, refundRequest: RefundRequest): Observable<void> {\n    return this.http.post<void>(`${this.apiUrl}/${paymentTxId}/refund`, refundRequest);\n  }\n\n  /**\n   * Get client payment history with pagination\n   */\n  getClientPayments(clientId: string, page: number = 0, size: number = 100): Observable<PaymentSearchResponse> {\n    const params = new HttpParams()\n      .set('page', page.toString())\n      .set('size', size.toString());\n    return this.http.get<PaymentSearchResponse>(`${this.apiUrl}/client/${clientId}`, { params });\n  }\n\n  /**\n   * Create a draft payment\n   */\n  createDraftPayment(request: CreateDraftPaymentRequest): Observable<DraftPaymentResponse> {\n    console.log('=== CREATE DRAFT PAYMENT REQUEST ===');\n    console.log('URL:', `${this.apiUrl}/draft`);\n    console.log('Method: POST');\n    console.log('Full Request Payload:', JSON.stringify(request, null, 2));\n    console.log('Request Payload (object):', request);\n    console.log('====================================');\n    return this.http.post<DraftPaymentResponse>(`${this.apiUrl}/draft`, request);\n  }\n\n  /**\n   * Complete a payment\n   */\n  completePayment(paymentTxId: string, request: CompletePaymentRequest): Observable<void> {\n    console.log('=== COMPLETE PAYMENT REQUEST ===');\n    console.log('URL:', `${this.apiUrl}/${paymentTxId}/complete`);\n    console.log('Method: POST');\n    console.log('Payment TX ID:', paymentTxId);\n    console.log('Full Request Payload:', JSON.stringify(request, null, 2));\n    console.log('Request Payload (object):', request);\n    console.log('================================');\n    return this.http.post<void>(`${this.apiUrl}/${paymentTxId}/complete`, request);\n  }\n\n  /**\n   * Delete a draft payment\n   */\n  deleteDraftPayment(paymentTxId: string): Observable<void> {\n    console.log('=== DELETE DRAFT PAYMENT REQUEST ===');\n    console.log('URL:', `${this.apiUrl}/draft/${paymentTxId}`);\n    console.log('Method: DELETE');\n    console.log('Payment TX ID:', paymentTxId);\n    console.log('=====================================');\n    return this.http.delete<void>(`${this.apiUrl}/draft/${paymentTxId}`);\n  }\n\n  /**\n   * Get payment by transaction ID\n   */\n  getPaymentByTxId(txId: string): Observable<PaymentTransactionDto> {\n    return this.http.get<PaymentTransactionDto>(`${this.apiUrl}/${txId}`);\n  }\n\n  /**\n   * Update payment method\n   */\n  updatePaymentMethod(txId: string, request: UpdatePaymentMethodRequest): Observable<PaymentTransactionDto> {\n    return this.http.put<PaymentTransactionDto>(`${this.apiUrl}/${txId}/payment-method`, request);\n  }\n\n  /**\n   * Delete a completed payment and its associated bonuses\n   */\n  deletePayment(txId: string): Observable<void> {\n    return this.http.delete<void>(`${this.apiUrl}/${txId}`);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;AAcM,IAAO,0BAAP,MAAO,yBAAuB;EAC1B,gBAAgB,IAAI,gBAAyB,KAAK;EAC1D,WAAgC,KAAK,cAAc,aAAY;EAEvD,4BAA4B,IAAI,QAAO;EAC/C,uBAAsD,KAAK,0BAA0B,aAAY;EAEjG,OAAI;AACF,SAAK,cAAc,KAAK,IAAI;EAC9B;EAEA,QAAK;AACH,SAAK,cAAc,KAAK,KAAK;EAC/B;EAEA,SAAM;AACJ,SAAK,cAAc,KAAK,CAAC,KAAK,cAAc,KAAK;EACnD;EAEA,wBAAwB,QAAyB;AAC/C,SAAK,0BAA0B,KAAK,MAAM;EAC5C;;qCArBW,0BAAuB;EAAA;4EAAvB,0BAAuB,SAAvB,yBAAuB,WAAA,YAFtB,OAAM,CAAA;;;sEAEP,yBAAuB,CAAA;UAHnC;WAAW;MACV,YAAY;KACb;;;;;AC6FK,IAAO,kBAAP,MAAO,iBAAe;EAGN;EAFH,SAAS,GAAG,YAAY,MAAM;EAE/C,YAAoB,MAAgB;AAAhB,SAAA,OAAA;EAAmB;;;;EAKvC,eAAe,SAA6B;AAC1C,WAAO,KAAK,KAAK,KAA4B,GAAG,KAAK,MAAM,WAAW,OAAO;EAC/E;;;;EAKA,cAAc,aAAqB,eAA4B;AAC7D,WAAO,KAAK,KAAK,KAAW,GAAG,KAAK,MAAM,IAAI,WAAW,WAAW,aAAa;EACnF;;;;EAKA,kBAAkB,UAAkB,OAAe,GAAG,OAAe,KAAG;AACtE,UAAM,SAAS,IAAI,WAAU,EAC1B,IAAI,QAAQ,KAAK,SAAQ,CAAE,EAC3B,IAAI,QAAQ,KAAK,SAAQ,CAAE;AAC9B,WAAO,KAAK,KAAK,IAA2B,GAAG,KAAK,MAAM,WAAW,QAAQ,IAAI,EAAE,OAAM,CAAE;EAC7F;;;;EAKA,mBAAmB,SAAkC;AACnD,YAAQ,IAAI,sCAAsC;AAClD,YAAQ,IAAI,QAAQ,GAAG,KAAK,MAAM,QAAQ;AAC1C,YAAQ,IAAI,cAAc;AAC1B,YAAQ,IAAI,yBAAyB,KAAK,UAAU,SAAS,MAAM,CAAC,CAAC;AACrE,YAAQ,IAAI,6BAA6B,OAAO;AAChD,YAAQ,IAAI,sCAAsC;AAClD,WAAO,KAAK,KAAK,KAA2B,GAAG,KAAK,MAAM,UAAU,OAAO;EAC7E;;;;EAKA,gBAAgB,aAAqB,SAA+B;AAClE,YAAQ,IAAI,kCAAkC;AAC9C,YAAQ,IAAI,QAAQ,GAAG,KAAK,MAAM,IAAI,WAAW,WAAW;AAC5D,YAAQ,IAAI,cAAc;AAC1B,YAAQ,IAAI,kBAAkB,WAAW;AACzC,YAAQ,IAAI,yBAAyB,KAAK,UAAU,SAAS,MAAM,CAAC,CAAC;AACrE,YAAQ,IAAI,6BAA6B,OAAO;AAChD,YAAQ,IAAI,kCAAkC;AAC9C,WAAO,KAAK,KAAK,KAAW,GAAG,KAAK,MAAM,IAAI,WAAW,aAAa,OAAO;EAC/E;;;;EAKA,mBAAmB,aAAmB;AACpC,YAAQ,IAAI,sCAAsC;AAClD,YAAQ,IAAI,QAAQ,GAAG,KAAK,MAAM,UAAU,WAAW,EAAE;AACzD,YAAQ,IAAI,gBAAgB;AAC5B,YAAQ,IAAI,kBAAkB,WAAW;AACzC,YAAQ,IAAI,uCAAuC;AACnD,WAAO,KAAK,KAAK,OAAa,GAAG,KAAK,MAAM,UAAU,WAAW,EAAE;EACrE;;;;EAKA,iBAAiB,MAAY;AAC3B,WAAO,KAAK,KAAK,IAA2B,GAAG,KAAK,MAAM,IAAI,IAAI,EAAE;EACtE;;;;EAKA,oBAAoB,MAAc,SAAmC;AACnE,WAAO,KAAK,KAAK,IAA2B,GAAG,KAAK,MAAM,IAAI,IAAI,mBAAmB,OAAO;EAC9F;;;;EAKA,cAAc,MAAY;AACxB,WAAO,KAAK,KAAK,OAAa,GAAG,KAAK,MAAM,IAAI,IAAI,EAAE;EACxD;;qCAvFW,kBAAe,mBAAA,UAAA,CAAA;EAAA;4EAAf,kBAAe,SAAf,iBAAe,WAAA,YAFd,OAAM,CAAA;;;sEAEP,iBAAe,CAAA;UAH3B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
