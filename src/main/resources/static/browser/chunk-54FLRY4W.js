import{a as q}from"./chunk-4W763UB3.js";import{b as Y}from"./chunk-JQSPPBHG.js";import{a as j}from"./chunk-GJSZY4YS.js";import{a as A}from"./chunk-T6AS2VJX.js";import{c as z,e as N,g as L,m as U,n as H,o as G,u as W}from"./chunk-OGICRJHM.js";import{$ as v,Ca as i,Da as n,Ea as x,Fa as E,Ga as S,Hb as B,Ia as y,Ja as f,Ka as d,Lb as F,Sa as a,T as D,Ta as C,Ua as _,Xa as M,Y as I,Ya as P,Z as c,Za as w,_ as m,aa as h,ab as O,ea as b,ma as o,mb as V,nb as T,pa as k,ua as p,ub as R,ya as u}from"./chunk-SDVY3Z22.js";var X=t=>["/clients",t],J=t=>["/users",t];function K(t,s){if(t&1&&x(0,"app-badge",31),t&2){let e=d(2);u("paymentMethod",e.getPaymentMethodForBadge())}}function Q(t,s){if(t&1){let e=y();i(0,"div",32)(1,"select",33),w("ngModelChange",function(r){c(e);let g=d(2);return P(g.selectedPaymentMethod,r)||(g.selectedPaymentMethod=r),m(r)}),i(2,"option",34),a(3,"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u0435"),n(),i(4,"option",35),a(5,"\u041A\u0430\u0440\u0442\u0430"),n(),i(6,"option",36),a(7,"\u041F\u0435\u0440\u0435\u0432\u043E\u0434"),n()(),i(8,"div",37)(9,"button",38),f("click",function(){c(e);let r=d(2);return m(r.savePaymentMethod())}),a(10),n(),i(11,"button",39),f("click",function(){c(e);let r=d(2);return m(r.cancelEditPaymentMethod())}),a(12,"\u041E\u0442\u043C\u0435\u043D\u0430"),n()()()}if(t&2){let e=d(2);o(),M("ngModel",e.selectedPaymentMethod),o(8),u("disabled",e.isSaving),o(),_(" ",e.isSaving?"\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435...":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"," ")}}function Z(t,s){if(t&1){let e=y();i(0,"button",40),f("click",function(){c(e);let r=d(2);return m(r.startEditPaymentMethod())}),v(),i(1,"svg",41),x(2,"path",42)(3,"path",43),n(),a(4," \u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C "),n()}}function $(t,s){if(t&1&&(i(0,"div",45)(1,"app-badge",46),a(2),n(),i(3,"span",47),a(4),n()()),t&2){let e=s.$implicit,l=d(3);o(2),_(" \u041E\u0442\u043E\u0437\u0432\u0430\u043D\u043E: -",l.formatAmount(e.bonusAmount)," "),o(2),_("(",l.getRevokeReasonLabel(e.revokeReason),")")}}function ee(t,s){if(t&1&&(E(0),p(1,$,5,2,"div",44),S()),t&2){let e=d(2);o(),u("ngForOf",e.paymentData.bonusRevocations)}}function te(t,s){if(t&1&&(i(0,"div",48)(1,"app-badge",49),a(2),n()()),t&2){let e=d(3);o(2),_(" \u041D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043E: +",e.formatAmount(e.bonusInfo.bonusGranted)," ")}}function ne(t,s){if(t&1&&(E(0),p(1,te,3,1,"div",23),S()),t&2){let e=d(2);o(),u("ngIf",e.bonusInfo&&e.bonusInfo.bonusGranted>0)}}function ie(t,s){if(t&1&&(i(0,"div",48)(1,"app-badge",50),a(2),n()()),t&2){let e=d(2);o(2),_(" \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E: -",e.formatAmount(e.bonusInfo.bonusUsed)," ")}}function oe(t,s){t&1&&(i(0,"span",51),a(1,"\u041D\u0435\u0442 \u0431\u043E\u043D\u0443\u0441\u043E\u0432"),n())}function ae(t,s){if(t&1&&(i(0,"div",14)(1,"span",15),a(2,"\u0417\u0430\u043C\u0435\u0442\u043A\u0438"),n(),i(3,"span",52),a(4),n()()),t&2){let e=d(2);o(4),C(e.paymentData.notes)}}function re(t,s){if(t&1&&(i(0,"div",14)(1,"span",15),a(2,"\u0422\u0435\u043B\u0435\u0444\u043E\u043D"),n(),i(3,"span",29),a(4),n()()),t&2){let e=d(2);o(4),C(e.bonusInfo==null?null:e.bonusInfo.clientPhone)}}function ue(t,s){if(t&1&&(i(0,"div",14)(1,"span",15),a(2,"Email"),n(),i(3,"span",29),a(4),n()()),t&2){let e=d(2);o(4),C(e.bonusInfo==null?null:e.bonusInfo.clientEmail)}}function de(t,s){if(t&1&&(i(0,"a",26),a(1),n()),t&2){let e=d(2);u("routerLink",O(2,J,e.paymentData.enteredByUserId)),o(),_(" ",e.paymentData.enteredByUsername," ")}}function le(t,s){if(t&1&&(i(0,"span",29),a(1),n()),t&2){let e=d(2);o(),C(e.paymentData.enteredByUsername||"\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D")}}function se(t,s){if(t&1&&(i(0,"div",14)(1,"span",15),a(2,"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0435 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435"),n(),i(3,"span",29),a(4),n()()),t&2){let e=d(2);o(4),C(e.formatDate(e.paymentData.updatedAt))}}function ce(t,s){if(t&1){let e=y();i(0,"div",14)(1,"span",15),a(2,"\u0412\u043E\u0437\u0432\u0440\u0430\u0442 \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),n(),i(3,"span",53),f("click",function(){c(e);let r=d(2);return m(r.openRefundedPayment(r.paymentData.refundedPaymentTxId))}),a(4),n()()}if(t&2){let e=d(2);o(4),_(" ",e.paymentData.refundedPaymentTxId," ")}}function me(t,s){if(t&1){let e=y();i(0,"button",62),f("click",function(){c(e);let r=d(3);return m(r.toggleRefundConfirmation())}),v(),i(1,"svg",41),x(2,"path",63),n(),h(),i(3,"span"),a(4,"\u0412\u043E\u0437\u0432\u0440\u0430\u0442 \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),n()()}if(t&2){let e=d(3);u("disabled",e.isDeleting||e.isRefunding)}}function pe(t,s){t&1&&(i(0,"p"),a(1," \u0411\u043E\u043D\u0443\u0441\u043D\u044B\u0435 \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0438, \u043D\u0430\u0447\u0438\u0441\u043B\u0435\u043D\u043D\u044B\u0435 \u0437\u0430 \u044D\u0442\u043E\u0442 \u043F\u043B\u0430\u0442\u0435\u0436, \u0442\u0430\u043A\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B. "),n())}function fe(t,s){t&1&&(i(0,"p"),a(1," \u041E\u0440\u0438\u0433\u0438\u043D\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u043B\u0430\u0442\u0435\u0436 \u0438 \u0432\u0441\u0435 \u0441\u0432\u044F\u0437\u0430\u043D\u043D\u044B\u0435 \u0431\u043E\u043D\u0443\u0441\u043D\u044B\u0435 \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0438 \u0442\u0430\u043A\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B. "),n())}function _e(t,s){t&1&&(i(0,"p"),a(1," \u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u044F \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430 \u0438 \u0432\u0441\u0435 \u0441\u0432\u044F\u0437\u0430\u043D\u043D\u044B\u0435 \u0431\u043E\u043D\u0443\u0441\u043D\u044B\u0435 \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0438 \u0442\u0430\u043A\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B. "),n())}function ge(t,s){if(t&1){let e=y();i(0,"div",64)(1,"div",65),v(),i(2,"svg",66),x(3,"path",67)(4,"path",68),n(),h(),i(5,"div",69)(6,"strong"),a(7,"\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u043F\u043B\u0430\u0442\u0435\u0436?"),n(),p(8,pe,2,0,"p",22)(9,fe,2,0,"p",22)(10,_e,2,0,"p",22),i(11,"p"),a(12,"\u042D\u0442\u043E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C."),n()()(),i(13,"div",70)(14,"label"),a(15,"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 "),i(16,"strong"),a(17,"\u0443\u0434\u0430\u043B\u0438\u0442\u044C"),n(),a(18," \u0434\u043B\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F:"),n(),i(19,"input",71),w("ngModelChange",function(r){c(e);let g=d(3);return P(g.deleteConfirmText,r)||(g.deleteConfirmText=r),m(r)}),f("keyup.enter",function(){c(e);let r=d(3);return m(r.confirmDelete())}),n()(),i(20,"div",72)(21,"button",73),f("click",function(){c(e);let r=d(3);return m(r.confirmDelete())}),a(22),n(),i(23,"button",74),f("click",function(){c(e);let r=d(3);return m(r.cancelDeleteConfirmation())}),a(24," \u041E\u0442\u043C\u0435\u043D\u0430 "),n()()()}if(t&2){let e=d(3);o(8),u("ngIf",e.isCompletedPayment()&&e.hasGrantedBonuses()),o(),u("ngIf",e.isRefundPayment()),o(),u("ngIf",e.isRefundedPayment()),o(9),M("ngModel",e.deleteConfirmText),o(2),u("disabled",e.isDeleting||!e.isDeleteConfirmValid()),o(),_(" ",e.isDeleting?"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435...":"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"," "),o(),u("disabled",e.isDeleting)}}function xe(t,s){if(t&1){let e=y();i(0,"div",75)(1,"div",76)(2,"label",77),a(3,"\u041F\u0440\u0438\u0447\u0438\u043D\u0430 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430 (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)"),n(),i(4,"textarea",78),w("ngModelChange",function(r){c(e);let g=d(3);return P(g.refundNotes,r)||(g.refundNotes=r),m(r)}),n()(),i(5,"div",72)(6,"button",79),f("click",function(){c(e);let r=d(3);return m(r.confirmRefund())}),a(7),n(),i(8,"button",74),f("click",function(){c(e);let r=d(3);return m(r.showRefundConfirmation=!1)}),a(9," \u041E\u0442\u043C\u0435\u043D\u0430 "),n()()()}if(t&2){let e=d(3);o(4),M("ngModel",e.refundNotes),o(2),u("disabled",e.isRefunding),o(),_(" ",e.isRefunding?"\u0412\u043E\u0437\u0432\u0440\u0430\u0442...":"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C \u0432\u043E\u0437\u0432\u0440\u0430\u0442"," "),o(),u("disabled",e.isRefunding)}}function ye(t,s){if(t&1){let e=y();i(0,"div",54),x(1,"div",55),i(2,"div",56)(3,"button",57),f("click",function(){c(e);let r=d(2);return m(r.toggleDeleteConfirmation())}),v(),i(4,"svg",41),x(5,"path",58),n(),h(),i(6,"span"),a(7,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043B\u0430\u0442\u0435\u0436"),n()(),p(8,me,5,1,"button",59),n(),p(9,ge,25,7,"div",60)(10,xe,10,4,"div",61),n()}if(t&2){let e=d(2);o(3),u("disabled",e.isDeleting||e.isRefunding),o(5),u("ngIf",e.canRefund()),o(),u("ngIf",e.showDeleteConfirmation),o(),u("ngIf",e.showRefundConfirmation)}}function Ce(t,s){if(t&1&&(i(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),a(4,"ID \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),n(),i(5,"span",7),a(6),n()(),i(7,"div",8)(8,"app-badge",9),a(9),n()()(),i(10,"div",10)(11,"div",11)(12,"div",12)(13,"h3",13),a(14,"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043F\u043B\u0430\u0442\u0435\u0436\u0435"),n(),i(15,"div",14)(16,"span",15),a(17,"\u0421\u0443\u043C\u043C\u0430"),n(),i(18,"span",16),a(19),n()(),i(20,"div",14)(21,"span",15),a(22,"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B"),n(),i(23,"div",17),p(24,K,1,1,"app-badge",18)(25,Q,13,3,"div",19)(26,Z,5,0,"button",20),n()(),i(27,"div",14)(28,"span",15),a(29,"\u0411\u043E\u043D\u0443\u0441\u044B"),n(),i(30,"div",21),p(31,ee,2,1,"ng-container",22)(32,ne,2,1,"ng-container",22)(33,ie,3,1,"div",23)(34,oe,2,0,"span",24),n()(),p(35,ae,5,1,"div",25),n()(),i(36,"div",11)(37,"div",12)(38,"h3",13),a(39,"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043A\u043B\u0438\u0435\u043D\u0442\u0435"),n(),i(40,"div",14)(41,"span",15),a(42,"\u041A\u043B\u0438\u0435\u043D\u0442"),n(),i(43,"a",26),a(44),n()(),p(45,re,5,1,"div",25)(46,ue,5,1,"div",25),n(),i(47,"div",12)(48,"h3",13),a(49,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F"),n(),i(50,"div",14)(51,"span",15),a(52,"\u0418\u043D\u0438\u0446\u0438\u0430\u0442\u043E\u0440"),n(),p(53,de,2,4,"a",27)(54,le,2,1,"span",28),n(),i(55,"div",14)(56,"span",15),a(57,"\u0414\u0430\u0442\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F"),n(),i(58,"span",29),a(59),n()(),p(60,se,5,1,"div",25)(61,ce,5,1,"div",25),n()()(),p(62,ye,11,4,"div",30),n()),t&2){let e=d();o(6),C(e.paymentData.txId),o(2),u("badgeType",e.getStatusBadgeType())("icon",e.getStatusIcon()),o(),_(" ",e.getStatusLabel()," "),o(10),_("",e.formatAmount(e.paymentData.amount)," \u20B8"),o(5),u("ngIf",!e.isEditingPaymentMethod),o(),u("ngIf",e.isEditingPaymentMethod),o(),u("ngIf",!e.isEditingPaymentMethod&&!e.isSaving),o(5),u("ngIf",e.paymentData.bonusRevocations&&e.paymentData.bonusRevocations.length>0),o(),u("ngIf",!e.paymentData.bonusRevocations||e.paymentData.bonusRevocations.length===0),o(),u("ngIf",e.bonusInfo&&e.bonusInfo.bonusUsed>0),o(),u("ngIf",(!e.bonusInfo||e.bonusInfo.bonusGranted===0&&e.bonusInfo.bonusUsed===0)&&(!e.paymentData.bonusRevocations||e.paymentData.bonusRevocations.length===0)),o(),u("ngIf",e.paymentData.notes),o(8),u("routerLink",O(23,X,e.paymentData.clientId)),o(),_(" ",e.paymentData.clientName," "),o(),u("ngIf",e.bonusInfo==null?null:e.bonusInfo.clientPhone),o(),u("ngIf",e.bonusInfo==null?null:e.bonusInfo.clientEmail),o(7),u("ngIf",e.paymentData.enteredByUserId),o(),u("ngIf",!e.paymentData.enteredByUserId),o(5),C(e.formatDate(e.paymentData.createdAt)),o(),u("ngIf",e.paymentData.updatedAt&&e.paymentData.updatedAt!==e.paymentData.createdAt),o(),u("ngIf",e.paymentData.refundedPaymentTxId),o(),u("ngIf",e.canShowActions())}}function ve(t,s){t&1&&(i(0,"div",80),x(1,"div",81),i(2,"span"),a(3,"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445..."),n()())}var ze=(()=>{class t{paymentsService=D(Y);toastService=D(A);visible=!1;paymentTxId=null;paymentSearchResult=null;visibleChange=new b;paymentUpdated=new b;paymentDeleted=new b;refundedPaymentClick=new b;paymentData=null;bonusInfo=null;isLoading=!1;isEditingPaymentMethod=!1;selectedPaymentMethod="CASH";isSaving=!1;showDeleteConfirmation=!1;showRefundConfirmation=!1;isDeleting=!1;isRefunding=!1;refundNotes="";deleteConfirmText="";ngOnInit(){this.paymentSearchResult&&this.loadPaymentFromSearchResult()}ngOnChanges(e){e.visible&&e.visible.currentValue&&this.paymentTxId&&this.loadPayment(),e.paymentSearchResult&&e.paymentSearchResult.currentValue&&this.loadPaymentFromSearchResult()}loadPayment(){this.paymentTxId&&(this.isLoading=!0,this.paymentsService.getPaymentByTxId(this.paymentTxId).subscribe({next:e=>{this.paymentData=e,this.selectedPaymentMethod=e.paymentMethod||"CASH",this.isLoading=!1,this.paymentSearchResult&&this.paymentSearchResult.txId===e.txId&&(this.bonusInfo=this.paymentSearchResult)},error:e=>{this.toastService.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u043F\u043B\u0430\u0442\u0435\u0436\u0430"),console.error("Error loading payment:",e),this.isLoading=!1}}))}loadPaymentFromSearchResult(){this.paymentSearchResult&&(this.bonusInfo=this.paymentSearchResult,this.paymentSearchResult.txId&&(this.paymentTxId=this.paymentSearchResult.txId,this.loadPayment()))}startEditPaymentMethod(){this.isEditingPaymentMethod=!0,this.selectedPaymentMethod=this.paymentData?.paymentMethod||"CASH"}cancelEditPaymentMethod(){this.isEditingPaymentMethod=!1,this.selectedPaymentMethod=this.paymentData?.paymentMethod||"CASH"}savePaymentMethod(){if(!this.paymentData||!this.paymentTxId)return;this.isSaving=!0;let e={paymentMethod:this.selectedPaymentMethod};this.paymentsService.updatePaymentMethod(this.paymentTxId,e).subscribe({next:l=>{this.paymentData=l,this.isEditingPaymentMethod=!1,this.isSaving=!1,this.toastService.success("\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D"),this.paymentUpdated.emit()},error:l=>{this.toastService.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0441\u043F\u043E\u0441\u043E\u0431\u0430 \u043E\u043F\u043B\u0430\u0442\u044B"),console.error("Error updating payment method:",l),this.isSaving=!1}})}openRefundedPayment(e){this.refundedPaymentClick.emit(e)}onClose(){this.visible=!1,this.visibleChange.emit(!1),this.isEditingPaymentMethod=!1,this.showDeleteConfirmation=!1,this.showRefundConfirmation=!1,this.refundNotes="",this.deleteConfirmText=""}canShowActions(){return!!this.paymentData}isRefundedPayment(){return this.paymentData?this.paymentData.status?.toUpperCase()==="REFUNDED":!1}canRefund(){return this.paymentData?this.isCompletedPayment():!1}isCompletedPayment(){return this.paymentData?this.paymentData.status?.toUpperCase()==="COMPLETED":!1}isRefundPayment(){return this.paymentData?this.paymentData.status?.toUpperCase()==="REFUND":!1}hasGrantedBonuses(){return this.bonusInfo?this.bonusInfo.bonusGranted>0:!1}toggleDeleteConfirmation(){this.showDeleteConfirmation=!this.showDeleteConfirmation,this.showRefundConfirmation=!1,this.showDeleteConfirmation||(this.deleteConfirmText="")}cancelDeleteConfirmation(){this.showDeleteConfirmation=!1,this.deleteConfirmText=""}isDeleteConfirmValid(){return this.deleteConfirmText.toLowerCase().trim()==="\u0443\u0434\u0430\u043B\u0438\u0442\u044C"}toggleRefundConfirmation(){this.showRefundConfirmation=!this.showRefundConfirmation,this.showDeleteConfirmation=!1}confirmDelete(){!this.paymentData?.txId||!this.isDeleteConfirmValid()||(this.isDeleting=!0,this.paymentsService.deletePayment(this.paymentData.txId).subscribe({next:()=>{this.toastService.success("\u041F\u043B\u0430\u0442\u0435\u0436 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D"),this.paymentDeleted.emit(this.paymentData.txId),this.isDeleting=!1,this.deleteConfirmText="",this.onClose()},error:e=>{let l=e.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u043F\u043B\u0430\u0442\u0435\u0436\u0430";this.toastService.error(l),this.isDeleting=!1}}))}confirmRefund(){this.paymentData?.txId&&(this.isRefunding=!0,this.paymentsService.refundPayment(this.paymentData.txId,{notes:this.refundNotes}).subscribe({next:()=>{this.toastService.success("\u041F\u043B\u0430\u0442\u0435\u0436 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0435\u043D"),this.paymentUpdated.emit(),this.isRefunding=!1,this.showRefundConfirmation=!1,this.refundNotes="",this.loadPayment()},error:e=>{let l=e.error?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0435 \u043F\u043B\u0430\u0442\u0435\u0436\u0430";this.toastService.error(l),this.isRefunding=!1}}))}formatAmount(e){return new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}formatDate(e){let l=new Date(e);return new Intl.DateTimeFormat("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(l)}getPaymentMethodForBadge(){if(!this.paymentData?.paymentMethod)return null;let e=this.paymentData.paymentMethod.toUpperCase();return e==="CASH"||e==="CARD"||e==="TRANSFER"?e:null}getPaymentMethodLabel(e){return e?{CASH:"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u0435",CARD:"\u041A\u0430\u0440\u0442\u0430",TRANSFER:"\u041F\u0435\u0440\u0435\u0432\u043E\u0434"}[e.toUpperCase()]||e:"\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D"}getRevokeReasonLabel(e){return e?{PAYMENT_REFUND:"\u0412\u043E\u0437\u0432\u0440\u0430\u0442 \u043F\u043B\u0430\u0442\u0435\u0436\u0430",EXPIRED:"\u0418\u0441\u0442\u0435\u043A \u0441\u0440\u043E\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F",MANUAL:"\u0420\u0443\u0447\u043D\u043E\u0439 \u043E\u0442\u0437\u044B\u0432"}[e]||e:"\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430"}getStatusLabel(){if(!this.paymentData)return"";let e=this.paymentData.status;return e==="COMPLETED"?"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E":e==="PENDING"?"\u0412 \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u0438":e==="CANCELLED"?"\u041E\u0442\u043C\u0435\u043D\u0435\u043D\u043E":e==="REFUNDED"?"\u0412\u043E\u0437\u0432\u0440\u0430\u0449\u0435\u043D\u043E":e}getStatusBadgeType(){return this.paymentData&&this.paymentData.status==="REFUNDED"?"refund":"payment"}getStatusIcon(){return this.paymentData&&this.paymentData.status==="REFUNDED"?"refund":"payment"}static \u0275fac=function(l){return new(l||t)};static \u0275cmp=k({type:t,selectors:[["app-payment-view-modal"]],inputs:{visible:"visible",paymentTxId:"paymentTxId",paymentSearchResult:"paymentSearchResult"},outputs:{visibleChange:"visibleChange",paymentUpdated:"paymentUpdated",paymentDeleted:"paymentDeleted",refundedPaymentClick:"refundedPaymentClick"},features:[I],decls:3,vars:5,consts:[["title","\u0414\u0435\u0442\u0430\u043B\u0438 \u043F\u043B\u0430\u0442\u0435\u0436\u0430",3,"closed","visible","showCloseButton","size"],["class","payment-view-content",4,"ngIf"],["class","loading-state",4,"ngIf"],[1,"payment-view-content"],[1,"payment-header"],[1,"payment-id-section"],[1,"payment-id-label"],[1,"payment-id-value"],[1,"payment-status"],["size","medium",3,"badgeType","icon"],[1,"payment-info-grid"],[1,"info-column"],[1,"info-section"],[1,"section-title"],[1,"info-item"],[1,"info-label"],[1,"info-value","amount"],[1,"payment-method-section"],["badgeType","paymentMethod","size","medium",3,"paymentMethod",4,"ngIf"],["class","method-selector",4,"ngIf"],["class","edit-method-btn",3,"click",4,"ngIf"],[1,"bonus-info-section"],[4,"ngIf"],["class","bonus-item",4,"ngIf"],["class","bonus-none",4,"ngIf"],["class","info-item",4,"ngIf"],[1,"info-value","link",3,"routerLink"],["class","info-value link",3,"routerLink",4,"ngIf"],["class","info-value",4,"ngIf"],[1,"info-value"],["class","actions-section",4,"ngIf"],["badgeType","paymentMethod","size","medium",3,"paymentMethod"],[1,"method-selector"],[1,"method-select",3,"ngModelChange","ngModel"],["value","CASH"],["value","CARD"],["value","TRANSFER"],[1,"method-actions"],[1,"method-btn","save",3,"click","disabled"],[1,"method-btn","cancel",3,"click"],[1,"edit-method-btn",3,"click"],["viewBox","0 0 24 24","fill","none"],["d","M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7","stroke","currentColor","stroke-width","2"],["d","M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z","stroke","currentColor","stroke-width","2"],["class","bonus-item revoked",4,"ngFor","ngForOf"],[1,"bonus-item","revoked"],["badgeType","danger","size","small","icon","refund"],[1,"revoke-reason"],[1,"bonus-item"],["badgeType","bonusGranted","size","small","icon","star"],["badgeType","bonusUsed","size","small","icon","check"],[1,"bonus-none"],[1,"info-value","notes"],[1,"info-value","refund-link",3,"click"],[1,"actions-section"],[1,"actions-divider"],[1,"actions-buttons"],[1,"action-btn","delete-btn",3,"click","disabled"],["d","M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14zM10 11v6M14 11v6","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["class","action-btn refund-btn",3,"disabled","click",4,"ngIf"],["class","confirmation-area delete-confirmation",4,"ngIf"],["class","confirmation-area refund-confirmation",4,"ngIf"],[1,"action-btn","refund-btn",3,"click","disabled"],["d","M3 10h10a5 5 0 010 10H9M3 10l4-4M3 10l4 4","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"confirmation-area","delete-confirmation"],[1,"confirmation-warning"],["viewBox","0 0 24 24","fill","none",1,"warning-icon"],["d","M12 9v4M12 17h.01","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["d","M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z","stroke","currentColor","stroke-width","2"],[1,"warning-text"],[1,"delete-confirm-input"],["type","text","placeholder","\u0443\u0434\u0430\u043B\u0438\u0442\u044C",1,"confirm-text-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"confirmation-actions"],[1,"confirm-btn","danger",3,"click","disabled"],[1,"confirm-btn","cancel",3,"click","disabled"],[1,"confirmation-area","refund-confirmation"],[1,"refund-form"],[1,"refund-label"],["placeholder","\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043F\u0440\u0438\u0447\u0438\u043D\u0443 \u0432\u043E\u0437\u0432\u0440\u0430\u0442\u0430...","rows","2",1,"refund-input",3,"ngModelChange","ngModel"],[1,"confirm-btn","warning",3,"click","disabled"],[1,"loading-state"],[1,"loader"]],template:function(l,r){l&1&&(i(0,"app-modal",0),f("closed",function(){return r.onClose()}),p(1,Ce,63,25,"div",1)(2,ve,4,0,"div",2),n()),l&2&&(u("visible",r.visible)("showCloseButton",!0)("size","large"),o(),u("ngIf",r.paymentData),o(),u("ngIf",r.isLoading))},dependencies:[R,V,T,W,H,G,z,U,N,L,F,B,j,q],styles:[".payment-view-content[_ngcontent-%COMP%]{padding:0}.payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:2px solid #f1f5f9;margin-bottom:2rem}.payment-id-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.payment-id-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.5px}.payment-id-value[_ngcontent-%COMP%]{font-family:Courier New,Monaco,Menlo,Consolas,monospace;font-size:1.5rem;font-weight:700;color:#1f2937;letter-spacing:.5px}.payment-info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem;padding:0 1.5rem 1.5rem}.info-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#1f2937;margin:0 0 .5rem;padding-bottom:.75rem;border-bottom:1px solid #e2e8f0}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.info-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.3px}.info-value[_ngcontent-%COMP%]{font-size:1rem;color:#1f2937;font-weight:500}.info-value.amount[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#16a34a}.info-value.link[_ngcontent-%COMP%]{color:#16a34a;text-decoration:none;cursor:pointer;transition:color .2s}.info-value.link[_ngcontent-%COMP%]:hover{color:#14532d;text-decoration:underline}.info-value.refund-link[_ngcontent-%COMP%]{color:#dc2626;cursor:pointer;text-decoration:underline}.info-value.refund-link[_ngcontent-%COMP%]:hover{color:#991b1b}.info-value.notes[_ngcontent-%COMP%]{padding:.75rem;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0;white-space:pre-wrap;word-wrap:break-word}.revocations-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.revocation-item[_ngcontent-%COMP%]{padding:1rem;background:#fef2f2;border:1px solid #fecaca;border-radius:8px;border-left:4px solid #dc2626}.revocation-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}.revocation-amount[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#dc2626}.revocation-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:12px;font-size:.75rem;font-weight:600}.revocation-badge.revoked[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.revocation-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.revocation-detail-item[_ngcontent-%COMP%]{display:flex;gap:.5rem;font-size:.875rem}.revocation-detail-item[_ngcontent-%COMP%]   .detail-label[_ngcontent-%COMP%]{color:#64748b;font-weight:500;min-width:120px}.revocation-detail-item[_ngcontent-%COMP%]   .detail-value[_ngcontent-%COMP%]{color:#1e293b;flex:1}.revocation-detail-item[_ngcontent-%COMP%]   .detail-value.refund-link[_ngcontent-%COMP%]{color:#dc2626;cursor:pointer;text-decoration:underline}.revocation-detail-item[_ngcontent-%COMP%]   .detail-value.refund-link[_ngcontent-%COMP%]:hover{color:#991b1b}.payment-method-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}.edit-method-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.35rem .65rem;background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;color:#64748b;font-size:.75rem;font-weight:500;cursor:pointer;transition:all .2s}.edit-method-btn[_ngcontent-%COMP%]:hover{background:#f1f5f9;border-color:#cbd5e1;color:#1f2937}.edit-method-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:12px;height:12px}.method-selector[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;width:100%}.method-select[_ngcontent-%COMP%]{padding:.75rem;border:2px solid #e2e8f0;border-radius:8px;font-size:.875rem;background:#fff;color:#1f2937;cursor:pointer;transition:all .2s}.method-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#16a34a;box-shadow:0 0 0 3px #16a34a1a}.method-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.method-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:8px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s;border:none}.method-btn.save[_ngcontent-%COMP%]{background:#16a34a;color:#fff}.method-btn.save[_ngcontent-%COMP%]:hover:not(:disabled){background:#14532d}.method-btn.save[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}.method-btn.cancel[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b;border:1px solid #e2e8f0}.method-btn.cancel[_ngcontent-%COMP%]:hover{background:#e2e8f0}.bonus-info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.bonus-item[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem}.bonus-item.revoked[_ngcontent-%COMP%]{flex-direction:row}.revoke-reason[_ngcontent-%COMP%]{font-size:.75rem;color:#dc2626;font-style:italic}.bonus-none[_ngcontent-%COMP%]{color:#94a3b8;font-size:.875rem}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;gap:1rem;color:#64748b}.loader[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #e2e8f0;border-top-color:#16a34a;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.actions-section[_ngcontent-%COMP%]{margin-top:1rem;padding:0 1.5rem 1.5rem}.actions-divider[_ngcontent-%COMP%]{height:2px;background:#f1f5f9;margin-bottom:1.5rem}.actions-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.action-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.5rem .875rem;border-radius:8px;font-size:.8rem;font-weight:600;cursor:pointer;transition:all .2s;border:1.5px solid transparent}.action-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:15px;height:15px}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.action-btn.delete-btn[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626;border-color:#fecaca}.action-btn.delete-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#fee2e2;border-color:#f87171}.action-btn.refund-btn[_ngcontent-%COMP%]{background:#fefce8;color:#ca8a04;border-color:#fef08a}.action-btn.refund-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#fef9c3;border-color:#facc15}.confirmation-area[_ngcontent-%COMP%]{margin-top:1.5rem;padding:1.25rem;border-radius:12px;animation:_ngcontent-%COMP%_slideDown .2s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.delete-confirmation[_ngcontent-%COMP%]{background:#fef2f2;border:1px solid #fecaca}.refund-confirmation[_ngcontent-%COMP%]{background:#fefce8;border:1px solid #fef08a}.confirmation-warning[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1.25rem}.warning-icon[_ngcontent-%COMP%]{width:24px;height:24px;color:#dc2626;flex-shrink:0;margin-top:2px}.refund-confirmation[_ngcontent-%COMP%]   .warning-icon[_ngcontent-%COMP%]{color:#ca8a04}.warning-text[_ngcontent-%COMP%]{flex:1}.warning-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#991b1b;margin-bottom:.5rem}.refund-confirmation[_ngcontent-%COMP%]   .warning-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#854d0e}.warning-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0 0;font-size:.875rem;color:#b91c1c}.refund-confirmation[_ngcontent-%COMP%]   .warning-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#a16207}.delete-confirm-input[_ngcontent-%COMP%]{margin-bottom:1rem}.delete-confirm-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.875rem;color:#991b1b;margin-bottom:.5rem}.delete-confirm-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700;color:#7f1d1d}.confirm-text-input[_ngcontent-%COMP%]{width:100%;padding:.625rem .75rem;border:1px solid #fecaca;border-radius:6px;font-size:.875rem;font-family:inherit;background:#fff}.confirm-text-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#f87171;box-shadow:0 0 0 3px #f8717126}.refund-form[_ngcontent-%COMP%]{margin-bottom:1.25rem}.refund-label[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:600;color:#854d0e;margin-bottom:.5rem}.refund-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #fef08a;border-radius:8px;font-size:.875rem;font-family:inherit;resize:vertical;background:#fff}.refund-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#facc15;box-shadow:0 0 0 3px #facc1533}.confirmation-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.confirm-btn[_ngcontent-%COMP%]{padding:.625rem 1.25rem;border-radius:8px;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s;border:none}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.confirm-btn.danger[_ngcontent-%COMP%]{background:#dc2626;color:#fff}.confirm-btn.danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#b91c1c}.confirm-btn.warning[_ngcontent-%COMP%]{background:#ca8a04;color:#fff}.confirm-btn.warning[_ngcontent-%COMP%]:hover:not(:disabled){background:#a16207}.confirm-btn.cancel[_ngcontent-%COMP%]{background:#fff;color:#64748b;border:1px solid #e2e8f0}.confirm-btn.cancel[_ngcontent-%COMP%]:hover:not(:disabled){background:#f8fafc}@media (max-width: 768px){.payment-info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1.5rem;padding:0 1rem 1rem}.payment-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.actions-section[_ngcontent-%COMP%]{padding:0 1rem 1rem}.actions-buttons[_ngcontent-%COMP%]{flex-direction:column}.action-btn[_ngcontent-%COMP%]{width:100%;justify-content:center}.confirmation-actions[_ngcontent-%COMP%]{flex-direction:column}.confirm-btn[_ngcontent-%COMP%]{width:100%}}"]})}return t})();export{ze as a};
